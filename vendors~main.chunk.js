(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(t,e,n){"use strict";n.r(e),n.d(e,"AABB",(function(){return c})),n.d(e,"ArrayCollisionMatrix",(function(){return p})),n.d(e,"BODY_SLEEP_STATES",(function(){return B})),n.d(e,"BODY_TYPES",(function(){return T})),n.d(e,"Body",(function(){return F})),n.d(e,"Box",(function(){return P})),n.d(e,"Broadphase",(function(){return G})),n.d(e,"COLLISION_TYPES",(function(){return br})),n.d(e,"ConeTwistConstraint",(function(){return de})),n.d(e,"Constraint",(function(){return jt})),n.d(e,"ContactEquation",(function(){return Yt})),n.d(e,"ContactMaterial",(function(){return ye})),n.d(e,"ConvexPolyhedron",(function(){return x})),n.d(e,"Cylinder",(function(){return yn})),n.d(e,"DistanceConstraint",(function(){return he})),n.d(e,"Equation",(function(){return Dt})),n.d(e,"EventTarget",(function(){return f})),n.d(e,"FrictionEquation",(function(){return ge})),n.d(e,"GSSolver",(function(){return er})),n.d(e,"GridBroadphase",(function(){return Z})),n.d(e,"Heightfield",(function(){return Cn})),n.d(e,"HingeConstraint",(function(){return ve})),n.d(e,"JacobianElement",(function(){return Nt})),n.d(e,"LockConstraint",(function(){return pe})),n.d(e,"Mat3",(function(){return i})),n.d(e,"Material",(function(){return xe})),n.d(e,"NaiveBroadphase",(function(){return J})),n.d(e,"Narrowphase",(function(){return gr})),n.d(e,"ObjectCollisionMatrix",(function(){return r})),n.d(e,"Particle",(function(){return xn})),n.d(e,"Plane",(function(){return An})),n.d(e,"PointToPointConstraint",(function(){return ie})),n.d(e,"Pool",(function(){return vr})),n.d(e,"Quaternion",(function(){return v})),n.d(e,"RAY_MODES",(function(){return lt})),n.d(e,"Ray",(function(){return ut})),n.d(e,"RaycastResult",(function(){return tt})),n.d(e,"RaycastVehicle",(function(){return Oe})),n.d(e,"RigidVehicle",(function(){return cn})),n.d(e,"RotationalEquation",(function(){return le})),n.d(e,"RotationalMotorEquation",(function(){return fe})),n.d(e,"SAPBroadphase",(function(){return Ot})),n.d(e,"SHAPE_TYPES",(function(){return g})),n.d(e,"SPHSystem",(function(){return pn})),n.d(e,"Shape",(function(){return w})),n.d(e,"Solver",(function(){return tr})),n.d(e,"Sphere",(function(){return un})),n.d(e,"SplitSolver",(function(){return or})),n.d(e,"Spring",(function(){return Ae})),n.d(e,"Transform",(function(){return _})),n.d(e,"Trimesh",(function(){return jn})),n.d(e,"Vec3",(function(){return s})),n.d(e,"Vec3Pool",(function(){return mr})),n.d(e,"WheelInfo",(function(){return ze})),n.d(e,"World",(function(){return qi}));class r{constructor(){this.matrix={}}get(t,e){let{id:n}=t,{id:r}=e;if(r>n){const t=r;r=n,n=t}return`${n}-${r}`in this.matrix}set(t,e,n){let{id:r}=t,{id:i}=e;if(i>r){const t=i;i=r,r=t}n?this.matrix[`${r}-${i}`]=!0:delete this.matrix[`${r}-${i}`]}reset(){this.matrix={}}setNumObjects(t){}}class i{constructor(t){void 0===t&&(t=[0,0,0,0,0,0,0,0,0]),this.elements=t}identity(){const t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}setZero(){const t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0}setTrace(t){const e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z}getTrace(t){void 0===t&&(t=new s);const e=this.elements;return t.x=e[0],t.y=e[4],t.z=e[8],t}vmult(t,e){void 0===e&&(e=new s);const n=this.elements,r=t.x,i=t.y,o=t.z;return e.x=n[0]*r+n[1]*i+n[2]*o,e.y=n[3]*r+n[4]*i+n[5]*o,e.z=n[6]*r+n[7]*i+n[8]*o,e}smult(t){for(let e=0;e<this.elements.length;e++)this.elements[e]*=t}mmult(t,e){void 0===e&&(e=new i);const n=this.elements,r=t.elements,o=e.elements,s=n[0],a=n[1],l=n[2],u=n[3],c=n[4],d=n[5],h=n[6],p=n[7],f=n[8],v=r[0],m=r[1],b=r[2],g=r[3],w=r[4],_=r[5],y=r[6],x=r[7],A=r[8];return o[0]=s*v+a*g+l*y,o[1]=s*m+a*w+l*x,o[2]=s*b+a*_+l*A,o[3]=u*v+c*g+d*y,o[4]=u*m+c*w+d*x,o[5]=u*b+c*_+d*A,o[6]=h*v+p*g+f*y,o[7]=h*m+p*w+f*x,o[8]=h*b+p*_+f*A,e}scale(t,e){void 0===e&&(e=new i);const n=this.elements,r=e.elements;for(let e=0;3!==e;e++)r[3*e+0]=t.x*n[3*e+0],r[3*e+1]=t.y*n[3*e+1],r[3*e+2]=t.z*n[3*e+2];return e}solve(t,e){void 0===e&&(e=new s);const n=[];let r,i;for(r=0;r<12;r++)n.push(0);for(r=0;r<3;r++)for(i=0;i<3;i++)n[r+4*i]=this.elements[r+3*i];n[3]=t.x,n[7]=t.y,n[11]=t.z;let o=3;const a=o;let l;let u;do{if(r=a-o,0===n[r+4*r])for(i=r+1;i<a;i++)if(0!==n[r+4*i]){l=4;do{u=4-l,n[u+4*r]+=n[u+4*i]}while(--l);break}if(0!==n[r+4*r])for(i=r+1;i<a;i++){const t=n[r+4*i]/n[r+4*r];l=4;do{u=4-l,n[u+4*i]=u<=r?0:n[u+4*i]-n[u+4*r]*t}while(--l)}}while(--o);if(e.z=n[11]/n[10],e.y=(n[7]-n[6]*e.z)/n[5],e.x=(n[3]-n[2]*e.z-n[1]*e.y)/n[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw`Could not solve equation! Got x=[${e.toString()}], b=[${t.toString()}], A=[${this.toString()}]`;return e}e(t,e,n){if(void 0===n)return this.elements[e+3*t];this.elements[e+3*t]=n}copy(t){for(let e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this}toString(){let t="";for(let e=0;e<9;e++)t+=this.elements[e]+",";return t}reverse(t){void 0===t&&(t=new i);const e=o;let n,r;for(n=0;n<3;n++)for(r=0;r<3;r++)e[n+6*r]=this.elements[n+3*r];e[3]=1,e[9]=0,e[15]=0,e[4]=0,e[10]=1,e[16]=0,e[5]=0,e[11]=0,e[17]=1;let s=3;const a=s;let l;let u;do{if(n=a-s,0===e[n+6*n])for(r=n+1;r<a;r++)if(0!==e[n+6*r]){l=6;do{u=6-l,e[u+6*n]+=e[u+6*r]}while(--l);break}if(0!==e[n+6*n])for(r=n+1;r<a;r++){const t=e[n+6*r]/e[n+6*n];l=6;do{u=6-l,e[u+6*r]=u<=n?0:e[u+6*r]-e[u+6*n]*t}while(--l)}}while(--s);n=2;do{r=n-1;do{const t=e[n+6*r]/e[n+6*n];l=6;do{u=6-l,e[u+6*r]=e[u+6*r]-e[u+6*n]*t}while(--l)}while(r--)}while(--n);n=2;do{const t=1/e[n+6*n];l=6;do{u=6-l,e[u+6*n]=e[u+6*n]*t}while(--l)}while(n--);n=2;do{r=2;do{if(u=e[3+r+6*n],isNaN(u)||u===1/0)throw`Could not reverse! A=[${this.toString()}]`;t.e(n,r,u)}while(r--)}while(n--);return t}setRotationFromQuaternion(t){const e=t.x,n=t.y,r=t.z,i=t.w,o=e+e,s=n+n,a=r+r,l=e*o,u=e*s,c=e*a,d=n*s,h=n*a,p=r*a,f=i*o,v=i*s,m=i*a,b=this.elements;return b[0]=1-(d+p),b[1]=u-m,b[2]=c+v,b[3]=u+m,b[4]=1-(l+p),b[5]=h-f,b[6]=c-v,b[7]=h+f,b[8]=1-(l+d),this}transpose(t){void 0===t&&(t=new i);const e=this.elements,n=t.elements;let r;return n[0]=e[0],n[4]=e[4],n[8]=e[8],r=e[1],n[1]=e[3],n[3]=r,r=e[2],n[2]=e[6],n[6]=r,r=e[5],n[5]=e[7],n[7]=r,t}}const o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class s{constructor(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}cross(t,e){void 0===e&&(e=new s);const n=t.x,r=t.y,i=t.z,o=this.x,a=this.y,l=this.z;return e.x=a*i-l*r,e.y=l*n-o*i,e.z=o*r-a*n,e}set(t,e,n){return this.x=t,this.y=e,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(t,e){if(!e)return new s(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z}vsub(t,e){if(!e)return new s(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z}crossmat(){return new i([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const t=this.x,e=this.y,n=this.z,r=Math.sqrt(t*t+e*e+n*n);if(r>0){const t=1/r;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return r}unit(t){void 0===t&&(t=new s);const e=this.x,n=this.y,r=this.z;let i=Math.sqrt(e*e+n*n+r*r);return i>0?(i=1/i,t.x=e*i,t.y=n*i,t.z=r*i):(t.x=1,t.y=0,t.z=0),t}length(){const t=this.x,e=this.y,n=this.z;return Math.sqrt(t*t+e*e+n*n)}lengthSquared(){return this.dot(this)}distanceTo(t){const e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,s=t.z;return Math.sqrt((i-e)*(i-e)+(o-n)*(o-n)+(s-r)*(s-r))}distanceSquared(t){const e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,s=t.z;return(i-e)*(i-e)+(o-n)*(o-n)+(s-r)*(s-r)}scale(t,e){void 0===e&&(e=new s);const n=this.x,r=this.y,i=this.z;return e.x=t*n,e.y=t*r,e.z=t*i,e}vmul(t,e){return void 0===e&&(e=new s),e.x=t.x*this.x,e.y=t.y*this.y,e.z=t.z*this.z,e}addScaledVector(t,e,n){return void 0===n&&(n=new s),n.x=this.x+t*e.x,n.y=this.y+t*e.y,n.z=this.z+t*e.z,n}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(t){return void 0===t&&(t=new s),t.x=-this.x,t.y=-this.y,t.z=-this.z,t}tangents(t,e){const n=this.length();if(n>0){const r=a,i=1/n;r.set(this.x*i,this.y*i,this.z*i);const o=l;Math.abs(r.x)<.9?(o.set(1,0,0),r.cross(o,t)):(o.set(0,1,0),r.cross(o,t)),r.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}lerp(t,e,n){const r=this.x,i=this.y,o=this.z;n.x=r+(t.x-r)*e,n.y=i+(t.y-i)*e,n.z=o+(t.z-o)*e}almostEquals(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)}almostZero(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)}isAntiparallelTo(t,e){return this.negate(u),u.almostEquals(t,e)}clone(){return new s(this.x,this.y,this.z)}}s.ZERO=new s(0,0,0),s.UNIT_X=new s(1,0,0),s.UNIT_Y=new s(0,1,0),s.UNIT_Z=new s(0,0,1);const a=new s,l=new s,u=new s;class c{constructor(t){void 0===t&&(t={}),this.lowerBound=new s,this.upperBound=new s,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}setFromPoints(t,e,n,r){const i=this.lowerBound,o=this.upperBound,s=n;i.copy(t[0]),s&&s.vmult(i,i),o.copy(i);for(let e=1;e<t.length;e++){let n=t[e];s&&(s.vmult(n,d),n=d),n.x>o.x&&(o.x=n.x),n.x<i.x&&(i.x=n.x),n.y>o.y&&(o.y=n.y),n.y<i.y&&(i.y=n.y),n.z>o.z&&(o.z=n.z),n.z<i.z&&(i.z=n.z)}return e&&(e.vadd(i,i),e.vadd(o,o)),r&&(i.x-=r,i.y-=r,i.z-=r,o.x+=r,o.y+=r,o.z+=r),this}copy(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this}clone(){return(new c).copy(this)}extend(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)}overlaps(t){const e=this.lowerBound,n=this.upperBound,r=t.lowerBound,i=t.upperBound,o=r.x<=n.x&&n.x<=i.x||e.x<=i.x&&i.x<=n.x,s=r.y<=n.y&&n.y<=i.y||e.y<=i.y&&i.y<=n.y,a=r.z<=n.z&&n.z<=i.z||e.z<=i.z&&i.z<=n.z;return o&&s&&a}volume(){const t=this.lowerBound,e=this.upperBound;return(e.x-t.x)*(e.y-t.y)*(e.z-t.z)}contains(t){const e=this.lowerBound,n=this.upperBound,r=t.lowerBound,i=t.upperBound;return e.x<=r.x&&n.x>=i.x&&e.y<=r.y&&n.y>=i.y&&e.z<=r.z&&n.z>=i.z}getCorners(t,e,n,r,i,o,s,a){const l=this.lowerBound,u=this.upperBound;t.copy(l),e.set(u.x,l.y,l.z),n.set(u.x,u.y,l.z),r.set(l.x,u.y,u.z),i.set(u.x,l.y,u.z),o.set(l.x,u.y,l.z),s.set(l.x,l.y,u.z),a.copy(u)}toLocalFrame(t,e){const n=h,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],l=n[5],u=n[6],c=n[7];this.getCorners(r,i,o,s,a,l,u,c);for(let e=0;8!==e;e++){const r=n[e];t.pointToLocal(r,r)}return e.setFromPoints(n)}toWorldFrame(t,e){const n=h,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],l=n[5],u=n[6],c=n[7];this.getCorners(r,i,o,s,a,l,u,c);for(let e=0;8!==e;e++){const r=n[e];t.pointToWorld(r,r)}return e.setFromPoints(n)}overlapsRay(t){const{direction:e,from:n}=t,r=1/e.x,i=1/e.y,o=1/e.z,s=(this.lowerBound.x-n.x)*r,a=(this.upperBound.x-n.x)*r,l=(this.lowerBound.y-n.y)*i,u=(this.upperBound.y-n.y)*i,c=(this.lowerBound.z-n.z)*o,d=(this.upperBound.z-n.z)*o,h=Math.max(Math.max(Math.min(s,a),Math.min(l,u)),Math.min(c,d)),p=Math.min(Math.min(Math.max(s,a),Math.max(l,u)),Math.max(c,d));return!(p<0)&&!(h>p)}}const d=new s,h=[new s,new s,new s,new s,new s,new s,new s,new s];class p{constructor(){this.matrix=[]}get(t,e){let{index:n}=t,{index:r}=e;if(r>n){const t=r;r=n,n=t}return this.matrix[(n*(n+1)>>1)+r-1]}set(t,e,n){let{index:r}=t,{index:i}=e;if(i>r){const t=i;i=r,r=t}this.matrix[(r*(r+1)>>1)+i-1]=n?1:0}reset(){for(let t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0}setNumObjects(t){this.matrix.length=t*(t-1)>>1}}class f{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;return void 0===n[t]&&(n[t]=[]),n[t].includes(e)||n[t].push(e),this}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return!(void 0===n[t]||!n[t].includes(e))}hasAnyEventListener(t){if(void 0===this._listeners)return!1;return void 0!==this._listeners[t]}removeEventListener(t,e){if(void 0===this._listeners)return this;const n=this._listeners;if(void 0===n[t])return this;const r=n[t].indexOf(e);return-1!==r&&n[t].splice(r,1),this}dispatchEvent(t){if(void 0===this._listeners)return this;const e=this._listeners[t.type];if(void 0!==e){t.target=this;for(let n=0,r=e.length;n<r;n++)e[n].call(this,t)}return this}}class v{constructor(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),this.x=t,this.y=e,this.z=n,this.w=r}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(t,e){const n=Math.sin(.5*e);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(.5*e),this}toAxisAngle(t){void 0===t&&(t=new s),this.normalize();const e=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/n,t.y=this.y/n,t.z=this.z/n),[t,e]}setFromVectors(t,e){if(t.isAntiparallelTo(e)){const e=m,n=b;t.tangents(e,n),this.setFromAxisAngle(e,Math.PI)}else{const n=t.cross(e);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(t.length()**2*e.length()**2)+t.dot(e),this.normalize()}return this}mult(t,e){void 0===e&&(e=new v);const n=this.x,r=this.y,i=this.z,o=this.w,s=t.x,a=t.y,l=t.z,u=t.w;return e.x=n*u+o*s+r*l-i*a,e.y=r*u+o*a+i*s-n*l,e.z=i*u+o*l+n*a-r*s,e.w=o*u-n*s-r*a-i*l,e}inverse(t){void 0===t&&(t=new v);const e=this.x,n=this.y,r=this.z,i=this.w;this.conjugate(t);const o=1/(e*e+n*n+r*r+i*i);return t.x*=o,t.y*=o,t.z*=o,t.w*=o,t}conjugate(t){return void 0===t&&(t=new v),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}normalizeFast(){const t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}vmult(t,e){void 0===e&&(e=new s);const n=t.x,r=t.y,i=t.z,o=this.x,a=this.y,l=this.z,u=this.w,c=u*n+a*i-l*r,d=u*r+l*n-o*i,h=u*i+o*r-a*n,p=-o*n-a*r-l*i;return e.x=c*u+p*-o+d*-l-h*-a,e.y=d*u+p*-a+h*-o-c*-l,e.z=h*u+p*-l+c*-a-d*-o,e}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}toEuler(t,e){let n,r,i;void 0===e&&(e="YZX");const o=this.x,s=this.y,a=this.z,l=this.w;switch(e){case"YZX":const t=o*s+a*l;if(t>.499&&(n=2*Math.atan2(o,l),r=Math.PI/2,i=0),t<-.499&&(n=-2*Math.atan2(o,l),r=-Math.PI/2,i=0),void 0===n){const e=o*o,u=s*s,c=a*a;n=Math.atan2(2*s*l-2*o*a,1-2*u-2*c),r=Math.asin(2*t),i=Math.atan2(2*o*l-2*s*a,1-2*e-2*c)}break;default:throw new Error(`Euler order ${e} not supported yet.`)}t.y=n,t.z=r,t.x=i}setFromEuler(t,e,n,r){void 0===r&&(r="XYZ");const i=Math.cos(t/2),o=Math.cos(e/2),s=Math.cos(n/2),a=Math.sin(t/2),l=Math.sin(e/2),u=Math.sin(n/2);return"XYZ"===r?(this.x=a*o*s+i*l*u,this.y=i*l*s-a*o*u,this.z=i*o*u+a*l*s,this.w=i*o*s-a*l*u):"YXZ"===r?(this.x=a*o*s+i*l*u,this.y=i*l*s-a*o*u,this.z=i*o*u-a*l*s,this.w=i*o*s+a*l*u):"ZXY"===r?(this.x=a*o*s-i*l*u,this.y=i*l*s+a*o*u,this.z=i*o*u+a*l*s,this.w=i*o*s-a*l*u):"ZYX"===r?(this.x=a*o*s-i*l*u,this.y=i*l*s+a*o*u,this.z=i*o*u-a*l*s,this.w=i*o*s+a*l*u):"YZX"===r?(this.x=a*o*s+i*l*u,this.y=i*l*s+a*o*u,this.z=i*o*u-a*l*s,this.w=i*o*s-a*l*u):"XZY"===r&&(this.x=a*o*s-i*l*u,this.y=i*l*s-a*o*u,this.z=i*o*u+a*l*s,this.w=i*o*s+a*l*u),this}clone(){return new v(this.x,this.y,this.z,this.w)}slerp(t,e,n){void 0===n&&(n=new v);const r=this.x,i=this.y,o=this.z,s=this.w;let a,l,u,c,d,h=t.x,p=t.y,f=t.z,m=t.w;return l=r*h+i*p+o*f+s*m,l<0&&(l=-l,h=-h,p=-p,f=-f,m=-m),1-l>1e-6?(a=Math.acos(l),u=Math.sin(a),c=Math.sin((1-e)*a)/u,d=Math.sin(e*a)/u):(c=1-e,d=e),n.x=c*r+d*h,n.y=c*i+d*p,n.z=c*o+d*f,n.w=c*s+d*m,n}integrate(t,e,n,r){void 0===r&&(r=new v);const i=t.x*n.x,o=t.y*n.y,s=t.z*n.z,a=this.x,l=this.y,u=this.z,c=this.w,d=.5*e;return r.x+=d*(i*c+o*u-s*l),r.y+=d*(o*c+s*a-i*u),r.z+=d*(s*c+i*l-o*a),r.w+=d*(-i*a-o*l-s*u),r}}const m=new s,b=new s,g={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class w{constructor(t){void 0===t&&(t={}),this.id=w.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=!t.collisionResponse||t.collisionResponse,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}updateBoundingSphereRadius(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}volume(){throw"volume() not implemented for shape type "+this.type}calculateLocalInertia(t,e){throw"calculateLocalInertia() not implemented for shape type "+this.type}calculateWorldAABB(t,e,n,r){throw"calculateWorldAABB() not implemented for shape type "+this.type}}w.idCounter=0,w.types=g;class _{constructor(t){void 0===t&&(t={}),this.position=new s,this.quaternion=new v,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}pointToLocal(t,e){return _.pointToLocalFrame(this.position,this.quaternion,t,e)}pointToWorld(t,e){return _.pointToWorldFrame(this.position,this.quaternion,t,e)}vectorToWorldFrame(t,e){return void 0===e&&(e=new s),this.quaternion.vmult(t,e),e}static pointToLocalFrame(t,e,n,r){return void 0===r&&(r=new s),n.vsub(t,r),e.conjugate(y),y.vmult(r,r),r}static pointToWorldFrame(t,e,n,r){return void 0===r&&(r=new s),e.vmult(n,r),r.vadd(t,r),r}static vectorToWorldFrame(t,e,n){return void 0===n&&(n=new s),t.vmult(e,n),n}static vectorToLocalFrame(t,e,n,r){return void 0===r&&(r=new s),e.w*=-1,e.vmult(n,r),e.w*=-1,r}}const y=new v;class x extends w{constructor(t){void 0===t&&(t={});const{vertices:e=[],faces:n=[],normals:r=[],axes:i,boundingSphereRadius:o}=t;super({type:w.types.CONVEXPOLYHEDRON}),this.vertices=e,this.faces=n,this.faceNormals=r,0===this.faceNormals.length&&this.computeNormals(),o?this.boundingSphereRadius=o:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=i?i.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const t=this.faces,e=this.vertices,n=this.uniqueEdges;n.length=0;const r=new s;for(let i=0;i!==t.length;i++){const o=t[i],s=o.length;for(let t=0;t!==s;t++){const i=(t+1)%s;e[o[t]].vsub(e[o[i]],r),r.normalize();let a=!1;for(let t=0;t!==n.length;t++)if(n[t].almostEquals(r)||n[t].almostEquals(r)){a=!0;break}a||n.push(r.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let t=0;t<this.faces.length;t++){for(let e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error(`Vertex ${this.faces[t][e]} not found!`);const e=this.faceNormals[t]||new s;this.getFaceNormal(t,e),e.negate(e),this.faceNormals[t]=e;const n=this.vertices[this.faces[t][0]];if(e.dot(n)<0){console.error(`.faceNormals[${t}] = Vec3(${e.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let e=0;e<this.faces[t].length;e++)console.warn(`.vertices[${this.faces[t][e]}] = Vec3(${this.vertices[this.faces[t][e]].toString()})`)}}}getFaceNormal(t,e){const n=this.faces[t],r=this.vertices[n[0]],i=this.vertices[n[1]],o=this.vertices[n[2]];x.computeNormal(r,i,o,e)}static computeNormal(t,e,n,r){const i=new s,o=new s;e.vsub(t,o),n.vsub(e,i),i.cross(o,r),r.isZero()||r.normalize()}clipAgainstHull(t,e,n,r,i,o,a,l,u){const c=new s;let d=-1,h=-Number.MAX_VALUE;for(let t=0;t<n.faces.length;t++){c.copy(n.faceNormals[t]),i.vmult(c,c);const e=c.dot(o);e>h&&(h=e,d=t)}const p=[];for(let t=0;t<n.faces[d].length;t++){const e=n.vertices[n.faces[d][t]],o=new s;o.copy(e),i.vmult(o,o),r.vadd(o,o),p.push(o)}d>=0&&this.clipFaceAgainstHull(o,t,e,p,a,l,u)}findSeparatingAxis(t,e,n,r,i,o,a,l){const u=new s,c=new s,d=new s,h=new s,p=new s,f=new s;let v=Number.MAX_VALUE;const m=this;if(m.uniqueAxes)for(let s=0;s!==m.uniqueAxes.length;s++){n.vmult(m.uniqueAxes[s],u);const a=m.testSepAxis(u,t,e,n,r,i);if(!1===a)return!1;a<v&&(v=a,o.copy(u))}else{const s=a?a.length:m.faces.length;for(let l=0;l<s;l++){const s=a?a[l]:l;u.copy(m.faceNormals[s]),n.vmult(u,u);const c=m.testSepAxis(u,t,e,n,r,i);if(!1===c)return!1;c<v&&(v=c,o.copy(u))}}if(t.uniqueAxes)for(let s=0;s!==t.uniqueAxes.length;s++){i.vmult(t.uniqueAxes[s],c);const a=m.testSepAxis(c,t,e,n,r,i);if(!1===a)return!1;a<v&&(v=a,o.copy(c))}else{const s=l?l.length:t.faces.length;for(let a=0;a<s;a++){const s=l?l[a]:a;c.copy(t.faceNormals[s]),i.vmult(c,c);const u=m.testSepAxis(c,t,e,n,r,i);if(!1===u)return!1;u<v&&(v=u,o.copy(c))}}for(let s=0;s!==m.uniqueEdges.length;s++){n.vmult(m.uniqueEdges[s],h);for(let s=0;s!==t.uniqueEdges.length;s++)if(i.vmult(t.uniqueEdges[s],p),h.cross(p,f),!f.almostZero()){f.normalize();const s=m.testSepAxis(f,t,e,n,r,i);if(!1===s)return!1;s<v&&(v=s,o.copy(f))}}return r.vsub(e,d),d.dot(o)>0&&o.negate(o),!0}testSepAxis(t,e,n,r,i,o){x.project(this,t,n,r,A),x.project(e,t,i,o,E);const s=A[0],a=A[1],l=E[0],u=E[1];if(s<u||l<a)return!1;const c=s-u,d=l-a;return c<d?c:d}calculateLocalInertia(t,e){const n=new s,r=new s;this.computeLocalAABB(r,n);const i=n.x-r.x,o=n.y-r.y,a=n.z-r.z;e.x=1/12*t*(2*o*2*o+2*a*2*a),e.y=1/12*t*(2*i*2*i+2*a*2*a),e.z=1/12*t*(2*o*2*o+2*i*2*i)}getPlaneConstantOfFace(t){const e=this.faces[t],n=this.faceNormals[t],r=this.vertices[e[0]];return-n.dot(r)}clipFaceAgainstHull(t,e,n,r,i,o,a){const l=new s,u=new s,c=new s,d=new s,h=new s,p=new s,f=new s,v=new s,m=this,b=r,g=[];let w=-1,_=Number.MAX_VALUE;for(let e=0;e<m.faces.length;e++){l.copy(m.faceNormals[e]),n.vmult(l,l);const r=l.dot(t);r<_&&(_=r,w=e)}if(w<0)return;const y=m.faces[w];y.connectedFaces=[];for(let t=0;t<m.faces.length;t++)for(let e=0;e<m.faces[t].length;e++)-1!==y.indexOf(m.faces[t][e])&&t!==w&&-1===y.connectedFaces.indexOf(t)&&y.connectedFaces.push(t);const x=y.length;for(let t=0;t<x;t++){const r=m.vertices[y[t]],i=m.vertices[y[(t+1)%x]];r.vsub(i,u),c.copy(u),n.vmult(c,c),e.vadd(c,c),d.copy(this.faceNormals[w]),n.vmult(d,d),e.vadd(d,d),c.cross(d,h),h.negate(h),p.copy(r),n.vmult(p,p),e.vadd(p,p);const o=y.connectedFaces[t];f.copy(this.faceNormals[o]);const s=this.getPlaneConstantOfFace(o);v.copy(f),n.vmult(v,v);const a=s-v.dot(e);for(this.clipFaceAgainstPlane(b,g,v,a);b.length;)b.shift();for(;g.length;)b.push(g.shift())}f.copy(this.faceNormals[w]);const A=this.getPlaneConstantOfFace(w);v.copy(f),n.vmult(v,v);const E=A-v.dot(e);for(let t=0;t<b.length;t++){let e=v.dot(b[t])+E;if(e<=i&&(console.log(`clamped: depth=${e} to minDist=${i}`),e=i),e<=o){const n=b[t];if(e<=1e-6){const t={point:n,normal:v,depth:e};a.push(t)}}}}clipFaceAgainstPlane(t,e,n,r){let i,o;const a=t.length;if(a<2)return e;let l=t[t.length-1],u=t[0];i=n.dot(l)+r;for(let c=0;c<a;c++){if(u=t[c],o=n.dot(u)+r,i<0)if(o<0){const t=new s;t.copy(u),e.push(t)}else{const t=new s;l.lerp(u,i/(i-o),t),e.push(t)}else if(o<0){const t=new s;l.lerp(u,i/(i-o),t),e.push(t),e.push(u)}l=u,i=o}return e}computeWorldVertices(t,e){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new s);const n=this.vertices,r=this.worldVertices;for(let i=0;i!==this.vertices.length;i++)e.vmult(n[i],r[i]),t.vadd(r[i],r[i]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(t,e){const n=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let r=0;r<this.vertices.length;r++){const i=n[r];i.x<t.x?t.x=i.x:i.x>e.x&&(e.x=i.x),i.y<t.y?t.y=i.y:i.y>e.y&&(e.y=i.y),i.z<t.z?t.z=i.z:i.z>e.z&&(e.z=i.z)}}computeWorldFaceNormals(t){const e=this.faceNormals.length;for(;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new s);const n=this.faceNormals,r=this.worldFaceNormals;for(let i=0;i!==e;i++)t.vmult(n[i],r[i]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let t=0;const e=this.vertices;for(let n=0;n!==e.length;n++){const r=e[n].lengthSquared();r>t&&(t=r)}this.boundingSphereRadius=Math.sqrt(t)}calculateWorldAABB(t,e,n,r){const i=this.vertices;let o,a,l,u,c,d,h=new s;for(let n=0;n<i.length;n++){h.copy(i[n]),e.vmult(h,h),t.vadd(h,h);const r=h;(void 0===o||r.x<o)&&(o=r.x),(void 0===u||r.x>u)&&(u=r.x),(void 0===a||r.y<a)&&(a=r.y),(void 0===c||r.y>c)&&(c=r.y),(void 0===l||r.z<l)&&(l=r.z),(void 0===d||r.z>d)&&(d=r.z)}n.set(o,a,l),r.set(u,c,d)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(t){void 0===t&&(t=new s);const e=this.vertices;for(let n=0;n<e.length;n++)t.vadd(e[n],t);return t.scale(1/e.length,t),t}transformAllPoints(t,e){const n=this.vertices.length,r=this.vertices;if(e){for(let t=0;t<n;t++){const n=r[t];e.vmult(n,n)}for(let t=0;t<this.faceNormals.length;t++){const n=this.faceNormals[t];e.vmult(n,n)}}if(t)for(let e=0;e<n;e++){const n=r[e];n.vadd(t,n)}}pointIsInside(t){const e=this.vertices,n=this.faces,r=this.faceNormals,i=new s;this.getAveragePointLocal(i);for(let o=0;o<this.faces.length;o++){let a=r[o];const l=e[n[o][0]],u=new s;t.vsub(l,u);const c=a.dot(u),d=new s;i.vsub(l,d);const h=a.dot(d);if(c<0&&h>0||c>0&&h<0)return!1}return-1}static project(t,e,n,r,i){const o=t.vertices.length,s=C;let a=0,l=0;const u=M,c=t.vertices;u.setZero(),_.vectorToLocalFrame(n,r,e,s),_.pointToLocalFrame(n,r,u,u);const d=u.dot(s);l=a=c[0].dot(s);for(let t=1;t<o;t++){const e=c[t].dot(s);e>a&&(a=e),e<l&&(l=e)}if(l-=d,a-=d,l>a){const t=l;l=a,a=t}i[0]=a,i[1]=l}}const A=[],E=[],C=(new s,new s),M=new s;class P extends w{constructor(t){super({type:w.types.BOX}),this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const t=this.halfExtents.x,e=this.halfExtents.y,n=this.halfExtents.z,r=s,i=[new r(-t,-e,-n),new r(t,-e,-n),new r(t,e,-n),new r(-t,e,-n),new r(-t,-e,n),new r(t,-e,n),new r(t,e,n),new r(-t,e,n)],o=[new r(0,0,1),new r(0,1,0),new r(1,0,0)],a=new x({vertices:i,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:o});this.convexPolyhedronRepresentation=a,a.material=this.material}calculateLocalInertia(t,e){return void 0===e&&(e=new s),P.calculateInertia(this.halfExtents,t,e),e}static calculateInertia(t,e,n){const r=t;n.x=1/12*e*(2*r.y*2*r.y+2*r.z*2*r.z),n.y=1/12*e*(2*r.x*2*r.x+2*r.z*2*r.z),n.z=1/12*e*(2*r.y*2*r.y+2*r.x*2*r.x)}getSideNormals(t,e){const n=t,r=this.halfExtents;if(n[0].set(r.x,0,0),n[1].set(0,r.y,0),n[2].set(0,0,r.z),n[3].set(-r.x,0,0),n[4].set(0,-r.y,0),n[5].set(0,0,-r.z),void 0!==e)for(let t=0;t!==n.length;t++)e.vmult(n[t],n[t]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(t,e,n){const r=this.halfExtents,i=[[r.x,r.y,r.z],[-r.x,r.y,r.z],[-r.x,-r.y,r.z],[-r.x,-r.y,-r.z],[r.x,-r.y,-r.z],[r.x,r.y,-r.z],[-r.x,r.y,-r.z],[r.x,-r.y,r.z]];for(let r=0;r<i.length;r++)S.set(i[r][0],i[r][1],i[r][2]),e.vmult(S,S),t.vadd(S,S),n(S.x,S.y,S.z)}calculateWorldAABB(t,e,n,r){const i=this.halfExtents;k[0].set(i.x,i.y,i.z),k[1].set(-i.x,i.y,i.z),k[2].set(-i.x,-i.y,i.z),k[3].set(-i.x,-i.y,-i.z),k[4].set(i.x,-i.y,-i.z),k[5].set(i.x,i.y,-i.z),k[6].set(-i.x,i.y,-i.z),k[7].set(i.x,-i.y,i.z);const o=k[0];e.vmult(o,o),t.vadd(o,o),r.copy(o),n.copy(o);for(let i=1;i<8;i++){const o=k[i];e.vmult(o,o),t.vadd(o,o);const s=o.x,a=o.y,l=o.z;s>r.x&&(r.x=s),a>r.y&&(r.y=a),l>r.z&&(r.z=l),s<n.x&&(n.x=s),a<n.y&&(n.y=a),l<n.z&&(n.z=l)}}}const S=new s,k=[new s,new s,new s,new s,new s,new s,new s,new s],T={DYNAMIC:1,STATIC:2,KINEMATIC:4},B={AWAKE:0,SLEEPY:1,SLEEPING:2};class F extends f{constructor(t){void 0===t&&(t={}),super(),this.id=F.idCounter++,this.index=-1,this.world=null,this.vlambda=new s,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof t.collisionResponse||t.collisionResponse,this.position=new s,this.previousPosition=new s,this.interpolatedPosition=new s,this.initPosition=new s,t.position&&(this.position.copy(t.position),this.previousPosition.copy(t.position),this.interpolatedPosition.copy(t.position),this.initPosition.copy(t.position)),this.velocity=new s,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new s,this.force=new s;const e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=e>0?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?F.STATIC:F.DYNAMIC,typeof t.type==typeof F.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=F.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new s,this.quaternion=new v,this.initQuaternion=new v,this.previousQuaternion=new v,this.interpolatedQuaternion=new v,t.quaternion&&(this.quaternion.copy(t.quaternion),this.initQuaternion.copy(t.quaternion),this.previousQuaternion.copy(t.quaternion),this.interpolatedQuaternion.copy(t.quaternion)),this.angularVelocity=new s,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new s,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new s,this.invInertia=new s,this.invInertiaWorld=new i,this.invMassSolve=0,this.invInertiaSolve=new s,this.invInertiaWorldSolve=new i,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.linearFactor=new s(1,1,1),t.linearFactor&&this.linearFactor.copy(t.linearFactor),this.angularFactor=new s(1,1,1),t.angularFactor&&this.angularFactor.copy(t.angularFactor),this.aabb=new c,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new s,this.isTrigger=Boolean(t.isTrigger),t.shape&&this.addShape(t.shape),this.updateMassProperties()}wakeUp(){const t=this.sleepState;this.sleepState=F.AWAKE,this.wakeUpAfterNarrowphase=!1,t===F.SLEEPING&&this.dispatchEvent(F.wakeupEvent)}sleep(){this.sleepState=F.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(t){if(this.allowSleep){const e=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),r=this.sleepSpeedLimit**2;e===F.AWAKE&&n<r?(this.sleepState=F.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(F.sleepyEvent)):e===F.SLEEPY&&n>r?this.wakeUp():e===F.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(F.sleepEvent))}}updateSolveMassProperties(){this.sleepState===F.SLEEPING||this.type===F.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(t,e){return void 0===e&&(e=new s),t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e}vectorToLocalFrame(t,e){return void 0===e&&(e=new s),this.quaternion.conjugate().vmult(t,e),e}pointToWorldFrame(t,e){return void 0===e&&(e=new s),this.quaternion.vmult(t,e),e.vadd(this.position,e),e}vectorToWorldFrame(t,e){return void 0===e&&(e=new s),this.quaternion.vmult(t,e),e}addShape(t,e,n){const r=new s,i=new v;return e&&r.copy(e),n&&i.copy(n),this.shapes.push(t),this.shapeOffsets.push(r),this.shapeOrientations.push(i),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=this,this}removeShape(t){const e=this.shapes.indexOf(t);return-1===e?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(e,1),this.shapeOffsets.splice(e,1),this.shapeOrientations.splice(e,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=null,this)}updateBoundingRadius(){const t=this.shapes,e=this.shapeOffsets,n=t.length;let r=0;for(let i=0;i!==n;i++){const n=t[i];n.updateBoundingSphereRadius();const o=e[i].length(),s=n.boundingSphereRadius;o+s>r&&(r=o+s)}this.boundingRadius=r}updateAABB(){const t=this.shapes,e=this.shapeOffsets,n=this.shapeOrientations,r=t.length,i=V,o=I,s=this.quaternion,a=this.aabb,l=z;for(let u=0;u!==r;u++){const r=t[u];s.vmult(e[u],i),i.vadd(this.position,i),s.mult(n[u],o),r.calculateWorldAABB(i,o,l.lowerBound,l.upperBound),0===u?a.copy(l):a.extend(l)}this.aabbNeedsUpdate=!1}updateInertiaWorld(t){const e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){const t=L,n=R;t.setRotationFromQuaternion(this.quaternion),t.transpose(n),t.scale(e,t),t.mmult(n,this.invInertiaWorld)}else;}applyForce(t,e){if(void 0===e&&(e=new s),this.type!==F.DYNAMIC)return;this.sleepState===F.SLEEPING&&this.wakeUp();const n=O;e.cross(t,n),this.force.vadd(t,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(t,e){if(void 0===e&&(e=new s),this.type!==F.DYNAMIC)return;const n=q,r=j;this.vectorToWorldFrame(t,n),this.vectorToWorldFrame(e,r),this.applyForce(n,r)}applyTorque(t){this.type===F.DYNAMIC&&(this.sleepState===F.SLEEPING&&this.wakeUp(),this.torque.vadd(t,this.torque))}applyImpulse(t,e){if(void 0===e&&(e=new s),this.type!==F.DYNAMIC)return;this.sleepState===F.SLEEPING&&this.wakeUp();const n=e,r=N;r.copy(t),r.scale(this.invMass,r),this.velocity.vadd(r,this.velocity);const i=D;n.cross(t,i),this.invInertiaWorld.vmult(i,i),this.angularVelocity.vadd(i,this.angularVelocity)}applyLocalImpulse(t,e){if(void 0===e&&(e=new s),this.type!==F.DYNAMIC)return;const n=W,r=U;this.vectorToWorldFrame(t,n),this.vectorToWorldFrame(e,r),this.applyImpulse(n,r)}updateMassProperties(){const t=H;this.invMass=this.mass>0?1/this.mass:0;const e=this.inertia,n=this.fixedRotation;this.updateAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),P.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!n?1/e.x:0,e.y>0&&!n?1/e.y:0,e.z>0&&!n?1/e.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(t,e){const n=new s;return t.vsub(this.position,n),this.angularVelocity.cross(n,e),this.velocity.vadd(e,e),e}integrate(t,e,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==F.DYNAMIC&&this.type!==F.KINEMATIC||this.sleepState===F.SLEEPING)return;const r=this.velocity,i=this.angularVelocity,o=this.position,s=this.force,a=this.torque,l=this.quaternion,u=this.invMass,c=this.invInertiaWorld,d=this.linearFactor,h=u*t;r.x+=s.x*h*d.x,r.y+=s.y*h*d.y,r.z+=s.z*h*d.z;const p=c.elements,f=this.angularFactor,v=a.x*f.x,m=a.y*f.y,b=a.z*f.z;i.x+=t*(p[0]*v+p[1]*m+p[2]*b),i.y+=t*(p[3]*v+p[4]*m+p[5]*b),i.z+=t*(p[6]*v+p[7]*m+p[8]*b),o.x+=r.x*t,o.y+=r.y*t,o.z+=r.z*t,l.integrate(this.angularVelocity,t,this.angularFactor,l),e&&(n?l.normalizeFast():l.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}F.idCounter=0,F.COLLIDE_EVENT_NAME="collide",F.DYNAMIC=T.DYNAMIC,F.STATIC=T.STATIC,F.KINEMATIC=T.KINEMATIC,F.AWAKE=B.AWAKE,F.SLEEPY=B.SLEEPY,F.SLEEPING=B.SLEEPING,F.wakeupEvent={type:"wakeup"},F.sleepyEvent={type:"sleepy"},F.sleepEvent={type:"sleep"};const V=new s,I=new v,z=new c,L=new i,R=new i,O=(new i,new s),q=new s,j=new s,N=new s,D=new s,W=new s,U=new s,H=new s;class G{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(t,e,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&F.STATIC)&&t.sleepState!==F.SLEEPING||0==(e.type&F.STATIC)&&e.sleepState!==F.SLEEPING)}intersectionTest(t,e,n,r){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,n,r):this.doBoundingSphereBroadphase(t,e,n,r)}doBoundingSphereBroadphase(t,e,n,r){const i=K;e.position.vsub(t.position,i);const o=(t.boundingRadius+e.boundingRadius)**2;i.lengthSquared()<o&&(n.push(t),r.push(e))}doBoundingBoxBroadphase(t,e,n,r){t.aabbNeedsUpdate&&t.updateAABB(),e.aabbNeedsUpdate&&e.updateAABB(),t.aabb.overlaps(e.aabb)&&(n.push(t),r.push(e))}makePairsUnique(t,e){const n=$,r=Y,i=X,o=t.length;for(let n=0;n!==o;n++)r[n]=t[n],i[n]=e[n];t.length=0,e.length=0;for(let t=0;t!==o;t++){const e=r[t].id,o=i[t].id,s=e<o?`${e},${o}`:`${o},${e}`;n[s]=t,n.keys.push(s)}for(let o=0;o!==n.keys.length;o++){const o=n.keys.pop(),s=n[o];t.push(r[s]),e.push(i[s]),delete n[o]}}setWorld(t){}static boundingSphereCheck(t,e){const n=new s;t.position.vsub(e.position,n);const r=t.shapes[0],i=e.shapes[0];return Math.pow(r.boundingSphereRadius+i.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(t,e,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const K=new s;new s,new v,new s;const $={keys:[]},Y=[],X=[];new s;class Z extends G{constructor(t,e,n,r,i){void 0===t&&(t=new s(100,100,100)),void 0===e&&(e=new s(-100,-100,-100)),void 0===n&&(n=10),void 0===r&&(r=10),void 0===i&&(i=10),super(),this.nx=n,this.ny=r,this.nz=i,this.aabbMin=t,this.aabbMax=e;const o=this.nx*this.ny*this.nz;if(o<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=o,this.binLengths.length=o;for(let t=0;t<o;t++)this.bins[t]=[],this.binLengths[t]=0}collisionPairs(t,e,n){const r=t.bodies.length,i=t.bodies,o=this.aabbMax,s=this.aabbMin,a=this.nx,l=this.ny,u=this.nz,c=l*u,d=u,h=o.x,p=o.y,f=o.z,v=s.x,m=s.y,b=s.z,g=a/(h-v),_=l/(p-m),y=u/(f-b),x=(h-v)/a,A=(p-m)/l,E=(f-b)/u,C=.5*Math.sqrt(x*x+A*A+E*E),M=w.types,P=M.SPHERE,S=M.PLANE;M.BOX,M.COMPOUND,M.CONVEXPOLYHEDRON;const k=this.bins,T=this.binLengths,B=this.bins.length;for(let t=0;t!==B;t++)T[t]=0;const F=Math.ceil;function V(t,e,n,r,i,o,s){let h=(t-v)*g|0,p=(e-m)*_|0,f=(n-b)*y|0,w=F((r-v)*g),x=F((i-m)*_),A=F((o-b)*y);h<0?h=0:h>=a&&(h=a-1),p<0?p=0:p>=l&&(p=l-1),f<0?f=0:f>=u&&(f=u-1),w<0?w=0:w>=a&&(w=a-1),x<0?x=0:x>=l&&(x=l-1),A<0?A=0:A>=u&&(A=u-1),h*=c,p*=d,f*=1,w*=c,x*=d,A*=1;for(let t=h;t<=w;t+=c)for(let e=p;e<=x;e+=d)for(let n=f;n<=A;n+=1){const r=t+e+n;k[r][T[r]++]=s}}for(let t=0;t!==r;t++){const e=i[t],n=e.shapes[0];switch(n.type){case P:{const t=n,r=e.position.x,i=e.position.y,o=e.position.z,s=t.radius;V(r-s,i-s,o-s,r+s,i+s,o+s,e);break}case S:{const t=n;t.worldNormalNeedsUpdate&&t.computeWorldNormal(e.quaternion);const r=t.worldNormal,i=v+.5*x-e.position.x,o=m+.5*A-e.position.y,s=b+.5*E-e.position.z,h=Q;h.set(i,o,s);for(let t=0,n=0;t!==a;t++,n+=c,h.y=o,h.x+=x)for(let t=0,i=0;t!==l;t++,i+=d,h.z=s,h.y+=A)for(let t=0,o=0;t!==u;t++,o+=1,h.z+=E)if(h.dot(r)<C){const t=n+i+o;k[t][T[t]++]=e}break}default:e.aabbNeedsUpdate&&e.updateAABB(),V(e.aabb.lowerBound.x,e.aabb.lowerBound.y,e.aabb.lowerBound.z,e.aabb.upperBound.x,e.aabb.upperBound.y,e.aabb.upperBound.z,e)}}for(let t=0;t!==B;t++){const r=T[t];if(r>1){const i=k[t];for(let t=0;t!==r;t++){const r=i[t];for(let o=0;o!==t;o++){const t=i[o];this.needBroadphaseCollision(r,t)&&this.intersectionTest(r,t,e,n)}}}}this.makePairsUnique(e,n)}}const Q=new s;new s;class J extends G{constructor(){super()}collisionPairs(t,e,n){const r=t.bodies,i=r.length;let o,s;for(let t=0;t!==i;t++)for(let i=0;i!==t;i++)o=r[t],s=r[i],this.needBroadphaseCollision(o,s)&&this.intersectionTest(o,s,e,n)}aabbQuery(t,e,n){void 0===n&&(n=[]);for(let r=0;r<t.bodies.length;r++){const i=t.bodies[r];i.aabbNeedsUpdate&&i.updateAABB(),i.aabb.overlaps(e)&&n.push(i)}return n}}class tt{constructor(){this.rayFromWorld=new s,this.rayToWorld=new s,this.hitNormalWorld=new s,this.hitPointWorld=new s,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(t,e,n,r,i,o,s){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(r),this.shape=i,this.body=o,this.distance=s}}let et,nt,rt,it,ot,st,at;const lt={CLOSEST:1,ANY:2,ALL:4};et=w.types.SPHERE,nt=w.types.PLANE,rt=w.types.BOX,it=w.types.CYLINDER,ot=w.types.CONVEXPOLYHEDRON,st=w.types.HEIGHTFIELD,at=w.types.TRIMESH;class ut{get[et](){return this._intersectSphere}get[nt](){return this._intersectPlane}get[rt](){return this._intersectBox}get[it](){return this._intersectConvex}get[ot](){return this._intersectConvex}get[st](){return this._intersectHeightfield}get[at](){return this._intersectTrimesh}constructor(t,e){void 0===t&&(t=new s),void 0===e&&(e=new s),this.from=t.clone(),this.to=e.clone(),this.direction=new s,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ut.ANY,this.result=new tt,this.hasHit=!1,this.callback=t=>{}}intersectWorld(t,e){return this.mode=e.mode||ut.ANY,this.result=e.result||new tt,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===e.checkCollisionResponse||e.checkCollisionResponse,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(ct),dt.length=0,t.broadphase.aabbQuery(t,ct,dt),this.intersectBodies(dt),this.hasHit}intersectBody(t,e){e&&(this.result=e,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!t.collisionResponse)return;if(0==(this.collisionFilterGroup&t.collisionFilterMask)||0==(t.collisionFilterGroup&this.collisionFilterMask))return;const r=ft,i=vt;for(let e=0,o=t.shapes.length;e<o;e++){const o=t.shapes[e];if((!n||o.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[e],i),t.quaternion.vmult(t.shapeOffsets[e],r),r.vadd(t.position,r),this.intersectShape(o,i,r,t),this.result.shouldStop))break}}intersectBodies(t,e){e&&(this.result=e,this.updateDirection());for(let e=0,n=t.length;!this.result.shouldStop&&e<n;e++)this.intersectBody(t[e])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(t,e,n,r){if(function(t,e,n){n.vsub(t,Lt);const r=Lt.dot(e);e.scale(r,Rt),Rt.vadd(t,Rt);return n.distanceTo(Rt)}(this.from,this.direction,n)>t.boundingSphereRadius)return;const i=this[t.type];i&&i.call(this,t,e,n,r,t)}_intersectBox(t,e,n,r,i){return this._intersectConvex(t.convexPolyhedronRepresentation,e,n,r,i)}_intersectPlane(t,e,n,r,i){const o=this.from,a=this.to,l=this.direction,u=new s(0,0,1);e.vmult(u,u);const c=new s;o.vsub(n,c);const d=c.dot(u);a.vsub(n,c);if(d*c.dot(u)>0)return;if(o.distanceTo(a)<d)return;const h=u.dot(l);if(Math.abs(h)<this.precision)return;const p=new s,f=new s,v=new s;o.vsub(n,p);const m=-u.dot(p)/h;l.scale(m,f),o.vadd(f,v),this.reportIntersection(u,v,i,r,-1)}getAABB(t){const{lowerBound:e,upperBound:n}=t,r=this.to,i=this.from;e.x=Math.min(r.x,i.x),e.y=Math.min(r.y,i.y),e.z=Math.min(r.z,i.z),n.x=Math.max(r.x,i.x),n.y=Math.max(r.y,i.y),n.z=Math.max(r.z,i.z)}_intersectHeightfield(t,e,n,r,i){t.data,t.elementSize;const o=xt;o.from.copy(this.from),o.to.copy(this.to),_.pointToLocalFrame(n,e,o.from,o.from),_.pointToLocalFrame(n,e,o.to,o.to),o.updateDirection();const s=At;let a,l,u,d;a=l=0,u=d=t.data.length-1;const h=new c;o.getAABB(h),t.getIndexOfPosition(h.lowerBound.x,h.lowerBound.y,s,!0),a=Math.max(a,s[0]),l=Math.max(l,s[1]),t.getIndexOfPosition(h.upperBound.x,h.upperBound.y,s,!0),u=Math.min(u,s[0]+1),d=Math.min(d,s[1]+1);for(let s=a;s<u;s++)for(let a=l;a<d;a++){if(this.result.shouldStop)return;if(t.getAabbAtIndex(s,a,h),h.overlapsRay(o)){if(t.getConvexTrianglePillar(s,a,!1),_.pointToWorldFrame(n,e,t.pillarOffset,yt),this._intersectConvex(t.pillarConvex,e,yt,r,i,_t),this.result.shouldStop)return;t.getConvexTrianglePillar(s,a,!0),_.pointToWorldFrame(n,e,t.pillarOffset,yt),this._intersectConvex(t.pillarConvex,e,yt,r,i,_t)}}}_intersectSphere(t,e,n,r,i){const o=this.from,s=this.to,a=t.radius,l=(s.x-o.x)**2+(s.y-o.y)**2+(s.z-o.z)**2,u=2*((s.x-o.x)*(o.x-n.x)+(s.y-o.y)*(o.y-n.y)+(s.z-o.z)*(o.z-n.z)),c=u**2-4*l*((o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-a**2),d=Et,h=Ct;if(!(c<0))if(0===c)o.lerp(s,c,d),d.vsub(n,h),h.normalize(),this.reportIntersection(h,d,i,r,-1);else{const t=(-u-Math.sqrt(c))/(2*l),e=(-u+Math.sqrt(c))/(2*l);if(t>=0&&t<=1&&(o.lerp(s,t,d),d.vsub(n,h),h.normalize(),this.reportIntersection(h,d,i,r,-1)),this.result.shouldStop)return;e>=0&&e<=1&&(o.lerp(s,e,d),d.vsub(n,h),h.normalize(),this.reportIntersection(h,d,i,r,-1))}}_intersectConvex(t,e,n,r,i,o){const s=Mt,a=Pt,l=o&&o.faceList||null,u=t.faces,c=t.vertices,d=t.faceNormals,h=this.direction,p=this.from,f=this.to,v=p.distanceTo(f),m=l?l.length:u.length,b=this.result;for(let t=0;!b.shouldStop&&t<m;t++){const o=l?l[t]:t,f=u[o],m=d[o],g=e,w=n;a.copy(c[f[0]]),g.vmult(a,a),a.vadd(w,a),a.vsub(p,a),g.vmult(m,s);const _=h.dot(s);if(Math.abs(_)<this.precision)continue;const y=s.dot(a)/_;if(!(y<0)){h.scale(y,mt),mt.vadd(p,mt),bt.copy(c[f[0]]),g.vmult(bt,bt),w.vadd(bt,bt);for(let t=1;!b.shouldStop&&t<f.length-1;t++){gt.copy(c[f[t]]),wt.copy(c[f[t+1]]),g.vmult(gt,gt),g.vmult(wt,wt),w.vadd(gt,gt),w.vadd(wt,wt);const e=mt.distanceTo(p);!ut.pointInTriangle(mt,bt,gt,wt)&&!ut.pointInTriangle(mt,gt,bt,wt)||e>v||this.reportIntersection(s,mt,i,r,o)}}}}_intersectTrimesh(t,e,n,r,i,o){const s=St,a=It,l=zt,u=Pt,c=kt,d=Tt,h=Bt,p=Vt,f=Ft,v=t.indices;t.vertices;const m=this.from,b=this.to,g=this.direction;l.position.copy(n),l.quaternion.copy(e),_.vectorToLocalFrame(n,e,g,c),_.pointToLocalFrame(n,e,m,d),_.pointToLocalFrame(n,e,b,h),h.x*=t.scale.x,h.y*=t.scale.y,h.z*=t.scale.z,d.x*=t.scale.x,d.y*=t.scale.y,d.z*=t.scale.z,h.vsub(d,c),c.normalize();const w=d.distanceSquared(h);t.tree.rayQuery(this,l,a);for(let o=0,l=a.length;!this.result.shouldStop&&o!==l;o++){const l=a[o];t.getNormal(l,s),t.getVertex(v[3*l],bt),bt.vsub(d,u);const h=c.dot(s),m=s.dot(u)/h;if(m<0)continue;c.scale(m,mt),mt.vadd(d,mt),t.getVertex(v[3*l+1],gt),t.getVertex(v[3*l+2],wt);const b=mt.distanceSquared(d);!ut.pointInTriangle(mt,gt,bt,wt)&&!ut.pointInTriangle(mt,bt,gt,wt)||b>w||(_.vectorToWorldFrame(e,s,f),_.pointToWorldFrame(n,e,mt,p),this.reportIntersection(f,p,i,r,l))}a.length=0}reportIntersection(t,e,n,r,i){const o=this.from,s=this.to,a=o.distanceTo(e),l=this.result;if(!(this.skipBackfaces&&t.dot(this.direction)>0))switch(l.hitFaceIndex=void 0!==i?i:-1,this.mode){case ut.ALL:this.hasHit=!0,l.set(o,s,t,e,n,r,a),l.hasHit=!0,this.callback(l);break;case ut.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(o,s,t,e,n,r,a));break;case ut.ANY:this.hasHit=!0,l.hasHit=!0,l.set(o,s,t,e,n,r,a),l.shouldStop=!0}}static pointInTriangle(t,e,n,r){r.vsub(e,Lt),n.vsub(e,ht),t.vsub(e,pt);const i=Lt.dot(Lt),o=Lt.dot(ht),s=Lt.dot(pt),a=ht.dot(ht),l=ht.dot(pt);let u,c;return(u=a*s-o*l)>=0&&(c=i*l-o*s)>=0&&u+c<i*a-o*o}}ut.CLOSEST=lt.CLOSEST,ut.ANY=lt.ANY,ut.ALL=lt.ALL;const ct=new c,dt=[],ht=new s,pt=new s,ft=new s,vt=new v,mt=new s,bt=new s,gt=new s,wt=new s;new s,new tt;const _t={faceList:[0]},yt=new s,xt=new ut,At=[],Et=new s,Ct=new s,Mt=new s,Pt=(new s,new s,new s),St=new s,kt=new s,Tt=new s,Bt=new s,Ft=new s,Vt=new s;new c;const It=[],zt=new _,Lt=new s,Rt=new s;class Ot extends G{static checkBounds(t,e,n){let r,i;0===n?(r=t.position.x,i=e.position.x):1===n?(r=t.position.y,i=e.position.y):2===n&&(r=t.position.z,i=e.position.z);const o=t.boundingRadius;return i-e.boundingRadius<r+o}static insertionSortX(t){for(let e=1,n=t.length;e<n;e++){const n=t[e];let r;for(r=e-1;r>=0&&!(t[r].aabb.lowerBound.x<=n.aabb.lowerBound.x);r--)t[r+1]=t[r];t[r+1]=n}return t}static insertionSortY(t){for(let e=1,n=t.length;e<n;e++){const n=t[e];let r;for(r=e-1;r>=0&&!(t[r].aabb.lowerBound.y<=n.aabb.lowerBound.y);r--)t[r+1]=t[r];t[r+1]=n}return t}static insertionSortZ(t){for(let e=1,n=t.length;e<n;e++){const n=t[e];let r;for(r=e-1;r>=0&&!(t[r].aabb.lowerBound.z<=n.aabb.lowerBound.z);r--)t[r+1]=t[r];t[r+1]=n}return t}constructor(t){super(),this.axisList=[],this.world=null,this.axisIndex=0;const e=this.axisList;this._addBodyHandler=t=>{e.push(t.body)},this._removeBodyHandler=t=>{const n=e.indexOf(t.body);-1!==n&&e.splice(n,1)},t&&this.setWorld(t)}setWorld(t){this.axisList.length=0;for(let e=0;e<t.bodies.length;e++)this.axisList.push(t.bodies[e]);t.removeEventListener("addBody",this._addBodyHandler),t.removeEventListener("removeBody",this._removeBodyHandler),t.addEventListener("addBody",this._addBodyHandler),t.addEventListener("removeBody",this._removeBodyHandler),this.world=t,this.dirty=!0}collisionPairs(t,e,n){const r=this.axisList,i=r.length,o=this.axisIndex;let s,a;for(this.dirty&&(this.sortList(),this.dirty=!1),s=0;s!==i;s++){const t=r[s];for(a=s+1;a<i;a++){const i=r[a];if(this.needBroadphaseCollision(t,i)){if(!Ot.checkBounds(t,i,o))break;this.intersectionTest(t,i,e,n)}}}}sortList(){const t=this.axisList,e=this.axisIndex,n=t.length;for(let e=0;e!==n;e++){const n=t[e];n.aabbNeedsUpdate&&n.updateAABB()}0===e?Ot.insertionSortX(t):1===e?Ot.insertionSortY(t):2===e&&Ot.insertionSortZ(t)}autoDetectAxis(){let t=0,e=0,n=0,r=0,i=0,o=0;const s=this.axisList,a=s.length,l=1/a;for(let l=0;l!==a;l++){const a=s[l],u=a.position.x;t+=u,e+=u*u;const c=a.position.y;n+=c,r+=c*c;const d=a.position.z;i+=d,o+=d*d}const u=e-t*t*l,c=r-n*n*l,d=o-i*i*l;this.axisIndex=u>c?u>d?0:2:c>d?1:2}aabbQuery(t,e,n){void 0===n&&(n=[]),this.dirty&&(this.sortList(),this.dirty=!1);const r=this.axisIndex;let i="x";1===r&&(i="y"),2===r&&(i="z");const o=this.axisList;e.lowerBound[i],e.upperBound[i];for(let t=0;t<o.length;t++){const r=o[t];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&n.push(r)}return n}}class qt{static defaults(t,e){void 0===t&&(t={});for(let n in e)n in t||(t[n]=e[n]);return t}}class jt{constructor(t,e,n){void 0===n&&(n={}),n=qt.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=jt.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!0}disable(){const t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!1}}jt.idCounter=0;class Nt{constructor(){this.spatial=new s,this.rotational=new s}multiplyElement(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)}multiplyVectors(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}}class Dt{constructor(t,e,n,r){void 0===n&&(n=-1e6),void 0===r&&(r=1e6),this.id=Dt.idCounter++,this.minForce=n,this.maxForce=r,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Nt,this.jacobianElementB=new Nt,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(t,e,n){const r=e,i=t,o=n;this.a=4/(o*(1+4*r)),this.b=4*r/(1+4*r),this.eps=4/(o*o*i*(1+4*r))}computeB(t,e,n){const r=this.computeGW();return-this.computeGq()*t-r*e-this.computeGiMf()*n}computeGq(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.position,o=r.position;return t.spatial.dot(i)+e.spatial.dot(o)}computeGW(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.velocity,o=r.velocity,s=n.angularVelocity,a=r.angularVelocity;return t.multiplyVectors(i,s)+e.multiplyVectors(o,a)}computeGWlambda(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.vlambda,o=r.vlambda,s=n.wlambda,a=r.wlambda;return t.multiplyVectors(i,s)+e.multiplyVectors(o,a)}computeGiMf(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.force,o=n.torque,s=r.force,a=r.torque,l=n.invMassSolve,u=r.invMassSolve;return i.scale(l,Wt),s.scale(u,Ut),n.invInertiaWorldSolve.vmult(o,Ht),r.invInertiaWorldSolve.vmult(a,Gt),t.multiplyVectors(Wt,Ht)+e.multiplyVectors(Ut,Gt)}computeGiMGt(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.invMassSolve,o=r.invMassSolve,s=n.invInertiaWorldSolve,a=r.invInertiaWorldSolve;let l=i+o;return s.vmult(t.rotational,Kt),l+=Kt.dot(t.rotational),a.vmult(e.rotational,Kt),l+=Kt.dot(e.rotational),l}addToWlambda(t){const e=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,i=this.bj,o=$t;r.vlambda.addScaledVector(r.invMassSolve*t,e.spatial,r.vlambda),i.vlambda.addScaledVector(i.invMassSolve*t,n.spatial,i.vlambda),r.invInertiaWorldSolve.vmult(e.rotational,o),r.wlambda.addScaledVector(t,o,r.wlambda),i.invInertiaWorldSolve.vmult(n.rotational,o),i.wlambda.addScaledVector(t,o,i.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Dt.idCounter=0;const Wt=new s,Ut=new s,Ht=new s,Gt=new s,Kt=new s,$t=new s;class Yt extends Dt{constructor(t,e,n){void 0===n&&(n=1e6),super(t,e,0,n),this.restitution=0,this.ri=new s,this.rj=new s,this.ni=new s}computeB(t){const e=this.a,n=this.b,r=this.bi,i=this.bj,o=this.ri,s=this.rj,a=Xt,l=Zt,u=r.velocity,c=r.angularVelocity;r.force,r.torque;const d=i.velocity,h=i.angularVelocity;i.force,i.torque;const p=Qt,f=this.jacobianElementA,v=this.jacobianElementB,m=this.ni;o.cross(m,a),s.cross(m,l),m.negate(f.spatial),a.negate(f.rotational),v.spatial.copy(m),v.rotational.copy(l),p.copy(i.position),p.vadd(s,p),p.vsub(r.position,p),p.vsub(o,p);const b=m.dot(p),g=this.restitution+1;return-b*e-(g*d.dot(m)-g*u.dot(m)+h.dot(l)-c.dot(a))*n-t*this.computeGiMf()}getImpactVelocityAlongNormal(){const t=Jt,e=te,n=ee,r=ne,i=re;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,r),this.bi.getVelocityAtWorldPoint(n,t),this.bj.getVelocityAtWorldPoint(r,e),t.vsub(e,i),this.ni.dot(i)}}const Xt=new s,Zt=new s,Qt=new s,Jt=new s,te=new s,ee=new s,ne=new s,re=new s;class ie extends jt{constructor(t,e,n,r,i){void 0===e&&(e=new s),void 0===r&&(r=new s),void 0===i&&(i=1e6),super(t,n),this.pivotA=e.clone(),this.pivotB=r.clone();const o=this.equationX=new Yt(t,n),a=this.equationY=new Yt(t,n),l=this.equationZ=new Yt(t,n);this.equations.push(o,a,l),o.minForce=a.minForce=l.minForce=-i,o.maxForce=a.maxForce=l.maxForce=i,o.ni.set(1,0,0),a.ni.set(0,1,0),l.ni.set(0,0,1)}update(){const t=this.bodyA,e=this.bodyB,n=this.equationX,r=this.equationY,i=this.equationZ;t.quaternion.vmult(this.pivotA,n.ri),e.quaternion.vmult(this.pivotB,n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj)}}class oe extends Dt{constructor(t,e,n){void 0===n&&(n={});const r=void 0!==n.maxForce?n.maxForce:1e6;super(t,e,-r,r),this.axisA=n.axisA?n.axisA.clone():new s(1,0,0),this.axisB=n.axisB?n.axisB.clone():new s(0,1,0),this.angle=void 0!==n.angle?n.angle:0}computeB(t){const e=this.a,n=this.b,r=this.axisA,i=this.axisB,o=se,s=ae,a=this.jacobianElementA,l=this.jacobianElementB;r.cross(i,o),i.cross(r,s),a.rotational.copy(s),l.rotational.copy(o);return-(Math.cos(this.angle)-r.dot(i))*e-this.computeGW()*n-t*this.computeGiMf()}}const se=new s,ae=new s;class le extends Dt{constructor(t,e,n){void 0===n&&(n={});const r=void 0!==n.maxForce?n.maxForce:1e6;super(t,e,-r,r),this.axisA=n.axisA?n.axisA.clone():new s(1,0,0),this.axisB=n.axisB?n.axisB.clone():new s(0,1,0),this.maxAngle=Math.PI/2}computeB(t){const e=this.a,n=this.b,r=this.axisA,i=this.axisB,o=ue,s=ce,a=this.jacobianElementA,l=this.jacobianElementB;r.cross(i,o),i.cross(r,s),a.rotational.copy(s),l.rotational.copy(o);return-(Math.cos(this.maxAngle)-r.dot(i))*e-this.computeGW()*n-t*this.computeGiMf()}}const ue=new s,ce=new s;class de extends ie{constructor(t,e,n){void 0===n&&(n={});const r=void 0!==n.maxForce?n.maxForce:1e6;super(t,n.pivotA?n.pivotA.clone():new s,e,n.pivotB?n.pivotB.clone():new s,r),this.axisA=n.axisA?n.axisA.clone():new s,this.axisB=n.axisB?n.axisB.clone():new s,this.collideConnected=!!n.collideConnected,this.angle=void 0!==n.angle?n.angle:0;const i=this.coneEquation=new oe(t,e,n),o=this.twistEquation=new le(t,e,n);this.twistAngle=void 0!==n.twistAngle?n.twistAngle:0,i.maxForce=0,i.minForce=-r,o.maxForce=0,o.minForce=-r,this.equations.push(i,o)}update(){const t=this.bodyA,e=this.bodyB,n=this.coneEquation,r=this.twistEquation;super.update(),t.vectorToWorldFrame(this.axisA,n.axisA),e.vectorToWorldFrame(this.axisB,n.axisB),this.axisA.tangents(r.axisA,r.axisA),t.vectorToWorldFrame(r.axisA,r.axisA),this.axisB.tangents(r.axisB,r.axisB),e.vectorToWorldFrame(r.axisB,r.axisB),n.angle=this.angle,r.maxAngle=this.twistAngle}}new s,new s;class he extends jt{constructor(t,e,n,r){void 0===r&&(r=1e6),super(t,e),void 0===n&&(n=t.position.distanceTo(e.position)),this.distance=n;const i=this.distanceEquation=new Yt(t,e);this.equations.push(i),i.minForce=-r,i.maxForce=r}update(){const t=this.bodyA,e=this.bodyB,n=this.distanceEquation,r=.5*this.distance,i=n.ni;e.position.vsub(t.position,i),i.normalize(),i.scale(r,n.ri),i.scale(-r,n.rj)}}class pe extends ie{constructor(t,e,n){void 0===n&&(n={});const r=void 0!==n.maxForce?n.maxForce:1e6,i=new s,o=new s,a=new s;t.position.vadd(e.position,a),a.scale(.5,a),e.pointToLocalFrame(a,o),t.pointToLocalFrame(a,i),super(t,i,e,o,r),this.xA=t.vectorToLocalFrame(s.UNIT_X),this.xB=e.vectorToLocalFrame(s.UNIT_X),this.yA=t.vectorToLocalFrame(s.UNIT_Y),this.yB=e.vectorToLocalFrame(s.UNIT_Y),this.zA=t.vectorToLocalFrame(s.UNIT_Z),this.zB=e.vectorToLocalFrame(s.UNIT_Z);const l=this.rotationalEquation1=new le(t,e,n),u=this.rotationalEquation2=new le(t,e,n),c=this.rotationalEquation3=new le(t,e,n);this.equations.push(l,u,c)}update(){const t=this.bodyA,e=this.bodyB;this.motorEquation;const n=this.rotationalEquation1,r=this.rotationalEquation2,i=this.rotationalEquation3;super.update(),t.vectorToWorldFrame(this.xA,n.axisA),e.vectorToWorldFrame(this.yB,n.axisB),t.vectorToWorldFrame(this.yA,r.axisA),e.vectorToWorldFrame(this.zB,r.axisB),t.vectorToWorldFrame(this.zA,i.axisA),e.vectorToWorldFrame(this.xB,i.axisB)}}new s,new s;class fe extends Dt{constructor(t,e,n){void 0===n&&(n=1e6),super(t,e,-n,n),this.axisA=new s,this.axisB=new s,this.targetVelocity=0}computeB(t){this.a;const e=this.b;this.bi,this.bj;const n=this.axisA,r=this.axisB,i=this.jacobianElementA,o=this.jacobianElementB;i.rotational.copy(n),r.negate(o.rotational);return-(this.computeGW()-this.targetVelocity)*e-t*this.computeGiMf()}}class ve extends ie{constructor(t,e,n){void 0===n&&(n={});const r=void 0!==n.maxForce?n.maxForce:1e6;super(t,n.pivotA?n.pivotA.clone():new s,e,n.pivotB?n.pivotB.clone():new s,r);(this.axisA=n.axisA?n.axisA.clone():new s(1,0,0)).normalize();(this.axisB=n.axisB?n.axisB.clone():new s(1,0,0)).normalize(),this.collideConnected=!!n.collideConnected;const i=this.rotationalEquation1=new le(t,e,n),o=this.rotationalEquation2=new le(t,e,n),a=this.motorEquation=new fe(t,e,r);a.enabled=!1,this.equations.push(i,o,a)}enableMotor(){this.motorEquation.enabled=!0}disableMotor(){this.motorEquation.enabled=!1}setMotorSpeed(t){this.motorEquation.targetVelocity=t}setMotorMaxForce(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t}update(){const t=this.bodyA,e=this.bodyB,n=this.motorEquation,r=this.rotationalEquation1,i=this.rotationalEquation2,o=me,s=be,a=this.axisA,l=this.axisB;super.update(),t.quaternion.vmult(a,o),e.quaternion.vmult(l,s),o.tangents(r.axisA,i.axisA),r.axisB.copy(s),i.axisB.copy(s),this.motorEquation.enabled&&(t.quaternion.vmult(this.axisA,n.axisA),e.quaternion.vmult(this.axisB,n.axisB))}}const me=new s,be=new s;class ge extends Dt{constructor(t,e,n){super(t,e,-n,n),this.ri=new s,this.rj=new s,this.t=new s}computeB(t){this.a;const e=this.b;this.bi,this.bj;const n=this.ri,r=this.rj,i=we,o=_e,s=this.t;n.cross(s,i),r.cross(s,o);const a=this.jacobianElementA,l=this.jacobianElementB;s.negate(a.spatial),i.negate(a.rotational),l.spatial.copy(s),l.rotational.copy(o);return-this.computeGW()*e-t*this.computeGiMf()}}const we=new s,_e=new s;class ye{constructor(t,e,n){n=qt.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=ye.idCounter++,this.materials=[t,e],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}ye.idCounter=0;class xe{constructor(t){void 0===t&&(t={});let e="";"string"==typeof t&&(e=t,t={}),this.name=e,this.id=xe.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}}xe.idCounter=0;class Ae{constructor(t,e,n){void 0===n&&(n={}),this.restLength="number"==typeof n.restLength?n.restLength:1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=t,this.bodyB=e,this.localAnchorA=new s,this.localAnchorB=new s,n.localAnchorA&&this.localAnchorA.copy(n.localAnchorA),n.localAnchorB&&this.localAnchorB.copy(n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB)}setWorldAnchorA(t){this.bodyA.pointToLocalFrame(t,this.localAnchorA)}setWorldAnchorB(t){this.bodyB.pointToLocalFrame(t,this.localAnchorB)}getWorldAnchorA(t){this.bodyA.pointToWorldFrame(this.localAnchorA,t)}getWorldAnchorB(t){this.bodyB.pointToWorldFrame(this.localAnchorB,t)}applyForce(){const t=this.stiffness,e=this.damping,n=this.restLength,r=this.bodyA,i=this.bodyB,o=Ee,s=Ce,a=Me,l=Pe,u=Ie,c=Se,d=ke,h=Te,p=Be,f=Fe,v=Ve;this.getWorldAnchorA(c),this.getWorldAnchorB(d),c.vsub(r.position,h),d.vsub(i.position,p),d.vsub(c,o);const m=o.length();s.copy(o),s.normalize(),i.velocity.vsub(r.velocity,a),i.angularVelocity.cross(p,u),a.vadd(u,a),r.angularVelocity.cross(h,u),a.vsub(u,a),s.scale(-t*(m-n)-e*a.dot(s),l),r.force.vsub(l,r.force),i.force.vadd(l,i.force),h.cross(l,f),p.cross(l,v),r.torque.vsub(f,r.torque),i.torque.vadd(v,i.torque)}}const Ee=new s,Ce=new s,Me=new s,Pe=new s,Se=new s,ke=new s,Te=new s,Be=new s,Fe=new s,Ve=new s,Ie=new s;class ze{constructor(t){void 0===t&&(t={}),t=qt.defaults(t,{chassisConnectionPointLocal:new s,chassisConnectionPointWorld:new s,directionLocal:new s,directionWorld:new s,axleLocal:new s,axleWorld:new s,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:10.5,forwardAcceleration:1,sideAcceleration:1,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,slipInfo:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointWorld.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionWorld.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleWorld.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.forwardAcceleration=t.forwardAcceleration,this.sideAcceleration=t.sideAcceleration,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.slipInfo=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new tt,this.worldTransform=new _,this.isInContact=!1}updateWheel(t){const e=this.raycastResult;if(this.isInContact){const n=e.hitNormalWorld.dot(e.directionWorld);e.hitPointWorld.vsub(t.position,Re),t.getVelocityAtWorldPoint(Re,Le);const r=e.hitNormalWorld.dot(Le);if(n>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{const t=-1/n;this.suspensionRelativeVelocity=r*t,this.clippedInvContactDotSuspension=t}}else e.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.hitNormalWorld),this.clippedInvContactDotSuspension=1}}const Le=new s,Re=new s;class Oe{constructor(t){this.chassisBody=t.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==t.indexRightAxis?t.indexRightAxis:2,this.indexForwardAxis=void 0!==t.indexForwardAxis?t.indexForwardAxis:0,this.indexUpAxis=void 0!==t.indexUpAxis?t.indexUpAxis:1,this.constraints=[],this.preStepCallback=()=>{},this.currentVehicleSpeedKmHour=0,this.numWheelsOnGround=0}addWheel(t){void 0===t&&(t={});const e=new ze(t),n=this.wheelInfos.length;return this.wheelInfos.push(e),n}setSteeringValue(t,e){this.wheelInfos[e].steering=t}applyEngineForce(t,e){this.wheelInfos[e].engineForce=t}setBrake(t,e){this.wheelInfos[e].brake=t}addToWorld(t){t.addBody(this.chassisBody);const e=this;this.preStepCallback=()=>{e.updateVehicle(t.dt)},t.addEventListener("preStep",this.preStepCallback),this.world=t}getVehicleAxisWorld(t,e){e.set(0===t?1:0,1===t?1:0,2===t?1:0),this.chassisBody.vectorToWorldFrame(e,e)}updateVehicle(t){const e=this.wheelInfos,n=e.length,r=this.chassisBody;for(let t=0;t<n;t++)this.updateWheelTransform(t);this.currentVehicleSpeedKmHour=3.6*r.velocity.length();const i=new s;this.getVehicleAxisWorld(this.indexForwardAxis,i),i.dot(r.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(let t=0;t<n;t++)this.castRay(e[t]);this.updateSuspension(t);const o=new s,a=new s;for(let i=0;i<n;i++){const n=e[i];let s=n.suspensionForce;s>n.maxSuspensionForce&&(s=n.maxSuspensionForce),n.raycastResult.hitNormalWorld.scale(s*t,o),n.raycastResult.hitPointWorld.vsub(r.position,a),r.applyImpulse(o,a)}this.updateFriction(t);const l=new s,u=new s,c=new s;for(let i=0;i<n;i++){const n=e[i];r.getVelocityAtWorldPoint(n.chassisConnectionPointWorld,c);let o=1;switch(this.indexUpAxis){case 1:o=-1}if(n.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,u);const e=u.dot(n.raycastResult.hitNormalWorld);n.raycastResult.hitNormalWorld.scale(e,l),u.vsub(l,u);const r=u.dot(c);n.deltaRotation=o*r*t/n.radius}!n.sliding&&n.isInContact||0===n.engineForce||!n.useCustomSlidingRotationalSpeed||(n.deltaRotation=(n.engineForce>0?1:-1)*n.customSlidingRotationalSpeed*t),Math.abs(n.brake)>Math.abs(n.engineForce)&&(n.deltaRotation=0),n.rotation+=n.deltaRotation,n.deltaRotation*=.99}}updateSuspension(t){const e=this.chassisBody.mass,n=this.wheelInfos,r=n.length;for(let t=0;t<r;t++){const r=n[t];if(r.isInContact){let t;const n=r.suspensionRestLength-r.suspensionLength;t=r.suspensionStiffness*n*r.clippedInvContactDotSuspension;const i=r.suspensionRelativeVelocity;let o;o=i<0?r.dampingCompression:r.dampingRelaxation,t-=o*i,r.suspensionForce=t*e,r.suspensionForce<0&&(r.suspensionForce=0)}else r.suspensionForce=0}}removeFromWorld(t){this.constraints,t.removeBody(this.chassisBody),t.removeEventListener("preStep",this.preStepCallback),this.world=null}castRay(t){const e=De,n=We;this.updateWheelTransformWorld(t);const r=this.chassisBody;let i=-1;const o=t.suspensionRestLength+t.radius;t.directionWorld.scale(o,e);const a=t.chassisConnectionPointWorld;a.vadd(e,n);const l=t.raycastResult;l.reset();const u=r.collisionResponse;r.collisionResponse=!1,this.world.rayTest(a,n,l),r.collisionResponse=u;const c=l.body;if(t.raycastResult.groundObject=0,c){i=l.distance,t.raycastResult.hitNormalWorld=l.hitNormalWorld,t.isInContact=!0;const e=l.distance;t.suspensionLength=e-t.radius;const n=t.suspensionRestLength-t.maxSuspensionTravel,o=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<n&&(t.suspensionLength=n),t.suspensionLength>o&&(t.suspensionLength=o,t.raycastResult.reset());const a=t.raycastResult.hitNormalWorld.dot(t.directionWorld),u=new s;r.getVelocityAtWorldPoint(t.raycastResult.hitPointWorld,u);const c=t.raycastResult.hitNormalWorld.dot(u);if(a>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{const e=-1/a;t.suspensionRelativeVelocity=c*e,t.clippedInvContactDotSuspension=e}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return i}updateWheelTransformWorld(t){t.isInContact=!1;const e=this.chassisBody;e.pointToWorldFrame(t.chassisConnectionPointLocal,t.chassisConnectionPointWorld),e.vectorToWorldFrame(t.directionLocal,t.directionWorld),e.vectorToWorldFrame(t.axleLocal,t.axleWorld)}updateWheelTransform(t){const e=qe,n=je,r=Ne,i=this.wheelInfos[t];this.updateWheelTransformWorld(i),i.directionLocal.scale(-1,e),n.copy(i.axleLocal),e.cross(n,r),r.normalize(),n.normalize();const o=i.steering,s=new v;s.setFromAxisAngle(e,o);const a=new v;a.setFromAxisAngle(n,i.rotation);const l=i.worldTransform.quaternion;this.chassisBody.quaternion.mult(s,l),l.mult(a,l),l.normalize();const u=i.worldTransform.position;u.copy(i.directionWorld),u.scale(i.suspensionLength,u),u.vadd(i.chassisConnectionPointWorld,u)}getWheelTransformWorld(t){return this.wheelInfos[t].worldTransform}updateFriction(t){const e=He,n=this.wheelInfos,r=n.length,i=this.chassisBody,o=Ke,a=Ge;this.numWheelsOnGround=0;for(let t=0;t<r;t++){const e=n[t];e.raycastResult.body&&this.numWheelsOnGround++,e.sideImpulse=0,e.forwardImpulse=0,o[t]||(o[t]=new s),a[t]||(a[t]=new s)}for(let t=0;t<r;t++){const r=n[t],s=r.raycastResult.body;if(s){const n=a[t];this.getWheelTransformWorld(t).vectorToWorldFrame(Ue[this.indexRightAxis],n);const l=r.raycastResult.hitNormalWorld,u=n.dot(l);l.scale(u,e),n.vsub(e,n),n.normalize(),l.cross(n,o[t]),o[t].normalize(),r.sideImpulse=ln(i,r.raycastResult.hitPointWorld,s,r.raycastResult.hitPointWorld,n),r.sideImpulse*=$e}}this.sliding=!1;for(let e=0;e<r;e++){const r=n[e],s=r.raycastResult.body;let a=0;if(r.slipInfo=1,s){const n=0,l=r.brake?r.brake:n;a=Qe(i,s,r.raycastResult.hitPointWorld,o[e],l),a+=r.engineForce*t;const u=l/a;r.slipInfo*=u}if(r.forwardImpulse=0,r.skidInfo=1,s){r.skidInfo=1;const e=r.suspensionForce*t*r.frictionSlip,n=e*e;r.forwardImpulse=a;const i=.5*r.forwardImpulse/r.forwardAcceleration,o=1*r.sideImpulse/r.sideAcceleration,s=i*i+o*o;if(r.sliding=!1,s>n){this.sliding=!0,r.sliding=!0;const t=e/Math.sqrt(s);r.skidInfo*=t}}}if(this.sliding)for(let t=0;t<r;t++){const e=n[t];0!==e.sideImpulse&&e.skidInfo<1&&(e.forwardImpulse*=e.skidInfo,e.sideImpulse*=e.skidInfo)}for(let t=0;t<r;t++){const e=n[t],r=new s;if(e.raycastResult.hitPointWorld.vsub(i.position,r),0!==e.forwardImpulse){const n=new s;o[t].scale(e.forwardImpulse,n),i.applyImpulse(n,r)}if(0!==e.sideImpulse){const n=e.raycastResult.body,o=new s;e.raycastResult.hitPointWorld.vsub(n.position,o);const l=new s;a[t].scale(e.sideImpulse,l),i.vectorToLocalFrame(r,r),r["xyz"[this.indexUpAxis]]*=e.rollInfluence,i.vectorToWorldFrame(r,r),i.applyImpulse(l,r),l.scale(-1,l),n.applyImpulse(l,o)}}}}new s,new s,new s;const qe=new s,je=new s,Ne=new s;new ut,new s;const De=new s,We=new s,Ue=[new s(1,0,0),new s(0,1,0),new s(0,0,1)],He=new s,Ge=[],Ke=[],$e=1,Ye=new s,Xe=new s,Ze=new s;function Qe(t,e,n,r,i){let o=0;const s=n,a=Ye,l=Xe,u=Ze;t.getVelocityAtWorldPoint(s,a),e.getVelocityAtWorldPoint(s,l),a.vsub(l,u);return o=-r.dot(u)*(1/(rn(t,n,r)+rn(e,n,r))),i<o&&(o=i),o<-i&&(o=-i),o}const Je=new s,tn=new s,en=new s,nn=new s;function rn(t,e,n){const r=Je,i=tn,o=en,s=nn;return e.vsub(t.position,r),r.cross(n,i),t.invInertiaWorld.vmult(i,s),s.cross(r,o),t.invMass+n.dot(o)}const on=new s,sn=new s,an=new s;function ln(t,e,n,r,i){if(i.lengthSquared()>1.1)return 0;const o=on,s=sn,a=an;t.getVelocityAtWorldPoint(e,o),n.getVelocityAtWorldPoint(r,s),o.vsub(s,a);return-.2*i.dot(a)*(1/(t.invMass+n.invMass))}class un extends w{constructor(t){if(super({type:w.types.SPHERE}),this.radius=void 0!==t?t:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(t,e){void 0===e&&(e=new s);const n=2*t*this.radius*this.radius/5;return e.x=n,e.y=n,e.z=n,e}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(t,e,n,r){const i=this.radius,o=["x","y","z"];for(let e=0;e<o.length;e++){const s=o[e];n[s]=t[s]-i,r[s]=t[s]+i}}}class cn{constructor(t){void 0===t&&(t={}),this.wheelBodies=[],this.coordinateSystem=void 0!==t.coordinateSystem?t.coordinateSystem.clone():new s(1,2,3),t.chassisBody?this.chassisBody=t.chassisBody:this.chassisBody=new F({mass:1,shape:new P(new s(5,.5,2))}),this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}addWheel(t){let e;void 0===t&&(t={}),e=t.body?t.body:new F({mass:1,shape:new un(1.2)}),this.wheelBodies.push(e),this.wheelForces.push(0);const n=void 0!==t.position?t.position.clone():new s,r=new s;this.chassisBody.pointToWorldFrame(n,r),e.position.set(r.x,r.y,r.z);const i=void 0!==t.axis?t.axis.clone():new s(0,0,1);this.wheelAxes.push(i);const o=new ve(this.chassisBody,e,{pivotA:n,axisA:i,pivotB:s.ZERO,axisB:i,collideConnected:!1});return this.constraints.push(o),this.wheelBodies.length-1}setSteeringValue(t,e){const n=this.wheelAxes[e],r=Math.cos(t),i=Math.sin(t),o=n.x,s=n.z;this.constraints[e].axisA.set(-r*o+i*s,0,i*o+r*s)}setMotorSpeed(t,e){const n=this.constraints[e];n.enableMotor(),n.motorTargetVelocity=t}disableMotor(t){this.constraints[t].disableMotor()}setWheelForce(t,e){this.wheelForces[e]=t}applyWheelForce(t,e){const n=this.wheelAxes[e],r=this.wheelBodies[e],i=r.torque;n.scale(t,dn),r.vectorToWorldFrame(dn,dn),i.vadd(dn,i)}addToWorld(t){const e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]);for(let e=0;e<n.length;e++)t.addBody(n[e]);for(let n=0;n<e.length;n++)t.addConstraint(e[n]);t.addEventListener("preStep",this._update.bind(this))}_update(){const t=this.wheelForces;for(let e=0;e<t.length;e++)this.applyWheelForce(t[e],e)}removeFromWorld(t){const e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]);for(let e=0;e<n.length;e++)t.removeBody(n[e]);for(let n=0;n<e.length;n++)t.removeConstraint(e[n])}getWheelSpeed(t){const e=this.wheelAxes[t],n=this.wheelBodies[t].angularVelocity;return this.chassisBody.vectorToWorldFrame(e,hn),n.dot(hn)}}const dn=new s,hn=new s;class pn{constructor(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}add(t){this.particles.push(t),this.neighbors.length<this.particles.length&&this.neighbors.push([])}remove(t){const e=this.particles.indexOf(t);-1!==e&&(this.particles.splice(e,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())}getNeighbors(t,e){const n=this.particles.length,r=t.id,i=this.smoothingRadius*this.smoothingRadius,o=fn;for(let s=0;s!==n;s++){const n=this.particles[s];n.position.vsub(t.position,o),r!==n.id&&o.lengthSquared()<i&&e.push(n)}}update(){const t=this.particles.length,e=vn,n=this.speedOfSound,r=this.eps;for(let r=0;r!==t;r++){const t=this.particles[r],i=this.neighbors[r];i.length=0,this.getNeighbors(t,i),i.push(this.particles[r]);const o=i.length;let s=0;for(let n=0;n!==o;n++){t.position.vsub(i[n].position,e);const r=e.length(),o=this.w(r);s+=i[n].mass*o}this.densities[r]=s,this.pressures[r]=n*n*(this.densities[r]-this.density)}const i=mn,o=bn,s=gn,a=wn,l=_n;for(let e=0;e!==t;e++){const t=this.particles[e];let n,u;i.set(0,0,0),o.set(0,0,0);const c=this.neighbors[e],d=c.length;for(let h=0;h!==d;h++){const d=c[h];t.position.vsub(d.position,a);const p=a.length();n=-d.mass*(this.pressures[e]/(this.densities[e]*this.densities[e]+r)+this.pressures[h]/(this.densities[h]*this.densities[h]+r)),this.gradw(a,s),s.scale(n,s),i.vadd(s,i),d.velocity.vsub(t.velocity,l),l.scale(1/(1e-4+this.densities[e]*this.densities[h])*this.viscosity*d.mass,l),u=this.nablaw(p),l.scale(u,l),o.vadd(l,o)}o.scale(t.mass,o),i.scale(t.mass,i),t.force.vadd(o,t.force),t.force.vadd(i,t.force)}}w(t){const e=this.smoothingRadius;return 315/(64*Math.PI*e**9)*(e*e-t*t)**3}gradw(t,e){const n=t.length(),r=this.smoothingRadius;t.scale(945/(32*Math.PI*r**9)*(r*r-n*n)**2,e)}nablaw(t){const e=this.smoothingRadius;return 945/(32*Math.PI*e**9)*(e*e-t*t)*(7*t*t-3*e*e)}}const fn=new s,vn=new s,mn=new s,bn=new s,gn=new s,wn=new s,_n=new s;class yn extends x{constructor(t,e,n,r){if(void 0===t&&(t=1),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=8),t<0)throw new Error("The cylinder radiusTop cannot be negative.");if(e<0)throw new Error("The cylinder radiusBottom cannot be negative.");const i=r,o=[],a=[],l=[],u=[],c=[],d=Math.cos,h=Math.sin;o.push(new s(-e*h(0),.5*-n,e*d(0))),u.push(0),o.push(new s(-t*h(0),.5*n,t*d(0))),c.push(1);for(let r=0;r<i;r++){const p=2*Math.PI/i*(r+1),f=2*Math.PI/i*(r+.5);r<i-1?(o.push(new s(-e*h(p),.5*-n,e*d(p))),u.push(2*r+2),o.push(new s(-t*h(p),.5*n,t*d(p))),c.push(2*r+3),l.push([2*r,2*r+1,2*r+3,2*r+2])):l.push([2*r,2*r+1,1,0]),(i%2==1||r<i/2)&&a.push(new s(-h(f),0,d(f)))}l.push(u),a.push(new s(0,1,0));const p=[];for(let t=0;t<c.length;t++)p.push(c[c.length-t-1]);l.push(p),super({vertices:o,faces:l,axes:a}),this.type=w.types.CYLINDER,this.radiusTop=t,this.radiusBottom=e,this.height=n,this.numSegments=r}}class xn extends w{constructor(){super({type:w.types.PARTICLE})}calculateLocalInertia(t,e){return void 0===e&&(e=new s),e.set(0,0,0),e}volume(){return 0}updateBoundingSphereRadius(){this.boundingSphereRadius=0}calculateWorldAABB(t,e,n,r){n.copy(t),r.copy(t)}}class An extends w{constructor(){super({type:w.types.PLANE}),this.worldNormal=new s,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(t){const e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(t,e){return void 0===e&&(e=new s),e}volume(){return Number.MAX_VALUE}calculateWorldAABB(t,e,n,r){En.set(0,0,1),e.vmult(En,En);const i=Number.MAX_VALUE;n.set(-i,-i,-i),r.set(i,i,i),1===En.x?r.x=t.x:-1===En.x&&(n.x=t.x),1===En.y?r.y=t.y:-1===En.y&&(n.y=t.y),1===En.z?r.z=t.z:-1===En.z&&(n.z=t.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const En=new s;class Cn extends w{constructor(t,e){void 0===e&&(e={}),e=qt.defaults(e,{maxValue:null,minValue:null,elementSize:1}),super({type:w.types.HEIGHTFIELD}),this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementSize=e.elementSize,null===e.minValue&&this.updateMinValue(),null===e.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,this.pillarConvex=new x,this.pillarOffset=new s,this.updateBoundingSphereRadius(),this._cachedPillars={}}update(){this._cachedPillars={}}updateMinValue(){const t=this.data;let e=t[0][0];for(let n=0;n!==t.length;n++)for(let r=0;r!==t[n].length;r++){const i=t[n][r];i<e&&(e=i)}this.minValue=e}updateMaxValue(){const t=this.data;let e=t[0][0];for(let n=0;n!==t.length;n++)for(let r=0;r!==t[n].length;r++){const i=t[n][r];i>e&&(e=i)}this.maxValue=e}setHeightValueAtIndex(t,e,n){this.data[t][e]=n,this.clearCachedConvexTrianglePillar(t,e,!1),t>0&&(this.clearCachedConvexTrianglePillar(t-1,e,!0),this.clearCachedConvexTrianglePillar(t-1,e,!1)),e>0&&(this.clearCachedConvexTrianglePillar(t,e-1,!0),this.clearCachedConvexTrianglePillar(t,e-1,!1)),e>0&&t>0&&this.clearCachedConvexTrianglePillar(t-1,e-1,!0)}getRectMinMax(t,e,n,r,i){void 0===i&&(i=[]);const o=this.data;let s=this.minValue;for(let i=t;i<=n;i++)for(let t=e;t<=r;t++){const e=o[i][t];e>s&&(s=e)}i[0]=this.minValue,i[1]=s}getIndexOfPosition(t,e,n,r){const i=this.elementSize,o=this.data;let s=Math.floor(t/i),a=Math.floor(e/i);return n[0]=s,n[1]=a,r&&(s<0&&(s=0),a<0&&(a=0),s>=o.length-1&&(s=o.length-1),a>=o[0].length-1&&(a=o[0].length-1)),!(s<0||a<0||s>=o.length-1||a>=o[0].length-1)}getTriangleAt(t,e,n,r,i,o){const s=Mn;this.getIndexOfPosition(t,e,s,n);let a=s[0],l=s[1];const u=this.data;n&&(a=Math.min(u.length-2,Math.max(0,a)),l=Math.min(u[0].length-2,Math.max(0,l)));const c=this.elementSize,d=(t/c-a)**2+(e/c-l)**2>(t/c-(a+1))**2+(e/c-(l+1))**2;return this.getTriangle(a,l,d,r,i,o),d}getNormalAt(t,e,n,r){const i=Bn,o=Fn,s=Vn,a=In,l=zn;this.getTriangleAt(t,e,n,i,o,s),o.vsub(i,a),s.vsub(i,l),a.cross(l,r),r.normalize()}getAabbAtIndex(t,e,n){let{lowerBound:r,upperBound:i}=n;const o=this.data,s=this.elementSize;r.set(t*s,e*s,o[t][e]),i.set((t+1)*s,(e+1)*s,o[t+1][e+1])}getHeightAt(t,e,n){const r=this.data,i=Sn,o=kn,s=Tn,a=Mn;this.getIndexOfPosition(t,e,a,n);let l=a[0],u=a[1];n&&(l=Math.min(r.length-2,Math.max(0,l)),u=Math.min(r[0].length-2,Math.max(0,u)));const c=this.getTriangleAt(t,e,n,i,o,s);!function(t,e,n,r,i,o,s,a,l){l.x=((o-a)*(t-s)+(s-i)*(e-a))/((o-a)*(n-s)+(s-i)*(r-a)),l.y=((a-r)*(t-s)+(n-s)*(e-a))/((o-a)*(n-s)+(s-i)*(r-a)),l.z=1-l.x-l.y}(t,e,i.x,i.y,o.x,o.y,s.x,s.y,Pn);const d=Pn;return c?r[l+1][u+1]*d.x+r[l][u+1]*d.y+r[l+1][u]*d.z:r[l][u]*d.x+r[l+1][u]*d.y+r[l][u+1]*d.z}getCacheConvexTrianglePillarKey(t,e,n){return`${t}_${e}_${n?1:0}`}getCachedConvexTrianglePillar(t,e,n){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]}setCachedConvexTrianglePillar(t,e,n,r,i){this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]={convex:r,offset:i}}clearCachedConvexTrianglePillar(t,e,n){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]}getTriangle(t,e,n,r,i,o){const s=this.data,a=this.elementSize;n?(r.set((t+1)*a,(e+1)*a,s[t+1][e+1]),i.set(t*a,(e+1)*a,s[t][e+1]),o.set((t+1)*a,e*a,s[t+1][e])):(r.set(t*a,e*a,s[t][e]),i.set((t+1)*a,e*a,s[t+1][e]),o.set(t*a,(e+1)*a,s[t][e+1]))}getConvexTrianglePillar(t,e,n){let r=this.pillarConvex,i=this.pillarOffset;if(this.cacheEnabled){const o=this.getCachedConvexTrianglePillar(t,e,n);if(o)return this.pillarConvex=o.convex,void(this.pillarOffset=o.offset);r=new x,i=new s,this.pillarConvex=r,this.pillarOffset=i}const o=this.data,a=this.elementSize,l=r.faces;r.vertices.length=6;for(let t=0;t<6;t++)r.vertices[t]||(r.vertices[t]=new s);l.length=5;for(let t=0;t<5;t++)l[t]||(l[t]=[]);const u=r.vertices,c=(Math.min(o[t][e],o[t+1][e],o[t][e+1],o[t+1][e+1])-this.minValue)/2+this.minValue;n?(i.set((t+.75)*a,(e+.75)*a,c),u[0].set(.25*a,.25*a,o[t+1][e+1]-c),u[1].set(-.75*a,.25*a,o[t][e+1]-c),u[2].set(.25*a,-.75*a,o[t+1][e]-c),u[3].set(.25*a,.25*a,-Math.abs(c)-1),u[4].set(-.75*a,.25*a,-Math.abs(c)-1),u[5].set(.25*a,-.75*a,-Math.abs(c)-1),l[0][0]=0,l[0][1]=1,l[0][2]=2,l[1][0]=5,l[1][1]=4,l[1][2]=3,l[2][0]=2,l[2][1]=5,l[2][2]=3,l[2][3]=0,l[3][0]=3,l[3][1]=4,l[3][2]=1,l[3][3]=0,l[4][0]=1,l[4][1]=4,l[4][2]=5,l[4][3]=2):(i.set((t+.25)*a,(e+.25)*a,c),u[0].set(-.25*a,-.25*a,o[t][e]-c),u[1].set(.75*a,-.25*a,o[t+1][e]-c),u[2].set(-.25*a,.75*a,o[t][e+1]-c),u[3].set(-.25*a,-.25*a,-Math.abs(c)-1),u[4].set(.75*a,-.25*a,-Math.abs(c)-1),u[5].set(-.25*a,.75*a,-Math.abs(c)-1),l[0][0]=0,l[0][1]=1,l[0][2]=2,l[1][0]=5,l[1][1]=4,l[1][2]=3,l[2][0]=0,l[2][1]=2,l[2][2]=5,l[2][3]=3,l[3][0]=1,l[3][1]=0,l[3][2]=3,l[3][3]=4,l[4][0]=4,l[4][1]=5,l[4][2]=2,l[4][3]=1),r.computeNormals(),r.computeEdges(),r.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(t,e,n,r,i)}calculateLocalInertia(t,e){return void 0===e&&(e=new s),e.set(0,0,0),e}volume(){return Number.MAX_VALUE}calculateWorldAABB(t,e,n,r){n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}updateBoundingSphereRadius(){const t=this.data,e=this.elementSize;this.boundingSphereRadius=new s(t.length*e,t[0].length*e,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).length()}setHeightsFromImage(t,e){const{x:n,z:r,y:i}=e,o=document.createElement("canvas");o.width=t.width,o.height=t.height;const s=o.getContext("2d");s.drawImage(t,0,0);const a=s.getImageData(0,0,t.width,t.height),l=this.data;l.length=0,this.elementSize=Math.abs(n)/a.width;for(let t=0;t<a.height;t++){const e=[];for(let i=0;i<a.width;i++){const o=(a.data[4*(t*a.height+i)]+a.data[4*(t*a.height+i)+1]+a.data[4*(t*a.height+i)+2])/4/255*r;n<0?e.push(o):e.unshift(o)}i<0?l.unshift(e):l.push(e)}this.updateMaxValue(),this.updateMinValue(),this.update()}}const Mn=[],Pn=new s,Sn=new s,kn=new s,Tn=new s,Bn=new s,Fn=new s,Vn=new s,In=new s,zn=new s;class Ln{constructor(t){void 0===t&&(t={}),this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new c,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(t,e,n){void 0===n&&(n=0);const r=this.data;if(!this.aabb.contains(t))return!1;const i=this.children;if(n<(this.maxDepth||this.root.maxDepth)){let r=!1;i.length||(this.subdivide(),r=!0);for(let r=0;8!==r;r++)if(i[r].insert(t,e,n+1))return!0;r&&(i.length=0)}return r.push(e),!0}subdivide(){const t=this.aabb,e=t.lowerBound,n=t.upperBound,r=this.children;r.push(new Ln({aabb:new c({lowerBound:new s(0,0,0)})}),new Ln({aabb:new c({lowerBound:new s(1,0,0)})}),new Ln({aabb:new c({lowerBound:new s(1,1,0)})}),new Ln({aabb:new c({lowerBound:new s(1,1,1)})}),new Ln({aabb:new c({lowerBound:new s(0,1,1)})}),new Ln({aabb:new c({lowerBound:new s(0,0,1)})}),new Ln({aabb:new c({lowerBound:new s(1,0,1)})}),new Ln({aabb:new c({lowerBound:new s(0,1,0)})})),n.vsub(e,On),On.scale(.5,On);const i=this.root||this;for(let t=0;8!==t;t++){const n=r[t];n.root=i;const o=n.aabb.lowerBound;o.x*=On.x,o.y*=On.y,o.z*=On.z,o.vadd(e,o),o.vadd(On,n.aabb.upperBound)}}aabbQuery(t,e){this.data,this.children;const n=[this];for(;n.length;){const r=n.pop();r.aabb.overlaps(t)&&Array.prototype.push.apply(e,r.data),Array.prototype.push.apply(n,r.children)}return e}rayQuery(t,e,n){return t.getAABB(qn),qn.toLocalFrame(e,qn),this.aabbQuery(qn,n),n}removeEmptyNodes(){for(let t=this.children.length-1;t>=0;t--)this.children[t].removeEmptyNodes(),this.children[t].children.length||this.children[t].data.length||this.children.splice(t,1)}}class Rn extends Ln{constructor(t,e){void 0===e&&(e={}),super({root:null,aabb:t}),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}}const On=new s,qn=new c;class jn extends w{constructor(t,e){super({type:w.types.TRIMESH}),this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new c,this.edges=null,this.scale=new s(1,1,1),this.tree=new Rn,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const t=this.tree;t.reset(),t.aabb.copy(this.aabb);const e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;const n=new c,r=new s,i=new s,o=new s,a=[r,i,o];for(let e=0;e<this.indices.length/3;e++){const s=3*e;this._getUnscaledVertex(this.indices[s],r),this._getUnscaledVertex(this.indices[s+1],i),this._getUnscaledVertex(this.indices[s+2],o),n.setFromPoints(a),t.insert(n,e)}t.removeEmptyNodes()}getTrianglesInAABB(t,e){Dn.copy(t);const n=this.scale,r=n.x,i=n.y,o=n.z,s=Dn.lowerBound,a=Dn.upperBound;return s.x/=r,s.y/=i,s.z/=o,a.x/=r,a.y/=i,a.z/=o,this.tree.aabbQuery(Dn,e)}setScale(t){const e=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,n=t.x===t.y&&t.y===t.z;e&&n||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const t=Nn,e=this.normals;for(let n=0;n<this.indices.length/3;n++){const r=3*n,i=this.indices[r],o=this.indices[r+1],s=this.indices[r+2];this.getVertex(i,Kn),this.getVertex(o,$n),this.getVertex(s,Yn),jn.computeNormal($n,Kn,Yn,t),e[r]=t.x,e[r+1]=t.y,e[r+2]=t.z}}updateEdges(){const t={},e=(e,n)=>{t[e<n?`${e}_${n}`:`${n}_${e}`]=!0};for(let t=0;t<this.indices.length/3;t++){const n=3*t,r=this.indices[n],i=this.indices[n+1],o=this.indices[n+2];e(r,i),e(i,o),e(o,r)}const n=Object.keys(t);this.edges=new Int16Array(2*n.length);for(let t=0;t<n.length;t++){const e=n[t].split("_");this.edges[2*t]=parseInt(e[0],10),this.edges[2*t+1]=parseInt(e[1],10)}}getEdgeVertex(t,e,n){const r=this.edges[2*t+(e?1:0)];this.getVertex(r,n)}getEdgeVector(t,e){const n=Wn,r=Un;this.getEdgeVertex(t,0,n),this.getEdgeVertex(t,1,r),r.vsub(n,e)}static computeNormal(t,e,n,r){e.vsub(t,Gn),n.vsub(e,Hn),Hn.cross(Gn,r),r.isZero()||r.normalize()}getVertex(t,e){const n=this.scale;return this._getUnscaledVertex(t,e),e.x*=n.x,e.y*=n.y,e.z*=n.z,e}_getUnscaledVertex(t,e){const n=3*t,r=this.vertices;return e.set(r[n],r[n+1],r[n+2])}getWorldVertex(t,e,n,r){return this.getVertex(t,r),_.pointToWorldFrame(e,n,r,r),r}getTriangleVertices(t,e,n,r){const i=3*t;this.getVertex(this.indices[i],e),this.getVertex(this.indices[i+1],n),this.getVertex(this.indices[i+2],r)}getNormal(t,e){const n=3*t;return e.set(this.normals[n],this.normals[n+1],this.normals[n+2])}calculateLocalInertia(t,e){this.computeLocalAABB(Xn);const n=Xn.upperBound.x-Xn.lowerBound.x,r=Xn.upperBound.y-Xn.lowerBound.y,i=Xn.upperBound.z-Xn.lowerBound.z;return e.set(1/12*t*(2*r*2*r+2*i*2*i),1/12*t*(2*n*2*n+2*i*2*i),1/12*t*(2*r*2*r+2*n*2*n))}computeLocalAABB(t){const e=t.lowerBound,n=t.upperBound,r=this.vertices.length;this.vertices;const i=Zn;this.getVertex(0,i),e.copy(i),n.copy(i);for(let t=0;t!==r;t++)this.getVertex(t,i),i.x<e.x?e.x=i.x:i.x>n.x&&(n.x=i.x),i.y<e.y?e.y=i.y:i.y>n.y&&(n.y=i.y),i.z<e.z?e.z=i.z:i.z>n.z&&(n.z=i.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let t=0;const e=this.vertices,n=new s;for(let r=0,i=e.length/3;r!==i;r++){this.getVertex(r,n);const e=n.lengthSquared();e>t&&(t=e)}this.boundingSphereRadius=Math.sqrt(t)}calculateWorldAABB(t,e,n,r){const i=Qn,o=Jn;i.position=t,i.quaternion=e,this.aabb.toWorldFrame(i,o),n.copy(o.lowerBound),r.copy(o.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(t,e,n,r,i){void 0===t&&(t=1),void 0===e&&(e=.5),void 0===n&&(n=8),void 0===r&&(r=6),void 0===i&&(i=2*Math.PI);const o=[],s=[];for(let s=0;s<=n;s++)for(let a=0;a<=r;a++){const l=a/r*i,u=s/n*Math.PI*2,c=(t+e*Math.cos(u))*Math.cos(l),d=(t+e*Math.cos(u))*Math.sin(l),h=e*Math.sin(u);o.push(c,d,h)}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*t+e-1,i=(r+1)*(t-1)+e-1,o=(r+1)*(t-1)+e,a=(r+1)*t+e;s.push(n,i,a),s.push(i,o,a)}return new jn(o,s)}}const Nn=new s,Dn=new c,Wn=new s,Un=new s,Hn=new s,Gn=new s,Kn=new s,$n=new s,Yn=new s,Xn=new c,Zn=new s,Qn=new _,Jn=new c;class tr{constructor(){this.equations=[]}solve(t,e){return 0}addEquation(t){!t.enabled||t.bi.isTrigger||t.bj.isTrigger||this.equations.push(t)}removeEquation(t){const e=this.equations,n=e.indexOf(t);-1!==n&&e.splice(n,1)}removeAllEquations(){this.equations.length=0}}class er extends tr{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(t,e){let n=0;const r=this.iterations,i=this.tolerance*this.tolerance,o=this.equations,s=o.length,a=e.bodies,l=a.length,u=t;let c,d,h,p,f,v;if(0!==s)for(let t=0;t!==l;t++)a[t].updateSolveMassProperties();const m=rr,b=ir,g=nr;m.length=s,b.length=s,g.length=s;for(let t=0;t!==s;t++){const e=o[t];g[t]=0,b[t]=e.computeB(u),m[t]=1/e.computeC()}if(0!==s){for(let t=0;t!==l;t++){const e=a[t],n=e.vlambda,r=e.wlambda;n.set(0,0,0),r.set(0,0,0)}for(n=0;n!==r;n++){p=0;for(let t=0;t!==s;t++){const e=o[t];c=b[t],d=m[t],v=g[t],f=e.computeGWlambda(),h=d*(c-f-e.eps*v),v+h<e.minForce?h=e.minForce-v:v+h>e.maxForce&&(h=e.maxForce-v),g[t]+=h,p+=h>0?h:-h,e.addToWlambda(h)}if(p*p<i)break}for(let t=0;t!==l;t++){const e=a[t],n=e.velocity,r=e.angularVelocity;e.vlambda.vmul(e.linearFactor,e.vlambda),n.vadd(e.vlambda,n),e.wlambda.vmul(e.angularFactor,e.wlambda),r.vadd(e.wlambda,r)}let t=o.length;const e=1/u;for(;t--;)o[t].multiplier=g[t]*e}return n}}const nr=[],rr=[],ir=[];class or extends tr{constructor(t){for(super(),this.iterations=10,this.tolerance=1e-7,this.subsolver=t,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}createNode(){return{body:null,children:[],eqs:[],visited:!1}}solve(t,e){const n=sr,r=this.nodePool,i=e.bodies,o=this.equations,s=o.length,a=i.length,l=this.subsolver;for(;r.length<a;)r.push(this.createNode());n.length=a;for(let t=0;t<a;t++)n[t]=r[t];for(let t=0;t!==a;t++){const e=n[t];e.body=i[t],e.children.length=0,e.eqs.length=0,e.visited=!1}for(let t=0;t!==s;t++){const e=o[t],r=i.indexOf(e.bi),s=i.indexOf(e.bj),a=n[r],l=n[s];a.children.push(l),a.eqs.push(e),l.children.push(a),l.eqs.push(e)}let u,c=0,d=ar;l.tolerance=this.tolerance,l.iterations=this.iterations;const h=lr;for(;u=cr(n);){d.length=0,h.bodies.length=0,hr(u,pr,h.bodies,d);const e=d.length;d=d.sort(fr);for(let t=0;t!==e;t++)l.addEquation(d[t]);l.solve(t,h),l.removeAllEquations(),c++}return c}}const sr=[],ar=[],lr={bodies:[]},ur=F.STATIC;function cr(t){const e=t.length;for(let n=0;n!==e;n++){const e=t[n];if(!(e.visited||e.body.type&ur))return e}return!1}const dr=[];function hr(t,e,n,r){for(dr.push(t),t.visited=!0,e(t,n,r);dr.length;){const t=dr.pop();let i;for(;i=cr(t.children);)i.visited=!0,e(i,n,r),dr.push(i)}}function pr(t,e,n){e.push(t.body);const r=t.eqs.length;for(let e=0;e!==r;e++){const r=t.eqs[e];n.includes(r)||n.push(r)}}function fr(t,e){return e.id-t.id}class vr{constructor(){this.objects=[],this.type=Object}release(){const t=arguments.length;for(let e=0;e!==t;e++)this.objects.push(e<0||arguments.length<=e?void 0:arguments[e]);return this}get(){return 0===this.objects.length?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(t){const e=this.objects;for(;e.length>t;)e.pop();for(;e.length<t;)e.push(this.constructObject());return this}}class mr extends vr{constructor(){super(...arguments),this.type=s}constructObject(){return new s}}const br={sphereSphere:w.types.SPHERE,spherePlane:w.types.SPHERE|w.types.PLANE,boxBox:w.types.BOX|w.types.BOX,sphereBox:w.types.SPHERE|w.types.BOX,planeBox:w.types.PLANE|w.types.BOX,convexConvex:w.types.CONVEXPOLYHEDRON,sphereConvex:w.types.SPHERE|w.types.CONVEXPOLYHEDRON,planeConvex:w.types.PLANE|w.types.CONVEXPOLYHEDRON,boxConvex:w.types.BOX|w.types.CONVEXPOLYHEDRON,sphereHeightfield:w.types.SPHERE|w.types.HEIGHTFIELD,boxHeightfield:w.types.BOX|w.types.HEIGHTFIELD,convexHeightfield:w.types.CONVEXPOLYHEDRON|w.types.HEIGHTFIELD,sphereParticle:w.types.PARTICLE|w.types.SPHERE,planeParticle:w.types.PLANE|w.types.PARTICLE,boxParticle:w.types.BOX|w.types.PARTICLE,convexParticle:w.types.PARTICLE|w.types.CONVEXPOLYHEDRON,cylinderCylinder:w.types.CYLINDER,sphereCylinder:w.types.SPHERE|w.types.CYLINDER,planeCylinder:w.types.PLANE|w.types.CYLINDER,boxCylinder:w.types.BOX|w.types.CYLINDER,convexCylinder:w.types.CONVEXPOLYHEDRON|w.types.CYLINDER,heightfieldCylinder:w.types.HEIGHTFIELD|w.types.CYLINDER,particleCylinder:w.types.PARTICLE|w.types.CYLINDER,sphereTrimesh:w.types.SPHERE|w.types.TRIMESH,planeTrimesh:w.types.PLANE|w.types.TRIMESH};class gr{get[br.sphereSphere](){return this.sphereSphere}get[br.spherePlane](){return this.spherePlane}get[br.boxBox](){return this.boxBox}get[br.sphereBox](){return this.sphereBox}get[br.planeBox](){return this.planeBox}get[br.convexConvex](){return this.convexConvex}get[br.sphereConvex](){return this.sphereConvex}get[br.planeConvex](){return this.planeConvex}get[br.boxConvex](){return this.boxConvex}get[br.sphereHeightfield](){return this.sphereHeightfield}get[br.boxHeightfield](){return this.boxHeightfield}get[br.convexHeightfield](){return this.convexHeightfield}get[br.sphereParticle](){return this.sphereParticle}get[br.planeParticle](){return this.planeParticle}get[br.boxParticle](){return this.boxParticle}get[br.convexParticle](){return this.convexParticle}get[br.cylinderCylinder](){return this.convexConvex}get[br.sphereCylinder](){return this.sphereConvex}get[br.planeCylinder](){return this.planeConvex}get[br.boxCylinder](){return this.boxConvex}get[br.convexCylinder](){return this.convexConvex}get[br.heightfieldCylinder](){return this.heightfieldCylinder}get[br.particleCylinder](){return this.particleCylinder}get[br.sphereTrimesh](){return this.sphereTrimesh}get[br.planeTrimesh](){return this.planeTrimesh}constructor(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new mr,this.world=t,this.currentContactMaterial=t.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(t,e,n,r,i,o){let s;this.contactPointPool.length?(s=this.contactPointPool.pop(),s.bi=t,s.bj=e):s=new Yt(t,e),s.enabled=t.collisionResponse&&e.collisionResponse&&n.collisionResponse&&r.collisionResponse;const a=this.currentContactMaterial;s.restitution=a.restitution,s.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);const l=n.material||t.material,u=r.material||e.material;return l&&u&&l.restitution>=0&&u.restitution>=0&&(s.restitution=l.restitution*u.restitution),s.si=i||n,s.sj=o||r,s}createFrictionEquationsFromContact(t,e){const n=t.bi,r=t.bj,i=t.si,o=t.sj,s=this.world,a=this.currentContactMaterial;let l=a.friction;const u=i.material||n.material,c=o.material||r.material;if(u&&c&&u.friction>=0&&c.friction>=0&&(l=u.friction*c.friction),l>0){const i=l*(s.frictionGravity||s.gravity).length();let o=n.invMass+r.invMass;o>0&&(o=1/o);const u=this.frictionEquationPool,c=u.length?u.pop():new ge(n,r,i*o),d=u.length?u.pop():new ge(n,r,i*o);return c.bi=d.bi=n,c.bj=d.bj=r,c.minForce=d.minForce=-i*o,c.maxForce=d.maxForce=i*o,c.ri.copy(t.ri),c.rj.copy(t.rj),d.ri.copy(t.ri),d.rj.copy(t.rj),t.ni.tangents(c.t,d.t),c.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),d.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),c.enabled=d.enabled=t.enabled,e.push(c,d),!0}return!1}createFrictionFromAverage(t){let e=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(e,this.frictionResult)||1===t)return;const n=this.frictionResult[this.frictionResult.length-2],r=this.frictionResult[this.frictionResult.length-1];wr.setZero(),_r.setZero(),yr.setZero();const i=e.bi;e.bj;for(let n=0;n!==t;n++)e=this.result[this.result.length-1-n],e.bi!==i?(wr.vadd(e.ni,wr),_r.vadd(e.ri,_r),yr.vadd(e.rj,yr)):(wr.vsub(e.ni,wr),_r.vadd(e.rj,_r),yr.vadd(e.ri,yr));const o=1/t;_r.scale(o,n.ri),yr.scale(o,n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj),wr.normalize(),wr.tangents(n.t,r.t)}getContacts(t,e,n,r,i,o,s){this.contactPointPool=i,this.frictionEquationPool=s,this.result=r,this.frictionResult=o;const a=Er,l=Cr,u=xr,c=Ar;for(let r=0,i=t.length;r!==i;r++){const i=t[r],o=e[r];let s=null;i.material&&o.material&&(s=n.getContactMaterial(i.material,o.material)||null);const d=i.type&F.KINEMATIC&&o.type&F.STATIC||i.type&F.STATIC&&o.type&F.KINEMATIC||i.type&F.KINEMATIC&&o.type&F.KINEMATIC;for(let t=0;t<i.shapes.length;t++){i.quaternion.mult(i.shapeOrientations[t],a),i.quaternion.vmult(i.shapeOffsets[t],u),u.vadd(i.position,u);const e=i.shapes[t];for(let t=0;t<o.shapes.length;t++){o.quaternion.mult(o.shapeOrientations[t],l),o.quaternion.vmult(o.shapeOffsets[t],c),c.vadd(o.position,c);const r=o.shapes[t];if(!(e.collisionFilterMask&r.collisionFilterGroup&&r.collisionFilterMask&e.collisionFilterGroup))continue;if(u.distanceTo(c)>e.boundingSphereRadius+r.boundingSphereRadius)continue;let h=null;e.material&&r.material&&(h=n.getContactMaterial(e.material,r.material)||null),this.currentContactMaterial=h||s||n.defaultContactMaterial;const p=this[e.type|r.type];if(p){let t=!1;t=e.type<r.type?p.call(this,e,r,u,c,a,l,i,o,e,r,d):p.call(this,r,e,c,u,l,a,o,i,e,r,d),t&&d&&(n.shapeOverlapKeeper.set(e.id,r.id),n.bodyOverlapKeeper.set(i.id,o.id))}}}}}sphereSphere(t,e,n,r,i,o,s,a,l,u,c){if(c)return n.distanceSquared(r)<(t.radius+e.radius)**2;const d=this.createContactEquation(s,a,t,e,l,u);r.vsub(n,d.ni),d.ni.normalize(),d.ri.copy(d.ni),d.rj.copy(d.ni),d.ri.scale(t.radius,d.ri),d.rj.scale(-e.radius,d.rj),d.ri.vadd(n,d.ri),d.ri.vsub(s.position,d.ri),d.rj.vadd(r,d.rj),d.rj.vsub(a.position,d.rj),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}spherePlane(t,e,n,r,i,o,s,a,l,u,c){const d=this.createContactEquation(s,a,t,e,l,u);if(d.ni.set(0,0,1),o.vmult(d.ni,d.ni),d.ni.negate(d.ni),d.ni.normalize(),d.ni.scale(t.radius,d.ri),n.vsub(r,Ur),d.ni.scale(d.ni.dot(Ur),Hr),Ur.vsub(Hr,d.rj),-Ur.dot(d.ni)<=t.radius){if(c)return!0;const t=d.ri,e=d.rj;t.vadd(n,t),t.vsub(s.position,t),e.vadd(r,e),e.vsub(a.position,e),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}}boxBox(t,e,n,r,i,o,s,a,l,u,c){return t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,n,r,i,o,s,a,t,e,c)}sphereBox(t,e,n,r,i,o,s,a,l,u,c){const d=this.v3pool,h=ti;n.vsub(r,Xr),e.getSideNormals(h,o);const p=t.radius;let f=!1;const v=ni,m=ri,b=ii;let g=null,w=0,_=0,y=0,x=null;for(let t=0,e=h.length;t!==e&&!1===f;t++){const e=Zr;e.copy(h[t]);const n=e.length();e.normalize();const r=Xr.dot(e);if(r<n+p&&r>0){const i=Qr,o=Jr;i.copy(h[(t+1)%3]),o.copy(h[(t+2)%3]);const s=i.length(),a=o.length();i.normalize(),o.normalize();const l=Xr.dot(i),u=Xr.dot(o);if(l<s&&l>-s&&u<a&&u>-a){const t=Math.abs(r-n-p);if((null===x||t<x)&&(x=t,_=l,y=u,g=n,v.copy(e),m.copy(i),b.copy(o),w++,c))return!0}}}if(w){f=!0;const i=this.createContactEquation(s,a,t,e,l,u);v.scale(-p,i.ri),i.ni.copy(v),i.ni.negate(i.ni),v.scale(g,v),m.scale(_,m),v.vadd(m,v),b.scale(y,b),v.vadd(b,i.rj),i.ri.vadd(n,i.ri),i.ri.vsub(s.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}let A=d.get();const E=ei;for(let i=0;2!==i&&!f;i++)for(let o=0;2!==o&&!f;o++)for(let d=0;2!==d&&!f;d++)if(A.set(0,0,0),i?A.vadd(h[0],A):A.vsub(h[0],A),o?A.vadd(h[1],A):A.vsub(h[1],A),d?A.vadd(h[2],A):A.vsub(h[2],A),r.vadd(A,E),E.vsub(n,E),E.lengthSquared()<p*p){if(c)return!0;f=!0;const i=this.createContactEquation(s,a,t,e,l,u);i.ri.copy(E),i.ri.normalize(),i.ni.copy(i.ri),i.ri.scale(p,i.ri),i.rj.copy(A),i.ri.vadd(n,i.ri),i.ri.vsub(s.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}d.release(A),A=null;const C=d.get(),M=d.get(),P=d.get(),S=d.get(),k=d.get(),T=h.length;for(let i=0;i!==T&&!f;i++)for(let o=0;o!==T&&!f;o++)if(i%3!=o%3){h[o].cross(h[i],C),C.normalize(),h[i].vadd(h[o],M),P.copy(n),P.vsub(M,P),P.vsub(r,P);const d=P.dot(C);C.scale(d,S);let v=0;for(;v===i%3||v===o%3;)v++;k.copy(n),k.vsub(S,k),k.vsub(M,k),k.vsub(r,k);const m=Math.abs(d),b=k.length();if(m<h[v].length()&&b<p){if(c)return!0;f=!0;const i=this.createContactEquation(s,a,t,e,l,u);M.vadd(S,i.rj),i.rj.copy(i.rj),k.negate(i.ni),i.ni.normalize(),i.ri.copy(i.rj),i.ri.vadd(r,i.ri),i.ri.vsub(n,i.ri),i.ri.normalize(),i.ri.scale(p,i.ri),i.ri.vadd(n,i.ri),i.ri.vsub(s.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}d.release(C,M,P,S,k)}planeBox(t,e,n,r,i,o,s,a,l,u,c){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,e.convexPolyhedronRepresentation.id=e.id,this.planeConvex(t,e.convexPolyhedronRepresentation,n,r,i,o,s,a,t,e,c)}convexConvex(t,e,n,r,i,o,s,a,l,u,c,d,h){const p=wi;if(!(n.distanceTo(r)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,n,i,r,o,p,d,h)){const d=[],h=_i;t.clipAgainstHull(n,i,e,r,o,p,-100,100,d);let f=0;for(let i=0;i!==d.length;i++){if(c)return!0;const o=this.createContactEquation(s,a,t,e,l,u),v=o.ri,m=o.rj;p.negate(o.ni),d[i].normal.negate(h),h.scale(d[i].depth,h),d[i].point.vadd(h,v),m.copy(d[i].point),v.vsub(n,v),m.vsub(r,m),v.vadd(n,v),v.vsub(s.position,v),m.vadd(r,m),m.vsub(a.position,m),this.result.push(o),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(o,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}}sphereConvex(t,e,n,r,i,o,s,a,l,u,c){const d=this.v3pool;n.vsub(r,oi);const h=e.faceNormals,p=e.faces,f=e.vertices,v=t.radius;let m=!1;for(let i=0;i!==f.length;i++){const d=f[i],h=ui;o.vmult(d,h),r.vadd(h,h);const p=li;if(h.vsub(n,p),p.lengthSquared()<v*v){if(c)return!0;m=!0;const i=this.createContactEquation(s,a,t,e,l,u);return i.ri.copy(p),i.ri.normalize(),i.ni.copy(i.ri),i.ri.scale(v,i.ri),h.vsub(r,i.rj),i.ri.vadd(n,i.ri),i.ri.vsub(s.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),void this.createFrictionEquationsFromContact(i,this.frictionResult)}}for(let i=0,b=p.length;i!==b&&!1===m;i++){const b=h[i],g=p[i],w=ci;o.vmult(b,w);const _=di;o.vmult(f[g[0]],_),_.vadd(r,_);const y=hi;w.scale(-v,y),n.vadd(y,y);const x=pi;y.vsub(_,x);const A=x.dot(w),E=fi;if(n.vsub(_,E),A<0&&E.dot(w)>0){const i=[];for(let t=0,e=g.length;t!==e;t++){const e=d.get();o.vmult(f[g[t]],e),r.vadd(e,e),i.push(e)}if(Yr(i,w,n)){if(c)return!0;m=!0;const o=this.createContactEquation(s,a,t,e,l,u);w.scale(-v,o.ri),w.negate(o.ni);const h=d.get();w.scale(-A,h);const p=d.get();w.scale(-v,p),n.vsub(r,o.rj),o.rj.vadd(p,o.rj),o.rj.vadd(h,o.rj),o.rj.vadd(r,o.rj),o.rj.vsub(a.position,o.rj),o.ri.vadd(n,o.ri),o.ri.vsub(s.position,o.ri),d.release(h),d.release(p),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult);for(let t=0,e=i.length;t!==e;t++)d.release(i[t]);return}for(let h=0;h!==g.length;h++){const p=d.get(),m=d.get();o.vmult(f[g[(h+1)%g.length]],p),o.vmult(f[g[(h+2)%g.length]],m),r.vadd(p,p),r.vadd(m,m);const b=si;m.vsub(p,b);const w=ai;b.unit(w);const _=d.get(),y=d.get();n.vsub(p,y);const x=y.dot(w);w.scale(x,_),_.vadd(p,_);const A=d.get();if(_.vsub(n,A),x>0&&x*x<b.lengthSquared()&&A.lengthSquared()<v*v){if(c)return!0;const o=this.createContactEquation(s,a,t,e,l,u);_.vsub(r,o.rj),_.vsub(n,o.ni),o.ni.normalize(),o.ni.scale(v,o.ri),o.rj.vadd(r,o.rj),o.rj.vsub(a.position,o.rj),o.ri.vadd(n,o.ri),o.ri.vsub(s.position,o.ri),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult);for(let t=0,e=i.length;t!==e;t++)d.release(i[t]);return d.release(p),d.release(m),d.release(_),d.release(A),void d.release(y)}d.release(p),d.release(m),d.release(_),d.release(A),d.release(y)}for(let t=0,e=i.length;t!==e;t++)d.release(i[t])}}}planeConvex(t,e,n,r,i,o,s,a,l,u,c){const d=vi,h=mi;h.set(0,0,1),i.vmult(h,h);let p=0;const f=bi;for(let i=0;i!==e.vertices.length;i++){d.copy(e.vertices[i]),o.vmult(d,d),r.vadd(d,d),d.vsub(n,f);if(h.dot(f)<=0){if(c)return!0;const i=this.createContactEquation(s,a,t,e,l,u),o=gi;h.scale(h.dot(f),o),d.vsub(o,o),o.vsub(n,i.ri),i.ni.copy(h),d.vsub(r,i.rj),i.ri.vadd(n,i.ri),i.ri.vsub(s.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(i,this.frictionResult)}}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)}boxConvex(t,e,n,r,i,o,s,a,l,u,c){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,n,r,i,o,s,a,t,e,c)}sphereHeightfield(t,e,n,r,i,o,s,a,l,u,c){const d=e.data,h=t.radius,p=e.elementSize,f=Ii,v=Vi;_.pointToLocalFrame(r,o,n,v);let m=Math.floor((v.x-h)/p)-1,b=Math.ceil((v.x+h)/p)+1,g=Math.floor((v.y-h)/p)-1,w=Math.ceil((v.y+h)/p)+1;if(b<0||w<0||m>d.length||g>d[0].length)return;m<0&&(m=0),b<0&&(b=0),g<0&&(g=0),w<0&&(w=0),m>=d.length&&(m=d.length-1),b>=d.length&&(b=d.length-1),w>=d[0].length&&(w=d[0].length-1),g>=d[0].length&&(g=d[0].length-1);const y=[];e.getRectMinMax(m,g,b,w,y);const x=y[0],A=y[1];if(v.z-h>A||v.z+h<x)return;const E=this.result;for(let l=m;l<b;l++)for(let u=g;u<w;u++){const d=E.length;let h=!1;if(e.getConvexTrianglePillar(l,u,!1),_.pointToWorldFrame(r,o,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(h=this.sphereConvex(t,e.pillarConvex,n,f,i,o,s,a,t,e,c)),c&&h)return!0;if(e.getConvexTrianglePillar(l,u,!0),_.pointToWorldFrame(r,o,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(h=this.sphereConvex(t,e.pillarConvex,n,f,i,o,s,a,t,e,c)),c&&h)return!0;if(E.length-d>2)return}}boxHeightfield(t,e,n,r,i,o,s,a,l,u,c){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,n,r,i,o,s,a,t,e,c)}convexHeightfield(t,e,n,r,i,o,s,a,l,u,c){const d=e.data,h=e.elementSize,p=t.boundingSphereRadius,f=Bi,v=Fi,m=Ti;_.pointToLocalFrame(r,o,n,m);let b=Math.floor((m.x-p)/h)-1,g=Math.ceil((m.x+p)/h)+1,w=Math.floor((m.y-p)/h)-1,y=Math.ceil((m.y+p)/h)+1;if(g<0||y<0||b>d.length||w>d[0].length)return;b<0&&(b=0),g<0&&(g=0),w<0&&(w=0),y<0&&(y=0),b>=d.length&&(b=d.length-1),g>=d.length&&(g=d.length-1),y>=d[0].length&&(y=d[0].length-1),w>=d[0].length&&(w=d[0].length-1);const x=[];e.getRectMinMax(b,w,g,y,x);const A=x[0],E=x[1];if(!(m.z-p>E||m.z+p<A))for(let l=b;l<g;l++)for(let u=w;u<y;u++){let d=!1;if(e.getConvexTrianglePillar(l,u,!1),_.pointToWorldFrame(r,o,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(d=this.convexConvex(t,e.pillarConvex,n,f,i,o,s,a,null,null,c,v,null)),c&&d)return!0;if(e.getConvexTrianglePillar(l,u,!0),_.pointToWorldFrame(r,o,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(d=this.convexConvex(t,e.pillarConvex,n,f,i,o,s,a,null,null,c,v,null)),c&&d)return!0}}sphereParticle(t,e,n,r,i,o,s,a,l,u,c){const d=Ei;d.set(0,0,1),r.vsub(n,d);if(d.lengthSquared()<=t.radius*t.radius){if(c)return!0;const n=this.createContactEquation(a,s,e,t,l,u);d.normalize(),n.rj.copy(d),n.rj.scale(t.radius,n.rj),n.ni.copy(d),n.ni.negate(n.ni),n.ri.set(0,0,0),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}planeParticle(t,e,n,r,i,o,s,a,l,u,c){const d=yi;d.set(0,0,1),s.quaternion.vmult(d,d);const h=xi;r.vsub(s.position,h);if(d.dot(h)<=0){if(c)return!0;const n=this.createContactEquation(a,s,e,t,l,u);n.ni.copy(d),n.ni.negate(n.ni),n.ri.set(0,0,0);const i=Ai;d.scale(d.dot(r),i),r.vsub(i,i),n.rj.copy(i),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}boxParticle(t,e,n,r,i,o,s,a,l,u,c){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,n,r,i,o,s,a,t,e,c)}convexParticle(t,e,n,r,i,o,s,a,l,u,c){let d=-1;const h=Pi,p=ki;let f=null;const v=Mi;if(v.copy(r),v.vsub(n,v),i.conjugate(Ci),Ci.vmult(v,v),t.pointIsInside(v)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(n,i),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(i);for(let e=0,n=t.faces.length;e!==n;e++){const n=[t.worldVertices[t.faces[e][0]]],i=t.worldFaceNormals[e];r.vsub(n[0],Si);const o=-i.dot(Si);if(null===f||Math.abs(o)<Math.abs(f)){if(c)return!0;f=o,d=e,h.copy(i)}}if(-1!==d){const i=this.createContactEquation(a,s,e,t,l,u);h.scale(f,p),p.vadd(r,p),p.vsub(n,p),i.rj.copy(p),h.negate(i.ni),i.ri.set(0,0,0);const o=i.ri,c=i.rj;o.vadd(r,o),o.vsub(a.position,o),c.vadd(n,c),c.vsub(s.position,c),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(t,e,n,r,i,o,s,a,l,u,c){return this.convexHeightfield(e,t,r,n,o,i,a,s,l,u,c)}particleCylinder(t,e,n,r,i,o,s,a,l,u,c){return this.convexParticle(e,t,r,n,o,i,a,s,l,u,c)}sphereTrimesh(t,e,n,r,i,o,s,a,l,u,c){const d=Vr,h=Ir,p=zr,f=Lr,v=Rr,m=Or,b=Dr,g=Fr,w=Tr,y=Wr;_.pointToLocalFrame(r,o,n,v);const x=t.radius;b.lowerBound.set(v.x-x,v.y-x,v.z-x),b.upperBound.set(v.x+x,v.y+x,v.z+x),e.getTrianglesInAABB(b,y);const A=Br,E=t.radius*t.radius;for(let i=0;i<y.length;i++)for(let d=0;d<3;d++)if(e.getVertex(e.indices[3*y[i]+d],A),A.vsub(v,w),w.lengthSquared()<=E){if(g.copy(A),_.pointToWorldFrame(r,o,g,A),A.vsub(n,w),c)return!0;let i=this.createContactEquation(s,a,t,e,l,u);i.ni.copy(w),i.ni.normalize(),i.ri.copy(i.ni),i.ri.scale(t.radius,i.ri),i.ri.vadd(n,i.ri),i.ri.vsub(s.position,i.ri),i.rj.copy(A),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}for(let i=0;i<y.length;i++)for(let b=0;b<3;b++){e.getVertex(e.indices[3*y[i]+b],d),e.getVertex(e.indices[3*y[i]+(b+1)%3],h),h.vsub(d,p),v.vsub(h,m);const g=m.dot(p);v.vsub(d,m);let w=m.dot(p);if(w>0&&g<0){v.vsub(d,m),f.copy(p),f.normalize(),w=m.dot(f),f.scale(w,m),m.vadd(d,m);if(m.distanceTo(v)<t.radius){if(c)return!0;const i=this.createContactEquation(s,a,t,e,l,u);m.vsub(v,i.ni),i.ni.normalize(),i.ni.scale(t.radius,i.ri),i.ri.vadd(n,i.ri),i.ri.vsub(s.position,i.ri),_.pointToWorldFrame(r,o,m,m),m.vsub(a.position,i.rj),_.vectorToWorldFrame(o,i.ni,i.ni),_.vectorToWorldFrame(o,i.ri,i.ri),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}}const C=qr,M=jr,P=Nr,S=kr;for(let i=0,d=y.length;i!==d;i++){e.getTriangleVertices(y[i],C,M,P),e.getNormal(y[i],S),v.vsub(C,m);let d=m.dot(S);if(S.scale(d,m),v.vsub(m,m),d=m.distanceTo(v),ut.pointInTriangle(m,C,M,P)&&d<t.radius){if(c)return!0;let i=this.createContactEquation(s,a,t,e,l,u);m.vsub(v,i.ni),i.ni.normalize(),i.ni.scale(t.radius,i.ri),i.ri.vadd(n,i.ri),i.ri.vsub(s.position,i.ri),_.pointToWorldFrame(r,o,m,m),m.vsub(a.position,i.rj),_.vectorToWorldFrame(o,i.ni,i.ni),_.vectorToWorldFrame(o,i.ri,i.ri),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}y.length=0}planeTrimesh(t,e,n,r,i,o,a,l,u,c,d){const h=new s,p=Mr;p.set(0,0,1),i.vmult(p,p);for(let i=0;i<e.vertices.length/3;i++){e.getVertex(i,h);const f=new s;f.copy(h),_.pointToWorldFrame(r,o,f,h);const v=Pr;h.vsub(n,v);if(p.dot(v)<=0){if(d)return!0;const n=this.createContactEquation(a,l,t,e,u,c);n.ni.copy(p);const r=Sr;p.scale(v.dot(p),r),h.vsub(r,r),n.ri.copy(r),n.ri.vsub(a.position,n.ri),n.rj.copy(h),n.rj.vsub(l.position,n.rj),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}}}const wr=new s,_r=new s,yr=new s,xr=new s,Ar=new s,Er=new v,Cr=new v,Mr=new s,Pr=new s,Sr=new s,kr=new s,Tr=new s;new s;const Br=new s,Fr=new s,Vr=new s,Ir=new s,zr=new s,Lr=new s,Rr=new s,Or=new s,qr=new s,jr=new s,Nr=new s,Dr=new c,Wr=[],Ur=new s,Hr=new s,Gr=new s,Kr=new s,$r=new s;function Yr(t,e,n){let r=null;const i=t.length;for(let o=0;o!==i;o++){const s=t[o],a=Gr;t[(o+1)%i].vsub(s,a);const l=Kr;a.cross(e,l);const u=$r;n.vsub(s,u);const c=l.dot(u);if(!(null===r||c>0&&!0===r||c<=0&&!1===r))return!1;null===r&&(r=c>0)}return!0}const Xr=new s,Zr=new s,Qr=new s,Jr=new s,ti=[new s,new s,new s,new s,new s,new s],ei=new s,ni=new s,ri=new s,ii=new s,oi=new s,si=new s,ai=new s,li=new s,ui=new s,ci=new s,di=new s,hi=new s,pi=new s,fi=new s;new s,new s;const vi=new s,mi=new s,bi=new s,gi=new s,wi=new s,_i=new s,yi=new s,xi=new s,Ai=new s,Ei=new s,Ci=new v,Mi=new s;new s;const Pi=new s,Si=new s,ki=new s,Ti=new s,Bi=new s,Fi=[0],Vi=new s,Ii=new s;class zi{constructor(){this.current=[],this.previous=[]}getKey(t,e){if(e<t){const n=e;e=t,t=n}return t<<16|e}set(t,e){const n=this.getKey(t,e),r=this.current;let i=0;for(;n>r[i];)i++;if(n!==r[i]){for(let t=r.length-1;t>=i;t--)r[t+1]=r[t];r[i]=n}}tick(){const t=this.current;this.current=this.previous,this.previous=t,this.current.length=0}getDiff(t,e){const n=this.current,r=this.previous,i=n.length,o=r.length;let s=0;for(let e=0;e<i;e++){let i=!1;const o=n[e];for(;o>r[s];)s++;i=o===r[s],i||Li(t,o)}s=0;for(let t=0;t<o;t++){let i=!1;const o=r[t];for(;o>n[s];)s++;i=n[s]===o,i||Li(e,o)}}}function Li(t,e){t.push((4294901760&e)>>16,65535&e)}const Ri=(t,e)=>t<e?`${t}-${e}`:`${e}-${t}`;class Oi{constructor(){this.data={keys:[]}}get(t,e){const n=Ri(t,e);return this.data[n]}set(t,e,n){const r=Ri(t,e);this.get(t,e)||this.data.keys.push(r),this.data[r]=n}delete(t,e){const n=Ri(t,e),r=this.data.keys.indexOf(n);-1!==r&&this.data.keys.splice(r,1),delete this.data[n]}reset(){const t=this.data,e=t.keys;for(;e.length>0;){delete t[e.pop()]}}}class qi extends f{constructor(t){void 0===t&&(t={}),super(),this.dt=-1,this.allowSleep=!!t.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==t.quatNormalizeSkip?t.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==t.quatNormalizeFast&&t.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new s,t.gravity&&this.gravity.copy(t.gravity),t.frictionGravity&&(this.frictionGravity=new s,this.frictionGravity.copy(t.frictionGravity)),this.broadphase=void 0!==t.broadphase?t.broadphase:new J,this.bodies=[],this.hasActiveBodies=!1,this.solver=void 0!==t.solver?t.solver:new er,this.constraints=[],this.narrowphase=new gr(this),this.collisionMatrix=new p,this.collisionMatrixPrevious=new p,this.bodyOverlapKeeper=new zi,this.shapeOverlapKeeper=new zi,this.contactmaterials=[],this.contactMaterialTable=new Oi,this.defaultMaterial=new xe("default"),this.defaultContactMaterial=new ye(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(t,e){return this.contactMaterialTable.get(t.id,e.id)}collisionMatrixTick(){const t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(t){this.constraints.push(t)}removeConstraint(t){const e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)}rayTest(t,e,n){n instanceof tt?this.raycastClosest(t,e,{skipBackfaces:!0},n):this.raycastAll(t,e,{skipBackfaces:!0},n)}raycastAll(t,e,n,r){return void 0===n&&(n={}),n.mode=ut.ALL,n.from=t,n.to=e,n.callback=r,ji.intersectWorld(this,n)}raycastAny(t,e,n,r){return void 0===n&&(n={}),n.mode=ut.ANY,n.from=t,n.to=e,n.result=r,ji.intersectWorld(this,n)}raycastClosest(t,e,n,r){return void 0===n&&(n={}),n.mode=ut.CLOSEST,n.from=t,n.to=e,n.result=r,ji.intersectWorld(this,n)}addBody(t){this.bodies.includes(t)||(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof F&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.idToBodyMap[t.id]=t,this.dispatchEvent(this.addBodyEvent))}removeBody(t){t.world=null;const e=this.bodies.length-1,n=this.bodies,r=n.indexOf(t);if(-1!==r){n.splice(r,1);for(let t=0;t!==n.length;t++)n[t].index=t;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,delete this.idToBodyMap[t.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(t){return this.idToBodyMap[t]}getShapeById(t){const e=this.bodies;for(let n=0;n<e.length;n++){const r=e[n].shapes;for(let e=0;e<r.length;e++){const n=r[e];if(n.id===t)return n}}return null}addContactMaterial(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)}removeContactMaterial(t){const e=this.contactmaterials.indexOf(t);-1!==e&&(this.contactmaterials.splice(e,1),this.contactMaterialTable.delete(t.materials[0].id,t.materials[1].id))}fixedStep(t,e){void 0===t&&(t=1/60),void 0===e&&(e=10);const n=Ni.now()/1e3;if(this.lastCallTime){const r=n-this.lastCallTime;this.step(t,r,e)}else this.step(t,void 0,e);this.lastCallTime=n}step(t,e,n){if(void 0===n&&(n=10),void 0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;const r=Ni.now();let i=0;for(;this.accumulator>=t&&i<n&&(this.internalStep(t),this.accumulator-=t,i++,!(Ni.now()-r>1e3*t)););this.accumulator=this.accumulator%t;const o=this.accumulator/t;for(let t=0;t!==this.bodies.length;t++){const e=this.bodies[t];e.previousPosition.lerp(e.position,o,e.interpolatedPosition),e.previousQuaternion.slerp(e.quaternion,o,e.interpolatedQuaternion),e.previousQuaternion.normalize()}this.time+=e}}internalStep(t){this.dt=t;const e=this.contacts,n=Ki,r=$i,i=this.bodies.length,o=this.bodies,s=this.solver,a=this.gravity,l=this.doProfiling,u=this.profile,c=F.DYNAMIC;let d=-1/0;const h=this.constraints,p=Gi;a.length();const f=a.x,v=a.y,m=a.z;let b=0;for(l&&(d=Ni.now()),b=0;b!==i;b++){const t=o[b];if(t.type===c){const e=t.force,n=t.mass;e.x+=n*f,e.y+=n*v,e.z+=n*m}}for(let t=0,e=this.subsystems.length;t!==e;t++)this.subsystems[t].update();l&&(d=Ni.now()),n.length=0,r.length=0,this.broadphase.collisionPairs(this,n,r),l&&(u.broadphase=Ni.now()-d);let g=h.length;for(b=0;b!==g;b++){const t=h[b];if(!t.collideConnected)for(let e=n.length-1;e>=0;e-=1)(t.bodyA===n[e]&&t.bodyB===r[e]||t.bodyB===n[e]&&t.bodyA===r[e])&&(n.splice(e,1),r.splice(e,1))}this.collisionMatrixTick(),l&&(d=Ni.now());const w=Hi,_=e.length;for(b=0;b!==_;b++)w.push(e[b]);e.length=0;const y=this.frictionEquations.length;for(b=0;b!==y;b++)p.push(this.frictionEquations[b]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,r,this,e,w,this.frictionEquations,p),l&&(u.narrowphase=Ni.now()-d),l&&(d=Ni.now()),b=0;b<this.frictionEquations.length;b++)s.addEquation(this.frictionEquations[b]);const x=e.length;for(let t=0;t!==x;t++){const n=e[t],r=n.bi,i=n.bj,o=n.si,a=n.sj;let l;if(l=r.material&&i.material&&this.getContactMaterial(r.material,i.material)||this.defaultContactMaterial,l.friction,r.material&&i.material&&(r.material.friction>=0&&i.material.friction>=0&&(r.material.friction,i.material.friction),r.material.restitution>=0&&i.material.restitution>=0&&(n.restitution=r.material.restitution*i.material.restitution)),s.addEquation(n),r.allowSleep&&r.type===F.DYNAMIC&&r.sleepState===F.SLEEPING&&i.sleepState===F.AWAKE&&i.type!==F.STATIC){i.velocity.lengthSquared()+i.angularVelocity.lengthSquared()>=2*i.sleepSpeedLimit**2&&(r.wakeUpAfterNarrowphase=!0)}if(i.allowSleep&&i.type===F.DYNAMIC&&i.sleepState===F.SLEEPING&&r.sleepState===F.AWAKE&&r.type!==F.STATIC){r.velocity.lengthSquared()+r.angularVelocity.lengthSquared()>=2*r.sleepSpeedLimit**2&&(i.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(r,i,!0),this.collisionMatrixPrevious.get(r,i)||(Ui.body=i,Ui.contact=n,r.dispatchEvent(Ui),Ui.body=r,i.dispatchEvent(Ui)),this.bodyOverlapKeeper.set(r.id,i.id),this.shapeOverlapKeeper.set(o.id,a.id)}for(this.emitContactEvents(),l&&(u.makeContactConstraints=Ni.now()-d,d=Ni.now()),b=0;b!==i;b++){const t=o[b];t.wakeUpAfterNarrowphase&&(t.wakeUp(),t.wakeUpAfterNarrowphase=!1)}for(g=h.length,b=0;b!==g;b++){const t=h[b];t.update();for(let e=0,n=t.equations.length;e!==n;e++){const n=t.equations[e];s.addEquation(n)}}s.solve(t,this),l&&(u.solve=Ni.now()-d),s.removeAllEquations();const A=Math.pow;for(b=0;b!==i;b++){const e=o[b];if(e.type&c){const n=A(1-e.linearDamping,t),r=e.velocity;r.scale(n,r);const i=e.angularVelocity;if(i){const n=A(1-e.angularDamping,t);i.scale(n,i)}}}this.dispatchEvent(Wi),l&&(d=Ni.now());const E=this.stepnumber%(this.quatNormalizeSkip+1)==0,C=this.quatNormalizeFast;for(b=0;b!==i;b++)o[b].integrate(t,E,C);this.clearForces(),this.broadphase.dirty=!0,l&&(u.integrate=Ni.now()-d),this.stepnumber+=1,this.dispatchEvent(Di);let M=!0;if(this.allowSleep)for(M=!1,b=0;b!==i;b++){const t=o[b];t.sleepTick(this.time),t.sleepState!==F.SLEEPING&&(M=!0)}this.hasActiveBodies=M}emitContactEvents(){const t=this.hasAnyEventListener("beginContact"),e=this.hasAnyEventListener("endContact");if((t||e)&&this.bodyOverlapKeeper.getDiff(Yi,Xi),t){for(let t=0,e=Yi.length;t<e;t+=2)Zi.bodyA=this.getBodyById(Yi[t]),Zi.bodyB=this.getBodyById(Yi[t+1]),this.dispatchEvent(Zi);Zi.bodyA=Zi.bodyB=null}if(e){for(let t=0,e=Xi.length;t<e;t+=2)Qi.bodyA=this.getBodyById(Xi[t]),Qi.bodyB=this.getBodyById(Xi[t+1]),this.dispatchEvent(Qi);Qi.bodyA=Qi.bodyB=null}Yi.length=Xi.length=0;const n=this.hasAnyEventListener("beginShapeContact"),r=this.hasAnyEventListener("endShapeContact");if((n||r)&&this.shapeOverlapKeeper.getDiff(Yi,Xi),n){for(let t=0,e=Yi.length;t<e;t+=2){const e=this.getShapeById(Yi[t]),n=this.getShapeById(Yi[t+1]);Ji.shapeA=e,Ji.shapeB=n,e&&(Ji.bodyA=e.body),n&&(Ji.bodyB=n.body),this.dispatchEvent(Ji)}Ji.bodyA=Ji.bodyB=Ji.shapeA=Ji.shapeB=null}if(r){for(let t=0,e=Xi.length;t<e;t+=2){const e=this.getShapeById(Xi[t]),n=this.getShapeById(Xi[t+1]);to.shapeA=e,to.shapeB=n,e&&(to.bodyA=e.body),n&&(to.bodyB=n.body),this.dispatchEvent(to)}to.bodyA=to.bodyB=to.shapeA=to.shapeB=null}}clearForces(){const t=this.bodies,e=t.length;for(let n=0;n!==e;n++){const e=t[n];e.force,e.torque,e.force.set(0,0,0),e.torque.set(0,0,0)}}}new c;const ji=new ut,Ni=globalThis.performance||{};if(!Ni.now){let t=Date.now();Ni.timing&&Ni.timing.navigationStart&&(t=Ni.timing.navigationStart),Ni.now=()=>Date.now()-t}new s;const Di={type:"postStep"},Wi={type:"preStep"},Ui={type:F.COLLIDE_EVENT_NAME,body:null,contact:null},Hi=[],Gi=[],Ki=[],$i=[],Yi=[],Xi=[],Zi={type:"beginContact",bodyA:null,bodyB:null},Qi={type:"endContact",bodyA:null,bodyB:null},Ji={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},to={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null}},1:function(t,e,n){"use strict";n.r(e),n.d(e,"glMatrix",(function(){return r})),n.d(e,"mat2",(function(){return i})),n.d(e,"mat2d",(function(){return o})),n.d(e,"mat3",(function(){return s})),n.d(e,"mat4",(function(){return a})),n.d(e,"quat",(function(){return c})),n.d(e,"quat2",(function(){return d})),n.d(e,"vec2",(function(){return h})),n.d(e,"vec3",(function(){return l})),n.d(e,"vec4",(function(){return u}));var r={};n.r(r),n.d(r,"EPSILON",(function(){return p})),n.d(r,"ARRAY_TYPE",(function(){return f})),n.d(r,"RANDOM",(function(){return v})),n.d(r,"setMatrixArrayType",(function(){return m})),n.d(r,"toRadian",(function(){return g})),n.d(r,"equals",(function(){return w}));var i={};n.r(i),n.d(i,"create",(function(){return _})),n.d(i,"clone",(function(){return y})),n.d(i,"copy",(function(){return x})),n.d(i,"identity",(function(){return A})),n.d(i,"fromValues",(function(){return E})),n.d(i,"set",(function(){return C})),n.d(i,"transpose",(function(){return M})),n.d(i,"invert",(function(){return P})),n.d(i,"adjoint",(function(){return S})),n.d(i,"determinant",(function(){return k})),n.d(i,"multiply",(function(){return T})),n.d(i,"rotate",(function(){return B})),n.d(i,"scale",(function(){return F})),n.d(i,"fromRotation",(function(){return V})),n.d(i,"fromScaling",(function(){return I})),n.d(i,"str",(function(){return z})),n.d(i,"frob",(function(){return L})),n.d(i,"LDU",(function(){return R})),n.d(i,"add",(function(){return O})),n.d(i,"subtract",(function(){return q})),n.d(i,"exactEquals",(function(){return j})),n.d(i,"equals",(function(){return N})),n.d(i,"multiplyScalar",(function(){return D})),n.d(i,"multiplyScalarAndAdd",(function(){return W})),n.d(i,"mul",(function(){return U})),n.d(i,"sub",(function(){return H}));var o={};n.r(o),n.d(o,"create",(function(){return G})),n.d(o,"clone",(function(){return K})),n.d(o,"copy",(function(){return $})),n.d(o,"identity",(function(){return Y})),n.d(o,"fromValues",(function(){return X})),n.d(o,"set",(function(){return Z})),n.d(o,"invert",(function(){return Q})),n.d(o,"determinant",(function(){return J})),n.d(o,"multiply",(function(){return tt})),n.d(o,"rotate",(function(){return et})),n.d(o,"scale",(function(){return nt})),n.d(o,"translate",(function(){return rt})),n.d(o,"fromRotation",(function(){return it})),n.d(o,"fromScaling",(function(){return ot})),n.d(o,"fromTranslation",(function(){return st})),n.d(o,"str",(function(){return at})),n.d(o,"frob",(function(){return lt})),n.d(o,"add",(function(){return ut})),n.d(o,"subtract",(function(){return ct})),n.d(o,"multiplyScalar",(function(){return dt})),n.d(o,"multiplyScalarAndAdd",(function(){return ht})),n.d(o,"exactEquals",(function(){return pt})),n.d(o,"equals",(function(){return ft})),n.d(o,"mul",(function(){return vt})),n.d(o,"sub",(function(){return mt}));var s={};n.r(s),n.d(s,"create",(function(){return bt})),n.d(s,"fromMat4",(function(){return gt})),n.d(s,"clone",(function(){return wt})),n.d(s,"copy",(function(){return _t})),n.d(s,"fromValues",(function(){return yt})),n.d(s,"set",(function(){return xt})),n.d(s,"identity",(function(){return At})),n.d(s,"transpose",(function(){return Et})),n.d(s,"invert",(function(){return Ct})),n.d(s,"adjoint",(function(){return Mt})),n.d(s,"determinant",(function(){return Pt})),n.d(s,"multiply",(function(){return St})),n.d(s,"translate",(function(){return kt})),n.d(s,"rotate",(function(){return Tt})),n.d(s,"scale",(function(){return Bt})),n.d(s,"fromTranslation",(function(){return Ft})),n.d(s,"fromRotation",(function(){return Vt})),n.d(s,"fromScaling",(function(){return It})),n.d(s,"fromMat2d",(function(){return zt})),n.d(s,"fromQuat",(function(){return Lt})),n.d(s,"normalFromMat4",(function(){return Rt})),n.d(s,"projection",(function(){return Ot})),n.d(s,"str",(function(){return qt})),n.d(s,"frob",(function(){return jt})),n.d(s,"add",(function(){return Nt})),n.d(s,"subtract",(function(){return Dt})),n.d(s,"multiplyScalar",(function(){return Wt})),n.d(s,"multiplyScalarAndAdd",(function(){return Ut})),n.d(s,"exactEquals",(function(){return Ht})),n.d(s,"equals",(function(){return Gt})),n.d(s,"mul",(function(){return Kt})),n.d(s,"sub",(function(){return $t}));var a={};n.r(a),n.d(a,"create",(function(){return Yt})),n.d(a,"clone",(function(){return Xt})),n.d(a,"copy",(function(){return Zt})),n.d(a,"fromValues",(function(){return Qt})),n.d(a,"set",(function(){return Jt})),n.d(a,"identity",(function(){return te})),n.d(a,"transpose",(function(){return ee})),n.d(a,"invert",(function(){return ne})),n.d(a,"adjoint",(function(){return re})),n.d(a,"determinant",(function(){return ie})),n.d(a,"multiply",(function(){return oe})),n.d(a,"translate",(function(){return se})),n.d(a,"scale",(function(){return ae})),n.d(a,"rotate",(function(){return le})),n.d(a,"rotateX",(function(){return ue})),n.d(a,"rotateY",(function(){return ce})),n.d(a,"rotateZ",(function(){return de})),n.d(a,"fromTranslation",(function(){return he})),n.d(a,"fromScaling",(function(){return pe})),n.d(a,"fromRotation",(function(){return fe})),n.d(a,"fromXRotation",(function(){return ve})),n.d(a,"fromYRotation",(function(){return me})),n.d(a,"fromZRotation",(function(){return be})),n.d(a,"fromRotationTranslation",(function(){return ge})),n.d(a,"fromQuat2",(function(){return we})),n.d(a,"getTranslation",(function(){return _e})),n.d(a,"getScaling",(function(){return ye})),n.d(a,"getRotation",(function(){return xe})),n.d(a,"fromRotationTranslationScale",(function(){return Ae})),n.d(a,"fromRotationTranslationScaleOrigin",(function(){return Ee})),n.d(a,"fromQuat",(function(){return Ce})),n.d(a,"frustum",(function(){return Me})),n.d(a,"perspectiveNO",(function(){return Pe})),n.d(a,"perspective",(function(){return Se})),n.d(a,"perspectiveZO",(function(){return ke})),n.d(a,"perspectiveFromFieldOfView",(function(){return Te})),n.d(a,"orthoNO",(function(){return Be})),n.d(a,"ortho",(function(){return Fe})),n.d(a,"orthoZO",(function(){return Ve})),n.d(a,"lookAt",(function(){return Ie})),n.d(a,"targetTo",(function(){return ze})),n.d(a,"str",(function(){return Le})),n.d(a,"frob",(function(){return Re})),n.d(a,"add",(function(){return Oe})),n.d(a,"subtract",(function(){return qe})),n.d(a,"multiplyScalar",(function(){return je})),n.d(a,"multiplyScalarAndAdd",(function(){return Ne})),n.d(a,"exactEquals",(function(){return De})),n.d(a,"equals",(function(){return We})),n.d(a,"mul",(function(){return Ue})),n.d(a,"sub",(function(){return He}));var l={};n.r(l),n.d(l,"create",(function(){return Ge})),n.d(l,"clone",(function(){return Ke})),n.d(l,"length",(function(){return $e})),n.d(l,"fromValues",(function(){return Ye})),n.d(l,"copy",(function(){return Xe})),n.d(l,"set",(function(){return Ze})),n.d(l,"add",(function(){return Qe})),n.d(l,"subtract",(function(){return Je})),n.d(l,"multiply",(function(){return tn})),n.d(l,"divide",(function(){return en})),n.d(l,"ceil",(function(){return nn})),n.d(l,"floor",(function(){return rn})),n.d(l,"min",(function(){return on})),n.d(l,"max",(function(){return sn})),n.d(l,"round",(function(){return an})),n.d(l,"scale",(function(){return ln})),n.d(l,"scaleAndAdd",(function(){return un})),n.d(l,"distance",(function(){return cn})),n.d(l,"squaredDistance",(function(){return dn})),n.d(l,"squaredLength",(function(){return hn})),n.d(l,"negate",(function(){return pn})),n.d(l,"inverse",(function(){return fn})),n.d(l,"normalize",(function(){return vn})),n.d(l,"dot",(function(){return mn})),n.d(l,"cross",(function(){return bn})),n.d(l,"lerp",(function(){return gn})),n.d(l,"hermite",(function(){return wn})),n.d(l,"bezier",(function(){return _n})),n.d(l,"random",(function(){return yn})),n.d(l,"transformMat4",(function(){return xn})),n.d(l,"transformMat3",(function(){return An})),n.d(l,"transformQuat",(function(){return En})),n.d(l,"rotateX",(function(){return Cn})),n.d(l,"rotateY",(function(){return Mn})),n.d(l,"rotateZ",(function(){return Pn})),n.d(l,"angle",(function(){return Sn})),n.d(l,"zero",(function(){return kn})),n.d(l,"str",(function(){return Tn})),n.d(l,"exactEquals",(function(){return Bn})),n.d(l,"equals",(function(){return Fn})),n.d(l,"sub",(function(){return In})),n.d(l,"mul",(function(){return zn})),n.d(l,"div",(function(){return Ln})),n.d(l,"dist",(function(){return Rn})),n.d(l,"sqrDist",(function(){return On})),n.d(l,"len",(function(){return qn})),n.d(l,"sqrLen",(function(){return jn})),n.d(l,"forEach",(function(){return Nn}));var u={};n.r(u),n.d(u,"create",(function(){return Dn})),n.d(u,"clone",(function(){return Wn})),n.d(u,"fromValues",(function(){return Un})),n.d(u,"copy",(function(){return Hn})),n.d(u,"set",(function(){return Gn})),n.d(u,"add",(function(){return Kn})),n.d(u,"subtract",(function(){return $n})),n.d(u,"multiply",(function(){return Yn})),n.d(u,"divide",(function(){return Xn})),n.d(u,"ceil",(function(){return Zn})),n.d(u,"floor",(function(){return Qn})),n.d(u,"min",(function(){return Jn})),n.d(u,"max",(function(){return tr})),n.d(u,"round",(function(){return er})),n.d(u,"scale",(function(){return nr})),n.d(u,"scaleAndAdd",(function(){return rr})),n.d(u,"distance",(function(){return ir})),n.d(u,"squaredDistance",(function(){return or})),n.d(u,"length",(function(){return sr})),n.d(u,"squaredLength",(function(){return ar})),n.d(u,"negate",(function(){return lr})),n.d(u,"inverse",(function(){return ur})),n.d(u,"normalize",(function(){return cr})),n.d(u,"dot",(function(){return dr})),n.d(u,"cross",(function(){return hr})),n.d(u,"lerp",(function(){return pr})),n.d(u,"random",(function(){return fr})),n.d(u,"transformMat4",(function(){return vr})),n.d(u,"transformQuat",(function(){return mr})),n.d(u,"zero",(function(){return br})),n.d(u,"str",(function(){return gr})),n.d(u,"exactEquals",(function(){return wr})),n.d(u,"equals",(function(){return _r})),n.d(u,"sub",(function(){return yr})),n.d(u,"mul",(function(){return xr})),n.d(u,"div",(function(){return Ar})),n.d(u,"dist",(function(){return Er})),n.d(u,"sqrDist",(function(){return Cr})),n.d(u,"len",(function(){return Mr})),n.d(u,"sqrLen",(function(){return Pr})),n.d(u,"forEach",(function(){return Sr}));var c={};n.r(c),n.d(c,"create",(function(){return kr})),n.d(c,"identity",(function(){return Tr})),n.d(c,"setAxisAngle",(function(){return Br})),n.d(c,"getAxisAngle",(function(){return Fr})),n.d(c,"getAngle",(function(){return Vr})),n.d(c,"multiply",(function(){return Ir})),n.d(c,"rotateX",(function(){return zr})),n.d(c,"rotateY",(function(){return Lr})),n.d(c,"rotateZ",(function(){return Rr})),n.d(c,"calculateW",(function(){return Or})),n.d(c,"exp",(function(){return qr})),n.d(c,"ln",(function(){return jr})),n.d(c,"pow",(function(){return Nr})),n.d(c,"slerp",(function(){return Dr})),n.d(c,"random",(function(){return Wr})),n.d(c,"invert",(function(){return Ur})),n.d(c,"conjugate",(function(){return Hr})),n.d(c,"fromMat3",(function(){return Gr})),n.d(c,"fromEuler",(function(){return Kr})),n.d(c,"str",(function(){return $r})),n.d(c,"clone",(function(){return ei})),n.d(c,"fromValues",(function(){return ni})),n.d(c,"copy",(function(){return ri})),n.d(c,"set",(function(){return ii})),n.d(c,"add",(function(){return oi})),n.d(c,"mul",(function(){return si})),n.d(c,"scale",(function(){return ai})),n.d(c,"dot",(function(){return li})),n.d(c,"lerp",(function(){return ui})),n.d(c,"length",(function(){return ci})),n.d(c,"len",(function(){return di})),n.d(c,"squaredLength",(function(){return hi})),n.d(c,"sqrLen",(function(){return pi})),n.d(c,"normalize",(function(){return fi})),n.d(c,"exactEquals",(function(){return vi})),n.d(c,"equals",(function(){return mi})),n.d(c,"rotationTo",(function(){return bi})),n.d(c,"sqlerp",(function(){return gi})),n.d(c,"setAxes",(function(){return wi}));var d={};n.r(d),n.d(d,"create",(function(){return _i})),n.d(d,"clone",(function(){return yi})),n.d(d,"fromValues",(function(){return xi})),n.d(d,"fromRotationTranslationValues",(function(){return Ai})),n.d(d,"fromRotationTranslation",(function(){return Ei})),n.d(d,"fromTranslation",(function(){return Ci})),n.d(d,"fromRotation",(function(){return Mi})),n.d(d,"fromMat4",(function(){return Pi})),n.d(d,"copy",(function(){return Si})),n.d(d,"identity",(function(){return ki})),n.d(d,"set",(function(){return Ti})),n.d(d,"getReal",(function(){return Bi})),n.d(d,"getDual",(function(){return Fi})),n.d(d,"setReal",(function(){return Vi})),n.d(d,"setDual",(function(){return Ii})),n.d(d,"getTranslation",(function(){return zi})),n.d(d,"translate",(function(){return Li})),n.d(d,"rotateX",(function(){return Ri})),n.d(d,"rotateY",(function(){return Oi})),n.d(d,"rotateZ",(function(){return qi})),n.d(d,"rotateByQuatAppend",(function(){return ji})),n.d(d,"rotateByQuatPrepend",(function(){return Ni})),n.d(d,"rotateAroundAxis",(function(){return Di})),n.d(d,"add",(function(){return Wi})),n.d(d,"multiply",(function(){return Ui})),n.d(d,"mul",(function(){return Hi})),n.d(d,"scale",(function(){return Gi})),n.d(d,"dot",(function(){return Ki})),n.d(d,"lerp",(function(){return $i})),n.d(d,"invert",(function(){return Yi})),n.d(d,"conjugate",(function(){return Xi})),n.d(d,"length",(function(){return Zi})),n.d(d,"len",(function(){return Qi})),n.d(d,"squaredLength",(function(){return Ji})),n.d(d,"sqrLen",(function(){return to})),n.d(d,"normalize",(function(){return eo})),n.d(d,"str",(function(){return no})),n.d(d,"exactEquals",(function(){return ro})),n.d(d,"equals",(function(){return io}));var h={};n.r(h),n.d(h,"create",(function(){return oo})),n.d(h,"clone",(function(){return so})),n.d(h,"fromValues",(function(){return ao})),n.d(h,"copy",(function(){return lo})),n.d(h,"set",(function(){return uo})),n.d(h,"add",(function(){return co})),n.d(h,"subtract",(function(){return ho})),n.d(h,"multiply",(function(){return po})),n.d(h,"divide",(function(){return fo})),n.d(h,"ceil",(function(){return vo})),n.d(h,"floor",(function(){return mo})),n.d(h,"min",(function(){return bo})),n.d(h,"max",(function(){return go})),n.d(h,"round",(function(){return wo})),n.d(h,"scale",(function(){return _o})),n.d(h,"scaleAndAdd",(function(){return yo})),n.d(h,"distance",(function(){return xo})),n.d(h,"squaredDistance",(function(){return Ao})),n.d(h,"length",(function(){return Eo})),n.d(h,"squaredLength",(function(){return Co})),n.d(h,"negate",(function(){return Mo})),n.d(h,"inverse",(function(){return Po})),n.d(h,"normalize",(function(){return So})),n.d(h,"dot",(function(){return ko})),n.d(h,"cross",(function(){return To})),n.d(h,"lerp",(function(){return Bo})),n.d(h,"random",(function(){return Fo})),n.d(h,"transformMat2",(function(){return Vo})),n.d(h,"transformMat2d",(function(){return Io})),n.d(h,"transformMat3",(function(){return zo})),n.d(h,"transformMat4",(function(){return Lo})),n.d(h,"rotate",(function(){return Ro})),n.d(h,"angle",(function(){return Oo})),n.d(h,"zero",(function(){return qo})),n.d(h,"str",(function(){return jo})),n.d(h,"exactEquals",(function(){return No})),n.d(h,"equals",(function(){return Do})),n.d(h,"len",(function(){return Wo})),n.d(h,"sub",(function(){return Uo})),n.d(h,"mul",(function(){return Ho})),n.d(h,"div",(function(){return Go})),n.d(h,"dist",(function(){return Ko})),n.d(h,"sqrDist",(function(){return $o})),n.d(h,"sqrLen",(function(){return Yo})),n.d(h,"forEach",(function(){return Xo}));var p=1e-6,f="undefined"!=typeof Float32Array?Float32Array:Array,v=Math.random;function m(t){f=t}var b=Math.PI/180;function g(t){return t*b}function w(t,e){return Math.abs(t-e)<=p*Math.max(1,Math.abs(t),Math.abs(e))}function _(){var t=new f(4);return f!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function y(t){var e=new f(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function x(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function A(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function E(t,e,n,r){var i=new f(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function C(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function M(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function P(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n*o-i*r;return s?(s=1/s,t[0]=o*s,t[1]=-r*s,t[2]=-i*s,t[3]=n*s,t):null}function S(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t}function k(t){return t[0]*t[3]-t[2]*t[1]}function T(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=n[0],l=n[1],u=n[2],c=n[3];return t[0]=r*a+o*l,t[1]=i*a+s*l,t[2]=r*u+o*c,t[3]=i*u+s*c,t}function B(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=r*l+o*a,t[1]=i*l+s*a,t[2]=r*-a+o*l,t[3]=i*-a+s*l,t}function F(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=n[0],l=n[1];return t[0]=r*a,t[1]=i*a,t[2]=o*l,t[3]=s*l,t}function V(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t}function I(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function z(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function L(t){return Math.hypot(t[0],t[1],t[2],t[3])}function R(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]}function O(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function q(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function j(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function N(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=e[0],a=e[1],l=e[2],u=e[3];return Math.abs(n-s)<=p*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=p*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-l)<=p*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-u)<=p*Math.max(1,Math.abs(o),Math.abs(u))}function D(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function W(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var U=T,H=q;function G(){var t=new f(6);return f!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function K(t){var e=new f(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function $(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Y(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function X(t,e,n,r,i,o){var s=new f(6);return s[0]=t,s[1]=e,s[2]=n,s[3]=r,s[4]=i,s[5]=o,s}function Z(t,e,n,r,i,o,s){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=s,t}function Q(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=n*o-r*i;return l?(l=1/l,t[0]=o*l,t[1]=-r*l,t[2]=-i*l,t[3]=n*l,t[4]=(i*a-o*s)*l,t[5]=(r*s-n*a)*l,t):null}function J(t){return t[0]*t[3]-t[1]*t[2]}function tt(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=n[0],c=n[1],d=n[2],h=n[3],p=n[4],f=n[5];return t[0]=r*u+o*c,t[1]=i*u+s*c,t[2]=r*d+o*h,t[3]=i*d+s*h,t[4]=r*p+o*f+a,t[5]=i*p+s*f+l,t}function et(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=Math.sin(n),c=Math.cos(n);return t[0]=r*c+o*u,t[1]=i*c+s*u,t[2]=r*-u+o*c,t[3]=i*-u+s*c,t[4]=a,t[5]=l,t}function nt(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=n[0],c=n[1];return t[0]=r*u,t[1]=i*u,t[2]=o*c,t[3]=s*c,t[4]=a,t[5]=l,t}function rt(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=n[0],c=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=s,t[4]=r*u+o*c+a,t[5]=i*u+s*c+l,t}function it(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t[4]=0,t[5]=0,t}function ot(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function st(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function at(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function lt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function ut(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t}function ct(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}function dt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t}function ht(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t}function pt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function ft(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=e[0],u=e[1],c=e[2],d=e[3],h=e[4],f=e[5];return Math.abs(n-l)<=p*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-u)<=p*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-c)<=p*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(o-d)<=p*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-h)<=p*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(a-f)<=p*Math.max(1,Math.abs(a),Math.abs(f))}var vt=tt,mt=ct;function bt(){var t=new f(9);return f!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function gt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function wt(t){var e=new f(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function _t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function yt(t,e,n,r,i,o,s,a,l){var u=new f(9);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=i,u[5]=o,u[6]=s,u[7]=a,u[8]=l,u}function xt(t,e,n,r,i,o,s,a,l,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t[8]=u,t}function At(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Et(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Ct(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],u=e[7],c=e[8],d=c*s-a*u,h=-c*o+a*l,p=u*o-s*l,f=n*d+r*h+i*p;return f?(f=1/f,t[0]=d*f,t[1]=(-c*r+i*u)*f,t[2]=(a*r-i*s)*f,t[3]=h*f,t[4]=(c*n-i*l)*f,t[5]=(-a*n+i*o)*f,t[6]=p*f,t[7]=(-u*n+r*l)*f,t[8]=(s*n-r*o)*f,t):null}function Mt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],u=e[7],c=e[8];return t[0]=s*c-a*u,t[1]=i*u-r*c,t[2]=r*a-i*s,t[3]=a*l-o*c,t[4]=n*c-i*l,t[5]=i*o-n*a,t[6]=o*u-s*l,t[7]=r*l-n*u,t[8]=n*s-r*o,t}function Pt(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],l=t[7],u=t[8];return e*(u*o-s*l)+n*(-u*i+s*a)+r*(l*i-o*a)}function St(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],d=e[8],h=n[0],p=n[1],f=n[2],v=n[3],m=n[4],b=n[5],g=n[6],w=n[7],_=n[8];return t[0]=h*r+p*s+f*u,t[1]=h*i+p*a+f*c,t[2]=h*o+p*l+f*d,t[3]=v*r+m*s+b*u,t[4]=v*i+m*a+b*c,t[5]=v*o+m*l+b*d,t[6]=g*r+w*s+_*u,t[7]=g*i+w*a+_*c,t[8]=g*o+w*l+_*d,t}function kt(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],d=e[8],h=n[0],p=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=h*r+p*s+u,t[7]=h*i+p*a+c,t[8]=h*o+p*l+d,t}function Tt(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],d=e[8],h=Math.sin(n),p=Math.cos(n);return t[0]=p*r+h*s,t[1]=p*i+h*a,t[2]=p*o+h*l,t[3]=p*s-h*r,t[4]=p*a-h*i,t[5]=p*l-h*o,t[6]=u,t[7]=c,t[8]=d,t}function Bt(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Ft(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Vt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function It(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function zt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Lt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n+n,a=r+r,l=i+i,u=n*s,c=r*s,d=r*a,h=i*s,p=i*a,f=i*l,v=o*s,m=o*a,b=o*l;return t[0]=1-d-f,t[3]=c-b,t[6]=h+m,t[1]=c+b,t[4]=1-u-f,t[7]=p-v,t[2]=h-m,t[5]=p+v,t[8]=1-u-d,t}function Rt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],u=e[7],c=e[8],d=e[9],h=e[10],p=e[11],f=e[12],v=e[13],m=e[14],b=e[15],g=n*a-r*s,w=n*l-i*s,_=n*u-o*s,y=r*l-i*a,x=r*u-o*a,A=i*u-o*l,E=c*v-d*f,C=c*m-h*f,M=c*b-p*f,P=d*m-h*v,S=d*b-p*v,k=h*b-p*m,T=g*k-w*S+_*P+y*M-x*C+A*E;return T?(T=1/T,t[0]=(a*k-l*S+u*P)*T,t[1]=(l*M-s*k-u*C)*T,t[2]=(s*S-a*M+u*E)*T,t[3]=(i*S-r*k-o*P)*T,t[4]=(n*k-i*M+o*C)*T,t[5]=(r*M-n*S-o*E)*T,t[6]=(v*A-m*x+b*y)*T,t[7]=(m*_-f*A-b*w)*T,t[8]=(f*x-v*_+b*g)*T,t):null}function Ot(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function qt(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function jt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Nt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function Dt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function Wt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function Ut(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function Ht(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Gt(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],d=e[0],h=e[1],f=e[2],v=e[3],m=e[4],b=e[5],g=e[6],w=e[7],_=e[8];return Math.abs(n-d)<=p*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(r-h)<=p*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-f)<=p*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-v)<=p*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-m)<=p*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-b)<=p*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(l-g)<=p*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(u-w)<=p*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(c-_)<=p*Math.max(1,Math.abs(c),Math.abs(_))}var Kt=St,$t=Dt;function Yt(){var t=new f(16);return f!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Xt(t){var e=new f(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Zt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Qt(t,e,n,r,i,o,s,a,l,u,c,d,h,p,v,m){var b=new f(16);return b[0]=t,b[1]=e,b[2]=n,b[3]=r,b[4]=i,b[5]=o,b[6]=s,b[7]=a,b[8]=l,b[9]=u,b[10]=c,b[11]=d,b[12]=h,b[13]=p,b[14]=v,b[15]=m,b}function Jt(t,e,n,r,i,o,s,a,l,u,c,d,h,p,f,v,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t[8]=u,t[9]=c,t[10]=d,t[11]=h,t[12]=p,t[13]=f,t[14]=v,t[15]=m,t}function te(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ee(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function ne(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],u=e[7],c=e[8],d=e[9],h=e[10],p=e[11],f=e[12],v=e[13],m=e[14],b=e[15],g=n*a-r*s,w=n*l-i*s,_=n*u-o*s,y=r*l-i*a,x=r*u-o*a,A=i*u-o*l,E=c*v-d*f,C=c*m-h*f,M=c*b-p*f,P=d*m-h*v,S=d*b-p*v,k=h*b-p*m,T=g*k-w*S+_*P+y*M-x*C+A*E;return T?(T=1/T,t[0]=(a*k-l*S+u*P)*T,t[1]=(i*S-r*k-o*P)*T,t[2]=(v*A-m*x+b*y)*T,t[3]=(h*x-d*A-p*y)*T,t[4]=(l*M-s*k-u*C)*T,t[5]=(n*k-i*M+o*C)*T,t[6]=(m*_-f*A-b*w)*T,t[7]=(c*A-h*_+p*w)*T,t[8]=(s*S-a*M+u*E)*T,t[9]=(r*M-n*S-o*E)*T,t[10]=(f*x-v*_+b*g)*T,t[11]=(d*_-c*x-p*g)*T,t[12]=(a*C-s*P-l*E)*T,t[13]=(n*P-r*C+i*E)*T,t[14]=(v*w-f*y-m*g)*T,t[15]=(c*y-d*w+h*g)*T,t):null}function re(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],u=e[7],c=e[8],d=e[9],h=e[10],p=e[11],f=e[12],v=e[13],m=e[14],b=e[15];return t[0]=a*(h*b-p*m)-d*(l*b-u*m)+v*(l*p-u*h),t[1]=-(r*(h*b-p*m)-d*(i*b-o*m)+v*(i*p-o*h)),t[2]=r*(l*b-u*m)-a*(i*b-o*m)+v*(i*u-o*l),t[3]=-(r*(l*p-u*h)-a*(i*p-o*h)+d*(i*u-o*l)),t[4]=-(s*(h*b-p*m)-c*(l*b-u*m)+f*(l*p-u*h)),t[5]=n*(h*b-p*m)-c*(i*b-o*m)+f*(i*p-o*h),t[6]=-(n*(l*b-u*m)-s*(i*b-o*m)+f*(i*u-o*l)),t[7]=n*(l*p-u*h)-s*(i*p-o*h)+c*(i*u-o*l),t[8]=s*(d*b-p*v)-c*(a*b-u*v)+f*(a*p-u*d),t[9]=-(n*(d*b-p*v)-c*(r*b-o*v)+f*(r*p-o*d)),t[10]=n*(a*b-u*v)-s*(r*b-o*v)+f*(r*u-o*a),t[11]=-(n*(a*p-u*d)-s*(r*p-o*d)+c*(r*u-o*a)),t[12]=-(s*(d*m-h*v)-c*(a*m-l*v)+f*(a*h-l*d)),t[13]=n*(d*m-h*v)-c*(r*m-i*v)+f*(r*h-i*d),t[14]=-(n*(a*m-l*v)-s*(r*m-i*v)+f*(r*l-i*a)),t[15]=n*(a*h-l*d)-s*(r*h-i*d)+c*(r*l-i*a),t}function ie(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],l=t[7],u=t[8],c=t[9],d=t[10],h=t[11],p=t[12],f=t[13],v=t[14],m=t[15];return(e*s-n*o)*(d*m-h*v)-(e*a-r*o)*(c*m-h*f)+(e*l-i*o)*(c*v-d*f)+(n*a-r*s)*(u*m-h*p)-(n*l-i*s)*(u*v-d*p)+(r*l-i*a)*(u*f-c*p)}function oe(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],d=e[8],h=e[9],p=e[10],f=e[11],v=e[12],m=e[13],b=e[14],g=e[15],w=n[0],_=n[1],y=n[2],x=n[3];return t[0]=w*r+_*a+y*d+x*v,t[1]=w*i+_*l+y*h+x*m,t[2]=w*o+_*u+y*p+x*b,t[3]=w*s+_*c+y*f+x*g,w=n[4],_=n[5],y=n[6],x=n[7],t[4]=w*r+_*a+y*d+x*v,t[5]=w*i+_*l+y*h+x*m,t[6]=w*o+_*u+y*p+x*b,t[7]=w*s+_*c+y*f+x*g,w=n[8],_=n[9],y=n[10],x=n[11],t[8]=w*r+_*a+y*d+x*v,t[9]=w*i+_*l+y*h+x*m,t[10]=w*o+_*u+y*p+x*b,t[11]=w*s+_*c+y*f+x*g,w=n[12],_=n[13],y=n[14],x=n[15],t[12]=w*r+_*a+y*d+x*v,t[13]=w*i+_*l+y*h+x*m,t[14]=w*o+_*u+y*p+x*b,t[15]=w*s+_*c+y*f+x*g,t}function se(t,e,n){var r,i,o,s,a,l,u,c,d,h,p,f,v=n[0],m=n[1],b=n[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*b+e[12],t[13]=e[1]*v+e[5]*m+e[9]*b+e[13],t[14]=e[2]*v+e[6]*m+e[10]*b+e[14],t[15]=e[3]*v+e[7]*m+e[11]*b+e[15]):(r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],d=e[8],h=e[9],p=e[10],f=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=u,t[7]=c,t[8]=d,t[9]=h,t[10]=p,t[11]=f,t[12]=r*v+a*m+d*b+e[12],t[13]=i*v+l*m+h*b+e[13],t[14]=o*v+u*m+p*b+e[14],t[15]=s*v+c*m+f*b+e[15]),t}function ae(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function le(t,e,n,r){var i,o,s,a,l,u,c,d,h,f,v,m,b,g,w,_,y,x,A,E,C,M,P,S,k=r[0],T=r[1],B=r[2],F=Math.hypot(k,T,B);return F<p?null:(k*=F=1/F,T*=F,B*=F,i=Math.sin(n),s=1-(o=Math.cos(n)),a=e[0],l=e[1],u=e[2],c=e[3],d=e[4],h=e[5],f=e[6],v=e[7],m=e[8],b=e[9],g=e[10],w=e[11],_=k*k*s+o,y=T*k*s+B*i,x=B*k*s-T*i,A=k*T*s-B*i,E=T*T*s+o,C=B*T*s+k*i,M=k*B*s+T*i,P=T*B*s-k*i,S=B*B*s+o,t[0]=a*_+d*y+m*x,t[1]=l*_+h*y+b*x,t[2]=u*_+f*y+g*x,t[3]=c*_+v*y+w*x,t[4]=a*A+d*E+m*C,t[5]=l*A+h*E+b*C,t[6]=u*A+f*E+g*C,t[7]=c*A+v*E+w*C,t[8]=a*M+d*P+m*S,t[9]=l*M+h*P+b*S,t[10]=u*M+f*P+g*S,t[11]=c*M+v*P+w*S,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ue(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],s=e[5],a=e[6],l=e[7],u=e[8],c=e[9],d=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+u*r,t[5]=s*i+c*r,t[6]=a*i+d*r,t[7]=l*i+h*r,t[8]=u*i-o*r,t[9]=c*i-s*r,t[10]=d*i-a*r,t[11]=h*i-l*r,t}function ce(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],s=e[1],a=e[2],l=e[3],u=e[8],c=e[9],d=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-u*r,t[1]=s*i-c*r,t[2]=a*i-d*r,t[3]=l*i-h*r,t[8]=o*r+u*i,t[9]=s*r+c*i,t[10]=a*r+d*i,t[11]=l*r+h*i,t}function de(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],s=e[1],a=e[2],l=e[3],u=e[4],c=e[5],d=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+u*r,t[1]=s*i+c*r,t[2]=a*i+d*r,t[3]=l*i+h*r,t[4]=u*i-o*r,t[5]=c*i-s*r,t[6]=d*i-a*r,t[7]=h*i-l*r,t}function he(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function pe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fe(t,e,n){var r,i,o,s=n[0],a=n[1],l=n[2],u=Math.hypot(s,a,l);return u<p?null:(s*=u=1/u,a*=u,l*=u,r=Math.sin(e),o=1-(i=Math.cos(e)),t[0]=s*s*o+i,t[1]=a*s*o+l*r,t[2]=l*s*o-a*r,t[3]=0,t[4]=s*a*o-l*r,t[5]=a*a*o+i,t[6]=l*a*o+s*r,t[7]=0,t[8]=s*l*o+a*r,t[9]=a*l*o-s*r,t[10]=l*l*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function ve(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function me(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function be(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ge(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=r+r,l=i+i,u=o+o,c=r*a,d=r*l,h=r*u,p=i*l,f=i*u,v=o*u,m=s*a,b=s*l,g=s*u;return t[0]=1-(p+v),t[1]=d+g,t[2]=h-b,t[3]=0,t[4]=d-g,t[5]=1-(c+v),t[6]=f+m,t[7]=0,t[8]=h+b,t[9]=f-m,t[10]=1-(c+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function we(t,e){var n=new f(3),r=-e[0],i=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],d=r*r+i*i+o*o+s*s;return d>0?(n[0]=2*(a*s+c*r+l*o-u*i)/d,n[1]=2*(l*s+c*i+u*r-a*o)/d,n[2]=2*(u*s+c*o+a*i-l*r)/d):(n[0]=2*(a*s+c*r+l*o-u*i),n[1]=2*(l*s+c*i+u*r-a*o),n[2]=2*(u*s+c*o+a*i-l*r)),ge(t,e,n),t}function _e(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function ye(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],s=e[5],a=e[6],l=e[8],u=e[9],c=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,s,a),t[2]=Math.hypot(l,u,c),t}function xe(t,e){var n=new f(3);ye(n,e);var r=1/n[0],i=1/n[1],o=1/n[2],s=e[0]*r,a=e[1]*i,l=e[2]*o,u=e[4]*r,c=e[5]*i,d=e[6]*o,h=e[8]*r,p=e[9]*i,v=e[10]*o,m=s+c+v,b=0;return m>0?(b=2*Math.sqrt(m+1),t[3]=.25*b,t[0]=(d-p)/b,t[1]=(h-l)/b,t[2]=(a-u)/b):s>c&&s>v?(b=2*Math.sqrt(1+s-c-v),t[3]=(d-p)/b,t[0]=.25*b,t[1]=(a+u)/b,t[2]=(h+l)/b):c>v?(b=2*Math.sqrt(1+c-s-v),t[3]=(h-l)/b,t[0]=(a+u)/b,t[1]=.25*b,t[2]=(d+p)/b):(b=2*Math.sqrt(1+v-s-c),t[3]=(a-u)/b,t[0]=(h+l)/b,t[1]=(d+p)/b,t[2]=.25*b),t}function Ae(t,e,n,r){var i=e[0],o=e[1],s=e[2],a=e[3],l=i+i,u=o+o,c=s+s,d=i*l,h=i*u,p=i*c,f=o*u,v=o*c,m=s*c,b=a*l,g=a*u,w=a*c,_=r[0],y=r[1],x=r[2];return t[0]=(1-(f+m))*_,t[1]=(h+w)*_,t[2]=(p-g)*_,t[3]=0,t[4]=(h-w)*y,t[5]=(1-(d+m))*y,t[6]=(v+b)*y,t[7]=0,t[8]=(p+g)*x,t[9]=(v-b)*x,t[10]=(1-(d+f))*x,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Ee(t,e,n,r,i){var o=e[0],s=e[1],a=e[2],l=e[3],u=o+o,c=s+s,d=a+a,h=o*u,p=o*c,f=o*d,v=s*c,m=s*d,b=a*d,g=l*u,w=l*c,_=l*d,y=r[0],x=r[1],A=r[2],E=i[0],C=i[1],M=i[2],P=(1-(v+b))*y,S=(p+_)*y,k=(f-w)*y,T=(p-_)*x,B=(1-(h+b))*x,F=(m+g)*x,V=(f+w)*A,I=(m-g)*A,z=(1-(h+v))*A;return t[0]=P,t[1]=S,t[2]=k,t[3]=0,t[4]=T,t[5]=B,t[6]=F,t[7]=0,t[8]=V,t[9]=I,t[10]=z,t[11]=0,t[12]=n[0]+E-(P*E+T*C+V*M),t[13]=n[1]+C-(S*E+B*C+I*M),t[14]=n[2]+M-(k*E+F*C+z*M),t[15]=1,t}function Ce(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n+n,a=r+r,l=i+i,u=n*s,c=r*s,d=r*a,h=i*s,p=i*a,f=i*l,v=o*s,m=o*a,b=o*l;return t[0]=1-d-f,t[1]=c+b,t[2]=h-m,t[3]=0,t[4]=c-b,t[5]=1-u-f,t[6]=p+v,t[7]=0,t[8]=h+m,t[9]=p-v,t[10]=1-u-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Me(t,e,n,r,i,o,s){var a=1/(n-e),l=1/(i-r),u=1/(o-s);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*l,t[10]=(s+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*u,t[15]=0,t}function Pe(t,e,n,r,i){var o,s=1/Math.tan(e/2);return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var Se=Pe;function ke(t,e,n,r,i){var o,s=1/Math.tan(e/2);return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function Te(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(s+a),u=2/(i+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(s-a)*l*.5,t[9]=(i-o)*u*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Be(t,e,n,r,i,o,s){var a=1/(e-n),l=1/(r-i),u=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*l,t[14]=(s+o)*u,t[15]=1,t}var Fe=Be;function Ve(t,e,n,r,i,o,s){var a=1/(e-n),l=1/(r-i),u=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*l,t[14]=o*u,t[15]=1,t}function Ie(t,e,n,r){var i,o,s,a,l,u,c,d,h,f,v=e[0],m=e[1],b=e[2],g=r[0],w=r[1],_=r[2],y=n[0],x=n[1],A=n[2];return Math.abs(v-y)<p&&Math.abs(m-x)<p&&Math.abs(b-A)<p?te(t):(c=v-y,d=m-x,h=b-A,i=w*(h*=f=1/Math.hypot(c,d,h))-_*(d*=f),o=_*(c*=f)-g*h,s=g*d-w*c,(f=Math.hypot(i,o,s))?(i*=f=1/f,o*=f,s*=f):(i=0,o=0,s=0),a=d*s-h*o,l=h*i-c*s,u=c*o-d*i,(f=Math.hypot(a,l,u))?(a*=f=1/f,l*=f,u*=f):(a=0,l=0,u=0),t[0]=i,t[1]=a,t[2]=c,t[3]=0,t[4]=o,t[5]=l,t[6]=d,t[7]=0,t[8]=s,t[9]=u,t[10]=h,t[11]=0,t[12]=-(i*v+o*m+s*b),t[13]=-(a*v+l*m+u*b),t[14]=-(c*v+d*m+h*b),t[15]=1,t)}function ze(t,e,n,r){var i=e[0],o=e[1],s=e[2],a=r[0],l=r[1],u=r[2],c=i-n[0],d=o-n[1],h=s-n[2],p=c*c+d*d+h*h;p>0&&(c*=p=1/Math.sqrt(p),d*=p,h*=p);var f=l*h-u*d,v=u*c-a*h,m=a*d-l*c;return(p=f*f+v*v+m*m)>0&&(f*=p=1/Math.sqrt(p),v*=p,m*=p),t[0]=f,t[1]=v,t[2]=m,t[3]=0,t[4]=d*m-h*v,t[5]=h*f-c*m,t[6]=c*v-d*f,t[7]=0,t[8]=c,t[9]=d,t[10]=h,t[11]=0,t[12]=i,t[13]=o,t[14]=s,t[15]=1,t}function Le(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Re(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Oe(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function qe(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function je(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function Ne(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function De(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function We(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],f=t[11],v=t[12],m=t[13],b=t[14],g=t[15],w=e[0],_=e[1],y=e[2],x=e[3],A=e[4],E=e[5],C=e[6],M=e[7],P=e[8],S=e[9],k=e[10],T=e[11],B=e[12],F=e[13],V=e[14],I=e[15];return Math.abs(n-w)<=p*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(r-_)<=p*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-y)<=p*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-x)<=p*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-A)<=p*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(a-E)<=p*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(l-C)<=p*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(u-M)<=p*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(c-P)<=p*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(d-S)<=p*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(h-k)<=p*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(f-T)<=p*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(v-B)<=p*Math.max(1,Math.abs(v),Math.abs(B))&&Math.abs(m-F)<=p*Math.max(1,Math.abs(m),Math.abs(F))&&Math.abs(b-V)<=p*Math.max(1,Math.abs(b),Math.abs(V))&&Math.abs(g-I)<=p*Math.max(1,Math.abs(g),Math.abs(I))}var Ue=oe,He=qe;function Ge(){var t=new f(3);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ke(t){var e=new f(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function $e(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Ye(t,e,n){var r=new f(3);return r[0]=t,r[1]=e,r[2]=n,r}function Xe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ze(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Qe(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Je(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function tn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function en(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function nn(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function rn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function on(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function sn(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function an(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ln(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function un(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function cn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function dn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function hn(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function pn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function fn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function vn(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function mn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function bn(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],l=n[2];return t[0]=i*l-o*a,t[1]=o*s-r*l,t[2]=r*a-i*s,t}function gn(t,e,n,r){var i=e[0],o=e[1],s=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=s+r*(n[2]-s),t}function wn(t,e,n,r,i,o){var s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,u=s*(o-1),c=s*(3-2*o);return t[0]=e[0]*a+n[0]*l+r[0]*u+i[0]*c,t[1]=e[1]*a+n[1]*l+r[1]*u+i[1]*c,t[2]=e[2]*a+n[2]*l+r[2]*u+i[2]*c,t}function _n(t,e,n,r,i,o){var s=1-o,a=s*s,l=o*o,u=a*s,c=3*o*a,d=3*l*s,h=l*o;return t[0]=e[0]*u+n[0]*c+r[0]*d+i[0]*h,t[1]=e[1]*u+n[1]*c+r[1]*d+i[1]*h,t[2]=e[2]*u+n[2]*c+r[2]*d+i[2]*h,t}function yn(t,e){e=e||1;var n=2*v()*Math.PI,r=2*v()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function xn(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[3]*r+n[7]*i+n[11]*o+n[15];return s=s||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/s,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/s,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/s,t}function An(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function En(t,e,n){var r=n[0],i=n[1],o=n[2],s=n[3],a=e[0],l=e[1],u=e[2],c=i*u-o*l,d=o*a-r*u,h=r*l-i*a,p=i*h-o*d,f=o*c-r*h,v=r*d-i*c,m=2*s;return c*=m,d*=m,h*=m,p*=2,f*=2,v*=2,t[0]=a+c+p,t[1]=l+d+f,t[2]=u+h+v,t}function Cn(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Mn(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Pn(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Sn(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],s=e[1],a=e[2],l=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+s*s+a*a),u=l&&mn(t,e)/l;return Math.acos(Math.min(Math.max(u,-1),1))}function kn(t){return t[0]=0,t[1]=0,t[2]=0,t}function Tn(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Bn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Fn(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(n-o)<=p*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=p*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=p*Math.max(1,Math.abs(i),Math.abs(a))}var Vn,In=Je,zn=tn,Ln=en,Rn=cn,On=dn,qn=$e,jn=hn,Nn=(Vn=Ge(),function(t,e,n,r,i,o){var s,a;for(e||(e=3),n||(n=0),a=r?Math.min(r*e+n,t.length):t.length,s=n;s<a;s+=e)Vn[0]=t[s],Vn[1]=t[s+1],Vn[2]=t[s+2],i(Vn,Vn,o),t[s]=Vn[0],t[s+1]=Vn[1],t[s+2]=Vn[2];return t});function Dn(){var t=new f(4);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Wn(t){var e=new f(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Un(t,e,n,r){var i=new f(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function Hn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Gn(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function Kn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function $n(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Yn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Xn(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Zn(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Qn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Jn(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function tr(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function er(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function nr(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function rr(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function ir(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.hypot(n,r,i,o)}function or(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+i*i+o*o}function sr(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function ar(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function lr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function ur(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function cr(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n*n+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=n*s,t[1]=r*s,t[2]=i*s,t[3]=o*s,t}function dr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function hr(t,e,n,r){var i=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],s=n[0]*r[3]-n[3]*r[0],a=n[1]*r[2]-n[2]*r[1],l=n[1]*r[3]-n[3]*r[1],u=n[2]*r[3]-n[3]*r[2],c=e[0],d=e[1],h=e[2],p=e[3];return t[0]=d*u-h*l+p*a,t[1]=-c*u+h*s-p*o,t[2]=c*l-d*s+p*i,t[3]=-c*a+d*o-h*i,t}function pr(t,e,n,r){var i=e[0],o=e[1],s=e[2],a=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=s+r*(n[2]-s),t[3]=a+r*(n[3]-a),t}function fr(t,e){var n,r,i,o,s,a;e=e||1;do{s=(n=2*v()-1)*n+(r=2*v()-1)*r}while(s>=1);do{a=(i=2*v()-1)*i+(o=2*v()-1)*o}while(a>=1);var l=Math.sqrt((1-s)/a);return t[0]=e*n,t[1]=e*r,t[2]=e*i*l,t[3]=e*o*l,t}function vr(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*s,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*s,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*s,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*s,t}function mr(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],l=n[2],u=n[3],c=u*r+a*o-l*i,d=u*i+l*r-s*o,h=u*o+s*i-a*r,p=-s*r-a*i-l*o;return t[0]=c*u+p*-s+d*-l-h*-a,t[1]=d*u+p*-a+h*-s-c*-l,t[2]=h*u+p*-l+c*-a-d*-s,t[3]=e[3],t}function br(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function gr(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function wr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function _r(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=e[0],a=e[1],l=e[2],u=e[3];return Math.abs(n-s)<=p*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=p*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-l)<=p*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-u)<=p*Math.max(1,Math.abs(o),Math.abs(u))}var yr=$n,xr=Yn,Ar=Xn,Er=ir,Cr=or,Mr=sr,Pr=ar,Sr=function(){var t=Dn();return function(e,n,r,i,o,s){var a,l;for(n||(n=4),r||(r=0),l=i?Math.min(i*n+r,e.length):e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}();function kr(){var t=new f(4);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Tr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Br(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function Fr(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>p?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Vr(t,e){var n=li(t,e);return Math.acos(2*n*n-1)}function Ir(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=n[0],l=n[1],u=n[2],c=n[3];return t[0]=r*c+s*a+i*u-o*l,t[1]=i*c+s*l+o*a-r*u,t[2]=o*c+s*u+r*l-i*a,t[3]=s*c-r*a-i*l-o*u,t}function zr(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=r*l+s*a,t[1]=i*l+o*a,t[2]=o*l-i*a,t[3]=s*l-r*a,t}function Lr(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=r*l-o*a,t[1]=i*l+s*a,t[2]=o*l+r*a,t[3]=s*l-i*a,t}function Rr(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=r*l+i*a,t[1]=i*l-r*a,t[2]=o*l+s*a,t[3]=s*l-o*a,t}function Or(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function qr(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=Math.sqrt(n*n+r*r+i*i),a=Math.exp(o),l=s>0?a*Math.sin(s)/s:0;return t[0]=n*l,t[1]=r*l,t[2]=i*l,t[3]=a*Math.cos(s),t}function jr(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=Math.sqrt(n*n+r*r+i*i),a=s>0?Math.atan2(s,o)/s:0;return t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=.5*Math.log(n*n+r*r+i*i+o*o),t}function Nr(t,e,n){return jr(t,e),ai(t,t,n),qr(t,t),t}function Dr(t,e,n,r){var i,o,s,a,l,u=e[0],c=e[1],d=e[2],h=e[3],f=n[0],v=n[1],m=n[2],b=n[3];return(o=u*f+c*v+d*m+h*b)<0&&(o=-o,f=-f,v=-v,m=-m,b=-b),1-o>p?(i=Math.acos(o),s=Math.sin(i),a=Math.sin((1-r)*i)/s,l=Math.sin(r*i)/s):(a=1-r,l=r),t[0]=a*u+l*f,t[1]=a*c+l*v,t[2]=a*d+l*m,t[3]=a*h+l*b,t}function Wr(t){var e=v(),n=v(),r=v(),i=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*r),t[3]=o*Math.cos(2*Math.PI*r),t}function Ur(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n*n+r*r+i*i+o*o,a=s?1/s:0;return t[0]=-n*a,t[1]=-r*a,t[2]=-i*a,t[3]=o*a,t}function Hr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Gr(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,s=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*s+s]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*o+s]-e[3*s+o])*n,t[o]=(e[3*o+i]+e[3*i+o])*n,t[s]=(e[3*s+i]+e[3*i+s])*n}return t}function Kr(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var o=Math.sin(e),s=Math.cos(e),a=Math.sin(n),l=Math.cos(n),u=Math.sin(r),c=Math.cos(r);return t[0]=o*l*c-s*a*u,t[1]=s*a*c+o*l*u,t[2]=s*l*u-o*a*c,t[3]=s*l*c+o*a*u,t}function $r(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Yr,Xr,Zr,Qr,Jr,ti,ei=Wn,ni=Un,ri=Hn,ii=Gn,oi=Kn,si=Ir,ai=nr,li=dr,ui=pr,ci=sr,di=ci,hi=ar,pi=hi,fi=cr,vi=wr,mi=_r,bi=(Yr=Ge(),Xr=Ye(1,0,0),Zr=Ye(0,1,0),function(t,e,n){var r=mn(e,n);return r<-.999999?(bn(Yr,Xr,e),qn(Yr)<1e-6&&bn(Yr,Zr,e),vn(Yr,Yr),Br(t,Yr,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(bn(Yr,e,n),t[0]=Yr[0],t[1]=Yr[1],t[2]=Yr[2],t[3]=1+r,fi(t,t))}),gi=(Qr=kr(),Jr=kr(),function(t,e,n,r,i,o){return Dr(Qr,e,i,o),Dr(Jr,n,r,o),Dr(t,Qr,Jr,2*o*(1-o)),t}),wi=(ti=bt(),function(t,e,n,r){return ti[0]=n[0],ti[3]=n[1],ti[6]=n[2],ti[1]=r[0],ti[4]=r[1],ti[7]=r[2],ti[2]=-e[0],ti[5]=-e[1],ti[8]=-e[2],fi(t,Gr(t,ti))});function _i(){var t=new f(8);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function yi(t){var e=new f(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function xi(t,e,n,r,i,o,s,a){var l=new f(8);return l[0]=t,l[1]=e,l[2]=n,l[3]=r,l[4]=i,l[5]=o,l[6]=s,l[7]=a,l}function Ai(t,e,n,r,i,o,s){var a=new f(8);a[0]=t,a[1]=e,a[2]=n,a[3]=r;var l=.5*i,u=.5*o,c=.5*s;return a[4]=l*r+u*n-c*e,a[5]=u*r+c*t-l*n,a[6]=c*r+l*e-u*t,a[7]=-l*t-u*e-c*n,a}function Ei(t,e,n){var r=.5*n[0],i=.5*n[1],o=.5*n[2],s=e[0],a=e[1],l=e[2],u=e[3];return t[0]=s,t[1]=a,t[2]=l,t[3]=u,t[4]=r*u+i*l-o*a,t[5]=i*u+o*s-r*l,t[6]=o*u+r*a-i*s,t[7]=-r*s-i*a-o*l,t}function Ci(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function Mi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Pi(t,e){var n=kr();xe(n,e);var r=new f(3);return _e(r,e),Ei(t,n,r),t}function Si(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function ki(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Ti(t,e,n,r,i,o,s,a,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t}var Bi=ri;function Fi(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var Vi=ri;function Ii(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function zi(t,e){var n=e[4],r=e[5],i=e[6],o=e[7],s=-e[0],a=-e[1],l=-e[2],u=e[3];return t[0]=2*(n*u+o*s+r*l-i*a),t[1]=2*(r*u+o*a+i*s-n*l),t[2]=2*(i*u+o*l+n*a-r*s),t}function Li(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=.5*n[0],l=.5*n[1],u=.5*n[2],c=e[4],d=e[5],h=e[6],p=e[7];return t[0]=r,t[1]=i,t[2]=o,t[3]=s,t[4]=s*a+i*u-o*l+c,t[5]=s*l+o*a-r*u+d,t[6]=s*u+r*l-i*a+h,t[7]=-r*a-i*l-o*u+p,t}function Ri(t,e,n){var r=-e[0],i=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],d=a*s+c*r+l*o-u*i,h=l*s+c*i+u*r-a*o,p=u*s+c*o+a*i-l*r,f=c*s-a*r-l*i-u*o;return zr(t,e,n),r=t[0],i=t[1],o=t[2],s=t[3],t[4]=d*s+f*r+h*o-p*i,t[5]=h*s+f*i+p*r-d*o,t[6]=p*s+f*o+d*i-h*r,t[7]=f*s-d*r-h*i-p*o,t}function Oi(t,e,n){var r=-e[0],i=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],d=a*s+c*r+l*o-u*i,h=l*s+c*i+u*r-a*o,p=u*s+c*o+a*i-l*r,f=c*s-a*r-l*i-u*o;return Lr(t,e,n),r=t[0],i=t[1],o=t[2],s=t[3],t[4]=d*s+f*r+h*o-p*i,t[5]=h*s+f*i+p*r-d*o,t[6]=p*s+f*o+d*i-h*r,t[7]=f*s-d*r-h*i-p*o,t}function qi(t,e,n){var r=-e[0],i=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],d=a*s+c*r+l*o-u*i,h=l*s+c*i+u*r-a*o,p=u*s+c*o+a*i-l*r,f=c*s-a*r-l*i-u*o;return Rr(t,e,n),r=t[0],i=t[1],o=t[2],s=t[3],t[4]=d*s+f*r+h*o-p*i,t[5]=h*s+f*i+p*r-d*o,t[6]=p*s+f*o+d*i-h*r,t[7]=f*s-d*r-h*i-p*o,t}function ji(t,e,n){var r=n[0],i=n[1],o=n[2],s=n[3],a=e[0],l=e[1],u=e[2],c=e[3];return t[0]=a*s+c*r+l*o-u*i,t[1]=l*s+c*i+u*r-a*o,t[2]=u*s+c*o+a*i-l*r,t[3]=c*s-a*r-l*i-u*o,a=e[4],l=e[5],u=e[6],c=e[7],t[4]=a*s+c*r+l*o-u*i,t[5]=l*s+c*i+u*r-a*o,t[6]=u*s+c*o+a*i-l*r,t[7]=c*s-a*r-l*i-u*o,t}function Ni(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=n[0],l=n[1],u=n[2],c=n[3];return t[0]=r*c+s*a+i*u-o*l,t[1]=i*c+s*l+o*a-r*u,t[2]=o*c+s*u+r*l-i*a,t[3]=s*c-r*a-i*l-o*u,a=n[4],l=n[5],u=n[6],c=n[7],t[4]=r*c+s*a+i*u-o*l,t[5]=i*c+s*l+o*a-r*u,t[6]=o*c+s*u+r*l-i*a,t[7]=s*c-r*a-i*l-o*u,t}function Di(t,e,n,r){if(Math.abs(r)<p)return Si(t,e);var i=Math.hypot(n[0],n[1],n[2]);r*=.5;var o=Math.sin(r),s=o*n[0]/i,a=o*n[1]/i,l=o*n[2]/i,u=Math.cos(r),c=e[0],d=e[1],h=e[2],f=e[3];t[0]=c*u+f*s+d*l-h*a,t[1]=d*u+f*a+h*s-c*l,t[2]=h*u+f*l+c*a-d*s,t[3]=f*u-c*s-d*a-h*l;var v=e[4],m=e[5],b=e[6],g=e[7];return t[4]=v*u+g*s+m*l-b*a,t[5]=m*u+g*a+b*s-v*l,t[6]=b*u+g*l+v*a-m*s,t[7]=g*u-v*s-m*a-b*l,t}function Wi(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t}function Ui(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=n[4],l=n[5],u=n[6],c=n[7],d=e[4],h=e[5],p=e[6],f=e[7],v=n[0],m=n[1],b=n[2],g=n[3];return t[0]=r*g+s*v+i*b-o*m,t[1]=i*g+s*m+o*v-r*b,t[2]=o*g+s*b+r*m-i*v,t[3]=s*g-r*v-i*m-o*b,t[4]=r*c+s*a+i*u-o*l+d*g+f*v+h*b-p*m,t[5]=i*c+s*l+o*a-r*u+h*g+f*m+p*v-d*b,t[6]=o*c+s*u+r*l-i*a+p*g+f*b+d*m-h*v,t[7]=s*c-r*a-i*l-o*u+f*g-d*v-h*m-p*b,t}var Hi=Ui;function Gi(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t}var Ki=li;function $i(t,e,n,r){var i=1-r;return Ki(e,n)<0&&(r=-r),t[0]=e[0]*i+n[0]*r,t[1]=e[1]*i+n[1]*r,t[2]=e[2]*i+n[2]*r,t[3]=e[3]*i+n[3]*r,t[4]=e[4]*i+n[4]*r,t[5]=e[5]*i+n[5]*r,t[6]=e[6]*i+n[6]*r,t[7]=e[7]*i+n[7]*r,t}function Yi(t,e){var n=Ji(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t}function Xi(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Zi=ci,Qi=Zi,Ji=hi,to=Ji;function eo(t,e){var n=Ji(e);if(n>0){n=Math.sqrt(n);var r=e[0]/n,i=e[1]/n,o=e[2]/n,s=e[3]/n,a=e[4],l=e[5],u=e[6],c=e[7],d=r*a+i*l+o*u+s*c;t[0]=r,t[1]=i,t[2]=o,t[3]=s,t[4]=(a-r*d)/n,t[5]=(l-i*d)/n,t[6]=(u-o*d)/n,t[7]=(c-s*d)/n}return t}function no(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function ro(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function io(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=e[0],d=e[1],h=e[2],f=e[3],v=e[4],m=e[5],b=e[6],g=e[7];return Math.abs(n-c)<=p*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-d)<=p*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-h)<=p*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-f)<=p*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-v)<=p*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(a-m)<=p*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-b)<=p*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(u-g)<=p*Math.max(1,Math.abs(u),Math.abs(g))}function oo(){var t=new f(2);return f!=Float32Array&&(t[0]=0,t[1]=0),t}function so(t){var e=new f(2);return e[0]=t[0],e[1]=t[1],e}function ao(t,e){var n=new f(2);return n[0]=t,n[1]=e,n}function lo(t,e){return t[0]=e[0],t[1]=e[1],t}function uo(t,e,n){return t[0]=e,t[1]=n,t}function co(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function ho(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function po(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function fo(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function vo(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function mo(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function bo(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function go(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function wo(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function _o(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function yo(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function xo(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function Ao(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function Eo(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function Co(t){var e=t[0],n=t[1];return e*e+n*n}function Mo(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Po(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function So(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function ko(t,e){return t[0]*e[0]+t[1]*e[1]}function To(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function Bo(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}function Fo(t,e){e=e||1;var n=2*v()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function Vo(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function Io(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function zo(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function Lo(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}function Ro(t,e,n,r){var i=e[0]-n[0],o=e[1]-n[1],s=Math.sin(r),a=Math.cos(r);return t[0]=i*a-o*s+n[0],t[1]=i*s+o*a+n[1],t}function Oo(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+o*o),a=s&&(n*i+r*o)/s;return Math.acos(Math.min(Math.max(a,-1),1))}function qo(t){return t[0]=0,t[1]=0,t}function jo(t){return"vec2("+t[0]+", "+t[1]+")"}function No(t,e){return t[0]===e[0]&&t[1]===e[1]}function Do(t,e){var n=t[0],r=t[1],i=e[0],o=e[1];return Math.abs(n-i)<=p*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=p*Math.max(1,Math.abs(r),Math.abs(o))}var Wo=Eo,Uo=ho,Ho=po,Go=fo,Ko=xo,$o=Ao,Yo=Co,Xo=function(){var t=oo();return function(e,n,r,i,o,s){var a,l;for(n||(n=2),r||(r=0),l=i?Math.min(i*n+r,e.length):e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],o(t,t,s),e[a]=t[0],e[a+1]=t[1];return e}}()},17:function(t,e,n){"use strict";n.r(e),n.d(e,"addExtensionsToContext",(function(){return Ar})),n.d(e,"attributes",(function(){return et})),n.d(e,"bindFramebufferInfo",(function(){return hr})),n.d(e,"bindTransformFeedbackInfo",(function(){return In})),n.d(e,"bindUniformBlock",(function(){return jn})),n.d(e,"canFilter",(function(){return me})),n.d(e,"canGenerateMipmap",(function(){return ve})),n.d(e,"createAttribsFromArrays",(function(){return Y})),n.d(e,"createAttributeSetters",(function(){return Gn})),n.d(e,"createBufferFromArray",(function(){return J})),n.d(e,"createBufferFromTypedArray",(function(){return O})),n.d(e,"createBufferInfoFromArrays",(function(){return Q})),n.d(e,"createBuffersFromArrays",(function(){return tt})),n.d(e,"createFramebufferInfo",(function(){return cr})),n.d(e,"createProgram",(function(){return yn})),n.d(e,"createProgramAsync",(function(){return An})),n.d(e,"createProgramFromScripts",(function(){return Pn})),n.d(e,"createProgramFromSources",(function(){return Sn})),n.d(e,"createProgramInfo",(function(){return Zn})),n.d(e,"createProgramInfoAsync",(function(){return En})),n.d(e,"createProgramInfoFromProgram",(function(){return Yn})),n.d(e,"createProgramInfos",(function(){return tr})),n.d(e,"createProgramInfosAsync",(function(){return nr})),n.d(e,"createPrograms",(function(){return Jn})),n.d(e,"createProgramsAsync",(function(){return er})),n.d(e,"createSampler",(function(){return Pe})),n.d(e,"createSamplers",(function(){return Se})),n.d(e,"createTexture",(function(){return Ue})),n.d(e,"createTextures",(function(){return Ge})),n.d(e,"createTransformFeedback",(function(){return zn})),n.d(e,"createTransformFeedbackInfo",(function(){return Vn})),n.d(e,"createUniformBlockInfo",(function(){return qn})),n.d(e,"createUniformBlockInfoFromProgram",(function(){return On})),n.d(e,"createUniformBlockSpecFromProgram",(function(){return Ln})),n.d(e,"createUniformSetters",(function(){return Fn})),n.d(e,"createVAOAndSetAttributes",(function(){return vr})),n.d(e,"createVAOFromBufferInfo",(function(){return mr})),n.d(e,"createVertexArrayInfo",(function(){return fr})),n.d(e,"draw",(function(){return sr})),n.d(e,"drawBufferInfo",(function(){return ir})),n.d(e,"drawObjectList",(function(){return or})),n.d(e,"framebuffers",(function(){return pr})),n.d(e,"getArray_",(function(){return j})),n.d(e,"getBytesPerElementForInternalFormat",(function(){return he})),n.d(e,"getContext",(function(){return Cr})),n.d(e,"getFormatAndTypeForInternalFormat",(function(){return pe})),n.d(e,"getGLTypeForTypedArray",(function(){return x})),n.d(e,"getGLTypeForTypedArrayType",(function(){return A})),n.d(e,"getNumComponentsForFormat",(function(){return be})),n.d(e,"getNumComponents_",(function(){return W})),n.d(e,"getTypedArrayTypeForGLType",(function(){return E})),n.d(e,"getWebGLContext",(function(){return Er})),n.d(e,"glEnumToString",(function(){return ne})),n.d(e,"isArrayBuffer",(function(){return C})),n.d(e,"isWebGL1",(function(){return ee})),n.d(e,"isWebGL2",(function(){return te})),n.d(e,"loadTextureFromUrl",(function(){return qe})),n.d(e,"m4",(function(){return _})),n.d(e,"primitives",(function(){return Jt})),n.d(e,"programs",(function(){return rr})),n.d(e,"resizeCanvasToDisplaySize",(function(){return Mr})),n.d(e,"resizeFramebufferInfo",(function(){return dr})),n.d(e,"resizeTexture",(function(){return He})),n.d(e,"setAttribInfoBufferFromArray",(function(){return X})),n.d(e,"setAttributeDefaults_",(function(){return L})),n.d(e,"setAttributePrefix",(function(){return z})),n.d(e,"setAttributes",(function(){return Kn})),n.d(e,"setBlockUniforms",(function(){return Dn})),n.d(e,"setBuffersAndAttributes",(function(){return $n})),n.d(e,"setDefaultTextureColor",(function(){return _e})),n.d(e,"setDefaults",(function(){return wr})),n.d(e,"setEmptyTexture",(function(){return We})),n.d(e,"setSamplerParameters",(function(){return Me})),n.d(e,"setTextureDefaults_",(function(){return ye})),n.d(e,"setTextureFilteringForSize",(function(){return ke})),n.d(e,"setTextureFromArray",(function(){return De})),n.d(e,"setTextureFromElement",(function(){return Ve})),n.d(e,"setTextureParameters",(function(){return Ce})),n.d(e,"setUniformBlock",(function(){return Nn})),n.d(e,"setUniforms",(function(){return Un})),n.d(e,"setUniformsAndBindTextures",(function(){return Hn})),n.d(e,"textures",(function(){return Ke})),n.d(e,"typedarrays",(function(){return M})),n.d(e,"utils",(function(){return re})),n.d(e,"v3",(function(){return c})),n.d(e,"vertexArrays",(function(){return br}));
/* @license twgl.js 5.5.3 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
Available via the MIT license.
see: http://github.com/greggman/twgl.js for details */
let r=Float32Array;function i(t,e,n){const i=new r(3);return t&&(i[0]=t),e&&(i[1]=e),n&&(i[2]=n),i}function o(t,e,n){return(n=n||new r(3))[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function s(t,e,n){return(n=n||new r(3))[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function a(t,e,n){n=n||new r(3);const i=t[2]*e[0]-t[0]*e[2],o=t[0]*e[1]-t[1]*e[0];return n[0]=t[1]*e[2]-t[2]*e[1],n[1]=i,n[2]=o,n}function l(t,e){e=e||new r(3);const n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=Math.sqrt(n);return i>1e-5?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=0,e[1]=0,e[2]=0),e}function u(t,e,n){return(n=n||new r(3))[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2],n}var c=Object.freeze({__proto__:null,add:o,copy:function(t,e){return(e=e||new r(3))[0]=t[0],e[1]=t[1],e[2]=t[2],e},create:i,cross:a,distance:function(t,e){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},distanceSq:function(t,e){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i},divide:function(t,e,n){return(n=n||new r(3))[0]=t[0]/e[0],n[1]=t[1]/e[1],n[2]=t[2]/e[2],n},divScalar:function(t,e,n){return(n=n||new r(3))[0]=t[0]/e,n[1]=t[1]/e,n[2]=t[2]/e,n},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},lerp:function(t,e,n,i){return(i=i||new r(3))[0]=t[0]+n*(e[0]-t[0]),i[1]=t[1]+n*(e[1]-t[1]),i[2]=t[2]+n*(e[2]-t[2]),i},lerpV:function(t,e,n,i){return(i=i||new r(3))[0]=t[0]+n[0]*(e[0]-t[0]),i[1]=t[1]+n[1]*(e[1]-t[1]),i[2]=t[2]+n[2]*(e[2]-t[2]),i},length:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},lengthSq:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]},max:function(t,e,n){return(n=n||new r(3))[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n[2]=Math.max(t[2],e[2]),n},min:function(t,e,n){return(n=n||new r(3))[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.min(t[2],e[2]),n},mulScalar:function(t,e,n){return(n=n||new r(3))[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n},multiply:u,negate:function(t,e){return(e=e||new r(3))[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},normalize:l,setDefaultType:function(t){const e=r;return r=t,e},subtract:s});let d,h,p,f=Float32Array;function v(t,e){return(e=e||new f(16))[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function m(t){return(t=t||new f(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function b(t,e){e=e||new f(16);const n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],p=t[11],v=t[12],m=t[13],b=t[14],g=t[15],w=h*g,_=b*p,y=l*g,x=b*u,A=l*p,E=h*u,C=i*g,M=b*o,P=i*p,S=h*o,k=i*u,T=l*o,B=c*m,F=v*d,V=s*m,I=v*a,z=s*d,L=c*a,R=n*m,O=v*r,q=n*d,j=c*r,N=n*a,D=s*r,W=w*a+x*d+A*m-(_*a+y*d+E*m),U=_*r+C*d+S*m-(w*r+M*d+P*m),H=y*r+M*a+k*m-(x*r+C*a+T*m),G=E*r+P*a+T*d-(A*r+S*a+k*d),K=1/(n*W+s*U+c*H+v*G);return e[0]=K*W,e[1]=K*U,e[2]=K*H,e[3]=K*G,e[4]=K*(_*s+y*c+E*v-(w*s+x*c+A*v)),e[5]=K*(w*n+M*c+P*v-(_*n+C*c+S*v)),e[6]=K*(x*n+C*s+T*v-(y*n+M*s+k*v)),e[7]=K*(A*n+S*s+k*c-(E*n+P*s+T*c)),e[8]=K*(B*u+I*p+z*g-(F*u+V*p+L*g)),e[9]=K*(F*o+R*p+j*g-(B*o+O*p+q*g)),e[10]=K*(V*o+O*u+N*g-(I*o+R*u+D*g)),e[11]=K*(L*o+q*u+D*p-(z*o+j*u+N*p)),e[12]=K*(V*h+L*b+F*l-(z*b+B*l+I*h)),e[13]=K*(q*b+B*i+O*h-(R*h+j*b+F*i)),e[14]=K*(R*l+D*b+I*i-(N*b+V*i+O*l)),e[15]=K*(N*h+z*i+j*l-(q*l+D*h+L*i)),e}function g(t,e,n){n=n||i();const r=e[0],o=e[1],s=e[2],a=r*t[3]+o*t[7]+s*t[11]+t[15];return n[0]=(r*t[0]+o*t[4]+s*t[8]+t[12])/a,n[1]=(r*t[1]+o*t[5]+s*t[9]+t[13])/a,n[2]=(r*t[2]+o*t[6]+s*t[10]+t[14])/a,n}function w(t,e,n){n=n||i();const r=e[0],o=e[1],s=e[2];return n[0]=r*t[0]+o*t[4]+s*t[8],n[1]=r*t[1]+o*t[5]+s*t[9],n[2]=r*t[2]+o*t[6]+s*t[10],n}var _=Object.freeze({__proto__:null,axisRotate:function(t,e,n,r){r=r||new f(16);let i=e[0],o=e[1],s=e[2];const a=Math.sqrt(i*i+o*o+s*s);i/=a,o/=a,s/=a;const l=i*i,u=o*o,c=s*s,d=Math.cos(n),h=Math.sin(n),p=1-d,v=l+(1-l)*d,m=i*o*p+s*h,b=i*s*p-o*h,g=i*o*p-s*h,w=u+(1-u)*d,_=o*s*p+i*h,y=i*s*p+o*h,x=o*s*p-i*h,A=c+(1-c)*d,E=t[0],C=t[1],M=t[2],P=t[3],S=t[4],k=t[5],T=t[6],B=t[7],F=t[8],V=t[9],I=t[10],z=t[11];return r[0]=v*E+m*S+b*F,r[1]=v*C+m*k+b*V,r[2]=v*M+m*T+b*I,r[3]=v*P+m*B+b*z,r[4]=g*E+w*S+_*F,r[5]=g*C+w*k+_*V,r[6]=g*M+w*T+_*I,r[7]=g*P+w*B+_*z,r[8]=y*E+x*S+A*F,r[9]=y*C+x*k+A*V,r[10]=y*M+x*T+A*I,r[11]=y*P+x*B+A*z,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r},axisRotation:function(t,e,n){n=n||new f(16);let r=t[0],i=t[1],o=t[2];const s=Math.sqrt(r*r+i*i+o*o);r/=s,i/=s,o/=s;const a=r*r,l=i*i,u=o*o,c=Math.cos(e),d=Math.sin(e),h=1-c;return n[0]=a+(1-a)*c,n[1]=r*i*h+o*d,n[2]=r*o*h-i*d,n[3]=0,n[4]=r*i*h-o*d,n[5]=l+(1-l)*c,n[6]=i*o*h+r*d,n[7]=0,n[8]=r*o*h+i*d,n[9]=i*o*h-r*d,n[10]=u+(1-u)*c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},copy:v,create:function(){return new f(16).fill(0)},frustum:function(t,e,n,r,i,o,s){const a=e-t,l=r-n,u=i-o;return(s=s||new f(16))[0]=2*i/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*i/l,s[6]=0,s[7]=0,s[8]=(t+e)/a,s[9]=(r+n)/l,s[10]=o/u,s[11]=-1,s[12]=0,s[13]=0,s[14]=i*o/u,s[15]=0,s},getAxis:function(t,e,n){const r=4*e;return(n=n||i())[0]=t[r+0],n[1]=t[r+1],n[2]=t[r+2],n},getTranslation:function(t,e){return(e=e||i())[0]=t[12],e[1]=t[13],e[2]=t[14],e},identity:m,inverse:b,lookAt:function(t,e,n,r){return r=r||new f(16),d=d||i(),h=h||i(),p=p||i(),l(s(t,e,p),p),l(a(n,p,d),d),l(a(p,d,h),h),r[0]=d[0],r[1]=d[1],r[2]=d[2],r[3]=0,r[4]=h[0],r[5]=h[1],r[6]=h[2],r[7]=0,r[8]=p[0],r[9]=p[1],r[10]=p[2],r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r},multiply:function(t,e,n){n=n||new f(16);const r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],p=t[10],v=t[11],m=t[12],b=t[13],g=t[14],w=t[15],_=e[0],y=e[1],x=e[2],A=e[3],E=e[4],C=e[5],M=e[6],P=e[7],S=e[8],k=e[9],T=e[10],B=e[11],F=e[12],V=e[13],I=e[14],z=e[15];return n[0]=r*_+a*y+d*x+m*A,n[1]=i*_+l*y+h*x+b*A,n[2]=o*_+u*y+p*x+g*A,n[3]=s*_+c*y+v*x+w*A,n[4]=r*E+a*C+d*M+m*P,n[5]=i*E+l*C+h*M+b*P,n[6]=o*E+u*C+p*M+g*P,n[7]=s*E+c*C+v*M+w*P,n[8]=r*S+a*k+d*T+m*B,n[9]=i*S+l*k+h*T+b*B,n[10]=o*S+u*k+p*T+g*B,n[11]=s*S+c*k+v*T+w*B,n[12]=r*F+a*V+d*I+m*z,n[13]=i*F+l*V+h*I+b*z,n[14]=o*F+u*V+p*I+g*z,n[15]=s*F+c*V+v*I+w*z,n},negate:function(t,e){return(e=e||new f(16))[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e[11]=-t[11],e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=-t[15],e},ortho:function(t,e,n,r,i,o,s){return(s=s||new f(16))[0]=2/(e-t),s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/(r-n),s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2/(i-o),s[11]=0,s[12]=(e+t)/(t-e),s[13]=(r+n)/(n-r),s[14]=(o+i)/(i-o),s[15]=1,s},perspective:function(t,e,n,r,i){i=i||new f(16);const o=Math.tan(.5*Math.PI-.5*t),s=1/(n-r);return i[0]=o/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(n+r)*s,i[11]=-1,i[12]=0,i[13]=0,i[14]=n*r*s*2,i[15]=0,i},rotateX:function(t,e,n){n=n||new f(16);const r=t[4],i=t[5],o=t[6],s=t[7],a=t[8],l=t[9],u=t[10],c=t[11],d=Math.cos(e),h=Math.sin(e);return n[4]=d*r+h*a,n[5]=d*i+h*l,n[6]=d*o+h*u,n[7]=d*s+h*c,n[8]=d*a-h*r,n[9]=d*l-h*i,n[10]=d*u-h*o,n[11]=d*c-h*s,t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},rotateY:function(t,e,n){n=n||new f(16);const r=t[0],i=t[1],o=t[2],s=t[3],a=t[8],l=t[9],u=t[10],c=t[11],d=Math.cos(e),h=Math.sin(e);return n[0]=d*r-h*a,n[1]=d*i-h*l,n[2]=d*o-h*u,n[3]=d*s-h*c,n[8]=d*a+h*r,n[9]=d*l+h*i,n[10]=d*u+h*o,n[11]=d*c+h*s,t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},rotateZ:function(t,e,n){n=n||new f(16);const r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],d=Math.cos(e),h=Math.sin(e);return n[0]=d*r+h*a,n[1]=d*i+h*l,n[2]=d*o+h*u,n[3]=d*s+h*c,n[4]=d*a-h*r,n[5]=d*l-h*i,n[6]=d*u-h*o,n[7]=d*c-h*s,t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},rotationX:function(t,e){e=e||new f(16);const n=Math.cos(t),r=Math.sin(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotationY:function(t,e){e=e||new f(16);const n=Math.cos(t),r=Math.sin(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotationZ:function(t,e){e=e||new f(16);const n=Math.cos(t),r=Math.sin(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},scale:function(t,e,n){n=n||new f(16);const r=e[0],i=e[1],o=e[2];return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=r*t[3],n[4]=i*t[4],n[5]=i*t[5],n[6]=i*t[6],n[7]=i*t[7],n[8]=o*t[8],n[9]=o*t[9],n[10]=o*t[10],n[11]=o*t[11],t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},scaling:function(t,e){return(e=e||new f(16))[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},setAxis:function(t,e,n,r){r!==t&&(r=v(t,r));const i=4*n;return r[i+0]=e[0],r[i+1]=e[1],r[i+2]=e[2],r},setDefaultType:function(t){const e=f;return f=t,e},setTranslation:function(t,e,n){return t!==(n=n||m())&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11]),n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n},transformDirection:w,transformNormal:function(t,e,n){n=n||i();const r=b(t),o=e[0],s=e[1],a=e[2];return n[0]=o*r[0]+s*r[1]+a*r[2],n[1]=o*r[4]+s*r[5]+a*r[6],n[2]=o*r[8]+s*r[9]+a*r[10],n},transformPoint:g,translate:function(t,e,n){n=n||new f(16);const r=e[0],i=e[1],o=e[2],s=t[0],a=t[1],l=t[2],u=t[3],c=t[4],d=t[5],h=t[6],p=t[7],v=t[8],m=t[9],b=t[10],g=t[11],w=t[12],_=t[13],y=t[14],x=t[15];return t!==n&&(n[0]=s,n[1]=a,n[2]=l,n[3]=u,n[4]=c,n[5]=d,n[6]=h,n[7]=p,n[8]=v,n[9]=m,n[10]=b,n[11]=g),n[12]=s*r+c*i+v*o+w,n[13]=a*r+d*i+m*o+_,n[14]=l*r+h*i+b*o+y,n[15]=u*r+p*i+g*o+x,n},translation:function(t,e){return(e=e||new f(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},transpose:function(t,e){if((e=e||new f(16))===t){let n;return n=t[1],t[1]=t[4],t[4]=n,n=t[2],t[2]=t[8],t[8]=n,n=t[3],t[3]=t[12],t[12]=n,n=t[6],t[6]=t[9],t[9]=n,n=t[7],t[7]=t[13],t[13]=n,n=t[11],t[11]=t[14],t[14]=n,e}const n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],p=t[11],v=t[12],m=t[13],b=t[14],g=t[15];return e[0]=n,e[1]=s,e[2]=c,e[3]=v,e[4]=r,e[5]=a,e[6]=d,e[7]=m,e[8]=i,e[9]=l,e[10]=h,e[11]=b,e[12]=o,e[13]=u,e[14]=p,e[15]=g,e}});const y={};{const t=y;t[5120]=Int8Array,t[5121]=Uint8Array,t[5122]=Int16Array,t[5123]=Uint16Array,t[5124]=Int32Array,t[5125]=Uint32Array,t[5126]=Float32Array,t[32819]=Uint16Array,t[32820]=Uint16Array,t[33635]=Uint16Array,t[5131]=Uint16Array,t[33640]=Uint32Array,t[35899]=Uint32Array,t[35902]=Uint32Array,t[36269]=Uint32Array,t[34042]=Uint32Array}function x(t){if(t instanceof Int8Array)return 5120;if(t instanceof Uint8Array)return 5121;if(t instanceof Uint8ClampedArray)return 5121;if(t instanceof Int16Array)return 5122;if(t instanceof Uint16Array)return 5123;if(t instanceof Int32Array)return 5124;if(t instanceof Uint32Array)return 5125;if(t instanceof Float32Array)return 5126;throw new Error("unsupported typed array type")}function A(t){if(t===Int8Array)return 5120;if(t===Uint8Array)return 5121;if(t===Uint8ClampedArray)return 5121;if(t===Int16Array)return 5122;if(t===Uint16Array)return 5123;if(t===Int32Array)return 5124;if(t===Uint32Array)return 5125;if(t===Float32Array)return 5126;throw new Error("unsupported typed array type")}function E(t){const e=y[t];if(!e)throw new Error("unknown gl type");return e}const C="undefined"!=typeof SharedArrayBuffer?function(t){return t&&t.buffer&&(t.buffer instanceof ArrayBuffer||t.buffer instanceof SharedArrayBuffer)}:function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer};var M=Object.freeze({__proto__:null,getGLTypeForTypedArray:x,getGLTypeForTypedArrayType:A,getTypedArrayTypeForGLType:E,isArrayBuffer:C});function P(t,e){Object.keys(e).forEach((function(n){e.hasOwnProperty(n)&&t.hasOwnProperty(n)&&(e[n]=t[n])}))}function S(...t){console.error(...t)}function k(...t){console.warn(...t)}const T=new Map;function B(t,e){if(!t||"object"!=typeof t)return!1;let n=T.get(e);n||(n=new WeakMap,T.set(e,n));let r=n.get(t);if(void 0===r){const i=Object.prototype.toString.call(t);r=i.substring(8,i.length-1)===e,n.set(t,r)}return r}function F(t,e){return"undefined"!=typeof WebGLRenderbuffer&&B(e,"WebGLRenderbuffer")}function V(t,e){return"undefined"!=typeof WebGLTexture&&B(e,"WebGLTexture")}const I={attribPrefix:""};function z(t){I.attribPrefix=t}function L(t){P(t,I)}function R(t,e,n,r,i){t.bindBuffer(e,n),t.bufferData(e,r,i||35044)}function O(t,e,n,r){if(i=e,"undefined"!=typeof WebGLBuffer&&B(i,"WebGLBuffer"))return e;var i;n=n||34962;const o=t.createBuffer();return R(t,n,o,e,r),o}function q(t){return"indices"===t}function j(t){return t.length?t:t.data}const N=/coord|texture/i,D=/color|colour/i;function W(t,e,n){return t.numComponents||t.size||function(t,e){let n;if(n=N.test(t)?2:D.test(t)?4:3,e%n>0)throw new Error(`Can not guess numComponents for attribute '${t}'. Tried ${n} but ${e} values is not evenly divisible by ${n}. You should specify it.`);return n}(e,n||j(t).length)}function U(t,e){if(C(t))return t;if(C(t.data))return t.data;Array.isArray(t)&&(t={data:t});let n=t.type?H(t.type):void 0;return n||(n=q(e)?Uint16Array:Float32Array),new n(t.data)}function H(t){return"number"==typeof t?E(t):t||Float32Array}function G(t,e){return{buffer:e.buffer,numValues:24,type:(n=e.type,"number"==typeof n?n:n?A(n):5126),arrayType:H(e.type)};var n}function K(t,e){const n=e.data||e,r=H(e.type),i=n*r.BYTES_PER_ELEMENT,o=t.createBuffer();return t.bindBuffer(34962,o),t.bufferData(34962,i,e.drawType||35044),{buffer:o,numValues:n,type:A(r),arrayType:r}}function $(t,e,n){const r=U(e,n);return{arrayType:r.constructor,buffer:O(t,r,void 0,e.drawType),type:x(r),numValues:0}}function Y(t,e){const n={};return Object.keys(e).forEach((function(r){if(!q(r)){const o=e[r],s=o.attrib||o.name||o.attribName||I.attribPrefix+r;if(o.value){if(!Array.isArray(o.value)&&!C(o.value))throw new Error("array.value is not array or typedarray");n[s]={value:o.value}}else{let e;e=o.buffer&&o.buffer instanceof WebGLBuffer?G:"number"==typeof o||"number"==typeof o.data?K:$;const{buffer:a,type:l,numValues:u,arrayType:c}=e(t,o,r),d=void 0!==o.normalize?o.normalize:(i=c)===Int8Array||i===Uint8Array,h=W(o,r,u);n[s]={buffer:a,numComponents:h,type:l,normalize:d,stride:o.stride||0,offset:o.offset||0,divisor:void 0===o.divisor?void 0:o.divisor,drawType:o.drawType}}}var i})),t.bindBuffer(34962,null),n}function X(t,e,n,r){n=U(n),void 0!==r?(t.bindBuffer(34962,e.buffer),t.bufferSubData(34962,r,n)):R(t,34962,e.buffer,n,e.drawType)}const Z=["position","positions","a_position"];function Q(t,e,n){const r=Y(t,e),i=Object.assign({},n||{});i.attribs=Object.assign({},n?n.attribs:{},r);const o=e.indices;if(o){const e=U(o,"indices");i.indices=O(t,e,34963),i.numElements=e.length,i.elementType=x(e)}else i.numElements||(i.numElements=function(t,e){let n,r;for(r=0;r<Z.length&&(n=Z[r],!(n in e))&&(n=I.attribPrefix+n,!(n in e));++r);r===Z.length&&(n=Object.keys(e)[0]);const i=e[n];if(!i.buffer)return 1;t.bindBuffer(34962,i.buffer);const o=t.getBufferParameter(34962,34660);var s;t.bindBuffer(34962,null);const a=o/(5120===(s=i.type)||5121===s?1:5122===s||5123===s?2:5124===s||5125===s||5126===s?4:0),l=i.numComponents||i.size,u=a/l;if(u%1!=0)throw new Error(`numComponents ${l} not correct for length ${length}`);return u}(t,i.attribs));return i}function J(t,e,n){const r="indices"===n?34963:34962;return O(t,U(e,n),r)}function tt(t,e){const n={};return Object.keys(e).forEach((function(r){n[r]=J(t,e[r],r)})),e.indices?(n.numElements=e.indices.length,n.elementType=x(U(e.indices))):n.numElements=function(t){let e,n;for(n=0;n<Z.length&&(e=Z[n],!(e in t));++n);n===Z.length&&(e=Object.keys(t)[0]);const r=t[e],i=j(r).length;if(void 0===i)return 1;const o=W(r,e),s=i/o;if(i%o>0)throw new Error(`numComponents ${o} not correct for length ${i}`);return s}(e),n}var et=Object.freeze({__proto__:null,createAttribsFromArrays:Y,createBuffersFromArrays:tt,createBufferFromArray:J,createBufferFromTypedArray:O,createBufferInfoFromArrays:Q,setAttribInfoBufferFromArray:X,setAttributePrefix:z,setAttributeDefaults_:L,getNumComponents_:W,getArray_:j});const nt=j,rt=W;function it(t,e){let n=0;return t.push=function(){for(let e=0;e<arguments.length;++e){const r=arguments[e];if(r instanceof Array||C(r))for(let e=0;e<r.length;++e)t[n++]=r[e];else t[n++]=r}},t.reset=function(t){n=t||0},t.numComponents=e,Object.defineProperty(t,"numElements",{get:function(){return this.length/this.numComponents|0}}),t}function ot(t,e,n){return it(new(n||Float32Array)(t*e),t)}function st(t){return"indices"!==t}function at(t,e,n){const r=t.length,i=new Float32Array(3);for(let o=0;o<r;o+=3)n(e,[t[o],t[o+1],t[o+2]],i),t[o]=i[0],t[o+1]=i[1],t[o+2]=i[2]}function lt(t,e,n){n=n||i();const r=e[0],o=e[1],s=e[2];return n[0]=r*t[0]+o*t[1]+s*t[2],n[1]=r*t[4]+o*t[5]+s*t[6],n[2]=r*t[8]+o*t[9]+s*t[10],n}function ut(t,e){return at(t,e,w),t}function ct(t,e){return at(t,b(e),lt),t}function dt(t,e){return at(t,e,g),t}function ht(t,e){return Object.keys(t).forEach((function(n){const r=t[n];n.indexOf("pos")>=0?dt(r,e):n.indexOf("tan")>=0||n.indexOf("binorm")>=0?ut(r,e):n.indexOf("norm")>=0&&ct(r,e)})),t}function pt(t,e,n){return t=t||2,{position:{numComponents:2,data:[(e=e||0)+-1*(t*=.5),(n=n||0)+-1*t,e+1*t,n+-1*t,e+-1*t,n+1*t,e+1*t,n+1*t]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function ft(t,e,n,r,i){t=t||1,e=e||1,n=n||1,r=r||1,i=i||m();const o=(n+1)*(r+1),s=ot(3,o),a=ot(3,o),l=ot(2,o);for(let i=0;i<=r;i++)for(let o=0;o<=n;o++){const u=o/n,c=i/r;s.push(t*u-.5*t,0,e*c-.5*e),a.push(0,1,0),l.push(u,c)}const u=n+1,c=ot(3,n*r*2,Uint16Array);for(let t=0;t<r;t++)for(let e=0;e<n;e++)c.push((t+0)*u+e,(t+1)*u+e,(t+0)*u+e+1),c.push((t+1)*u+e,(t+1)*u+e+1,(t+0)*u+e+1);return ht({position:s,normal:a,texcoord:l,indices:c},i)}function vt(t,e,n,r,i,o,s){if(e<=0||n<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");r=r||0,o=o||0;const a=(i=i||Math.PI)-r,l=(s=s||2*Math.PI)-o,u=(e+1)*(n+1),c=ot(3,u),d=ot(3,u),h=ot(2,u);for(let i=0;i<=n;i++)for(let s=0;s<=e;s++){const u=s/e,p=i/n,f=l*u+o,v=a*p+r,m=Math.sin(f),b=Math.cos(f),g=Math.sin(v),w=b*g,_=Math.cos(v),y=m*g;c.push(t*w,t*_,t*y),d.push(w,_,y),h.push(1-u,p)}const p=e+1,f=ot(3,e*n*2,Uint16Array);for(let t=0;t<e;t++)for(let e=0;e<n;e++)f.push((e+0)*p+t,(e+0)*p+t+1,(e+1)*p+t),f.push((e+1)*p+t,(e+0)*p+t+1,(e+1)*p+t+1);return{position:c,normal:d,texcoord:h,indices:f}}const mt=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function bt(t){const e=(t=t||1)/2,n=[[-e,-e,-e],[+e,-e,-e],[-e,+e,-e],[+e,+e,-e],[-e,-e,+e],[+e,-e,+e],[-e,+e,+e],[+e,+e,+e]],r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=[[1,0],[0,0],[0,1],[1,1]],o=ot(3,24),s=ot(3,24),a=ot(2,24),l=ot(3,12,Uint16Array);for(let t=0;t<6;++t){const e=mt[t];for(let l=0;l<4;++l){const u=n[e[l]],c=r[t],d=i[l];o.push(u),s.push(c),a.push(d)}const u=4*t;l.push(u+0,u+1,u+2),l.push(u+0,u+2,u+3)}return{position:o,normal:s,texcoord:a,indices:l}}function gt(t,e,n,r,i,o,s){if(r<3)throw new Error("radialSubdivisions must be 3 or greater");if(i<1)throw new Error("verticalSubdivisions must be 1 or greater");const a=void 0===o||o,l=void 0===s||s,u=(a?2:0)+(l?2:0),c=(r+1)*(i+1+u),d=ot(3,c),h=ot(3,c),p=ot(2,c),f=ot(3,r*(i+u/2)*2,Uint16Array),v=r+1,m=Math.atan2(t-e,n),b=Math.cos(m),g=Math.sin(m),w=i+(l?2:0);for(let o=a?-2:0;o<=w;++o){let s,a=o/i,l=n*a;o<0?(l=0,a=1,s=t):o>i?(l=n,a=1,s=e):s=t+o/i*(e-t),-2!==o&&o!==i+2||(s=0,a=0),l-=n/2;for(let t=0;t<v;++t){const e=Math.sin(t*Math.PI*2/r),n=Math.cos(t*Math.PI*2/r);d.push(e*s,l,n*s),o<0?h.push(0,-1,0):o>i?h.push(0,1,0):0===s?h.push(0,0,0):h.push(e*b,g,n*b),p.push(t/r,1-a)}}for(let t=0;t<i+u;++t)if(!(1===t&&a||t===i+u-2&&l))for(let e=0;e<r;++e)f.push(v*(t+0)+0+e,v*(t+0)+1+e,v*(t+1)+1+e),f.push(v*(t+0)+0+e,v*(t+1)+1+e,v*(t+1)+0+e);return{position:d,normal:h,texcoord:p,indices:f}}function wt(t,e){e=e||[];const n=[];for(let r=0;r<t.length;r+=4){const i=t[r],o=t.slice(r+1,r+4);o.push.apply(o,e);for(let t=0;t<i;++t)n.push.apply(n,o)}return n}function _t(){const t=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],e=wt([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),n=wt([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),r=t.length/3,i={position:ot(3,r),texcoord:ot(2,r),normal:ot(3,r),color:ot(4,r,Uint8Array),indices:ot(3,r/3,Uint16Array)};i.position.push(t),i.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),i.normal.push(e),i.color.push(n);for(let t=0;t<r;++t)i.indices.push(t);return i}function yt(t,e,n,r,i,s,a){if(i<=0)throw new Error("subdivisionDown must be > 0");const l=(a=a||1)-(s=s||0),c=2*(i+1)*4,d=ot(3,c),h=ot(3,c),p=ot(2,c);function f(t,e,n){return t+(e-t)*n}function v(e,n,a,c,v,m){for(let b=0;b<=i;b++){const g=n/1,w=b/i,_=2*(g-.5),y=(s+w*l)*Math.PI,x=Math.sin(y),A=Math.cos(y),E=f(t,e,x),C=_*r,M=A*t,P=x*E;d.push(C,M,P);const S=o(u([0,x,A],a),c);h.push(S),p.push(g*v+m,w)}}for(let t=0;t<2;t++){const r=2*(t/1-.5);v(e,t,[1,1,1],[0,0,0],1,0),v(e,t,[0,0,0],[r,0,0],0,0),v(n,t,[1,1,1],[0,0,0],1,0),v(n,t,[0,0,0],[r,0,0],0,1)}const m=ot(3,2*i*4,Uint16Array);function b(t,e){for(let n=0;n<i;++n)m.push(t+n+0,t+n+1,e+n+0),m.push(t+n+1,e+n+1,e+n+0)}const g=i+1;return b(0*g,4*g),b(5*g,7*g),b(6*g,2*g),b(3*g,1*g),{position:d,normal:h,texcoord:p,indices:m}}function xt(t,e,n,r,i,o){return gt(t,t,e,n,r,i,o)}function At(t,e,n,r,i,o){if(n<3)throw new Error("radialSubdivisions must be 3 or greater");if(r<3)throw new Error("verticalSubdivisions must be 3 or greater");i=i||0;const s=(o=o||2*Math.PI)-i,a=n+1,l=r+1,u=a*l,c=ot(3,u),d=ot(3,u),h=ot(2,u),p=ot(3,n*r*2,Uint16Array);for(let o=0;o<l;++o){const l=o/r,u=l*Math.PI*2,p=Math.sin(u),f=t+p*e,v=Math.cos(u),m=v*e;for(let t=0;t<a;++t){const e=t/n,r=i+e*s,o=Math.sin(r),a=Math.cos(r),u=o*f,b=a*f,g=o*p,w=a*p;c.push(u,m,b),d.push(g,v,w),h.push(e,1-l)}}for(let t=0;t<r;++t)for(let e=0;e<n;++e){const n=1+e,r=1+t;p.push(a*t+e,a*r+e,a*t+n),p.push(a*r+e,a*r+n,a*t+n)}return{position:c,normal:d,texcoord:h,indices:p}}function Et(t,e,n,r,i){if(e<3)throw new Error("divisions must be at least 3");i=i||1,r=r||0;const o=(e+1)*((n=n||1)+1),s=ot(3,o),a=ot(3,o),l=ot(2,o),u=ot(3,n*e*2,Uint16Array);let c=0;const d=t-r,h=e+1;for(let t=0;t<=n;++t){const o=r+d*Math.pow(t/n,i);for(let r=0;r<=e;++r){const i=2*Math.PI*r/e,d=o*Math.cos(i),p=o*Math.sin(i);if(s.push(d,0,p),a.push(0,1,0),l.push(1-r/e,t/n),t>0&&r!==e){const t=c+(r+1),e=c+r,n=c+r-h,i=c+(r+1)-h;u.push(t,e,n),u.push(t,n,i)}}c+=e+1}return{position:s,normal:a,texcoord:l,indices:u}}function Ct(t){return function(e){const n=t.apply(this,Array.prototype.slice.call(arguments,1));return tt(e,n)}}function Mt(t){return function(e){const n=t.apply(null,Array.prototype.slice.call(arguments,1));return Q(e,n)}}const Pt=["numComponents","size","type","normalize","stride","offset","attrib","name","attribName"];function St(t,e,n,r){r=r||0;const i=t.length;for(let o=0;o<i;++o)e[n+o]=t[o]+r}function kt(t,e){const n=nt(t),r=new n.constructor(e);let i=r;var o,s;return n.numComponents&&n.numElements&&it(r,n.numComponents),t.data&&(i={data:r},o=t,s=i,Pt.forEach((function(t){const e=o[t];void 0!==e&&(s[t]=e)}))),i}const Tt=Mt(_t),Bt=Ct(_t),Ft=Mt(bt),Vt=Ct(bt),It=Mt(ft),zt=Ct(ft),Lt=Mt(vt),Rt=Ct(vt),Ot=Mt(gt),qt=Ct(gt),jt=Mt(pt),Nt=Ct(pt),Dt=Mt(yt),Wt=Ct(yt),Ut=Mt(xt),Ht=Ct(xt),Gt=Mt(At),Kt=Ct(At),$t=Mt(Et),Yt=Ct(Et),Xt=Dt,Zt=Wt,Qt=yt;var Jt=Object.freeze({__proto__:null,create3DFBufferInfo:Tt,create3DFBuffers:Bt,create3DFVertices:_t,createAugmentedTypedArray:ot,createCubeBufferInfo:Ft,createCubeBuffers:Vt,createCubeVertices:bt,createPlaneBufferInfo:It,createPlaneBuffers:zt,createPlaneVertices:ft,createSphereBufferInfo:Lt,createSphereBuffers:Rt,createSphereVertices:vt,createTruncatedConeBufferInfo:Ot,createTruncatedConeBuffers:qt,createTruncatedConeVertices:gt,createXYQuadBufferInfo:jt,createXYQuadBuffers:Nt,createXYQuadVertices:pt,createCresentBufferInfo:Xt,createCresentBuffers:Zt,createCresentVertices:Qt,createCrescentBufferInfo:Dt,createCrescentBuffers:Wt,createCrescentVertices:yt,createCylinderBufferInfo:Ut,createCylinderBuffers:Ht,createCylinderVertices:xt,createTorusBufferInfo:Gt,createTorusBuffers:Kt,createTorusVertices:At,createDiscBufferInfo:$t,createDiscBuffers:Yt,createDiscVertices:Et,deindexVertices:function(t){const e=t.indices,n={},r=e.length;return Object.keys(t).filter(st).forEach((function(i){const o=t[i],s=o.numComponents,a=ot(s,r,o.constructor);for(let t=0;t<r;++t){const n=e[t]*s;for(let t=0;t<s;++t)a.push(o[n+t])}n[i]=a})),n},flattenNormals:function(t){if(t.indices)throw new Error("can not flatten normals of indexed vertices. deindex them first");const e=t.normal,n=e.length;for(let t=0;t<n;t+=9){const n=e[t+0],r=e[t+1],i=e[t+2],o=e[t+3],s=e[t+4],a=e[t+5];let l=n+o+e[t+6],u=r+s+e[t+7],c=i+a+e[t+8];const d=Math.sqrt(l*l+u*u+c*c);l/=d,u/=d,c/=d,e[t+0]=l,e[t+1]=u,e[t+2]=c,e[t+3]=l,e[t+4]=u,e[t+5]=c,e[t+6]=l,e[t+7]=u,e[t+8]=c}return t},makeRandomVertexColors:function(t,e){e=e||{};const n=t.position.numElements,r=ot(4,n,Uint8Array),i=e.rand||function(t,e){return e<3?(n=256,Math.random()*n|0):255;var n};if(t.color=r,t.indices)for(let t=0;t<n;++t)r.push(i(t,0),i(t,1),i(t,2),i(t,3));else{const t=e.vertsPerColor||3,o=n/t;for(let e=0;e<o;++e){const n=[i(e,0),i(e,1),i(e,2),i(e,3)];for(let e=0;e<t;++e)r.push(n)}}return t},reorientDirections:ut,reorientNormals:ct,reorientPositions:dt,reorientVertices:ht,concatVertices:function(t){const e={};let n;for(let r=0;r<t.length;++r){const i=t[r];Object.keys(i).forEach((function(t){e[t]||(e[t]=[]),n||"indices"===t||(n=t);const r=i[t],o=rt(r,t),s=nt(r).length/o;e[t].push(s)}))}const r=e[n],i={};return Object.keys(e).forEach((function(e){const n=function(e){let n,r=0;for(let i=0;i<t.length;++i){const o=t[i][e];r+=nt(o).length,n&&!o.data||(n=o)}return{length:r,spec:n}}(e),o=kt(n.spec,n.length);!function(e,n,r){let i=0,o=0;for(let s=0;s<t.length;++s){const a=t[s][e],l=nt(a);"indices"===e?(St(l,r,o,i),i+=n[s]):St(l,r,o),o+=l.length}}(e,r,nt(o)),i[e]=o})),i},duplicateVertices:function(t){const e={};return Object.keys(t).forEach((function(n){const r=t[n],i=nt(r),o=kt(r,i.length);St(i,nt(o),0),e[n]=o})),e}});function te(t){return!!t.texStorage2D}function ee(t){return!t.texStorage2D}const ne=function(){const t={},e={};return function(n,r){return function(n){const r=n.constructor.name;if(!t[r]){for(const t in n)if("number"==typeof n[t]){const r=e[n[t]];e[n[t]]=r?`${r} | ${t}`:t}t[r]=!0}}(n),e[r]||("number"==typeof r?"0x"+r.toString(16):r)}}();var re=Object.freeze({__proto__:null,glEnumToString:ne,isWebGL1:ee,isWebGL2:te});const ie={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},oe=C,se=function(){let t;return function(){return t=t||("undefined"!=typeof document&&document.createElement?document.createElement("canvas").getContext("2d"):null),t}}(),ae=6407,le=33319,ue={};{const t=ue;t[6406]={numColorComponents:1},t[6409]={numColorComponents:1},t[6410]={numColorComponents:2},t[ae]={numColorComponents:3},t[6408]={numColorComponents:4},t[6403]={numColorComponents:1},t[36244]={numColorComponents:1},t[le]={numColorComponents:2},t[33320]={numColorComponents:2},t[ae]={numColorComponents:3},t[36248]={numColorComponents:3},t[6408]={numColorComponents:4},t[36249]={numColorComponents:4},t[6402]={numColorComponents:1},t[34041]={numColorComponents:2}}let ce;function de(t){if(!ce){const t={6406:{textureFormat:6406,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},6409:{textureFormat:6409,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},6410:{textureFormat:6410,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[5121,5131,36193,5126]}};t[ae]={textureFormat:ae,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[5121,5131,36193,5126,33635]},t[6408]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[5121,5131,36193,5126,32819,32820]},t[6402]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[5125,5123]},t[33321]={textureFormat:6403,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[5121]},t[36756]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[5120]},t[33325]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[5126,5131]},t[33326]={textureFormat:6403,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[5126]},t[33330]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[5121]},t[33329]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[5120]},t[33332]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5123]},t[33331]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5122]},t[33334]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5125]},t[33333]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5124]},t[33323]={textureFormat:le,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[5121]},t[36757]={textureFormat:le,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[5120]},t[33327]={textureFormat:le,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[5126,5131]},t[33328]={textureFormat:le,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[5126]},t[33336]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5121]},t[33335]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5120]},t[33338]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5123]},t[33337]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5122]},t[33340]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5125]},t[33339]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5124]},t[32849]={textureFormat:ae,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[5121]},t[35905]={textureFormat:ae,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[5121]},t[36194]={textureFormat:ae,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[5121,33635]},t[36758]={textureFormat:ae,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[5120]},t[35898]={textureFormat:ae,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35899]},t[35901]={textureFormat:ae,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35902]},t[34843]={textureFormat:ae,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[5126,5131]},t[34837]={textureFormat:ae,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5126]},t[36221]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[5121]},t[36239]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[5120]},t[36215]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[5123]},t[36233]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[5122]},t[36209]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5125]},t[36227]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5124]},t[32856]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[5121]},t[35907]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[5121]},t[36759]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[5120]},t[32855]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[5121,32820,33640]},t[32854]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[5121,32819]},t[32857]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[33640]},t[34842]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[5126,5131]},t[34836]={textureFormat:6408,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[5126]},t[36220]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5121]},t[36238]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5120]},t[36975]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[33640]},t[36214]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5123]},t[36232]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5122]},t[36226]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[5124]},t[36208]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[5125]},t[33189]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[5123,5125]},t[33190]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5125]},t[36012]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5126]},t[35056]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[34042]},t[36013]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[36269]},Object.keys(t).forEach((function(e){const n=t[e];n.bytesPerElementMap={},n.bytesPerElement.forEach((function(t,e){const r=n.type[e];n.bytesPerElementMap[r]=t}))})),ce=t}return ce[t]}function he(t,e){const n=de(t);if(!n)throw"unknown internal format";const r=n.bytesPerElementMap[e];if(void 0===r)throw"unknown internal format";return r}function pe(t){const e=de(t);if(!e)throw"unknown internal format";return{format:e.textureFormat,type:e.type[0]}}function fe(t){return 0==(t&t-1)}function ve(t,e,n,r){if(!te(t))return fe(e)&&fe(n);const i=de(r);if(!i)throw"unknown internal format";return i.colorRenderable&&i.textureFilterable}function me(t){const e=de(t);if(!e)throw"unknown internal format";return e.textureFilterable}function be(t){const e=ue[t];if(!e)throw"unknown format: "+t;return e.numColorComponents}function ge(t,e,n){return oe(e)?x(e):n||5121}function we(t,e,n,r,i){if(i%1!=0)throw"can't guess dimensions";if(n||r){if(r){if(!n&&(n=i/r)%1)throw"can't guess dimensions"}else if((r=i/n)%1)throw"can't guess dimensions"}else{const t=Math.sqrt(i/(34067===e?6:1));t%1==0?(n=t,r=t):(n=i,r=1)}return{width:n,height:r}}function _e(t){ie.textureColor=new Uint8Array([255*t[0],255*t[1],255*t[2],255*t[3]])}function ye(t){P(t,ie),t.textureColor&&_e(t.textureColor)}function xe(t,e){void 0!==e.colorspaceConversion&&t.pixelStorei(37443,e.colorspaceConversion),void 0!==e.premultiplyAlpha&&t.pixelStorei(37441,e.premultiplyAlpha),void 0!==e.flipY&&t.pixelStorei(37440,e.flipY)}function Ae(t){t.pixelStorei(3317,4),te(t)&&(t.pixelStorei(3314,0),t.pixelStorei(32878,0),t.pixelStorei(3316,0),t.pixelStorei(3315,0),t.pixelStorei(32877,0))}function Ee(t,e,n,r){var i;r.minMag&&(n.call(t,e,10241,r.minMag),n.call(t,e,10240,r.minMag)),r.min&&n.call(t,e,10241,r.min),r.mag&&n.call(t,e,10240,r.mag),r.wrap&&(n.call(t,e,10242,r.wrap),n.call(t,e,10243,r.wrap),(32879===e||(i=e,"undefined"!=typeof WebGLSampler&&B(i,"WebGLSampler")))&&n.call(t,e,32882,r.wrap)),r.wrapR&&n.call(t,e,32882,r.wrapR),r.wrapS&&n.call(t,e,10242,r.wrapS),r.wrapT&&n.call(t,e,10243,r.wrapT),void 0!==r.minLod&&n.call(t,e,33082,r.minLod),void 0!==r.maxLod&&n.call(t,e,33083,r.maxLod),void 0!==r.baseLevel&&n.call(t,e,33084,r.baseLevel),void 0!==r.maxLevel&&n.call(t,e,33085,r.maxLevel),void 0!==r.compareFunc&&n.call(t,e,34893,r.compareFunc),void 0!==r.compareMode&&n.call(t,e,34892,r.compareMode)}function Ce(t,e,n){const r=n.target||3553;t.bindTexture(r,e),Ee(t,r,t.texParameteri,n)}function Me(t,e,n){Ee(t,e,t.samplerParameteri,n)}function Pe(t,e){const n=t.createSampler();return Me(t,n,e),n}function Se(t,e){const n={};return Object.keys(e).forEach((function(r){n[r]=Pe(t,e[r])})),n}function ke(t,e,n,r,i,o){o=o||6408;const s=(n=n||ie.textureOptions).target||3553;if(r=r||n.width,i=i||n.height,t.bindTexture(s,e),ve(t,r,i,o))t.generateMipmap(s);else{const e=me(o)?9729:9728;t.texParameteri(s,10241,e),t.texParameteri(s,10240,e),t.texParameteri(s,10242,33071),t.texParameteri(s,10243,33071)}}function Te(t){return!0===t.auto||void 0===t.auto&&void 0===t.level}function Be(t,e){return(e=e||{}).cubeFaceOrder||[34069,34070,34071,34072,34073,34074]}function Fe(t,e){const n=Be(0,e).map((function(t,e){return{face:t,ndx:e}}));return n.sort((function(t,e){return t.face-e.face})),n}function Ve(t,e,n,r){const i=(r=r||ie.textureOptions).target||3553,o=r.level||0;let s=n.width,a=n.height;const l=r.internalFormat||r.format||6408,u=pe(l),c=r.format||u.format,d=r.type||u.type;if(xe(t,r),t.bindTexture(i,e),34067===i){const u=n.width,h=n.height;let p,f;if(u/6===h)p=h,f=[0,0,1,0,2,0,3,0,4,0,5,0];else if(h/6===u)p=u,f=[0,0,0,1,0,2,0,3,0,4,0,5];else if(u/3==h/2)p=u/3,f=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(u/2!=h/3)throw"can't figure out cube map from element: "+(n.src?n.src:n.nodeName);p=u/2,f=[0,0,1,0,0,1,1,1,0,2,1,2]}const v=se();v?(v.canvas.width=p,v.canvas.height=p,s=p,a=p,Fe(0,r).forEach((function(e){const r=f[2*e.ndx+0]*p,i=f[2*e.ndx+1]*p;v.drawImage(n,r,i,p,p,0,0,p,p),t.texImage2D(e.face,o,l,c,d,v.canvas)})),v.canvas.width=1,v.canvas.height=1):"undefined"!=typeof createImageBitmap&&(s=p,a=p,Fe(0,r).forEach((function(u){const h=f[2*u.ndx+0]*p,v=f[2*u.ndx+1]*p;t.texImage2D(u.face,o,l,p,p,0,c,d,null),createImageBitmap(n,h,v,p,p,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then((function(n){xe(t,r),t.bindTexture(i,e),t.texImage2D(u.face,o,l,c,d,n),Te(r)&&ke(t,e,r,s,a,l)}))})))}else if(32879===i||35866===i){const e=Math.min(n.width,n.height),r=Math.max(n.width,n.height),s=r/e;if(s%1!=0)throw"can not compute 3D dimensions of element";const a=n.width===r?1:0,u=n.height===r?1:0;t.pixelStorei(3317,1),t.pixelStorei(3314,n.width),t.pixelStorei(32878,0),t.pixelStorei(32877,0),t.texImage3D(i,o,l,e,e,e,0,c,d,null);for(let r=0;r<s;++r){const s=r*e*a,l=r*e*u;t.pixelStorei(3316,s),t.pixelStorei(3315,l),t.texSubImage3D(i,o,0,0,r,e,e,1,c,d,n)}Ae(t)}else t.texImage2D(i,o,l,c,d,n);Te(r)&&ke(t,e,r,s,a,l),Ce(t,e,r)}function Ie(){}function ze(t,e){return void 0!==e||function(t){if("undefined"!=typeof document){const e=document.createElement("a");return e.href=t,e.hostname===location.hostname&&e.port===location.port&&e.protocol===location.protocol}{const e=new URL(location.href).origin;return new URL(t,location.href).origin===e}}(t)?e:"anonymous"}function Le(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof ImageData&&t instanceof ImageData||"undefined"!=typeof HTMLElement&&t instanceof HTMLElement}function Re(t,e,n){return Le(t)?(setTimeout((function(){n(null,t)})),t):function(t,e,n){let r;if(n=n||Ie,e=void 0!==e?e:ie.crossOrigin,e=ze(t,e),"undefined"!=typeof Image){r=new Image,void 0!==e&&(r.crossOrigin=e);const i=function(){r.removeEventListener("error",o),r.removeEventListener("load",s),r=null},o=function(){const e="couldn't load image: "+t;S(e),n(e,r),i()},s=function(){n(null,r),i()};return r.addEventListener("error",o),r.addEventListener("load",s),r.src=t,r}if("undefined"!=typeof ImageBitmap){let i,o;const s=function(){n(i,o)},a={};e&&(a.mode="cors"),fetch(t,a).then((function(t){if(!t.ok)throw t;return t.blob()})).then((function(t){return createImageBitmap(t,{premultiplyAlpha:"none",colorSpaceConversion:"none"})})).then((function(t){o=t,setTimeout(s)})).catch((function(t){i=t,setTimeout(s)})),r=null}return r}(t,e,n)}function Oe(t,e,n){const r=(n=n||ie.textureOptions).target||3553;if(t.bindTexture(r,e),!1===n.color)return;const i=function(t){return t=t||ie.textureColor,oe(t)?t:new Uint8Array([255*t[0],255*t[1],255*t[2],255*t[3]])}(n.color);if(34067===r)for(let e=0;e<6;++e)t.texImage2D(34069+e,0,6408,1,1,0,6408,5121,i);else 32879===r||35866===r?t.texImage3D(r,0,6408,1,1,1,0,6408,5121,i):t.texImage2D(r,0,6408,1,1,0,6408,5121,i)}function qe(t,e,n,r){r=r||Ie,n=n||ie.textureOptions,Oe(t,e,n);return Re((n=Object.assign({},n)).src,n.crossOrigin,(function(i,o){i?r(i,e,o):(Ve(t,e,o,n),r(null,e,o))}))}function je(t,e,n,r){r=r||Ie;const i=n.src;if(6!==i.length)throw"there must be 6 urls for a cubemap";const o=n.level||0,s=n.internalFormat||n.format||6408,a=pe(s),l=n.format||a.format,u=n.type||5121,c=n.target||3553;if(34067!==c)throw"target must be TEXTURE_CUBE_MAP";Oe(t,e,n),n=Object.assign({},n);let d=6;const h=[],p=Be(0,n);let f;f=i.map((function(i,a){return Re(i,n.crossOrigin,(v=p[a],function(i,a){--d,i?h.push(i):a.width!==a.height?h.push("cubemap face img is not a square: "+a.src):(xe(t,n),t.bindTexture(c,e),5===d?Be().forEach((function(e){t.texImage2D(e,o,s,l,u,a)})):t.texImage2D(v,o,s,l,u,a),Te(n)&&t.generateMipmap(c)),0===d&&r(h.length?h:void 0,e,f)}));var v}))}function Ne(t,e,n,r){r=r||Ie;const i=n.src,o=n.internalFormat||n.format||6408,s=pe(o),a=n.format||s.format,l=n.type||5121,u=n.target||35866;if(32879!==u&&35866!==u)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";Oe(t,e,n),n=Object.assign({},n);let c=i.length;const d=[];let h;const p=n.level||0;let f=n.width,v=n.height;const m=i.length;let b=!0;h=i.map((function(i,s){return Re(i,n.crossOrigin,(g=s,function(i,s){if(--c,i)d.push(i);else{if(xe(t,n),t.bindTexture(u,e),b){b=!1,f=n.width||s.width,v=n.height||s.height,t.texImage3D(u,p,o,f,v,m,0,a,l,null);for(let e=0;e<m;++e)t.texSubImage3D(u,p,0,0,e,f,v,1,a,l,s)}else{let e,n=s;s.width===f&&s.height===v||(e=se(),n=e.canvas,e.canvas.width=f,e.canvas.height=v,e.drawImage(s,0,0,f,v)),t.texSubImage3D(u,p,0,0,g,f,v,1,a,l,n),e&&n===e.canvas&&(e.canvas.width=0,e.canvas.height=0)}Te(n)&&t.generateMipmap(u)}0===c&&r(d.length?d:void 0,e,h)}));var g}))}function De(t,e,n,r){const i=(r=r||ie.textureOptions).target||3553;t.bindTexture(i,e);let o=r.width,s=r.height,a=r.depth;const l=r.level||0,u=r.internalFormat||r.format||6408,c=pe(u),d=r.format||c.format,h=r.type||ge(0,n,c.type);if(oe(n))n instanceof Uint8ClampedArray&&(n=new Uint8Array(n.buffer));else{const t=E(h);n=new t(n)}const p=he(u,h),f=n.byteLength/p;if(f%1)throw"length wrong size for format: "+ne(t,d);let v;if(32879===i||35866===i)if(o||s||a)!o||s&&a?!s||o&&a?(v=we(0,i,o,s,f/a),o=v.width,s=v.height):(v=we(0,i,o,a,f/s),o=v.width,a=v.height):(v=we(0,i,s,a,f/o),s=v.width,a=v.height);else{const t=Math.cbrt(f);if(t%1!=0)throw"can't guess cube size of array of numElements: "+f;o=t,s=t,a=t}else v=we(0,i,o,s,f),o=v.width,s=v.height;if(Ae(t),t.pixelStorei(3317,r.unpackAlignment||1),xe(t,r),34067===i){const e=f/6*(p/n.BYTES_PER_ELEMENT);Fe(0,r).forEach(r=>{const i=e*r.ndx,a=n.subarray(i,i+e);t.texImage2D(r.face,l,u,o,s,0,d,h,a)})}else 32879===i||35866===i?t.texImage3D(i,l,u,o,s,a,0,d,h,n):t.texImage2D(i,l,u,o,s,0,d,h,n);return{width:o,height:s,depth:a,type:h}}function We(t,e,n){const r=n.target||3553;t.bindTexture(r,e);const i=n.level||0,o=n.internalFormat||n.format||6408,s=pe(o),a=n.format||s.format,l=n.type||s.type;if(xe(t,n),34067===r)for(let e=0;e<6;++e)t.texImage2D(34069+e,i,o,n.width,n.height,0,a,l,null);else 32879===r||35866===r?t.texImage3D(r,i,o,n.width,n.height,n.depth,0,a,l,null):t.texImage2D(r,i,o,n.width,n.height,0,a,l,null)}function Ue(t,e,n){n=n||Ie,e=e||ie.textureOptions;const r=t.createTexture(),i=e.target||3553;let o=e.width||1,s=e.height||1;const a=e.internalFormat||6408;t.bindTexture(i,r),34067===i&&(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071));let l=e.src;if(l)if("function"==typeof l&&(l=l(t,e)),"string"==typeof l)qe(t,r,e,n);else if(oe(l)||Array.isArray(l)&&("number"==typeof l[0]||Array.isArray(l[0])||oe(l[0]))){const n=De(t,r,l,e);o=n.width,s=n.height}else Array.isArray(l)&&("string"==typeof l[0]||Le(l[0]))?34067===i?je(t,r,e,n):Ne(t,r,e,n):(Ve(t,r,l,e),o=l.width,s=l.height);else We(t,r,e);return Te(e)&&ke(t,r,e,o,s,a),Ce(t,r,e),r}function He(t,e,n,r,i,o){r=r||n.width,i=i||n.height,o=o||n.depth;const s=n.target||3553;t.bindTexture(s,e);const a=n.level||0,l=n.internalFormat||n.format||6408,u=pe(l),c=n.format||u.format;let d;const h=n.src;if(d=h&&(oe(h)||Array.isArray(h)&&"number"==typeof h[0])?n.type||ge(0,h,u.type):n.type||u.type,34067===s)for(let e=0;e<6;++e)t.texImage2D(34069+e,a,l,r,i,0,c,d,null);else 32879===s||35866===s?t.texImage3D(s,a,l,r,i,o,0,c,d,null):t.texImage2D(s,a,l,r,i,0,c,d,null)}function Ge(t,e,n){n=n||Ie;let r=0;const i=[],o={},s={};function a(){0===r&&setTimeout((function(){n(i.length?i:void 0,o,s)}),0)}return Object.keys(e).forEach((function(n){const l=e[n];let u;var c;("string"==typeof(c=l.src)||Array.isArray(c)&&"string"==typeof c[0])&&(u=function(t,e,o){s[n]=o,--r,t&&i.push(t),a()},++r),o[n]=Ue(t,l,u)})),a(),o}var Ke=Object.freeze({__proto__:null,setTextureDefaults_:ye,createSampler:Pe,createSamplers:Se,setSamplerParameters:Me,createTexture:Ue,setEmptyTexture:We,setTextureFromArray:De,loadTextureFromUrl:qe,setTextureFromElement:Ve,setTextureFilteringForSize:ke,setTextureParameters:Ce,setDefaultTextureColor:_e,createTextures:Ge,resizeTexture:He,canGenerateMipmap:ve,canFilter:me,getNumComponentsForFormat:be,getBytesPerElementForInternalFormat:he,getFormatAndTypeForInternalFormat:pe});const $e=S,Ye=k;function Xe(t){return"undefined"!=typeof document&&document.getElementById?document.getElementById(t):null}const Ze={};function Qe(t,e){return Ze[e].bindPoint}function Je(t,e){return function(n){t.uniform1i(e,n)}}function tn(t,e){return function(n){t.uniform1iv(e,n)}}function en(t,e){return function(n){t.uniform2iv(e,n)}}function nn(t,e){return function(n){t.uniform3iv(e,n)}}function rn(t,e){return function(n){t.uniform4iv(e,n)}}function on(t,e,n,r){const i=Qe(0,e);return te(t)?function(e){let o,s;!e||V(0,e)?(o=e,s=null):(o=e.texture,s=e.sampler),t.uniform1i(r,n),t.activeTexture(33984+n),t.bindTexture(i,o),t.bindSampler(n,s)}:function(e){t.uniform1i(r,n),t.activeTexture(33984+n),t.bindTexture(i,e)}}function sn(t,e,n,r,i){const o=Qe(0,e),s=new Int32Array(i);for(let t=0;t<i;++t)s[t]=n+t;return te(t)?function(e){t.uniform1iv(r,s),e.forEach((function(e,r){let i,a;t.activeTexture(33984+s[r]),!e||V(0,e)?(i=e,a=null):(i=e.texture,a=e.sampler),t.bindSampler(n,a),t.bindTexture(o,i)}))}:function(e){t.uniform1iv(r,s),e.forEach((function(e,n){t.activeTexture(33984+s[n]),t.bindTexture(o,e)}))}}function an(t,e){return function(n){if(n.value)switch(t.disableVertexAttribArray(e),n.value.length){case 4:t.vertexAttrib4fv(e,n.value);break;case 3:t.vertexAttrib3fv(e,n.value);break;case 2:t.vertexAttrib2fv(e,n.value);break;case 1:t.vertexAttrib1fv(e,n.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else t.bindBuffer(34962,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,n.numComponents||n.size,n.type||5126,n.normalize||!1,n.stride||0,n.offset||0),t.vertexAttribDivisor&&t.vertexAttribDivisor(e,n.divisor||0)}}function ln(t,e){return function(n){if(n.value){if(t.disableVertexAttribArray(e),4!==n.value.length)throw new Error("The length of an integer constant value must be 4!");t.vertexAttrib4iv(e,n.value)}else t.bindBuffer(34962,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,n.numComponents||n.size,n.type||5124,n.stride||0,n.offset||0),t.vertexAttribDivisor&&t.vertexAttribDivisor(e,n.divisor||0)}}function un(t,e){return function(n){if(n.value){if(t.disableVertexAttribArray(e),4!==n.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");t.vertexAttrib4uiv(e,n.value)}else t.bindBuffer(34962,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,n.numComponents||n.size,n.type||5125,n.stride||0,n.offset||0),t.vertexAttribDivisor&&t.vertexAttribDivisor(e,n.divisor||0)}}function cn(t,e,n){const r=n.size,i=n.count;return function(n){t.bindBuffer(34962,n.buffer);const o=n.size||n.numComponents||r,s=o/i,a=n.type||5126,l=Ze[a].size*o,u=n.normalize||!1,c=n.offset||0,d=l/i;for(let r=0;r<i;++r)t.enableVertexAttribArray(e+r),t.vertexAttribPointer(e+r,s,a,u,l,c+d*r),t.vertexAttribDivisor&&t.vertexAttribDivisor(e+r,n.divisor||0)}}Ze[5126]={Type:Float32Array,size:4,setter:function(t,e){return function(n){t.uniform1f(e,n)}},arraySetter:function(t,e){return function(n){t.uniform1fv(e,n)}}},Ze[35664]={Type:Float32Array,size:8,setter:function(t,e){return function(n){t.uniform2fv(e,n)}},cols:2},Ze[35665]={Type:Float32Array,size:12,setter:function(t,e){return function(n){t.uniform3fv(e,n)}},cols:3},Ze[35666]={Type:Float32Array,size:16,setter:function(t,e){return function(n){t.uniform4fv(e,n)}},cols:4},Ze[5124]={Type:Int32Array,size:4,setter:Je,arraySetter:tn},Ze[35667]={Type:Int32Array,size:8,setter:en,cols:2},Ze[35668]={Type:Int32Array,size:12,setter:nn,cols:3},Ze[35669]={Type:Int32Array,size:16,setter:rn,cols:4},Ze[5125]={Type:Uint32Array,size:4,setter:function(t,e){return function(n){t.uniform1ui(e,n)}},arraySetter:function(t,e){return function(n){t.uniform1uiv(e,n)}}},Ze[36294]={Type:Uint32Array,size:8,setter:function(t,e){return function(n){t.uniform2uiv(e,n)}},cols:2},Ze[36295]={Type:Uint32Array,size:12,setter:function(t,e){return function(n){t.uniform3uiv(e,n)}},cols:3},Ze[36296]={Type:Uint32Array,size:16,setter:function(t,e){return function(n){t.uniform4uiv(e,n)}},cols:4},Ze[35670]={Type:Uint32Array,size:4,setter:Je,arraySetter:tn},Ze[35671]={Type:Uint32Array,size:8,setter:en,cols:2},Ze[35672]={Type:Uint32Array,size:12,setter:nn,cols:3},Ze[35673]={Type:Uint32Array,size:16,setter:rn,cols:4},Ze[35674]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix2fv(e,!1,n)}},rows:2,cols:2},Ze[35675]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix3fv(e,!1,n)}},rows:3,cols:3},Ze[35676]={Type:Float32Array,size:64,setter:function(t,e){return function(n){t.uniformMatrix4fv(e,!1,n)}},rows:4,cols:4},Ze[35685]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix2x3fv(e,!1,n)}},rows:2,cols:3},Ze[35686]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix2x4fv(e,!1,n)}},rows:2,cols:4},Ze[35687]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix3x2fv(e,!1,n)}},rows:3,cols:2},Ze[35688]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix3x4fv(e,!1,n)}},rows:3,cols:4},Ze[35689]={Type:Float32Array,size:64,setter:function(t,e){return function(n){t.uniformMatrix4x2fv(e,!1,n)}},rows:4,cols:2},Ze[35690]={Type:Float32Array,size:64,setter:function(t,e){return function(n){t.uniformMatrix4x3fv(e,!1,n)}},rows:4,cols:3},Ze[35678]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:3553},Ze[35680]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:34067},Ze[35679]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:32879},Ze[35682]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:3553},Ze[36289]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:35866},Ze[36292]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:35866},Ze[36293]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:34067},Ze[36298]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:3553},Ze[36299]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:32879},Ze[36300]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:34067},Ze[36303]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:35866},Ze[36306]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:3553},Ze[36307]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:32879},Ze[36308]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:34067},Ze[36311]={Type:null,size:0,setter:on,arraySetter:sn,bindPoint:35866};const dn={};dn[5126]={size:4,setter:an},dn[35664]={size:8,setter:an},dn[35665]={size:12,setter:an},dn[35666]={size:16,setter:an},dn[5124]={size:4,setter:ln},dn[35667]={size:8,setter:ln},dn[35668]={size:12,setter:ln},dn[35669]={size:16,setter:ln},dn[5125]={size:4,setter:un},dn[36294]={size:8,setter:un},dn[36295]={size:12,setter:un},dn[36296]={size:16,setter:un},dn[35670]={size:4,setter:ln},dn[35671]={size:8,setter:ln},dn[35672]={size:12,setter:ln},dn[35673]={size:16,setter:ln},dn[35674]={size:4,setter:cn,count:2},dn[35675]={size:9,setter:cn,count:3},dn[35676]={size:16,setter:cn,count:4};const hn=/ERROR:\s*\d+:(\d+)/gi;const pn=/^[ \t]*\n/;function fn(t){let e=0;return pn.test(t)&&(e=1,t=t.replace(pn,"")),{lineOffset:e,shaderSource:t}}function vn(t,e){return t.errorCallback(e),t.callback&&setTimeout(()=>{t.callback(`${e}\n${t.errors.join("\n")}`)}),null}function mn(t,e,n,r){r=r||$e;if(!t.getShaderParameter(n,35713)){const i=t.getShaderInfoLog(n),{lineOffset:o,shaderSource:s}=fn(t.getShaderSource(n)),a=`${function(t,e="",n=0){const r=[...e.matchAll(hn)],i=new Map(r.map((t,n)=>{const i=parseInt(t[1]),o=r[n+1],s=o?o.index:e.length;return[i-1,e.substring(t.index,s)]}));return t.split("\n").map((t,e)=>{const r=i.get(e);return`${e+1+n}: ${t}${r?"\n\n^^^ "+r:""}`}).join("\n")}(s,i,o)}\nError compiling ${ne(t,e)}: ${i}`;return r(a),a}return""}function bn(t,e,n){let r,i,o;if("function"==typeof e&&(n=e,e=void 0),"function"==typeof t)n=t,t=void 0;else if(t&&!Array.isArray(t)){const e=t;n=e.errorCallback,t=e.attribLocations,r=e.transformFeedbackVaryings,i=e.transformFeedbackMode,o=e.callback}const s=n||$e,a=[],l={errorCallback(t,...e){a.push(t),s(t,...e)},transformFeedbackVaryings:r,transformFeedbackMode:i,callback:o,errors:a};{let n={};Array.isArray(t)?t.forEach((function(t,r){n[t]=e?e[r]:r})):n=t||{},l.attribLocations=n}return l}const gn=["VERTEX_SHADER","FRAGMENT_SHADER"];const wn=(t=0)=>new Promise(e=>setTimeout(e,t));function _n(t,e,n){const r=t.createProgram(),{attribLocations:i,transformFeedbackVaryings:o,transformFeedbackMode:s}=bn(n);for(let n=0;n<e.length;++n){let i=e[n];if("string"==typeof i){const e=Xe(i),o=e?e.text:i;let s=t[gn[n]];e&&e.type&&(s=((a=e.type).indexOf("frag")>=0?35632:a.indexOf("vert")>=0?35633:void 0)||s),i=t.createShader(s),t.shaderSource(i,fn(o).shaderSource),t.compileShader(i),t.attachShader(r,i)}}var a;Object.entries(i).forEach(([e,n])=>t.bindAttribLocation(r,n,e));{let e=o;e&&(e.attribs&&(e=e.attribs),Array.isArray(e)||(e=Object.keys(e)),t.transformFeedbackVaryings(r,e,s||35981))}return t.linkProgram(r),r}function yn(t,e,n,r,i){const o=bn(n,r,i),s=new Set(e),a=_n(t,e,o);function l(t,e){const n=Mn(t,e,o.errorCallback);return n&&function(t,e,n){const r=t.getAttachedShaders(e);for(const e of r)n.has(e)&&t.deleteShader(e);t.deleteProgram(e)}(t,e,s),n}if(!o.callback)return l(t,a)?void 0:a;Cn(t,a).then(()=>{const e=l(t,a);o.callback(e,e?void 0:a)})}function xn(t){return function(e,n,...r){return new Promise((i,o)=>{const s=bn(...r);s.callback=(t,e)=>{t?o(t):i(e)},t(e,n,s)})}}const An=xn(yn),En=xn(Zn);async function Cn(t,e){const n=t.getExtension("KHR_parallel_shader_compile"),r=n?(t,e)=>t.getProgramParameter(e,n.COMPLETION_STATUS_KHR):()=>!0;let i=0;do{await wn(i),i=1e3/60}while(!r(t,e))}function Mn(t,e,n){n=n||$e;if(!t.getProgramParameter(e,35714)){const r=t.getProgramInfoLog(e);n("Error in program linking: "+r);return`${r}\n${t.getAttachedShaders(e).map(e=>mn(t,t.getShaderParameter(e,t.SHADER_TYPE),e,n)).filter(t=>t).join("\n")}`}}function Pn(t,e,n,r,i){const o=bn(n,r,i),s=[];for(const t of e){const e=Xe(t);if(!e)return vn(o,"unknown script element: "+t);s.push(e.text)}return yn(t,s,o)}function Sn(t,e,n,r,i){return yn(t,e,n,r,i)}function kn(t){const e=t.name;return e.startsWith("gl_")||e.startsWith("webgl_")}const Tn=/(\.|\[|]|\w+)/g;function Bn(t,e,n,r){const i=t.split(Tn).filter(t=>""!==t);let o=0,s="";for(;;){const t=i[o++];s+=t;const l=(a=t[0])>="0"&&a<="9",u=l?parseInt(t):t;l&&(s+=i[o++]);if(o===i.length){n[u]=e;break}{const t=i[o++],e="["===t,a=n[u]||(e?[]:{});n[u]=a,n=a,r[s]=r[s]||function(t){return function(e){Wn(t,e)}}(a),s+=t}}var a}function Fn(t,e){let n=0;function r(e,r,i){const o=r.name.endsWith("[0]"),s=r.type,a=Ze[s];if(!a)throw new Error("unknown type: 0x"+s.toString(16));let l;if(a.bindPoint){const e=n;n+=r.size,l=o?a.arraySetter(t,s,e,i,r.size):a.setter(t,s,e,i,r.size)}else l=a.arraySetter&&o?a.arraySetter(t,i):a.setter(t,i);return l.location=i,l}const i={},o={},s=t.getProgramParameter(e,35718);for(let n=0;n<s;++n){const s=t.getActiveUniform(e,n);if(kn(s))continue;let a=s.name;a.endsWith("[0]")&&(a=a.substr(0,a.length-3));const l=t.getUniformLocation(e,s.name);if(l){const t=r(0,s,l);i[a]=t,Bn(a,t,o,i)}}return i}function Vn(t,e){const n={},r=t.getProgramParameter(e,35971);for(let i=0;i<r;++i){const r=t.getTransformFeedbackVarying(e,i);n[r.name]={index:i,type:r.type,size:r.size}}return n}function In(t,e,n){e.transformFeedbackInfo&&(e=e.transformFeedbackInfo),n.attribs&&(n=n.attribs);for(const r in n){const i=e[r];if(i){const e=n[r];e.offset?t.bindBufferRange(35982,i.index,e.buffer,e.offset,e.size):t.bindBufferBase(35982,i.index,e.buffer)}}}function zn(t,e,n){const r=t.createTransformFeedback();return t.bindTransformFeedback(36386,r),t.useProgram(e.program),In(t,e,n),t.bindTransformFeedback(36386,null),r}function Ln(t,e){const n=t.getProgramParameter(e,35718),r=[],i=[];for(let o=0;o<n;++o){i.push(o),r.push({});const n=t.getActiveUniform(e,o);r[o].name=n.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach((function(n){const o=n[0],s=n[1];t.getActiveUniforms(e,i,t[o]).forEach((function(t,e){r[e][s]=t}))}));const o={},s=t.getProgramParameter(e,35382);for(let n=0;n<s;++n){const r=t.getActiveUniformBlockName(e,n),i={index:t.getUniformBlockIndex(e,r),usedByVertexShader:t.getActiveUniformBlockParameter(e,n,35396),usedByFragmentShader:t.getActiveUniformBlockParameter(e,n,35398),size:t.getActiveUniformBlockParameter(e,n,35392),uniformIndices:t.getActiveUniformBlockParameter(e,n,35395)};i.used=i.usedByVertexShader||i.usedByFragmentShader,o[r]=i}return{blockSpecs:o,uniformData:r}}const Rn=/\[\d+\]\.$/;function On(t,e,n,r){const i=n.blockSpecs,o=n.uniformData,s=i[r];if(!s)return Ye("no uniform block object named:",r),{name:r,uniforms:{}};const a=new ArrayBuffer(s.size),l=t.createBuffer(),u=s.index;t.bindBuffer(35345,l),t.uniformBlockBinding(e,s.index,u);let c=r+".";Rn.test(c)&&(c=c.replace(Rn,"."));const d={},h={},p={};return s.uniformIndices.forEach((function(t){const e=o[t];let n=e.name;n.startsWith(c)&&(n=n.substr(c.length));const r=n.endsWith("[0]");r&&(n=n.substr(0,n.length-3));const i=Ze[e.type],s=i.Type,l=r?((i.size+((u=16)-1))/u|0)*u*e.size:i.size*e.size;var u;const f=new s(a,e.offset,l/s.BYTES_PER_ELEMENT);d[n]=f;const v=function(t,e,n,r){if(e||n){r=r||1;const e=t.length/4;return function(n){let i=0,o=0;for(let s=0;s<e;++s){for(let e=0;e<r;++e)t[i++]=n[o++];i+=4-r}}}return function(e){e.length?t.set(e):t[0]=e}}(f,r,i.rows,i.cols);h[n]=v,Bn(n,v,p,h)})),{name:r,array:a,asFloat:new Float32Array(a),buffer:l,uniforms:d,setters:h}}function qn(t,e,n){return On(t,e.program,e.uniformBlockSpec,n)}function jn(t,e,n){const r=(e.uniformBlockSpec||e).blockSpecs[n.name];if(r){const e=r.index;return t.bindBufferRange(35345,e,n.buffer,n.offset||0,n.array.byteLength),!0}return!1}function Nn(t,e,n){jn(t,e,n)&&t.bufferData(35345,n.array,35048)}function Dn(t,e){const n=t.setters;for(const t in e){const r=n[t];if(r){r(e[t])}}}function Wn(t,e){for(const n in e){const r=t[n];"function"==typeof r?r(e[n]):Wn(t[n],e[n])}}function Un(t,...e){const n=t.uniformSetters||t,r=e.length;for(let t=0;t<r;++t){const r=e[t];if(Array.isArray(r)){const t=r.length;for(let e=0;e<t;++e)Un(n,r[e])}else for(const t in r){const e=n[t];e&&e(r[t])}}}const Hn=Un;function Gn(t,e){const n={},r=t.getProgramParameter(e,35721);for(let i=0;i<r;++i){const r=t.getActiveAttrib(e,i);if(kn(r))continue;const o=t.getAttribLocation(e,r.name),s=dn[r.type],a=s.setter(t,o,s);a.location=o,n[r.name]=a}return n}function Kn(t,e){for(const n in e){const r=t[n];r&&r(e[n])}}function $n(t,e,n){n.vertexArrayObject?t.bindVertexArray(n.vertexArrayObject):(Kn(e.attribSetters||e,n.attribs),n.indices&&t.bindBuffer(34963,n.indices))}function Yn(t,e){const n={program:e,uniformSetters:Fn(t,e),attribSetters:Gn(t,e)};return te(t)&&(n.uniformBlockSpec=Ln(t,e),n.transformFeedbackInfo=Vn(t,e)),n}const Xn=/\s|{|}|;/;function Zn(t,e,n,r,i){const o=bn(n,r,i),s=[];if(e=e.map((function(t){if(!Xn.test(t)){const e=Xe(t);if(e)t=e.text;else{const e="no element with id: "+t;o.errorCallback(e),s.push(e)}}return t})),s.length)return vn(o,"");const a=o.callback;a&&(o.callback=(e,n)=>{a(e,e?void 0:Yn(t,n))});const l=Sn(t,e,o);return l?Yn(t,l):null}function Qn(t,e,n,r,i){for(const[o,s]of Object.entries(e)){const a={...i},l=n[o];Array.isArray(l)||Object.assign(a,l);const u=Mn(t,s,a.errorCallback);if(u){for(const n of Object.values(e)){const e=t.getAttachedShaders(n);t.deleteProgram(n);for(const n of e)r.has(n)||t.deleteShader(n)}return u}}}function Jn(t,e,n={}){const r=new Set,i=Object.fromEntries(Object.entries(e).map(([e,i])=>{const o={...n},s=Array.isArray(i)?i:i.shaders;return Array.isArray(i)||Object.assign(o,i),s.forEach(r.add,r),[e,_n(t,s,o)]}));if(n.callback)return void async function(t,e){for(const n of Object.values(e))await Cn(t,n)}(t,i).then(()=>{const o=Qn(t,i,e,r,n);n.callback(o,o?void 0:i)});return Qn(t,i,e,r,n)?void 0:i}function tr(t,e,n){function r(t,e){return Object.fromEntries(Object.entries(e).map(([e,n])=>[e,Yn(t,n)]))}const i=(n=bn(n)).callback;i&&(n.callback=(e,n)=>{i(e,e?void 0:r(t,n))});const o=Jn(t,e,n);if(!i&&o)return r(t,o)}const er=xn(Jn),nr=xn(tr);var rr=Object.freeze({__proto__:null,createAttributeSetters:Gn,createProgram:yn,createProgramAsync:An,createPrograms:Jn,createProgramsAsync:er,createProgramFromScripts:Pn,createProgramFromSources:Sn,createProgramInfo:Zn,createProgramInfoAsync:En,createProgramInfos:tr,createProgramInfosAsync:nr,createProgramInfoFromProgram:Yn,createUniformSetters:Fn,createUniformBlockSpecFromProgram:Ln,createUniformBlockInfoFromProgram:On,createUniformBlockInfo:qn,createTransformFeedback:zn,createTransformFeedbackInfo:Vn,bindTransformFeedbackInfo:In,setAttributes:Kn,setBuffersAndAttributes:$n,setUniforms:Un,setUniformsAndBindTextures:Hn,setUniformBlock:Nn,setBlockUniforms:Dn,bindUniformBlock:jn});function ir(t,e,n,r,i,o){n=void 0===n?4:n;const s=e.indices,a=e.elementType,l=void 0===r?e.numElements:r;i=void 0===i?0:i,a||s?void 0!==o?t.drawElementsInstanced(n,l,void 0===a?5123:e.elementType,i,o):t.drawElements(n,l,void 0===a?5123:e.elementType,i):void 0!==o?t.drawArraysInstanced(n,i,l,o):t.drawArrays(n,i,l)}function or(t,e){let n=null,r=null;e.forEach((function(e){if(!1===e.active)return;const i=e.programInfo,o=e.vertexArrayInfo||e.bufferInfo;let s=!1;const a=void 0===e.type?4:e.type;i!==n&&(n=i,t.useProgram(i.program),s=!0),(s||o!==r)&&(r&&r.vertexArrayObject&&!o.vertexArrayObject&&t.bindVertexArray(null),r=o,$n(t,i,o)),Un(i,e.uniforms),ir(t,o,a,e.count,e.offset,e.instanceCount)})),r&&r.vertexArrayObject&&t.bindVertexArray(null)}var sr=Object.freeze({__proto__:null,drawBufferInfo:ir,drawObjectList:or});const ar=[{format:6408,type:5121,min:9729,wrap:33071},{format:34041}],lr={};lr[34041]=33306,lr[6401]=36128,lr[36168]=36128,lr[6402]=36096,lr[33189]=36096,lr[33190]=36096,lr[36012]=36096,lr[35056]=33306,lr[36013]=33306;const ur={};ur[32854]=!0,ur[32855]=!0,ur[36194]=!0,ur[34041]=!0,ur[33189]=!0,ur[6401]=!0,ur[36168]=!0;function cr(t,e,n,r){const i=t.createFramebuffer();t.bindFramebuffer(36160,i),n=n||t.drawingBufferWidth,r=r||t.drawingBufferHeight;const o=[],s={framebuffer:i,attachments:[],width:n,height:r};return(e=e||ar).forEach((function(e,i){let a=e.attachment;const l=e.samples,u=e.format;let c=e.attachmentPoint||function(t,e){return lr[t]||lr[e]}(u,e.internalFormat);if(c||(c=36064+i),function(t){return t>=36064&&t<36096}(c)&&o.push(c),!a)if(void 0!==l||function(t){return ur[t]}(u))a=t.createRenderbuffer(),t.bindRenderbuffer(36161,a),l>1?t.renderbufferStorageMultisample(36161,l,u,n,r):t.renderbufferStorage(36161,u,n,r);else{const i=Object.assign({},e);i.width=n,i.height=r,void 0===i.auto&&(i.auto=!1,i.min=i.min||i.minMag||9729,i.mag=i.mag||i.minMag||9729,i.wrapS=i.wrapS||i.wrap||33071,i.wrapT=i.wrapT||i.wrap||33071),a=Ue(t,i)}if(F(0,a))t.framebufferRenderbuffer(36160,c,36161,a);else{if(!V(0,a))throw new Error("unknown attachment type");void 0!==e.layer?t.framebufferTextureLayer(36160,c,a,e.level||0,e.layer):t.framebufferTexture2D(36160,c,e.target||3553,a,e.level||0)}s.attachments.push(a)})),t.drawBuffers&&t.drawBuffers(o),s}function dr(t,e,n,r,i){r=r||t.drawingBufferWidth,i=i||t.drawingBufferHeight,e.width=r,e.height=i,(n=n||ar).forEach((function(n,o){const s=e.attachments[o],a=n.format,l=n.samples;if(void 0!==l||F(0,s))t.bindRenderbuffer(36161,s),l>1?t.renderbufferStorageMultisample(36161,l,a,r,i):t.renderbufferStorage(36161,a,r,i);else{if(!V(0,s))throw new Error("unknown attachment type");He(t,s,n,r,i)}}))}function hr(t,e,n){n=n||36160,e?(t.bindFramebuffer(n,e.framebuffer),t.viewport(0,0,e.width,e.height)):(t.bindFramebuffer(n,null),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight))}var pr=Object.freeze({__proto__:null,bindFramebufferInfo:hr,createFramebufferInfo:cr,resizeFramebufferInfo:dr});function fr(t,e,n){const r=t.createVertexArray();return t.bindVertexArray(r),e.length||(e=[e]),e.forEach((function(e){$n(t,e,n)})),t.bindVertexArray(null),{numElements:n.numElements,elementType:n.elementType,vertexArrayObject:r}}function vr(t,e,n,r){const i=t.createVertexArray();return t.bindVertexArray(i),Kn(e,n),r&&t.bindBuffer(34963,r),t.bindVertexArray(null),i}function mr(t,e,n){return vr(t,e.attribSetters||e,n.attribs,n.indices)}var br=Object.freeze({__proto__:null,createVertexArrayInfo:fr,createVAOAndSetAttributes:vr,createVAOFromBufferInfo:mr});const gr={addExtensionsToContext:!0};function wr(t){P(t,gr),L(t),ye(t)}const _r=/^(.*?)_/;function yr(t,e){ne(t,0);const n=t.getExtension(e);if(n){const r={},i=_r.exec(e)[1],o="_"+i;for(const e in n){const s=n[e],a="function"==typeof s,l=a?i:o;let u=e;e.endsWith(l)&&(u=e.substring(0,e.length-l.length)),void 0!==t[u]?a||t[u]===s||k(u,t[u],s,e):a?t[u]=function(t){return function(){return t.apply(n,arguments)}}(s):(t[u]=s,r[u]=s)}r.constructor={name:n.constructor.name},ne(r,0)}return n}const xr=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];function Ar(t){for(let e=0;e<xr.length;++e)yr(t,xr[e])}function Er(t,e){return function(t,e){const n=["webgl","experimental-webgl"];let r=null;for(let i=0;i<n.length;++i)if(r=t.getContext(n[i],e),r){gr.addExtensionsToContext&&Ar(r);break}return r}(t,e)}function Cr(t,e){return function(t,e){const n=["webgl2","webgl","experimental-webgl"];let r=null;for(let i=0;i<n.length;++i)if(r=t.getContext(n[i],e),r){gr.addExtensionsToContext&&Ar(r);break}return r}(t,e)}function Mr(t,e){e=e||1,e=Math.max(0,e);const n=t.clientWidth*e|0,r=t.clientHeight*e|0;return(t.width!==n||t.height!==r)&&(t.width=n,t.height=r,!0)}},26:function(t,e,n){(function(n){var r;
/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */!function(){"use strict";var i=function(){this.init()};i.prototype={init:function(){var t=this||o;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||o;if(t=parseFloat(t),e.ctx||p(),void 0!==t&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,o.ctx.currentTime);for(var n=0;n<e._howls.length;n++)if(!e._howls[n]._webAudio)for(var r=e._howls[n]._getSoundIds(),i=0;i<r.length;i++){var s=e._howls[n]._soundById(r[i]);s&&s._node&&(s._node.volume=s._volume*t)}return e}return e._volume},mute:function(t){var e=this||o;e.ctx||p(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,o.ctx.currentTime);for(var n=0;n<e._howls.length;n++)if(!e._howls[n]._webAudio)for(var r=e._howls[n]._getSoundIds(),i=0;i<r.length;i++){var s=e._howls[n]._soundById(r[i]);s&&s._node&&(s._node.muted=!!t||s._muted)}return e},stop:function(){for(var t=this||o,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||o,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&void 0!==t.ctx.close&&(t.ctx.close(),t.ctx=null,p()),t},codecs:function(t){return(this||o)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||o;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(t){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||o,e=null;try{e="undefined"!=typeof Audio?new Audio:null}catch(e){return t}if(!e||"function"!=typeof e.canPlayType)return t;var n=e.canPlayType("audio/mpeg;").replace(/^no$/,""),r=t._navigator?t._navigator.userAgent:"",i=r.match(/OPR\/([0-6].)/g),s=i&&parseInt(i[0].split("/")[1],10)<33,a=-1!==r.indexOf("Safari")&&-1===r.indexOf("Chrome"),l=r.match(/Version\/(.*?) /),u=a&&l&&parseInt(l[1],10)<15;return t._codecs={mp3:!(s||!n&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(u||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(u||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||o;if(!t._audioUnlocked&&t.ctx){t._audioUnlocked=!1,t.autoUnlock=!1,t._mobileUnloaded||44100===t.ctx.sampleRate||(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(n){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var r=new Audio;r._unlocked=!0,t._releaseHtml5Audio(r)}catch(n){t.noAudio=!0;break}for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var o=t._howls[i]._getSoundIds(),s=0;s<o.length;s++){var a=t._howls[i]._soundById(o[s]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}t._autoResume();var l=t.ctx.createBufferSource();l.buffer=t._scratchBuffer,l.connect(t.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof t.ctx.resume&&t.ctx.resume(),l.onended=function(){l.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var n=0;n<t._howls.length;n++)t._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||o;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=(new Audio).play();return e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)&&e.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(t){var e=this||o;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&o.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var n=0;n<t._howls[e]._sounds.length;n++)if(!t._howls[e]._sounds[n]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout((function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var e=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(e,e)}}),3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&o.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then((function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")})),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var o=new i,s=function(t){t.src&&0!==t.src.length?this.init(t):console.error("An array of source files must be passed with any new Howl.")};s.prototype={init:function(t){var e=this;return o.ctx||p(),e._autoplay=t.autoplay||!1,e._format="string"!=typeof t.format?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload="boolean"!=typeof t.preload&&"metadata"!==t.preload||t.preload,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src="string"!=typeof t.src?t.src:[t.src],e._volume=void 0!==t.volume?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:!(!t.xhr||!t.xhr.withCredentials)&&t.xhr.withCredentials},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=o.usingWebAudio&&!e._html5,void 0!==o.ctx&&o.ctx&&o.autoUnlock&&o._unlockAudio(),o._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&"none"!==e._preload&&e.load(),e},load:function(){var t=null;if(o.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"==typeof this._src&&(this._src=[this._src]);for(var e=0;e<this._src.length;e++){var n,r;if(this._format&&this._format[e])n=this._format[e];else{if("string"!=typeof(r=this._src[e])){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(n=/^data:audio\/([^;,]+);/i.exec(r))||(n=/\.([^.]+)$/.exec(r.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&o.codecs(n)){t=this._src[e];break}}if(t)return this._src=t,this._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new a(this),this._webAudio&&u(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,e){var n=this,r=null;if("number"==typeof t)r=t,t=null;else{if("string"==typeof t&&"loaded"===n._state&&!n._sprite[t])return null;if(void 0===t&&(t="__default",!n._playLock)){for(var i=0,s=0;s<n._sounds.length;s++)n._sounds[s]._paused&&!n._sounds[s]._ended&&(i++,r=n._sounds[s]._id);1===i?t=null:r=null}}var a=r?n._soundById(r):n._inactiveSound();if(!a)return null;if(r&&!t&&(t=a._sprite||"__default"),"loaded"!==n._state){a._sprite=t,a._ended=!1;var l=a._id;return n._queue.push({event:"play",action:function(){n.play(l)}}),l}if(r&&!a._paused)return e||n._loadQueue("play"),a._id;n._webAudio&&o._autoResume();var u=Math.max(0,a._seek>0?a._seek:n._sprite[t][0]/1e3),c=Math.max(0,(n._sprite[t][0]+n._sprite[t][1])/1e3-u),d=1e3*c/Math.abs(a._rate),h=n._sprite[t][0]/1e3,p=(n._sprite[t][0]+n._sprite[t][1])/1e3;a._sprite=t,a._ended=!1;var f=function(){a._paused=!1,a._seek=u,a._start=h,a._stop=p,a._loop=!(!a._loop&&!n._sprite[t][2])};if(!(u>=p)){var v=a._node;if(n._webAudio){var m=function(){n._playLock=!1,f(),n._refreshBuffer(a);var t=a._muted||n._muted?0:a._volume;v.gain.setValueAtTime(t,o.ctx.currentTime),a._playStart=o.ctx.currentTime,void 0===v.bufferSource.start?a._loop?v.bufferSource.noteGrainOn(0,u,86400):v.bufferSource.noteGrainOn(0,u,c):a._loop?v.bufferSource.start(0,u,86400):v.bufferSource.start(0,u,c),d!==1/0&&(n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),d)),e||setTimeout((function(){n._emit("play",a._id),n._loadQueue()}),0)};"running"===o.state&&"interrupted"!==o.ctx.state?m():(n._playLock=!0,n.once("resume",m),n._clearTimer(a._id))}else{var b=function(){v.currentTime=u,v.muted=a._muted||n._muted||o._muted||v.muted,v.volume=a._volume*o.volume(),v.playbackRate=a._rate;try{var r=v.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(n._playLock=!0,f(),r.then((function(){n._playLock=!1,v._unlocked=!0,e?n._loadQueue():n._emit("play",a._id)})).catch((function(){n._playLock=!1,n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):e||(n._playLock=!1,f(),n._emit("play",a._id)),v.playbackRate=a._rate,v.paused)return void n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||a._loop?n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),d):(n._endTimers[a._id]=function(){n._ended(a),v.removeEventListener("ended",n._endTimers[a._id],!1)},v.addEventListener("ended",n._endTimers[a._id],!1))}catch(t){n._emit("playerror",a._id,t)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===v.src&&(v.src=n._src,v.load());var g=window&&window.ejecta||!v.readyState&&o._navigator.isCocoonJS;if(v.readyState>=3||g)b();else{n._playLock=!0,n._state="loading";var w=function(){n._state="loaded",b(),v.removeEventListener(o._canPlayEvent,w,!1)};v.addEventListener(o._canPlayEvent,w,!1),n._clearTimer(a._id)}}return a._id}n._ended(a)},pause:function(t){var e=this;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var n=e._getSoundIds(t),r=0;r<n.length;r++){e._clearTimer(n[r]);var i=e._soundById(n[r]);if(i&&!i._paused&&(i._seek=e.seek(n[r]),i._rateSeek=0,i._paused=!0,e._stopFade(n[r]),i._node))if(e._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),e._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||e._emit("pause",i?i._id:null)}return e},stop:function(t,e){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(t)}}),n;for(var r=n._getSoundIds(t),i=0;i<r.length;i++){n._clearTimer(r[i]);var o=n._soundById(r[i]);o&&(o._seek=o._start||0,o._rateSeek=0,o._paused=!0,o._ended=!0,n._stopFade(r[i]),o._node&&(n._webAudio?o._node.bufferSource&&(void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),n._cleanBuffer(o._node)):isNaN(o._node.duration)&&o._node.duration!==1/0||(o._node.currentTime=o._start||0,o._node.pause(),o._node.duration===1/0&&n._clearSound(o._node))),e||n._emit("stop",o._id))}return n},mute:function(t,e){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(t,e)}}),n;if(void 0===e){if("boolean"!=typeof t)return n._muted;n._muted=t}for(var r=n._getSoundIds(e),i=0;i<r.length;i++){var s=n._soundById(r[i]);s&&(s._muted=t,s._interval&&n._stopFade(s._id),n._webAudio&&s._node?s._node.gain.setValueAtTime(t?0:s._volume,o.ctx.currentTime):s._node&&(s._node.muted=!!o._muted||t),n._emit("mute",s._id))}return n},volume:function(){var t,e,n,r=this,i=arguments;if(0===i.length)return r._volume;if(1===i.length||2===i.length&&void 0===i[1]){var s=r._getSoundIds(),a=s.indexOf(i[0]);a>=0?e=parseInt(i[0],10):t=parseFloat(i[0])}else i.length>=2&&(t=parseFloat(i[0]),e=parseInt(i[1],10));if(!(void 0!==t&&t>=0&&t<=1))return(n=e?r._soundById(e):r._sounds[0])?n._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,i)}}),r;void 0===e&&(r._volume=t),e=r._getSoundIds(e);for(var l=0;l<e.length;l++)(n=r._soundById(e[l]))&&(n._volume=t,i[2]||r._stopFade(e[l]),r._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(t,o.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=t*o.volume()),r._emit("volume",n._id));return r},fade:function(t,e,n,r){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"fade",action:function(){i.fade(t,e,n,r)}}),i;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),n=parseFloat(n),i.volume(t,r);for(var s=i._getSoundIds(r),a=0;a<s.length;a++){var l=i._soundById(s[a]);if(l){if(r||i._stopFade(s[a]),i._webAudio&&!l._muted){var u=o.ctx.currentTime,c=u+n/1e3;l._volume=t,l._node.gain.setValueAtTime(t,u),l._node.gain.linearRampToValueAtTime(e,c)}i._startFadeInterval(l,t,e,n,s[a],void 0===r)}}return i},_startFadeInterval:function(t,e,n,r,i,o){var s=this,a=e,l=n-e,u=Math.abs(l/.01),c=Math.max(4,u>0?r/u:r),d=Date.now();t._fadeTo=n,t._interval=setInterval((function(){var i=(Date.now()-d)/r;d=Date.now(),a+=l*i,a=Math.round(100*a)/100,a=l<0?Math.max(n,a):Math.min(n,a),s._webAudio?t._volume=a:s.volume(a,t._id,!0),o&&(s._volume=a),(n<e&&a<=n||n>e&&a>=n)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,s.volume(n,t._id),s._emit("fade",t._id))}),c)},_stopFade:function(t){var e=this._soundById(t);return e&&e._interval&&(this._webAudio&&e._node.gain.cancelScheduledValues(o.ctx.currentTime),clearInterval(e._interval),e._interval=null,this.volume(e._fadeTo,t),e._fadeTo=null,this._emit("fade",t)),this},loop:function(){var t,e,n,r=this,i=arguments;if(0===i.length)return r._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(n=r._soundById(parseInt(i[0],10)))&&n._loop;t=i[0],r._loop=t}else 2===i.length&&(t=i[0],e=parseInt(i[1],10));for(var o=r._getSoundIds(e),s=0;s<o.length;s++)(n=r._soundById(o[s]))&&(n._loop=t,r._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=t,t&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop,r.playing(o[s])&&(r.pause(o[s],!0),r.play(o[s],!0)))));return r},rate:function(){var t,e,n,r=this,i=arguments;if(0===i.length)e=r._sounds[0]._id;else if(1===i.length){var s=r._getSoundIds(),a=s.indexOf(i[0]);a>=0?e=parseInt(i[0],10):t=parseFloat(i[0])}else 2===i.length&&(t=parseFloat(i[0]),e=parseInt(i[1],10));if("number"!=typeof t)return(n=r._soundById(e))?n._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,i)}}),r;void 0===e&&(r._rate=t),e=r._getSoundIds(e);for(var l=0;l<e.length;l++)if(n=r._soundById(e[l])){r.playing(e[l])&&(n._rateSeek=r.seek(e[l]),n._playStart=r._webAudio?o.ctx.currentTime:n._playStart),n._rate=t,r._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(t,o.ctx.currentTime):n._node&&(n._node.playbackRate=t);var u=r.seek(e[l]),c=(r._sprite[n._sprite][0]+r._sprite[n._sprite][1])/1e3-u,d=1e3*c/Math.abs(n._rate);!r._endTimers[e[l]]&&n._paused||(r._clearTimer(e[l]),r._endTimers[e[l]]=setTimeout(r._ended.bind(r,n),d)),r._emit("rate",n._id)}return r},seek:function(){var t,e,n=this,r=arguments;if(0===r.length)n._sounds.length&&(e=n._sounds[0]._id);else if(1===r.length){var i=n._getSoundIds(),s=i.indexOf(r[0]);s>=0?e=parseInt(r[0],10):n._sounds.length&&(e=n._sounds[0]._id,t=parseFloat(r[0]))}else 2===r.length&&(t=parseFloat(r[0]),e=parseInt(r[1],10));if(void 0===e)return 0;if("number"==typeof t&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,r)}}),n;var a=n._soundById(e);if(a){if(!("number"==typeof t&&t>=0)){if(n._webAudio){var l=n.playing(e)?o.ctx.currentTime-a._playStart:0,u=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(u+l*Math.abs(a._rate))}return a._node.currentTime}var c=n.playing(e);c&&n.pause(e,!0),a._seek=t,a._ended=!1,n._clearTimer(e),n._webAudio||!a._node||isNaN(a._node.duration)||(a._node.currentTime=t);var d=function(){c&&n.play(e,!0),n._emit("seek",e)};if(c&&!n._webAudio){var h=function(){n._playLock?setTimeout(h,0):d()};setTimeout(h,0)}else d()}return n},playing:function(t){if("number"==typeof t){var e=this._soundById(t);return!!e&&!e._paused}for(var n=0;n<this._sounds.length;n++)if(!this._sounds[n]._paused)return!0;return!1},duration:function(t){var e=this._duration,n=this._soundById(t);return n&&(e=this._sprite[n._sprite][1]/1e3),e},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,n=0;n<e.length;n++)e[n]._paused||t.stop(e[n]._id),t._webAudio||(t._clearSound(e[n]._node),e[n]._node.removeEventListener("error",e[n]._errorFn,!1),e[n]._node.removeEventListener(o._canPlayEvent,e[n]._loadFn,!1),e[n]._node.removeEventListener("ended",e[n]._endFn,!1),o._releaseHtml5Audio(e[n]._node)),delete e[n]._node,t._clearTimer(e[n]._id);var r=o._howls.indexOf(t);r>=0&&o._howls.splice(r,1);var i=!0;for(n=0;n<o._howls.length;n++)if(o._howls[n]._src===t._src||t._src.indexOf(o._howls[n]._src)>=0){i=!1;break}return l&&i&&delete l[t._src],o.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,n,r){var i=this["_on"+t];return"function"==typeof e&&i.push(r?{id:n,fn:e,once:r}:{id:n,fn:e}),this},off:function(t,e,n){var r=this["_on"+t],i=0;if("number"==typeof e&&(n=e,e=null),e||n)for(i=0;i<r.length;i++){var o=n===r[i].id;if(e===r[i].fn&&o||!e&&o){r.splice(i,1);break}}else if(t)this["_on"+t]=[];else{var s=Object.keys(this);for(i=0;i<s.length;i++)0===s[i].indexOf("_on")&&Array.isArray(this[s[i]])&&(this[s[i]]=[])}return this},once:function(t,e,n){return this.on(t,e,n,1),this},_emit:function(t,e,n){for(var r=this["_on"+t],i=r.length-1;i>=0;i--)r[i].id&&r[i].id!==e&&"load"!==t||(setTimeout(function(t){t.call(this,e,n)}.bind(this,r[i].fn),0),r[i].once&&this.off(t,r[i].fn,r[i].id));return this._loadQueue(t),this},_loadQueue:function(t){if(this._queue.length>0){var e=this._queue[0];e.event===t&&(this._queue.shift(),this._loadQueue()),t||e.action()}return this},_ended:function(t){var e=t._sprite;if(!this._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(this._ended.bind(this,t),100),this;var n=!(!t._loop&&!this._sprite[e][2]);if(this._emit("end",t._id),!this._webAudio&&n&&this.stop(t._id,!0).play(t._id),this._webAudio&&n){this._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=o.ctx.currentTime;var r=1e3*(t._stop-t._start)/Math.abs(t._rate);this._endTimers[t._id]=setTimeout(this._ended.bind(this,t),r)}return this._webAudio&&!n&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,this._clearTimer(t._id),this._cleanBuffer(t._node),o._autoSuspend()),this._webAudio||n||this.stop(t._id,!0),this},_clearTimer:function(t){if(this._endTimers[t]){if("function"!=typeof this._endTimers[t])clearTimeout(this._endTimers[t]);else{var e=this._soundById(t);e&&e._node&&e._node.removeEventListener("ended",this._endTimers[t],!1)}delete this._endTimers[t]}return this},_soundById:function(t){for(var e=0;e<this._sounds.length;e++)if(t===this._sounds[e]._id)return this._sounds[e];return null},_inactiveSound:function(){this._drain();for(var t=0;t<this._sounds.length;t++)if(this._sounds[t]._ended)return this._sounds[t].reset();return new a(this)},_drain:function(){var t=this._pool,e=0,n=0;if(!(this._sounds.length<t)){for(n=0;n<this._sounds.length;n++)this._sounds[n]._ended&&e++;for(n=this._sounds.length-1;n>=0;n--){if(e<=t)return;this._sounds[n]._ended&&(this._webAudio&&this._sounds[n]._node&&this._sounds[n]._node.disconnect(0),this._sounds.splice(n,1),e--)}}},_getSoundIds:function(t){if(void 0===t){for(var e=[],n=0;n<this._sounds.length;n++)e.push(this._sounds[n]._id);return e}return[t]},_refreshBuffer:function(t){return t._node.bufferSource=o.ctx.createBufferSource(),t._node.bufferSource.buffer=l[this._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,o.ctx.currentTime),this},_cleanBuffer:function(t){var e=o._navigator&&o._navigator.vendor.indexOf("Apple")>=0;if(o._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),e))try{t.bufferSource.buffer=o._scratchBuffer}catch(t){}return t.bufferSource=null,this},_clearSound:function(t){/MSIE |Trident\//.test(o._navigator&&o._navigator.userAgent)||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(t){this._parent=t,this.init()};a.prototype={init:function(){var t=this._parent;return this._muted=t._muted,this._loop=t._loop,this._volume=t._volume,this._rate=t._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++o._counter,t._sounds.push(this),this.create(),this},create:function(){var t=this._parent,e=o._muted||this._muted||this._parent._muted?0:this._volume;return t._webAudio?(this._node=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),this._node.gain.setValueAtTime(e,o.ctx.currentTime),this._node.paused=!0,this._node.connect(o.masterGain)):o.noAudio||(this._node=o._obtainHtml5Audio(),this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(o._canPlayEvent,this._loadFn,!1),this._endFn=this._endListener.bind(this),this._node.addEventListener("ended",this._endFn,!1),this._node.src=t._src,this._node.preload=!0===t._preload?"auto":t._preload,this._node.volume=e*o.volume(),this._node.load()),this},reset:function(){var t=this._parent;return this._muted=t._muted,this._loop=t._loop,this._volume=t._volume,this._rate=t._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++o._counter,this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var t=this._parent;t._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),this._node.removeEventListener(o._canPlayEvent,this._loadFn,!1)},_endListener:function(){var t=this._parent;t._duration===1/0&&(t._duration=Math.ceil(10*this._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(this)),this._node.removeEventListener("ended",this._endFn,!1)}};var l={},u=function(t){var e=t._src;if(l[e])return t._duration=l[e].duration,void h(t);if(/^data:[^;]+;base64,/.test(e)){for(var n=atob(e.split(",")[1]),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);d(r.buffer,t)}else{var o=new XMLHttpRequest;o.open(t._xhr.method,e,!0),o.withCredentials=t._xhr.withCredentials,o.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach((function(e){o.setRequestHeader(e,t._xhr.headers[e])})),o.onload=function(){var e=(o.status+"")[0];"0"===e||"2"===e||"3"===e?d(o.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+o.status+".")},o.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete l[e],t.load())},c(o)}},c=function(t){try{t.send()}catch(e){t.onerror()}},d=function(t,e){var n=function(){e._emit("loaderror",null,"Decoding audio data failed.")},r=function(t){t&&e._sounds.length>0?(l[e._src]=t,h(e,t)):n()};"undefined"!=typeof Promise&&1===o.ctx.decodeAudioData.length?o.ctx.decodeAudioData(t).then(r).catch(n):o.ctx.decodeAudioData(t,r,n)},h=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue())},p=function(){if(o.usingWebAudio){try{"undefined"!=typeof AudioContext?o.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?o.ctx=new webkitAudioContext:o.usingWebAudio=!1}catch(t){o.usingWebAudio=!1}o.ctx||(o.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(o._navigator&&o._navigator.platform),e=o._navigator&&o._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=e?parseInt(e[1],10):null;if(t&&n&&n<9){var r=/safari/.test(o._navigator&&o._navigator.userAgent.toLowerCase());o._navigator&&!r&&(o.usingWebAudio=!1)}o.usingWebAudio&&(o.masterGain=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),o.masterGain.gain.setValueAtTime(o._muted?0:o._volume,o.ctx.currentTime),o.masterGain.connect(o.ctx.destination)),o._setup()}};void 0===(r=function(){return{Howler:o,Howl:s}}.apply(e,[]))||(t.exports=r),e.Howler=o,e.Howl=s,void 0!==n?(n.HowlerGlobal=i,n.Howler=o,n.Howl=s,n.Sound=a):"undefined"!=typeof window&&(window.HowlerGlobal=i,window.Howler=o,window.Howl=s,window.Sound=a)}(),
/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){"use strict";var t;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){if(!this.ctx||!this.ctx.listener)return this;for(var e=this._howls.length-1;e>=0;e--)this._howls[e].stereo(t);return this},HowlerGlobal.prototype.pos=function(t,e,n){return this.ctx&&this.ctx.listener?(e="number"!=typeof e?this._pos[1]:e,n="number"!=typeof n?this._pos[2]:n,"number"!=typeof t?this._pos:(this._pos=[t,e,n],void 0!==this.ctx.listener.positionX?(this.ctx.listener.positionX.setTargetAtTime(this._pos[0],Howler.ctx.currentTime,.1),this.ctx.listener.positionY.setTargetAtTime(this._pos[1],Howler.ctx.currentTime,.1),this.ctx.listener.positionZ.setTargetAtTime(this._pos[2],Howler.ctx.currentTime,.1)):this.ctx.listener.setPosition(this._pos[0],this._pos[1],this._pos[2]),this)):this},HowlerGlobal.prototype.orientation=function(t,e,n,r,i,o){if(!this.ctx||!this.ctx.listener)return this;var s=this._orientation;return e="number"!=typeof e?s[1]:e,n="number"!=typeof n?s[2]:n,r="number"!=typeof r?s[3]:r,i="number"!=typeof i?s[4]:i,o="number"!=typeof o?s[5]:o,"number"!=typeof t?s:(this._orientation=[t,e,n,r,i,o],void 0!==this.ctx.listener.forwardX?(this.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),this.ctx.listener.forwardY.setTargetAtTime(e,Howler.ctx.currentTime,.1),this.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),this.ctx.listener.upX.setTargetAtTime(r,Howler.ctx.currentTime,.1),this.ctx.listener.upY.setTargetAtTime(i,Howler.ctx.currentTime,.1),this.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):this.ctx.listener.setOrientation(t,e,n,r,i,o),this)},Howl.prototype.init=(t=Howl.prototype.init,function(e){return this._orientation=e.orientation||[1,0,0],this._stereo=e.stereo||null,this._pos=e.pos||null,this._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},this._onstereo=e.onstereo?[{fn:e.onstereo}]:[],this._onpos=e.onpos?[{fn:e.onpos}]:[],this._onorientation=e.onorientation?[{fn:e.onorientation}]:[],t.call(this,e)}),Howl.prototype.stereo=function(t,n){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"stereo",action:function(){r.stereo(t,n)}}),r;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof t)return r._stereo;r._stereo=t,r._pos=[t,0,0]}for(var o=r._getSoundIds(n),s=0;s<o.length;s++){var a=r._soundById(o[s]);if(a){if("number"!=typeof t)return a._stereo;a._stereo=t,a._pos=[t,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||e(a,i),"spatial"===i?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(t,0,0):a._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),r._emit("stereo",a._id)}}return r},Howl.prototype.pos=function(t,n,r,i){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"pos",action:function(){o.pos(t,n,r,i)}}),o;if(n="number"!=typeof n?0:n,r="number"!=typeof r?-.5:r,void 0===i){if("number"!=typeof t)return o._pos;o._pos=[t,n,r]}for(var s=o._getSoundIds(i),a=0;a<s.length;a++){var l=o._soundById(s[a]);if(l){if("number"!=typeof t)return l._pos;l._pos=[t,n,r],l._node&&(l._panner&&!l._panner.pan||e(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):l._panner.setPosition(t,n,r)),o._emit("pos",l._id)}}return o},Howl.prototype.orientation=function(t,n,r,i){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"orientation",action:function(){o.orientation(t,n,r,i)}}),o;if(n="number"!=typeof n?o._orientation[1]:n,r="number"!=typeof r?o._orientation[2]:r,void 0===i){if("number"!=typeof t)return o._orientation;o._orientation=[t,n,r]}for(var s=o._getSoundIds(i),a=0;a<s.length;a++){var l=o._soundById(s[a]);if(l){if("number"!=typeof t)return l._orientation;l._orientation=[t,n,r],l._node&&(l._panner||(l._pos||(l._pos=o._pos||[0,0,-.5]),e(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):l._panner.setOrientation(t,n,r)),o._emit("orientation",l._id)}}return o},Howl.prototype.pannerAttr=function(){var t,n,r,i=this,o=arguments;if(!i._webAudio)return i;if(0===o.length)return i._pannerAttr;if(1===o.length){if("object"!=typeof o[0])return(r=i._soundById(parseInt(o[0],10)))?r._pannerAttr:i._pannerAttr;t=o[0],void 0===n&&(t.pannerAttr||(t.pannerAttr={coneInnerAngle:t.coneInnerAngle,coneOuterAngle:t.coneOuterAngle,coneOuterGain:t.coneOuterGain,distanceModel:t.distanceModel,maxDistance:t.maxDistance,refDistance:t.refDistance,rolloffFactor:t.rolloffFactor,panningModel:t.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==t.pannerAttr.coneInnerAngle?t.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==t.pannerAttr.coneOuterAngle?t.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==t.pannerAttr.coneOuterGain?t.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==t.pannerAttr.distanceModel?t.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==t.pannerAttr.maxDistance?t.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==t.pannerAttr.refDistance?t.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==t.pannerAttr.rolloffFactor?t.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==t.pannerAttr.panningModel?t.pannerAttr.panningModel:i._panningModel})}else 2===o.length&&(t=o[0],n=parseInt(o[1],10));for(var s=i._getSoundIds(n),a=0;a<s.length;a++)if(r=i._soundById(s[a])){var l=r._pannerAttr;l={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==t.distanceModel?t.distanceModel:l.distanceModel,maxDistance:void 0!==t.maxDistance?t.maxDistance:l.maxDistance,refDistance:void 0!==t.refDistance?t.refDistance:l.refDistance,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:l.rolloffFactor,panningModel:void 0!==t.panningModel?t.panningModel:l.panningModel};var u=r._panner;u?(u.coneInnerAngle=l.coneInnerAngle,u.coneOuterAngle=l.coneOuterAngle,u.coneOuterGain=l.coneOuterGain,u.distanceModel=l.distanceModel,u.maxDistance=l.maxDistance,u.refDistance=l.refDistance,u.rolloffFactor=l.rolloffFactor,u.panningModel=l.panningModel):(r._pos||(r._pos=i._pos||[0,0,-.5]),e(r,"spatial"))}return i},Sound.prototype.init=function(t){return function(){var e=this._parent;this._orientation=e._orientation,this._stereo=e._stereo,this._pos=e._pos,this._pannerAttr=e._pannerAttr,t.call(this),this._stereo?e.stereo(this._stereo):this._pos&&e.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var e=this._parent;return this._orientation=e._orientation,this._stereo=e._stereo,this._pos=e._pos,this._pannerAttr=e._pannerAttr,this._stereo?e.stereo(this._stereo):this._pos?e.pos(this._pos[0],this._pos[1],this._pos[2],this._id):this._panner&&(this._panner.disconnect(0),this._panner=void 0,e._refreshBuffer(this)),t.call(this)}}(Sound.prototype.reset);var e=function(t,e){"spatial"===(e=e||"spatial")?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,void 0!==t._panner.positionX?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),void 0!==t._panner.orientationX?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}}()}).call(this,n(45))},31:function(t,e,n){"use strict";function r(t){return null==t}function i(t){return null!==t&&"object"==typeof t}function o(t){return null!==t&&"object"==typeof t}function s(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function a(t,e){return Array.from(new Set([...Object.keys(t),...Object.keys(e)])).reduce((n,r)=>{const i=t[r],s=e[r];return o(i)&&o(s)?Object.assign(Object.assign({},n),{[r]:a(i,s)}):Object.assign(Object.assign({},n),{[r]:r in e?s:i})},{})}function l(t){return!!i(t)&&"target"in t}n.r(e),n.d(e,"BladeApi",(function(){return tt})),n.d(e,"ButtonApi",(function(){return Gt})),n.d(e,"FolderApi",(function(){return ve})),n.d(e,"ListBladeApi",(function(){return bo})),n.d(e,"ListInputBindingApi",(function(){return Le})),n.d(e,"Pane",(function(){return To})),n.d(e,"Semver",(function(){return Jt})),n.d(e,"SeparatorBladeApi",(function(){return go})),n.d(e,"SliderBladeApi",(function(){return wo})),n.d(e,"SliderInputBindingApi",(function(){return yi})),n.d(e,"TabApi",(function(){return ke})),n.d(e,"TabPageApi",(function(){return Te})),n.d(e,"TextBladeApi",(function(){return _o})),n.d(e,"TpChangeEvent",(function(){return nt})),n.d(e,"VERSION",(function(){return Bo}));const u={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:t=>`Not compatible with  plugin '${t.id}'`,propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class c{static alreadyDisposed(){return new c({type:"alreadydisposed"})}static notBindable(){return new c({type:"notbindable"})}static notCompatible(t,e){return new c({type:"notcompatible",context:{id:`${t}.${e}`}})}static propertyNotFound(t){return new c({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new c({type:"shouldneverhappen"})}constructor(t){var e;this.message=null!==(e=u[t.type](t.context))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}toString(){return this.message}}class d{constructor(t,e){this.obj_=t,this.key=e}static isBindable(t){return null!==t&&("object"==typeof t||"function"==typeof t)}read(){return this.obj_[this.key]}write(t){this.obj_[this.key]=t}writeProperty(t,e){const n=this.read();if(!d.isBindable(n))throw c.notBindable();if(!(t in n))throw c.propertyNotFound(t);n[t]=e}}class h{constructor(){this.observers_={}}on(t,e,n){var r;let i=this.observers_[t];return i||(i=this.observers_[t]=[]),i.push({handler:e,key:null!==(r=null==n?void 0:n.key)&&void 0!==r?r:e}),this}off(t,e){const n=this.observers_[t];return n&&(this.observers_[t]=n.filter(t=>t.key!==e)),this}emit(t,e){const n=this.observers_[t];n&&n.forEach(t=>{t.handler(e)})}}class p{constructor(t,e){var n;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(n=null==e?void 0:e.equals)&&void 0!==n?n:(t,e)=>t===e,this.emitter=new h,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const n=null!=e?e:{forceEmit:!1,last:!0},r=this.constraint_?this.constraint_.constrain(t):t,i=this.rawValue_;(!this.equals_(i,r)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=r,this.emitter.emit("change",{options:n,previousRawValue:i,rawValue:r,sender:this}))}}class f{constructor(t){this.emitter=new h,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const n=null!=e?e:{forceEmit:!1,last:!0},r=this.value_;(r!==t||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:n,previousRawValue:r,rawValue:this.value_,sender:this}))}}class v{constructor(t){this.emitter=new h,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function m(t,e){const n=null==e?void 0:e.constraint,r=null==e?void 0:e.equals;return n||r?new p(t,e):new f(t)}class b{constructor(t){this.emitter=new h,this.valMap_=t;for(const t in this.valMap_){this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}}static createCore(t){return Object.keys(t).reduce((e,n)=>Object.assign(e,{[n]:m(t[n])}),{})}static fromObject(t){const e=this.createCore(t);return new b(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}class g{constructor(t){this.values=b.fromObject({max:t.max,min:t.min})}constrain(t){const e=this.values.get("max"),n=this.values.get("min");return Math.min(Math.max(t,n),e)}}class w{constructor(t){this.values=b.fromObject({max:t.max,min:t.min})}constrain(t){const e=this.values.get("max"),n=this.values.get("min");let i=t;return r(n)||(i=Math.max(i,n)),r(e)||(i=Math.min(i,e)),i}}class _{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){const e=this.origin%this.step;return e+Math.round((t-e)/this.step)*this.step}}class y{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const x={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class A{constructor(t,e,n){this.left=e,this.operator=t,this.right=n}evaluate(){const t=x[this.operator];if(!t)throw new Error("unexpected binary operator: '"+this.operator);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const E={"+":t=>t,"-":t=>-t,"~":t=>~t};class C{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=E[this.operator];if(!t)throw new Error("unexpected unary operator: '"+this.operator);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function M(t){return(e,n)=>{for(let r=0;r<t.length;r++){const i=t[r](e,n);if(""!==i)return i}return""}}function P(t,e){var n;const r=t.substr(e).match(/^\s+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function S(t,e){var n;const r=t.substr(e).match(/^[0-9]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function k(t,e){const n=t.substr(e,1);if(e+=1,"e"!==n.toLowerCase())return"";const r=function(t,e){const n=S(t,e);if(""!==n)return n;const r=t.substr(e,1);if("-"!==r&&"+"!==r)return"";const i=S(t,e+=1);return""===i?"":r+i}(t,e);return""===r?"":n+r}function T(t,e){const n=t.substr(e,1);if("0"===n)return n;const r=function(t,e){const n=t.substr(e,1);return n.match(/^[1-9]$/)?n:""}(t,e);return e+=r.length,""===r?"":r+S(t,e)}const B=M([function(t,e){const n=T(t,e);if(e+=n.length,""===n)return"";const r=t.substr(e,1);if(e+=r.length,"."!==r)return"";const i=S(t,e);return n+r+i+k(t,e+=i.length)},function(t,e){const n=t.substr(e,1);if(e+=n.length,"."!==n)return"";const r=S(t,e);return e+=r.length,""===r?"":n+r+k(t,e)},function(t,e){const n=T(t,e);return e+=n.length,""===n?"":n+k(t,e)}]);const F=M([function(t,e){const n=t.substr(e,2);if(e+=n.length,"0b"!==n.toLowerCase())return"";const r=function(t,e){var n;const r=t.substr(e).match(/^[01]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}(t,e);return""===r?"":n+r},function(t,e){const n=t.substr(e,2);if(e+=n.length,"0o"!==n.toLowerCase())return"";const r=function(t,e){var n;const r=t.substr(e).match(/^[0-7]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}(t,e);return""===r?"":n+r},function(t,e){const n=t.substr(e,2);if(e+=n.length,"0x"!==n.toLowerCase())return"";const r=function(t,e){var n;const r=t.substr(e).match(/^[0-9a-f]+/i);return null!==(n=r&&r[0])&&void 0!==n?n:""}(t,e);return""===r?"":n+r}]),V=M([F,B]);function I(t,e){var n;return null!==(n=function(t,e){const n=V(t,e);return e+=n.length,""===n?null:{evaluable:new y(n),cursor:e}}(t,e))&&void 0!==n?n:function(t,e){const n=t.substr(e,1);if(e+=n.length,"("!==n)return null;const r=R(t,e);if(!r)return null;e=r.cursor,e+=P(t,e).length;const i=t.substr(e,1);return e+=i.length,")"!==i?null:{evaluable:r.evaluable,cursor:e}}(t,e)}function z(t,e,n){n+=P(e,n).length;const r=t.filter(t=>e.startsWith(t,n))[0];return r?(n+=r.length,{cursor:n+=P(e,n).length,operator:r}):null}const L=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((t,e)=>function(t,e){return(n,r)=>{const i=t(n,r);if(!i)return null;r=i.cursor;let o=i.evaluable;for(;;){const i=z(e,n,r);if(!i)break;r=i.cursor;const s=t(n,r);if(!s)return null;r=s.cursor,o=new A(i.operator,o,s.evaluable)}return o?{cursor:r,evaluable:o}:null}}(t,e),(function t(e,n){const r=I(e,n);if(r)return r;const i=e.substr(n,1);if(n+=i.length,"+"!==i&&"-"!==i&&"~"!==i)return null;const o=t(e,n);return o?{cursor:n=o.cursor,evaluable:new C(i,o.evaluable)}:null}));function R(t,e){return e+=P(t,e).length,L(t,e)}function O(t){var e;const n=function(t){const e=R(t,0);return e?e.cursor+P(t,e.cursor).length!==t.length?null:e.evaluable:null}(t);return null!==(e=null==n?void 0:n.evaluate())&&void 0!==e?e:null}function q(t){if("number"==typeof t)return t;if("string"==typeof t){const e=O(t);if(!r(e))return e}return 0}function j(t){return String(t)}function N(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}function D(t,e,n,r,i){return r+(t-e)/(n-e)*(i-r)}function W(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function U(t,e,n){return Math.min(Math.max(t,e),n)}function H(t,e){return(t%e+e)%e}function G(t,e){return r(t.step)?Math.max(W(e),2):W(t.step)}function K(t){var e;return null!==(e=t.step)&&void 0!==e?e:1}function $(t,e){var n;const r=Math.abs(null!==(n=t.step)&&void 0!==n?n:e);return 0===r?.1:Math.pow(10,Math.floor(Math.log10(r))-1)}function Y(t,e){return r(t.step)?null:new _(t.step,e)}function X(t){return r(t.max)||r(t.min)?r(t.max)&&r(t.min)?null:new w({max:t.max,min:t.min}):new g({max:t.max,min:t.min})}function Z(t,e){var n,r,i;return{formatter:null!==(n=t.format)&&void 0!==n?n:N(G(t,e)),keyScale:null!==(r=t.keyScale)&&void 0!==r?r:K(t),pointerScale:null!==(i=t.pointerScale)&&void 0!==i?i:$(t,e)}}function Q(t){return{format:t.optional.function,keyScale:t.optional.number,max:t.optional.number,min:t.optional.number,pointerScale:t.optional.number,step:t.optional.number}}function J(t){return{constraint:t.constraint,textProps:b.fromObject(Z(t.params,t.initialValue))}}class tt{constructor(t){this.controller=t}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(t){this.controller.viewProps.set("disabled",t)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(t){this.controller.viewProps.set("hidden",t)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(t){return this.controller.importState(t)}exportState(){return this.controller.exportState()}}class et{constructor(t){this.target=t}}class nt extends et{constructor(t,e,n){super(t),this.value=e,this.last=null==n||n}}class rt extends et{constructor(t,e){super(t),this.expanded=e}}class it extends et{constructor(t,e){super(t),this.index=e}}class ot extends et{constructor(t,e){super(t),this.native=e}}class st extends tt{constructor(t){super(t),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new h,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(t){this.controller.tag=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,t=>{n(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}refresh(){this.controller.value.fetch()}onValueChange_(t){const e=this.controller.value;this.emitter_.emit("change",new nt(this,e.binding.target.read(),t.options.last))}}class at{constructor(t,e){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e,this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new h}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function lt(t){return e=>n=>{if(!e&&void 0===n)return{succeeded:!1,value:void 0};if(e&&void 0===n)return{succeeded:!0,value:void 0};const r=t(n);return void 0!==r?{succeeded:!0,value:r}:{succeeded:!1,value:void 0}}}function ut(t){return{custom:e=>lt(e)(t),boolean:lt(t=>"boolean"==typeof t?t:void 0)(t),number:lt(t=>"number"==typeof t?t:void 0)(t),string:lt(t=>"string"==typeof t?t:void 0)(t),function:lt(t=>"function"==typeof t?t:void 0)(t),constant:e=>lt(t=>t===e?e:void 0)(t),raw:lt(t=>t)(t),object:e=>lt(t=>{var n;if(null!==(n=t)&&"object"==typeof n)return function(t,e){return Object.keys(e).reduce((n,r)=>{if(void 0===n)return;const i=(0,e[r])(t[r]);return i.succeeded?Object.assign(Object.assign({},n),{[r]:i.value}):void 0},{})}(t,e)})(t),array:e=>lt(t=>{var n;if(Array.isArray(t))return n=e,t.reduce((t,e)=>{if(void 0===t)return;const r=n(e);return r.succeeded&&void 0!==r.value?[...t,r.value]:void 0},[])})(t)}}const ct={optional:ut(!0),required:ut(!1)};function dt(t,e){const n=e(ct),r=ct.required.object(n)(t);return r.succeeded?r.value:void 0}function ht(t,e,n,r){if(e&&!e(t))return!1;const i=dt(t,n);return!!i&&r(i)}function pt(t,e){var n;return a(null!==(n=null==t?void 0:t())&&void 0!==n?n:{},e)}function ft(t){return"value"in t}function vt(t){if(!i(t)||!("binding"in t))return!1;return l(t.binding)}const mt="http://www.w3.org/2000/svg";function bt(t){t.offsetHeight}function gt(t){return void 0!==t.ontouchstart}function wt(){return globalThis.document}const _t={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function yt(t,e){const n=t.createElementNS(mt,"svg");return n.innerHTML=_t[e],n}function xt(t,e,n){t.insertBefore(e,t.children[n])}function At(t){t.parentElement&&t.parentElement.removeChild(t)}function Et(t){for(;t.children.length>0;)t.removeChild(t.children[0])}function Ct(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}function Mt(t,e){t.emitter.on("change",t=>{e(t.rawValue)}),e(t.rawValue)}function Pt(t,e,n){Mt(t.value(e),n)}const St="tp";function kt(t){return(e,n)=>[St,"-",t,"v",e?"_"+e:"",n?"-"+n:""].join("")}const Tt=kt("lbl");class Bt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Tt()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Tt("l")),Pt(e.props,"label",e=>{r(e)?this.element.classList.add(Tt(void 0,"nol")):(this.element.classList.remove(Tt(void 0,"nol")),function(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}(n),n.appendChild(function(t,e){const n=t.createDocumentFragment();return e.split("\n").map(e=>t.createTextNode(e)).forEach((e,r)=>{r>0&&n.appendChild(t.createElement("br")),n.appendChild(e)}),n}(t,e)))}),this.element.appendChild(n),this.labelElement=n;const i=t.createElement("div");i.classList.add(Tt("v")),this.element.appendChild(i),this.valueElement=i}}class Ft{constructor(t,e){this.props=e.props,this.valueController=e.valueController,this.viewProps=e.valueController.viewProps,this.view=new Bt(t,{props:e.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(t){return ht(t,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return pt(null,{label:this.props.get("label")})}}const Vt=kt(""),It={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class zt{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(t=>{e.classList.remove(Vt(void 0,It[t]))}),this.blade.get("positions").forEach(t=>{e.classList.add(Vt(void 0,It[t]))})}),this.viewProps.handleDispose(()=>{At(e)})}get parent(){return this.parent_}set parent(t){this.parent_=t,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(t){return ht(t,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return pt(null,Object.assign({},this.viewProps.exportState()))}}class Lt extends zt{constructor(t,e){if(e.value!==e.valueController.value)throw c.shouldNeverHappen();const n=e.valueController.viewProps,r=new Ft(t,{blade:e.blade,props:e.props,valueController:e.valueController});super(Object.assign(Object.assign({},e),{view:new Bt(t,{props:e.props,viewProps:n}),viewProps:n})),this.labelController=r,this.value=e.value,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(t){return ht(t,e=>{var n,r,i;return super.importState(e)&&this.labelController.importProps(e)&&(null===(i=null===(r=(n=this.valueController).importProps)||void 0===r?void 0:r.call(n,t))||void 0===i||i)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var t,e,n;return pt(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),null!==(n=null===(e=(t=this.valueController).exportProps)||void 0===e?void 0:e.call(t))&&void 0!==n?n:{}))}}function Rt(t){const e=Object.assign({},t);return delete e.value,e}class Ot extends Lt{constructor(t,e){super(t,e),this.tag=e.tag}importState(t){return ht(t,e=>super.importState(Rt(t)),t=>({tag:t.optional.string}),t=>(this.tag=t.tag,!0))}exportState(){return pt(()=>Rt(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}class qt extends Ot{importState(t){return ht(t,t=>super.importState(t),t=>({binding:t.required.object({value:t.required.raw})}),t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0))}}function jt(t){return ft(t)&&function(t){if(!("binding"in t))return!1;const e=t.binding;return l(e)&&"read"in e&&"write"in e}(t.value)}function Nt(t,e){for(;t.length<e;)t.push(void 0)}function Dt(t){const e=t.indexOf(void 0);return e<0?t:t.slice(0,e)}class Wt{constructor(t){this.emitter=new h,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t.binding,this.value_=m(function(t){const e=[];return Nt(e,t),e}(t.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=function(t,e){const n=[...Dt(t),e];return n.length>t.length?n.splice(0,n.length-t.length):Nt(n,t.length),n}(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}class Ut extends Ot{exportState(){return pt(()=>super.exportState(),{binding:{readonly:!0}})}}function Ht(t){return ft(t)&&function(t){if(!("binding"in t))return!1;const e=t.binding;return l(e)&&"read"in e&&!("write"in e)}(t.value)}class Gt extends tt{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get title(){var t;return null!==(t=this.controller.buttonController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.buttonController.props.set("title",t)}on(t,e){const n=e.bind(this);return this.controller.buttonController.emitter.on(t,t=>{n(new ot(this,t.nativeEvent))}),this}off(t,e){return this.controller.buttonController.emitter.off(t,e),this}}function Kt(t,e){return n=>{!function(t,e,n){n?t.classList.add(e):t.classList.remove(e)}(t,e,n)}}function $t(t,e){Mt(t,t=>{e.textContent=null!=t?t:""})}const Yt=kt("btn");class Xt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Yt()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("button");n.classList.add(Yt("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const r=t.createElement("div");r.classList.add(Yt("t")),$t(e.props.value("title"),r),this.buttonElement.appendChild(r)}}class Zt{constructor(t,e){this.emitter=new h,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new Xt(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(t){return ht(t,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return pt(null,{title:this.props.get("title")})}onClick_(t){this.emitter.emit("click",{nativeEvent:t,sender:this})}}class Qt extends zt{constructor(t,e){const n=new Zt(t,{props:e.buttonProps,viewProps:e.viewProps}),r=new Ft(t,{blade:e.blade,props:e.labelProps,valueController:n});super({blade:e.blade,view:r.view,viewProps:e.viewProps}),this.buttonController=n,this.labelController=r}importState(t){return ht(t,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return pt(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class Jt{constructor(t){const[e,n]=t.split("-"),r=e.split(".");this.major=parseInt(r[0],10),this.minor=parseInt(r[1],10),this.patch=parseInt(r[2],10),this.prerelease=null!=n?n:null}toString(){const t=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[t,this.prerelease].join("-"):t}}const te=new Jt("2.0.3");function ee(t){return Object.assign({core:te},t)}const ne=ee({id:"button",type:"blade",accept(t){const e=dt(t,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller:t=>new Qt(t.document,{blade:t.blade,buttonProps:b.fromObject({title:t.params.title}),labelProps:b.fromObject({label:t.params.label}),viewProps:t.viewProps}),api:t=>t.controller instanceof Qt?new Gt(t.controller):null});class re{constructor(t,e){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=t,this.emitter_=new h,this.pool_=e;this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(t=>this.pool_.createApi(t))}addBinding(t,e,n){const r=null!=n?n:{},i=this.controller_.element.ownerDocument,o=this.pool_.createBinding(i,function(t,e){if(!d.isBindable(t))throw c.notBindable();return new d(t,e)}(t,e),r),s=this.pool_.createBindingApi(o);return this.add(s,r.index)}addFolder(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}(this,t)}addButton(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}(this,t)}addTab(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}(this,t)}add(t,e){const n=t.controller;return this.controller_.rack.add(n,e),t}remove(t){this.controller_.rack.remove(t.controller)}addBlade(t){const e=this.controller_.element.ownerDocument,n=this.pool_.createBlade(e,t),r=this.pool_.createApi(n);return this.add(r,t.index)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,t=>{n(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}refresh(){this.children.forEach(t=>{var e;i(e=t)&&"refresh"in e&&"function"==typeof e.refresh&&t.refresh()})}onRackValueChange_(t){const e=t.bladeController,n=this.pool_.createApi(e),r=vt(e.value)?e.value.binding:null;this.emitter_.emit("change",new nt(n,r?r.target.read():e.value.rawValue,t.options.last))}}class ie extends tt{constructor(t,e){super(t),this.rackApi_=new re(t.rackController,e)}refresh(){this.rackApi_.refresh()}}class oe extends zt{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}importState(t){return ht(t,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((e,n)=>e.importState(t.children[n])))}exportState(){return pt(()=>super.exportState(),{children:this.rackController.rack.children.map(t=>t.exportState())})}}function se(t){return"rackController"in t}class ae{constructor(t){this.emitter=new h,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw c.shouldNeverHappen();const n=void 0!==e?e:this.items_.length;this.items_.splice(n,0,t),this.cache_.add(t);const r=this.extract_(t);r&&(r.emitter.on("add",this.onSubListAdd_),r.emitter.on("remove",this.onSubListRemove_),r.allItems().forEach(t=>{this.cache_.add(t)})),this.emitter.emit("add",{index:n,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);const n=this.extract_(t);n&&(n.allItems().forEach(t=>{this.cache_.delete(t)}),n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}function le(t){return se(t)?t.rackController.rack.bcSet_:null}class ue{constructor(t){var e,n;this.emitter=new h,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=null!==(e=t.blade)&&void 0!==e?e:null,null===(n=this.blade_)||void 0===n||n.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=t.viewProps,this.bcSet_=new ae(le),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){var n;null===(n=t.parent)||void 0===n||n.remove(t),t.parent=this,this.bcSet_.add(t,e)}remove(t){t.parent=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(t)}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,root:e,sender:this}),!e)return;const n=t.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),ft(n))n.value.emitter.on("change",this.onChildValueChange_);else if(se(n)){const t=n.rackController.rack;if(t){const e=t.emitter;e.on("layout",this.onRackLayout_),e.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,root:e,sender:this}),!e)return;const n=t.item;if(ft(n))n.value.emitter.off("change",this.onChildValueChange_);else if(se(n)){const t=n.rackController.rack;if(t){const e=t.emitter;e.off("layout",this.onRackLayout_),e.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const t=this.bcSet_.items.filter(t=>!t.viewProps.get("hidden")),e=t[0],n=t[t.length-1];this.bcSet_.items.forEach(t=>{const r=[];t===e&&(r.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||r.push("veryfirst")),t===n&&(r.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||r.push("verylast")),t.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(t){const e=function(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(ft(r)&&r.value===e)return r}return null}(this.find(ft),t.sender);if(!e)throw c.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:e,options:t.options,sender:this})}onRackLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(t){this.emitter.emit("valuechange",{bladeController:t.bladeController,options:t.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class ce{constructor(t){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=t.element,this.viewProps=t.viewProps;const e=new ue({blade:t.root?void 0:t.blade,viewProps:t.viewProps});e.emitter.on("add",this.onRackAdd_),e.emitter.on("remove",this.onRackRemove_),this.rack=e,this.viewProps.handleDispose(()=>{for(let t=this.rack.children.length-1;t>=0;t--){this.rack.children[t].viewProps.set("disposed",!0)}})}onRackAdd_(t){t.root&&xt(this.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.root&&At(t.bladeController.view.element)}}function de(){return new b({positions:m([],{equals:s})})}class he extends b{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=b.createCore(e);return new he(n)}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!r(t)?t+"px":"auto"}bindExpandedClass(t,e){const n=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};Pt(this,"expanded",n),Pt(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function pe(t,e){e.style.height=t.styleHeight}function fe(t,e){t.value("expanded").emitter.on("beforechange",()=>{if(t.set("completed",!1),r(t.get("expandedHeight"))){const n=function(t,e){let n=0;return function(t,e){const n=t.style.transition;t.style.transition="none",e(),t.style.transition=n}(e,()=>{t.set("expandedHeight",null),t.set("temporaryExpanded",!0),bt(e),n=e.clientHeight,t.set("temporaryExpanded",null),bt(e)}),n}(t,e);n>0&&t.set("expandedHeight",n)}t.set("shouldFixHeight",!0),bt(e)}),t.emitter.on("change",()=>{pe(t,e)}),pe(t,e),e.addEventListener("transitionend",e=>{"height"===e.propertyName&&t.cleanUpTransition()})}class ve extends ie{constructor(t,e){super(t,e),this.emitter_=new h,this.controller.foldable.value("expanded").emitter.on("change",t=>{this.emitter_.emit("fold",new rt(this,t.sender.rawValue))}),this.rackApi_.on("change",t=>{this.emitter_.emit("change",t)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(t){this.controller.foldable.set("expanded",t)}get title(){return this.controller.props.get("title")}set title(t){this.controller.props.set("title",t)}get children(){return this.rackApi_.children}addBinding(t,e,n){return this.rackApi_.addBinding(t,e,n)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,t=>{n(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}const me=kt("cnt");class be{constructor(t,e){var n;this.className_=kt(null!==(n=e.viewName)&&void 0!==n?n:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),me()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Pt(this.foldable_,"completed",Kt(this.element,this.className_(void 0,"cpl")));const i=t.createElement("button");i.classList.add(this.className_("b")),Pt(e.props,"title",t=>{r(t)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const o=t.createElement("div");o.classList.add(this.className_("i")),this.element.appendChild(o);const s=t.createElement("div");s.classList.add(this.className_("t")),$t(e.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s;const a=t.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);const l=t.createElement("div");l.classList.add(this.className_("c")),this.element.appendChild(l),this.containerElement=l}}class ge extends oe{constructor(t,e){var n;const r=he.create(null===(n=e.expanded)||void 0===n||n),i=new be(t,{foldable:r,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new ce({blade:e.blade,element:i.containerElement,root:e.root,viewProps:e.viewProps}),view:i})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=r,fe(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(t){return ht(t,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return pt(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const we=ee({id:"folder",type:"blade",accept(t){const e=dt(t,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller:t=>new ge(t.document,{blade:t.blade,expanded:t.params.expanded,props:b.fromObject({title:t.params.title}),viewProps:t.viewProps}),api:t=>t.controller instanceof ge?new ve(t.controller,t.pool):null}),_e=kt("");function ye(t,e){return Kt(t,_e(void 0,e))}class xe extends b{constructor(t){var e,n;super(t),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=(n=m(this.getGlobalDisabled_()),[new v(n),(t,e)=>{n.setRawValue(t,e)}]),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(t){var e,n,r;const i=null!=t?t:{};return new xe(b.createCore({disabled:null!==(e=i.disabled)&&void 0!==e&&e,disposed:!1,hidden:null!==(n=i.hidden)&&void 0!==n&&n,parent:null!==(r=i.parent)&&void 0!==r?r:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(t){Mt(this.globalDisabled_,ye(t,"disabled")),Pt(this,"hidden",ye(t,"hidden"))}bindDisabled(t){Mt(this.globalDisabled_,e=>{t.disabled=e})}bindTabIndex(t){Mt(this.globalDisabled_,e=>{t.tabIndex=e?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",e=>{e&&t()})}importState(t){this.set("disabled",t.disabled),this.set("hidden",t.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const t=this.get("parent");return!!t&&t.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(t){var e;const n=t.previousRawValue;null==n||n.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const Ae=kt("tbp");class Ee{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ae()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Ae("c")),this.element.appendChild(n),this.containerElement=n}}const Ce=kt("tbi");class Me{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ce()),e.viewProps.bindClassModifiers(this.element),Pt(e.props,"selected",t=>{t?this.element.classList.add(Ce(void 0,"sel")):this.element.classList.remove(Ce(void 0,"sel"))});const n=t.createElement("button");n.classList.add(Ce("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const r=t.createElement("div");r.classList.add(Ce("t")),$t(e.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r}}class Pe{constructor(t,e){this.emitter=new h,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new Me(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Se extends oe{constructor(t,e){const n=new Ee(t,{viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new ce({blade:e.blade,element:n.containerElement,viewProps:e.viewProps}),view:n})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Pe(t,{props:e.itemProps,viewProps:xe.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=e.props,Pt(this.props,"selected",t=>{this.itemController.props.set("selected",t),this.viewProps.set("hidden",!t)})}get itemController(){return this.ic_}importState(t){return ht(t,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return pt(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class ke extends ie{constructor(t,e){super(t,e),this.emitter_=new h,this.onSelect_=this.onSelect_.bind(this),this.pool_=e,this.rackApi_.on("change",t=>{this.emitter_.emit("change",t)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(t){const e=this.controller.view.element.ownerDocument,n=new Se(e,{blade:de(),itemProps:b.fromObject({selected:!1,title:t.title}),props:b.fromObject({selected:!1}),viewProps:xe.create()}),r=this.pool_.createApi(n);return this.rackApi_.add(r,t.index)}removePage(t){this.rackApi_.remove(this.rackApi_.children[t])}on(t,e){const n=e.bind(this);return this.emitter_.on(t,t=>{n(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}onSelect_(t){this.emitter_.emit("select",new it(this,t.rawValue))}}class Te extends ie{get title(){var t;return null!==(t=this.controller.itemController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.itemController.props.set("title",t)}get selected(){return this.controller.props.get("selected")}set selected(t){this.controller.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBinding(t,e,n){return this.rackApi_.addBinding(t,e,n)}addBlade(t){return this.rackApi_.addBlade(t)}}class Be{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=m(!0),this.selectedIndex=m(-1),this.items_=[]}add(t,e){const n=null!=e?e:this.items_.length;this.items_.splice(n,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){const e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const t=this.items_.findIndex(t=>t.rawValue);t<0?(this.items_.forEach((t,e)=>{t.rawValue=0===e}),this.selectedIndex.rawValue=0):(this.items_.forEach((e,n)=>{e.rawValue=n===t}),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){const e=this.items_.findIndex(e=>e===t.sender);this.items_.forEach((t,n)=>{t.rawValue=n===e}),this.selectedIndex.rawValue=e}else this.keepSelection_()}}const Fe=kt("tab");class Ve{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Fe(),me()),e.viewProps.bindClassModifiers(this.element),Mt(e.empty,Kt(this.element,Fe(void 0,"nop")));const n=t.createElement("div");n.classList.add(Fe("t")),this.element.appendChild(n),this.itemsElement=n;const r=t.createElement("div");r.classList.add(Fe("i")),this.element.appendChild(r);const i=t.createElement("div");i.classList.add(Fe("c")),this.element.appendChild(i),this.contentsElement=i}}class Ie extends oe{constructor(t,e){const n=new Be,r=new Ve(t,{empty:n.empty,viewProps:e.viewProps});super({blade:e.blade,rackController:new ce({blade:e.blade,element:r.contentsElement,viewProps:e.viewProps}),view:r}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const i=this.rackController.rack;i.emitter.on("add",this.onRackAdd_),i.emitter.on("remove",this.onRackRemove_),this.tab=n}add(t,e){this.rackController.rack.add(t,e)}remove(t){this.rackController.rack.remove(this.rackController.rack.children[t])}onRackAdd_(t){if(!t.root)return;const e=t.bladeController;xt(this.view.itemsElement,e.itemController.view.element,t.index),e.itemController.viewProps.set("parent",this.viewProps),this.tab.add(e.props.value("selected"))}onRackRemove_(t){if(!t.root)return;const e=t.bladeController;At(e.itemController.view.element),e.itemController.viewProps.set("parent",null),this.tab.remove(e.props.value("selected"))}}const ze=ee({id:"tab",type:"blade",accept(t){const e=dt(t,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return e&&0!==e.pages.length?{params:e}:null},controller(t){const e=new Ie(t.document,{blade:t.blade,viewProps:t.viewProps});return t.params.pages.forEach(n=>{const r=new Se(t.document,{blade:de(),itemProps:b.fromObject({selected:!1,title:n.title}),props:b.fromObject({selected:!1}),viewProps:xe.create()});e.add(r)}),e},api:t=>t.controller instanceof Ie?new ke(t.controller,t.pool):t.controller instanceof Se?new Te(t.controller,t.pool):null});class Le extends st{get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}}class Re{constructor(){this.disabled=!1,this.emitter=new h}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Oe{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new h,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class qe{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((t,e)=>e.constrain(t),t)}}function je(t,e){if(t instanceof e)return t;if(t instanceof qe){const n=t.constraints.reduce((t,n)=>t||(n instanceof e?n:null),null);if(n)return n}return null}class Ne{constructor(t){this.values=b.fromObject({options:t})}constrain(t){const e=this.values.get("options");if(0===e.length)return t;return e.filter(e=>e.value===t).length>0?t:e[0].value}}function De(t){var e;const n=ct;return Array.isArray(t)?null===(e=dt({items:t},t=>({items:t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))})))||void 0===e?void 0:e.items:"object"==typeof t?n.required.raw(t).value:void 0}function We(t){if(Array.isArray(t))return t;const e=[];return Object.keys(t).forEach(n=>{e.push({text:n,value:t[n]})}),e}function Ue(t){return r(t)?null:new Ne(We(t))}const He=kt("lst");class Ge{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(He()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("select");n.classList.add(He("s")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const r=t.createElement("div");r.classList.add(He("m")),r.appendChild(yt(t,"dropdown")),this.element.appendChild(r),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,Pt(this.props_,"options",e=>{Et(this.selectElement),e.forEach(e=>{const n=t.createElement("option");n.textContent=e.text,this.selectElement.appendChild(n)}),this.update_()})}update_(){const t=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Ke{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Ge(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const e=t.currentTarget;this.value.rawValue=this.props.get("options")[e.selectedIndex].value}importProps(t){return ht(t,null,t=>({options:t.required.custom(De)}),t=>(this.props.set("options",We(t.options)),!0))}exportProps(){return pt(null,{options:this.props.get("options")})}}const $e=kt("pop");class Ye{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add($e()),e.viewProps.bindClassModifiers(this.element),Mt(e.shows,Kt(this.element,$e(void 0,"v")))}}class Xe{constructor(t,e){this.shows=m(!1),this.viewProps=e.viewProps,this.view=new Ye(t,{shows:this.shows,viewProps:this.viewProps})}}const Ze=kt("txt");class Qe{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Ze()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const n=t.createElement("input");n.classList.add(Ze("i")),n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class Je{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Qe(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget.value,n=this.parser_(e);r(n)||(this.value.rawValue=n),this.view.refresh()}}function tn(t){return"false"!==t&&!!t}function en(t){return function(t){return String(t)}(t)}const nn=N(0);function rn(t){return nn(t)+"%"}function on(t){return String(t)}function sn(t){return t}function an({primary:t,secondary:e,forward:n,backward:r}){let i=!1;function o(t){i||(i=!0,t(),i=!1)}t.emitter.on("change",r=>{o(()=>{e.setRawValue(n(t.rawValue,e.rawValue),r.options)})}),e.emitter.on("change",i=>{o(()=>{t.setRawValue(r(t.rawValue,e.rawValue),i.options)}),o(()=>{e.setRawValue(n(t.rawValue,e.rawValue),i.options)})}),o(()=>{e.setRawValue(n(t.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function ln(t,e){const n=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+n:e.downKey?-n:0}function un(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function cn(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function dn(t){return function(t){return"ArrowUp"===t||"ArrowDown"===t}(t)||"ArrowLeft"===t||"ArrowRight"===t}function hn(t,e){var n,r;const i=e.ownerDocument.defaultView,o=e.getBoundingClientRect();return{x:t.pageX-((null!==(n=i&&i.scrollX)&&void 0!==n?n:0)+o.left),y:t.pageY-((null!==(r=i&&i.scrollY)&&void 0!==r?r:0)+o.top)}}class pn{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new h,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(hn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(hn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(hn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const n=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,r=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-r.left,y:n.clientY-r.top}:void 0),sender:this,shiftKey:t.shiftKey})}}const fn=kt("txt");class vn{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(fn(),fn(void 0,"num")),e.arrayPosition&&this.element.classList.add(fn(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("input");n.classList.add(fn("i")),n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(fn()),this.inputElement.classList.add(fn("i"));const r=t.createElement("div");r.classList.add(fn("k")),this.element.appendChild(r),this.knobElement=r;const i=t.createElementNS(mt,"svg");i.classList.add(fn("g")),this.knobElement.appendChild(i);const o=t.createElementNS(mt,"path");o.classList.add(fn("gb")),i.appendChild(o),this.guideBodyElem_=o;const s=t.createElementNS(mt,"path");s.classList.add(fn("gh")),i.appendChild(s),this.guideHeadElem_=s;const a=t.createElement("div");a.classList.add(kt("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(null===t.rawValue)return void this.element.classList.remove(fn(void 0,"drg"));this.element.classList.add(fn(void 0,"drg"));const e=t.rawValue/this.props_.get("pointerScale"),n=e+(e>0?-1:e<0?1:0),r=U(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+r},0 L${n},4 L${n+r},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const i=this.props_.get("formatter");this.tooltipElem_.textContent=i(this.value.rawValue),this.tooltipElem_.style.left=e+"px"}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class mn{constructor(t,e){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=e.parser,this.props=e.props,this.sliderProps_=null!==(n=e.sliderProps)&&void 0!==n?n:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=m(null),this.view=new vn(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const r=new pn(this.view.knobElement);r.emitter.on("down",this.onPointerDown_),r.emitter.on("move",this.onPointerMove_),r.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,n;const r=null===(e=this.sliderProps_)||void 0===e?void 0:e.get("min"),i=null===(n=this.sliderProps_)||void 0===n?void 0:n.get("max");let o=t;return void 0!==r&&(o=Math.max(o,r)),void 0!==i&&(o=Math.min(o,i)),o}onInputChange_(t){const e=t.currentTarget.value,n=this.parser_(e);r(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}onInputKeyDown_(t){const e=ln(this.props.get("keyScale"),un(t));0!==e&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==ln(this.props.get("keyScale"),un(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("pointerScale"))}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const bn=kt("sld");class gn{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(bn()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(bn("t")),e.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const r=t.createElement("div");r.classList.add(bn("k")),this.trackElement.appendChild(r),this.knobElement=r,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){const t=U(D(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=t+"%"}onChange_(){this.update_()}}class wn{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new gn(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new pn(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(D(U(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("min"),this.props.get("max")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=ln(this.props.get("keyScale"),cn(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){0!==ln(this.props.get("keyScale"),cn(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const _n=kt("sldtxt");class yn{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(_n());const n=t.createElement("div");n.classList.add(_n("s")),this.sliderView_=e.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const r=t.createElement("div");r.classList.add(_n("t")),this.textView_=e.textView,r.appendChild(this.textView_.element),this.element.appendChild(r)}}class xn{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new wn(t,{props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new mn(t,{parser:e.parser,props:e.textProps,sliderProps:e.sliderProps,value:e.value,viewProps:e.viewProps}),this.view=new yn(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(t){return ht(t,null,t=>({max:t.required.number,min:t.required.number}),t=>{const e=this.sliderC_.props;return e.set("max",t.max),e.set("min",t.min),!0})}exportProps(){const t=this.sliderC_.props;return pt(null,{max:t.get("max"),min:t.get("min")})}}function An(t){return{sliderProps:new b({keyScale:t.keyScale,max:t.max,min:t.min}),textProps:new b({formatter:m(t.formatter),keyScale:t.keyScale,pointerScale:m(t.pointerScale)})}}const En={containerUnitSize:"cnt-usz"};function Cn(t){return"--"+En[t]}function Mn(t){return Q(t)}function Pn(t){if(o(t))return dt(t,Mn)}function Sn(t,e){if(!t)return;const n=[],r=Y(t,e);r&&n.push(r);const i=X(t);return i&&n.push(i),new qe(n)}function kn(t){if("inline"===t||"popup"===t)return t}function Tn(t,e){t.write(e)}const Bn=kt("ckb");class Fn{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Bn()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("label");n.classList.add(Bn("l")),this.element.appendChild(n),this.labelElement=n;const r=t.createElement("input");r.classList.add(Bn("i")),r.type="checkbox",this.labelElement.appendChild(r),this.inputElement=r,e.viewProps.bindDisabled(this.inputElement);const i=t.createElement("div");i.classList.add(Bn("w")),this.labelElement.appendChild(i);const o=yt(t,"check");i.appendChild(o),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Vn{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Fn(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(t){const e=t.currentTarget;this.value.rawValue=e.checked,t.preventDefault(),t.stopPropagation()}onLabelMouseDown_(t){t.preventDefault()}}const In=ee({id:"input-bool",type:"input",accept:(t,e)=>{if("boolean"!=typeof t)return null;const n=dt(e,t=>({options:t.optional.custom(De),readonly:t.optional.constant(!1)}));return n?{initialValue:t,params:n}:null},binding:{reader:t=>tn,constraint:t=>function(t){const e=[],n=Ue(t.options);return n&&e.push(n),new qe(e)}(t.params),writer:t=>Tn},controller:t=>{const e=t.document,n=t.value,r=t.constraint,i=r&&je(r,Ne);return i?new Ke(e,{props:new b({options:i.values.value("options")}),value:n,viewProps:t.viewProps}):new Vn(e,{value:n,viewProps:t.viewProps})},api:t=>"boolean"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof Ke?new Le(t.controller):null}),zn=kt("col");class Ln{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(zn()),e.foldable.bindExpandedClass(this.element,zn(void 0,"expanded")),Pt(e.foldable,"completed",Kt(this.element,zn(void 0,"cpl")));const n=t.createElement("div");n.classList.add(zn("h")),this.element.appendChild(n);const r=t.createElement("div");r.classList.add(zn("s")),n.appendChild(r),this.swatchElement=r;const i=t.createElement("div");if(i.classList.add(zn("t")),n.appendChild(i),this.textElement=i,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(zn("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}function Rn(t,e,n){const r=H(t,360),i=U(e/100,0,1),o=U(n/100,0,1),s=o*i,a=s*(1-Math.abs(r/60%2-1)),l=o-s;let u,c,d;return[u,c,d]=r>=0&&r<60?[s,a,0]:r>=60&&r<120?[a,s,0]:r>=120&&r<180?[0,s,a]:r>=180&&r<240?[0,a,s]:r>=240&&r<300?[a,0,s]:[s,0,a],[255*(u+l),255*(c+l),255*(d+l)]}function On(t){return[t[0],t[1],t[2]]}function qn(t,e){return[t[0],t[1],t[2],e]}const jn={hsl:{hsl:(t,e,n)=>[t,e,n],hsv:function(t,e,n){const r=n+e*(100-Math.abs(2*n-100))/200;return[t,0!==r?e*(100-Math.abs(2*n-100))/r:0,n+e*(100-Math.abs(2*n-100))/200]},rgb:function(t,e,n){const r=(t%360+360)%360,i=U(e/100,0,1),o=U(n/100,0,1),s=(1-Math.abs(2*o-1))*i,a=s*(1-Math.abs(r/60%2-1)),l=o-s/2;let u,c,d;return[u,c,d]=r>=0&&r<60?[s,a,0]:r>=60&&r<120?[a,s,0]:r>=120&&r<180?[0,s,a]:r>=180&&r<240?[0,a,s]:r>=240&&r<300?[a,0,s]:[s,0,a],[255*(u+l),255*(c+l),255*(d+l)]}},hsv:{hsl:function(t,e,n){const r=100-Math.abs(n*(200-e)/100-100);return[t,0!==r?e*n/r:0,n*(200-e)/200]},hsv:(t,e,n)=>[t,e,n],rgb:Rn},rgb:{hsl:function(t,e,n){const r=U(t/255,0,1),i=U(e/255,0,1),o=U(n/255,0,1),s=Math.max(r,i,o),a=Math.min(r,i,o),l=s-a;let u=0,c=0;const d=(a+s)/2;return 0!==l&&(c=l/(1-Math.abs(s+a-1)),u=r===s?(i-o)/l:i===s?2+(o-r)/l:4+(r-i)/l,u=u/6+(u<0?1:0)),[360*u,100*c,100*d]},hsv:function(t,e,n){const r=U(t/255,0,1),i=U(e/255,0,1),o=U(n/255,0,1),s=Math.max(r,i,o),a=s-Math.min(r,i,o);let l;return l=0===a?0:s===r?((i-o)/a%6+6)%6*60:s===i?60*((o-r)/a+2):60*((r-i)/a+4),[l,100*(0===s?0:a/s),100*s]},rgb:(t,e,n)=>[t,e,n]}};function Nn(t,e){return["float"===e?1:"rgb"===t?255:360,"float"===e?1:"rgb"===t?255:100,"float"===e?1:"rgb"===t?255:100]}function Dn(t,e,n){var r;const i=Nn(e,n);return["rgb"===e?U(t[0],0,i[0]):(o=t[0],s=i[0],o===s?s:H(o,s)),U(t[1],0,i[1]),U(t[2],0,i[2]),U(null!==(r=t[3])&&void 0!==r?r:1,0,1)];var o,s}function Wn(t,e,n,r){const i=Nn(e,n),o=Nn(e,r);return t.map((t,e)=>t/i[e]*o[e])}function Un(t,e,n){const r=Wn(t,e.mode,e.type,"int");return Wn(jn[e.mode][n.mode](...r),n.mode,"int",n.type)}class Hn{static black(){return new Hn([0,0,0],"rgb")}constructor(t,e){this.type="int",this.mode=e,this.comps_=Dn(t,e,this.type)}getComponents(t){return qn(Un(On(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const Gn=kt("colp");class Kn{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(Gn()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Gn("hsv"));const r=t.createElement("div");r.classList.add(Gn("sv")),this.svPaletteView_=e.svPaletteView,r.appendChild(this.svPaletteView_.element),n.appendChild(r);const i=t.createElement("div");i.classList.add(Gn("h")),this.hPaletteView_=e.hPaletteView,i.appendChild(this.hPaletteView_.element),n.appendChild(i),this.element.appendChild(n);const o=t.createElement("div");if(o.classList.add(Gn("rgb")),this.textsView_=e.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const n=t.createElement("div");n.classList.add(Gn("a"));const r=t.createElement("div");r.classList.add(Gn("ap")),r.appendChild(this.alphaViews_.palette.element),n.appendChild(r);const i=t.createElement("div");i.classList.add(Gn("at")),i.appendChild(this.alphaViews_.text.element),n.appendChild(i),this.element.appendChild(n)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function $n(t){return"int"===t?"int":"float"===t?"float":void 0}function Yn(t){return dt(t,t=>({color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom($n)}),expanded:t.optional.boolean,picker:t.optional.custom(kn),readonly:t.optional.constant(!1)}))}function Xn(t){return t?.1:1}function Zn(t){var e;return null===(e=t.color)||void 0===e?void 0:e.type}class Qn{constructor(t,e){this.type="float",this.mode=e,this.comps_=Dn(t,e,this.type)}getComponents(t){return qn(Un(On(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const Jn={int:(t,e)=>new Hn(t,e),float:(t,e)=>new Qn(t,e)};function tr(t,e,n){return Jn[n](t,e)}function er(t,e){if(t.type===e)return t;if(function(t){return"int"===t.type}(t)&&"float"===e)return function(t){const e=t.getComponents(),n=Nn(t.mode,"int");return new Qn([D(e[0],0,n[0],0,1),D(e[1],0,n[1],0,1),D(e[2],0,n[2],0,1),e[3]],t.mode)}(t);if(function(t){return"float"===t.type}(t)&&"int"===e)return function(t){const e=t.getComponents(),n=Nn(t.mode,"int");return new Hn([Math.round(D(e[0],0,1,0,n[0])),Math.round(D(e[1],0,1,0,n[1])),Math.round(D(e[2],0,1,0,n[2])),e[3]],t.mode)}(t);throw c.shouldNeverHappen()}function nr(t,e){const n=t.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*e,e):Math.min(parseFloat(t),e)}const rr={deg:t=>t,grad:t=>360*t/400,rad:t=>360*t/(2*Math.PI),turn:t=>360*t};function ir(t){const e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);const n=parseFloat(e[1]),r=e[2];return rr[r](n)}function or(t){const e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[nr(e[1],255),nr(e[2],255),nr(e[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function sr(t){const e=or(t);return e?new Hn(e,"rgb"):null}function ar(t){const e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[nr(e[1],255),nr(e[2],255),nr(e[3],255),nr(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function lr(t){const e=ar(t);return e?new Hn(e,"rgb"):null}function ur(t){const e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[ir(e[1]),nr(e[2],100),nr(e[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function cr(t){const e=ur(t);return e?new Hn(e,"hsl"):null}function dr(t){const e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[ir(e[1]),nr(e[2],100),nr(e[3],100),nr(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function hr(t){const e=dr(t);return e?new Hn(e,"hsl"):null}function pr(t){const e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const n=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function fr(t){const e=pr(t);return e?new Hn(e,"rgb"):null}function vr(t){const e=t.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),D(parseInt(e[4]+e[4],16),0,255,0,1)];const n=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),D(parseInt(n[4],16),0,255,0,1)]:null}function mr(t){const e=vr(t);return e?new Hn(e,"rgb"):null}function br(t){const e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const n=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function gr(t){return e=>{const n=br(e);return n?tr(n,"rgb",t):null}}function wr(t){const e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const n=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function _r(t){return e=>{const n=wr(e);return n?tr(n,"rgb",t):null}}const yr=[{parser:pr,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:vr,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:or,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:ar,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:ur,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:dr,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:br,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:wr,result:{alpha:!0,mode:"rgb",notation:"object"}}];function xr(t,e="int"){const n=function(t){return yr.reduce((e,{parser:n,result:r})=>e||(n(t)?r:null),null)}(t);return n?"hex"===n.notation&&"float"!==e?Object.assign(Object.assign({},n),{type:"int"}):"func"===n.notation?Object.assign(Object.assign({},n),{type:e}):null:null}function Ar(t){const e=[fr,mr,sr,lr,cr,hr];"int"===t&&e.push(gr("int"),_r("int")),"float"===t&&e.push(gr("float"),_r("float"));const n=function(t){return e=>t.reduce((t,n)=>null!==t?t:n(e),null)}(e);return e=>{const r=n(e);return r?er(r,t):null}}function Er(t){const e=Ar("int");if("string"!=typeof t)return Hn.black();const n=e(t);return null!=n?n:Hn.black()}function Cr(t){const e=U(Math.floor(t),0,255).toString(16);return 1===e.length?"0"+e:e}function Mr(t,e="#"){return`${e}${On(t.getComponents("rgb")).map(Cr).join("")}`}function Pr(t,e="#"){const n=t.getComponents("rgb");return`${e}${[n[0],n[1],n[2],255*n[3]].map(Cr).join("")}`}function Sr(t){const e=N(0);return`rgb(${On(er(t,"int").getComponents("rgb")).map(t=>e(t)).join(", ")})`}function kr(t){const e=N(2),n=N(0);return`rgba(${er(t,"int").getComponents("rgb").map((t,r)=>(3===r?e:n)(t)).join(", ")})`}function Tr(t,e){const n=N("float"===e?2:0),r=["r","g","b"];return`{${On(er(t,e).getComponents("rgb")).map((t,e)=>`${r[e]}: ${n(t)}`).join(", ")}}`}function Br(t){return e=>Tr(e,t)}function Fr(t,e){const n=N(2),r=N("float"===e?2:0),i=["r","g","b","a"];return`{${er(t,e).getComponents("rgb").map((t,e)=>`${i[e]}: ${(3===e?n:r)(t)}`).join(", ")}}`}function Vr(t){return e=>Fr(e,t)}const Ir=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Mr},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Pr},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:Sr},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:kr},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){const e=[N(0),rn,rn];return`hsl(${On(er(t,"int").getComponents("hsl")).map((t,n)=>e[n](t)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){const e=[N(0),rn,rn,N(2)];return`hsla(${er(t,"int").getComponents("hsl").map((t,n)=>e[n](t)).join(", ")})`}},...["int","float"].reduce((t,e)=>[...t,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:Br(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:Vr(e)}],[])];function zr(t){return Ir.reduce((e,n)=>{return e||(r=n.format,i=t,r.alpha===i.alpha&&r.mode===i.mode&&r.notation===i.notation&&r.type===i.type?n.stringifier:null);var r,i},null)}const Lr=kt("apl");class Rr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Lr()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const n=t.createElement("div");n.classList.add(Lr("b")),this.element.appendChild(n);const r=t.createElement("div");r.classList.add(Lr("c")),n.appendChild(r),this.colorElem_=r;const i=t.createElement("div");i.classList.add(Lr("m")),this.element.appendChild(i),this.markerElem_=i;const o=t.createElement("div");o.classList.add(Lr("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const t=this.value.rawValue,e=t.getComponents("rgb"),n=new Hn([e[0],e[1],e[2],0],"rgb"),r=new Hn([e[0],e[1],e[2],255],"rgb"),i=["to right",kr(n),kr(r)];this.colorElem_.style.background=`linear-gradient(${i.join(",")})`,this.previewElem_.style.backgroundColor=kr(t);const o=D(e[3],0,1,0,100);this.markerElem_.style.left=o+"%"}onValueChange_(){this.update_()}}class Or{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Rr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new pn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=t.point.x/t.bounds.width,r=this.value.rawValue,[i,o,s]=r.getComponents("hsv");this.value.setRawValue(new Hn([i,o,s,n],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=ln(Xn(!0),cn(t));if(0===e)return;const n=this.value.rawValue,[r,i,o,s]=n.getComponents("hsv");this.value.setRawValue(new Hn([r,i,o,s+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==ln(Xn(!0),cn(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const qr=kt("coltxt");class jr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(qr()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(qr("m")),this.modeElem_=function(t){const e=t.createElement("select");return e.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce((e,n)=>{const r=t.createElement("option");return r.textContent=n.text,r.value=n.value,e.appendChild(r),e},t.createDocumentFragment())),e}(t),this.modeElem_.classList.add(qr("ms")),n.appendChild(this.modeSelectElement),e.viewProps.bindDisabled(this.modeElem_);const r=t.createElement("div");r.classList.add(qr("mm")),r.appendChild(yt(t,"dropdown")),n.appendChild(r),this.element.appendChild(n);const i=t.createElement("div");i.classList.add(qr("w")),this.element.appendChild(i),this.inputsElem_=i,this.inputViews_=e.inputViews,this.applyInputViews_(),Mt(e.mode,t=>{this.modeElem_.value=t})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(t){this.inputViews_=t,this.applyInputViews_()}applyInputViews_(){Et(this.inputsElem_);const t=this.element.ownerDocument;this.inputViews_.forEach(e=>{const n=t.createElement("div");n.classList.add(qr("c")),n.appendChild(e.element),this.inputsElem_.appendChild(n)})}}function Nr(t,e,n){const r=Nn(t,e)[n];return new g({min:0,max:r})}function Dr(t,e){const n={colorMode:e.colorMode,colorType:e.colorType,parser:O,viewProps:e.viewProps};return[0,1,2].map(r=>{const i=function(t,e,n){return new mn(t,{arrayPosition:0===n?"fst":2===n?"lst":"mid",parser:e.parser,props:b.fromObject({formatter:(r=e.colorType,N("float"===r?2:0)),keyScale:Xn(!1),pointerScale:"float"===e.colorType?.01:1}),value:m(0,{constraint:Nr(e.colorMode,e.colorType,n)}),viewProps:e.viewProps});var r}(t,n,r);return an({primary:e.value,secondary:i.value,forward:t=>er(t,e.colorType).getComponents(e.colorMode)[r],backward(t,n){const i=e.colorMode,o=er(t,e.colorType).getComponents(i);o[r]=n;return er(tr(qn(On(o),o[3]),i,e.colorType),"int")}}),i})}class Wr{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=m(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new jr(t,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e=this.colorMode.rawValue;return function(t){return"hex"!==t}(e)?Dr(t,{colorMode:e,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):function(t,e){const n=new Je(t,{parser:Ar("int"),props:b.fromObject({formatter:Mr}),value:m(Hn.black()),viewProps:e.viewProps});return an({primary:e.value,secondary:n.value,forward:t=>new Hn(On(t.getComponents()),t.mode),backward:(t,e)=>new Hn(qn(On(e.getComponents(t.mode)),t.getComponents()[3]),t.mode)}),[n]}(t,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(t=>t.view)}}const Ur=kt("hpl");class Hr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Ur()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const n=t.createElement("div");n.classList.add(Ur("c")),this.element.appendChild(n);const r=t.createElement("div");r.classList.add(Ur("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=Sr(new Hn([e,100,100],"hsv"));const n=D(e,0,360,0,100);this.markerElem_.style.left=n+"%"}onValueChange_(){this.update_()}}class Gr{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Hr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new pn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=D(U(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),r=this.value.rawValue,[,i,o,s]=r.getComponents("hsv");this.value.setRawValue(new Hn([n,i,o,s],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=ln(Xn(!1),cn(t));if(0===e)return;const n=this.value.rawValue,[r,i,o,s]=n.getComponents("hsv");this.value.setRawValue(new Hn([r+e,i,o,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==ln(Xn(!1),cn(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Kr=kt("svp");class $r{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Kr()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const n=t.createElement("canvas");n.height=64,n.width=64,n.classList.add(Kr("c")),this.element.appendChild(n),this.canvasElement=n;const r=t.createElement("div");r.classList.add(Kr("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const t=function(t){const e=t.ownerDocument.defaultView;return e&&"document"in e?t.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!t)return;const e=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,r=this.canvasElement.height,i=t.getImageData(0,0,n,r),o=i.data;for(let t=0;t<r;t++)for(let i=0;i<n;i++){const s=D(i,0,n,0,100),a=D(t,0,r,100,0),l=Rn(e[0],s,a),u=4*(t*n+i);o[u]=l[0],o[u+1]=l[1],o[u+2]=l[2],o[u+3]=255}t.putImageData(i,0,0);const s=D(e[1],0,100,0,100);this.markerElem_.style.left=s+"%";const a=D(e[2],0,100,100,0);this.markerElem_.style.top=a+"%"}onValueChange_(){this.update_()}}class Yr{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new $r(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new pn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=D(t.point.x,0,t.bounds.width,0,100),r=D(t.point.y,0,t.bounds.height,100,0),[i,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Hn([i,n,r,o],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){dn(t.key)&&t.preventDefault();const[e,n,r,i]=this.value.rawValue.getComponents("hsv"),o=Xn(!1),s=ln(o,cn(t)),a=ln(o,un(t));0===s&&0===a||this.value.setRawValue(new Hn([e,n+s,r+a,i],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=Xn(!1),n=ln(e,cn(t)),r=ln(e,un(t));0===n&&0===r||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Xr{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new Gr(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Yr(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new Or(t,{value:this.value,viewProps:this.viewProps}),text:new mn(t,{parser:O,props:b.fromObject({pointerScale:.01,keyScale:.1,formatter:N(2)}),value:m(0,{constraint:new g({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&an({primary:this.value,secondary:this.alphaIcs_.text.value,forward:t=>t.getComponents()[3],backward:(t,e)=>{const n=t.getComponents();return n[3]=e,new Hn(n,t.mode)}}),this.textsC_=new Wr(t,{colorType:e.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Kn(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const Zr=kt("colsw");class Qr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(Zr()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Zr("sw")),this.element.appendChild(n),this.swatchElem_=n;const r=t.createElement("button");r.classList.add(Zr("b")),e.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=Pr(t)}onValueChange_(){this.update_()}}class Jr{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Qr(t,{value:this.value,viewProps:this.viewProps})}}class ti{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=he.create(e.expanded),this.swatchC_=new Jr(t,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new Je(t,{parser:e.parser,props:b.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Ln(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===e.pickerLayout?new Xe(t,{viewProps:this.viewProps}):null;const r=new Xr(t,{colorType:e.colorType,supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(r.view.element),an({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),fe(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,n=t.relatedTarget;n&&e.contains(n)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,n=Ct(t);n&&e.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!gt(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}}function ei(t){return On(t.getComponents("rgb")).reduce((t,e)=>t<<8|255&Math.floor(e),0)}function ni(t){return t.getComponents("rgb").reduce((t,e,n)=>t<<8|255&Math.floor(3===n?255*e:e),0)>>>0}function ri(t){return"number"!=typeof t?Hn.black():new Hn([(e=t)>>16&255,e>>8&255,255&e],"rgb");var e}function ii(t){return"number"!=typeof t?Hn.black():new Hn([(e=t)>>24&255,e>>16&255,e>>8&255,D(255&e,0,255,0,1)],"rgb");var e}function oi(t,e){return"object"==typeof t&&!r(t)&&(e in t&&"number"==typeof t[e])}function si(t){return oi(t,"r")&&oi(t,"g")&&oi(t,"b")}function ai(t){return si(t)&&oi(t,"a")}function li(t){return si(t)}function ui(t,e){if(t.mode!==e.mode)return!1;if(t.type!==e.type)return!1;const n=t.getComponents(),r=e.getComponents();for(let t=0;t<n.length;t++)if(n[t]!==r[t])return!1;return!0}function ci(t){return"a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b]}function di(t,e){return(n,r)=>{t?function(t,e,n){const r=er(e,n).toRgbaObject();t.writeProperty("r",r.r),t.writeProperty("g",r.g),t.writeProperty("b",r.b),t.writeProperty("a",r.a)}(n,r,e):function(t,e,n){const r=er(e,n).toRgbaObject();t.writeProperty("r",r.r),t.writeProperty("g",r.g),t.writeProperty("b",r.b)}(n,r,e)}}const hi=ee({id:"input-color-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;if(!function(t){return"color"in t||"color"===t.view}(e))return null;const n=Yn(e);return n?{initialValue:t,params:Object.assign(Object.assign({},n),{supportsAlpha:(r=e,!!(null===(i=null==r?void 0:r.color)||void 0===i?void 0:i.alpha))})}:null;var r,i},binding:{reader:t=>t.params.supportsAlpha?ii:ri,equals:ui,writer:t=>function(t){const e=t?ni:ei;return(t,n)=>{Tn(t,e(n))}}(t.params.supportsAlpha)},controller:t=>{var e,n,r;return new ti(t.document,{colorType:"int",expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:(r=t.params.supportsAlpha,r?t=>Pr(t,"0x"):t=>Mr(t,"0x")),parser:Ar("int"),pickerLayout:null!==(n=t.params.picker)&&void 0!==n?n:"popup",supportsAlpha:t.params.supportsAlpha,value:t.value,viewProps:t.viewProps})}});function pi(t){return e=>{const n=function(t,e){if(!li(t))return er(Hn.black(),e);if("int"===e){const e=ci(t);return new Hn(e,"rgb")}if("float"===e){const e=ci(t);return new Qn(e,"rgb")}return er(Hn.black(),"int")}(e,t);return er(n,"int")}}function fi(t,e){return n=>t?Fr(n,e):Tr(n,e)}const vi=ee({id:"input-color-object",type:"input",accept:(t,e)=>{var n;if(!li(t))return null;const r=Yn(e);return r?{initialValue:t,params:Object.assign(Object.assign({},r),{colorType:null!==(n=Zn(e))&&void 0!==n?n:"int"})}:null},binding:{reader:t=>pi(t.params.colorType),equals:ui,writer:t=>di(ai(t.initialValue),t.params.colorType)},controller:t=>{var e,n;const r=ai(t.initialValue);return new ti(t.document,{colorType:t.params.colorType,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:fi(r,t.params.colorType),parser:Ar("int"),pickerLayout:null!==(n=t.params.picker)&&void 0!==n?n:"popup",supportsAlpha:r,value:t.value,viewProps:t.viewProps})}}),mi=ee({id:"input-color-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;if("text"===e.view)return null;const n=xr(t,Zn(e));if(!n)return null;const r=zr(n);if(!r)return null;const i=Yn(e);return i?{initialValue:t,params:Object.assign(Object.assign({},i),{format:n,stringifier:r})}:null},binding:{reader:()=>Er,equals:ui,writer:t=>{const e=function(t){const e=zr(t);return e?(t,n)=>{Tn(t,e(n))}:null}(t.params.format);if(!e)throw c.notBindable();return e}},controller:t=>{var e,n;return new ti(t.document,{colorType:t.params.format.type,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:t.params.stringifier,parser:Ar("int"),pickerLayout:null!==(n=t.params.picker)&&void 0!==n?n:"popup",supportsAlpha:t.params.format.alpha,value:t.value,viewProps:t.viewProps})}});class bi{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map((t,e)=>{var n,r;return null!==(r=null===(n=this.components[e])||void 0===n?void 0:n.constrain(t))&&void 0!==r?r:t});return this.asm_.fromComponents(e)}}const gi=kt("pndtxt");class wi{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(gi()),this.textViews.forEach(e=>{const n=t.createElement("div");n.classList.add(gi("a")),n.appendChild(e.element),this.element.appendChild(n)})}}class _i{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map((n,r)=>function(t,e,n){return new mn(t,{arrayPosition:0===n?"fst":n===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[n].textProps,value:m(0,{constraint:e.axes[n].constraint}),viewProps:e.viewProps})}(t,e,r)),this.acs_.forEach((t,n)=>{an({primary:this.value,secondary:t.value,forward:t=>e.assembly.toComponents(t)[n],backward:(t,r)=>{const i=e.assembly.toComponents(t);return i[n]=r,e.assembly.fromComponents(i)}})}),this.view=new wi(t,{textViews:this.acs_.map(t=>t.view)})}get textControllers(){return this.acs_}}class yi extends st{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}}const xi=ee({id:"input-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;const n=dt(e,t=>Object.assign(Object.assign({},Q(t)),{options:t.optional.custom(De),readonly:t.optional.constant(!1)}));return n?{initialValue:t,params:n}:null},binding:{reader:t=>q,constraint:t=>function(t,e){const n=[],r=Y(t,e);r&&n.push(r);const i=X(t);i&&n.push(i);const o=Ue(t.options);return o&&n.push(o),new qe(n)}(t.params,t.initialValue),writer:t=>Tn},controller:t=>{const e=t.value,n=t.constraint,r=n&&je(n,Ne);if(r)return new Ke(t.document,{props:new b({options:r.values.value("options")}),value:e,viewProps:t.viewProps});const i=Z(t.params,e.rawValue),o=n&&je(n,g);return o?new xn(t.document,Object.assign(Object.assign({},An(Object.assign(Object.assign({},i),{keyScale:m(i.keyScale),max:o.values.value("max"),min:o.values.value("min")}))),{parser:O,value:e,viewProps:t.viewProps})):new mn(t.document,{parser:O,props:b.fromObject(i),value:e,viewProps:t.viewProps})},api:t=>"number"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof xn?new yi(t.controller):t.controller.valueController instanceof Ke?new Le(t.controller):null});class Ai{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(r(t))return!1;const e=t.x,n=t.y;return"number"==typeof e&&"number"==typeof n}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const Ei={toComponents:t=>t.getComponents(),fromComponents:t=>new Ai(...t)},Ci=kt("p2d");class Mi{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ci()),e.viewProps.bindClassModifiers(this.element),Mt(e.expanded,Kt(this.element,Ci(void 0,"expanded")));const n=t.createElement("div");n.classList.add(Ci("h")),this.element.appendChild(n);const r=t.createElement("button");r.classList.add(Ci("b")),r.appendChild(yt(t,"p2dpad")),e.viewProps.bindDisabled(r),n.appendChild(r),this.buttonElement=r;const i=t.createElement("div");if(i.classList.add(Ci("t")),n.appendChild(i),this.textElement=i,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(Ci("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const Pi=kt("p2dp");class Si{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=t.createElement("div"),this.element.classList.add(Pi()),"popup"===e.layout&&this.element.classList.add(Pi(void 0,"p")),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Pi("p")),e.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const r=t.createElementNS(mt,"svg");r.classList.add(Pi("g")),this.padElement.appendChild(r),this.svgElem_=r;const i=t.createElementNS(mt,"line");i.classList.add(Pi("ax")),i.setAttributeNS(null,"x1","0"),i.setAttributeNS(null,"y1","50%"),i.setAttributeNS(null,"x2","100%"),i.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(i);const o=t.createElementNS(mt,"line");o.classList.add(Pi("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const s=t.createElementNS(mt,"line");s.classList.add(Pi("l")),s.setAttributeNS(null,"x1","50%"),s.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(s),this.lineElem_=s;const a=t.createElement("div");a.classList.add(Pi("m")),this.padElement.appendChild(a),this.markerElem_=a,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents(),n=this.props_.get("max"),r=D(t,-n,+n,0,100),i=D(e,-n,+n,0,100),o=this.props_.get("invertsY")?100-i:i;this.lineElem_.setAttributeNS(null,"x2",r+"%"),this.lineElem_.setAttributeNS(null,"y2",o+"%"),this.markerElem_.style.left=r+"%",this.markerElem_.style.top=o+"%"}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function ki(t,e,n){return[ln(e[0],cn(t)),ln(e[1],un(t))*(n?1:-1)]}class Ti{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Si(t,{layout:e.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new pn(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=this.props.get("max"),r=D(t.point.x,0,t.bounds.width,-n,+n),i=D(this.props.get("invertsY")?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-n,+n);this.value.setRawValue(new Ai(r,i),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){dn(t.key)&&t.preventDefault();const[e,n]=ki(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===e&&0===n||this.value.setRawValue(new Ai(this.value.rawValue.x+e,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[e,n]=ki(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===e&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Bi{constructor(t,e){var n,r;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=he.create(e.expanded),this.popC_="popup"===e.pickerLayout?new Xe(t,{viewProps:this.viewProps}):null;const i=new Ti(t,{layout:e.pickerLayout,props:new b({invertsY:m(e.invertsY),max:m(e.max),xKeyScale:e.axes[0].textProps.value("keyScale"),yKeyScale:e.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach(t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=i,this.textC_=new _i(t,{assembly:Ei,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new Mi(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("blur",this.onPadButtonBlur_),null===(r=this.view.buttonElement)||void 0===r||r.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),an({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),fe(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,n=t.relatedTarget;n&&e.contains(n)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,n=Ct(t);n&&e.contains(n)||n&&n===this.view.buttonElement&&!gt(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.view.buttonElement.focus()}}function Fi(t){return Ai.isObject(t)?new Ai(t.x,t.y):new Ai}function Vi(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function Ii(t,e){var n,i;if(!r(t.min)||!r(t.max))return Math.max(Math.abs(null!==(n=t.min)&&void 0!==n?n:0),Math.abs(null!==(i=t.max)&&void 0!==i?i:0));const o=K(t);return Math.max(10*Math.abs(o),10*Math.abs(e))}function zi(t,e){var n,r;const i=Ii(a(t,null!==(n=t.x)&&void 0!==n?n:{}),e.x),o=Ii(a(t,null!==(r=t.y)&&void 0!==r?r:{}),e.y);return Math.max(i,o)}function Li(t){if(!("y"in t))return!1;const e=t.y;return!!e&&("inverted"in e&&!!e.inverted)}const Ri=ee({id:"input-point2d",type:"input",accept:(t,e)=>{if(!Ai.isObject(t))return null;const n=dt(e,t=>Object.assign(Object.assign({},Mn(t)),{expanded:t.optional.boolean,picker:t.optional.custom(kn),readonly:t.optional.constant(!1),x:t.optional.custom(Pn),y:t.optional.object(Object.assign(Object.assign({},Mn(t)),{inverted:t.optional.boolean}))}));return n?{initialValue:t,params:n}:null},binding:{reader:()=>Fi,constraint:t=>{return e=t.params,n=t.initialValue,new bi({assembly:Ei,components:[Sn(Object.assign(Object.assign({},e),e.x),n.x),Sn(Object.assign(Object.assign({},e),e.y),n.y)]});var e,n},equals:Ai.equals,writer:()=>Vi},controller:t=>{var e,n;const r=t.document,i=t.value,o=t.constraint,s=[t.params.x,t.params.y];return new Bi(r,{axes:i.rawValue.getComponents().map((e,n)=>{var r;return J({constraint:o.components[n],initialValue:e,params:a(t.params,null!==(r=s[n])&&void 0!==r?r:{})})}),expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,invertsY:Li(t.params),max:zi(t.params,i.rawValue),parser:O,pickerLayout:null!==(n=t.params.picker)&&void 0!==n?n:"popup",value:i,viewProps:t.viewProps})}});class Oi{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(r(t))return!1;const e=t.x,n=t.y,i=t.z;return"number"==typeof e&&"number"==typeof n&&"number"==typeof i}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const qi={toComponents:t=>t.getComponents(),fromComponents:t=>new Oi(...t)};function ji(t){return Oi.isObject(t)?new Oi(t.x,t.y,t.z):new Oi}function Ni(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}const Di=ee({id:"input-point3d",type:"input",accept:(t,e)=>{if(!Oi.isObject(t))return null;const n=dt(e,t=>Object.assign(Object.assign({},Mn(t)),{readonly:t.optional.constant(!1),x:t.optional.custom(Pn),y:t.optional.custom(Pn),z:t.optional.custom(Pn)}));return n?{initialValue:t,params:n}:null},binding:{reader:t=>ji,constraint:t=>{return e=t.params,n=t.initialValue,new bi({assembly:qi,components:[Sn(Object.assign(Object.assign({},e),e.x),n.x),Sn(Object.assign(Object.assign({},e),e.y),n.y),Sn(Object.assign(Object.assign({},e),e.z),n.z)]});var e,n},equals:Oi.equals,writer:t=>Ni},controller:t=>{const e=t.value,n=t.constraint,r=[t.params.x,t.params.y,t.params.z];return new _i(t.document,{assembly:qi,axes:e.rawValue.getComponents().map((e,i)=>{var o;return J({constraint:n.components[i],initialValue:e,params:a(t.params,null!==(o=r[i])&&void 0!==o?o:{})})}),parser:O,value:e,viewProps:t.viewProps})}});class Wi{constructor(t=0,e=0,n=0,r=0){this.x=t,this.y=e,this.z=n,this.w=r}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(r(t))return!1;const e=t.x,n=t.y,i=t.z,o=t.w;return"number"==typeof e&&"number"==typeof n&&"number"==typeof i&&"number"==typeof o}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Ui={toComponents:t=>t.getComponents(),fromComponents:t=>new Wi(...t)};function Hi(t){return Wi.isObject(t)?new Wi(t.x,t.y,t.z,t.w):new Wi}function Gi(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}const Ki=ee({id:"input-point4d",type:"input",accept:(t,e)=>{if(!Wi.isObject(t))return null;const n=dt(e,t=>Object.assign(Object.assign({},Mn(t)),{readonly:t.optional.constant(!1),w:t.optional.custom(Pn),x:t.optional.custom(Pn),y:t.optional.custom(Pn),z:t.optional.custom(Pn)}));return n?{initialValue:t,params:n}:null},binding:{reader:t=>Hi,constraint:t=>{return e=t.params,n=t.initialValue,new bi({assembly:Ui,components:[Sn(Object.assign(Object.assign({},e),e.x),n.x),Sn(Object.assign(Object.assign({},e),e.y),n.y),Sn(Object.assign(Object.assign({},e),e.z),n.z),Sn(Object.assign(Object.assign({},e),e.w),n.w)]});var e,n},equals:Wi.equals,writer:t=>Gi},controller:t=>{const e=t.value,n=t.constraint,r=[t.params.x,t.params.y,t.params.z,t.params.w];return new _i(t.document,{assembly:Ui,axes:e.rawValue.getComponents().map((e,i)=>{var o;return J({constraint:n.components[i],initialValue:e,params:a(t.params,null!==(o=r[i])&&void 0!==o?o:{})})}),parser:O,value:e,viewProps:t.viewProps})}});const $i=ee({id:"input-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;const n=dt(e,t=>({readonly:t.optional.constant(!1),options:t.optional.custom(De)}));return n?{initialValue:t,params:n}:null},binding:{reader:t=>on,constraint:t=>function(t){const e=[],n=Ue(t.options);return n&&e.push(n),new qe(e)}(t.params),writer:t=>Tn},controller:t=>{const e=t.document,n=t.value,r=t.constraint,i=r&&je(r,Ne);return i?new Ke(e,{props:new b({options:i.values.value("options")}),value:n,viewProps:t.viewProps}):new Je(e,{parser:t=>t,props:b.fromObject({formatter:sn}),value:n,viewProps:t.viewProps})},api:t=>"string"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof Ke?new Le(t.controller):null}),Yi={defaultInterval:200,defaultRows:3},Xi=kt("mll");class Zi{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Xi()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("textarea");n.classList.add(Xi("i")),n.style.height=`calc(var(${Cn("containerUnitSize")}) * ${e.rows})`,n.readOnly=!0,e.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,n=[];this.value.rawValue.forEach(t=>{void 0!==t&&n.push(this.formatter_(t))}),t.textContent=n.join("\n"),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class Qi{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Zi(t,{formatter:e.formatter,rows:e.rows,value:this.value,viewProps:this.viewProps})}}const Ji=kt("sgl");class to{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Ji()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("input");n.classList.add(Ji("i")),n.readOnly=!0,n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=void 0!==e?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class eo{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new to(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const no=ee({id:"monitor-bool",type:"monitor",accept:(t,e)=>{if("boolean"!=typeof t)return null;const n=dt(e,t=>({readonly:t.required.constant(!0),rows:t.optional.number}));return n?{initialValue:t,params:n}:null},binding:{reader:t=>tn},controller:t=>{var e;return 1===t.value.rawValue.length?new eo(t.document,{formatter:en,value:t.value,viewProps:t.viewProps}):new Qi(t.document,{formatter:en,rows:null!==(e=t.params.rows)&&void 0!==e?e:Yi.defaultRows,value:t.value,viewProps:t.viewProps})}});class ro extends st{get max(){return this.controller.valueController.props.get("max")}set max(t){this.controller.valueController.props.set("max",t)}get min(){return this.controller.valueController.props.get("min")}set min(t){this.controller.valueController.props.set("min",t)}}const io=kt("grl");class oo{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(io()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.props_=e.props,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=t.createElementNS(mt,"svg");n.classList.add(io("g")),n.style.height=`calc(var(${Cn("containerUnitSize")}) * ${e.rows})`,this.element.appendChild(n),this.svgElem_=n;const r=t.createElementNS(mt,"polyline");this.svgElem_.appendChild(r),this.lineElem_=r;const i=t.createElement("div");i.classList.add(io("t"),kt("tt")()),this.element.appendChild(i),this.tooltipElem_=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:t,clientHeight:e}=this.element,n=this.value.rawValue.length-1,r=this.props_.get("min"),i=this.props_.get("max"),o=[];this.value.rawValue.forEach((s,a)=>{if(void 0===s)return;const l=D(a,0,n,0,t),u=D(s,r,i,e,0);o.push([l,u].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const s=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(void 0===a)return void s.classList.remove(io("t","a"));const l=D(this.cursor_.rawValue,0,n,0,t),u=D(a,r,i,e,0);s.style.left=l+"px",s.style.top=u+"px",s.textContent=""+this.formatter_(a),s.classList.contains(io("t","a"))||(s.classList.add(io("t","a"),io("t","in")),bt(s),s.classList.remove(io("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class so{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.cursor_=m(-1),this.view=new oo(t,{cursor:this.cursor_,formatter:e.formatter,rows:e.rows,props:this.props,value:this.value,viewProps:this.viewProps}),gt(t)){const t=new pn(this.view.element);t.emitter.on("down",this.onGraphPointerDown_),t.emitter.on("move",this.onGraphPointerMove_),t.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}importProps(t){return ht(t,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return pt(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){const{clientWidth:e}=this.view.element;this.cursor_.rawValue=Math.floor(D(t.offsetX,0,e,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){t.data.point?this.cursor_.rawValue=Math.floor(D(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function ao(t){return r(t.format)?N(2):t.format}function lo(t){return"graph"===t.view}const uo=ee({id:"monitor-number",type:"monitor",accept:(t,e)=>{if("number"!=typeof t)return null;const n=dt(e,t=>({format:t.optional.function,max:t.optional.number,min:t.optional.number,readonly:t.required.constant(!0),rows:t.optional.number,view:t.optional.string}));return n?{initialValue:t,params:n}:null},binding:{defaultBufferSize:t=>lo(t)?64:1,reader:t=>q},controller:t=>lo(t.params)?function(t){var e,n,r;return new so(t.document,{formatter:ao(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:Yi.defaultRows,props:b.fromObject({max:null!==(n=t.params.max)&&void 0!==n?n:100,min:null!==(r=t.params.min)&&void 0!==r?r:0}),value:t.value,viewProps:t.viewProps})}(t):function(t){var e;return 1===t.value.rawValue.length?new eo(t.document,{formatter:ao(t.params),value:t.value,viewProps:t.viewProps}):new Qi(t.document,{formatter:ao(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:Yi.defaultRows,value:t.value,viewProps:t.viewProps})}(t),api:t=>t.controller.valueController instanceof so?new ro(t.controller):null}),co=ee({id:"monitor-string",type:"monitor",accept:(t,e)=>{if("string"!=typeof t)return null;const n=dt(e,t=>({multiline:t.optional.boolean,readonly:t.required.constant(!0),rows:t.optional.number}));return n?{initialValue:t,params:n}:null},binding:{reader:t=>on},controller:t=>{var e;const n=t.value;return n.rawValue.length>1||t.params.multiline?new Qi(t.document,{formatter:sn,rows:null!==(e=t.params.rows)&&void 0!==e?e:Yi.defaultRows,value:n,viewProps:t.viewProps}):new eo(t.document,{formatter:sn,value:n,viewProps:t.viewProps})}});class ho{constructor(t){this.target=t.target,this.reader_=t.reader,this.writer_=t.writer}read(){return this.reader_(this.target.read())}write(t){this.writer_(this.target,t)}inject(t){this.write(this.reader_(t))}}class po{constructor(t){this.target=t.target,this.reader_=t.reader}read(){return this.reader_(this.target.read())}}function fo(t,e){return 0===e?new Re:new Oe(t,null!=e?e:Yi.defaultInterval)}class vo{constructor(t){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=t}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t,e){if(!(n=e.core)||n.major!==te.major)throw c.notCompatible(t,e.id);var n;"blade"===e.type?this.pluginsMap_.blades.unshift(e):"input"===e.type?this.pluginsMap_.inputs.unshift(e):"monitor"===e.type&&this.pluginsMap_.monitors.unshift(e)}createInput_(t,e,n){return this.pluginsMap_.inputs.reduce((i,o)=>null!=i?i:function(t,e){var n;const i=t.accept(e.target.read(),e.params);if(r(i))return null;const o={target:e.target,initialValue:i.initialValue,params:i.params},s=dt(e.params,t=>({disabled:t.optional.boolean,hidden:t.optional.boolean,label:t.optional.string,tag:t.optional.string})),a=t.binding.reader(o),l=t.binding.constraint?t.binding.constraint(o):void 0,u=new ho({reader:a,target:e.target,writer:t.binding.writer(o)}),c=new at(m(a(i.initialValue),{constraint:l,equals:t.binding.equals}),u),d=t.controller({constraint:l,document:e.document,initialValue:i.initialValue,params:i.params,value:c,viewProps:xe.create({disabled:null==s?void 0:s.disabled,hidden:null==s?void 0:s.hidden})});return new qt(e.document,{blade:de(),props:b.fromObject({label:"label"in e.params?null!==(n=null==s?void 0:s.label)&&void 0!==n?n:null:e.target.key}),tag:null==s?void 0:s.tag,value:c,valueController:d})}(o,{document:t,target:e,params:n}),null)}createMonitor_(t,e,n){return this.pluginsMap_.monitors.reduce((i,o)=>null!=i?i:function(t,e){var n,i,o;const s=t.accept(e.target.read(),e.params);if(r(s))return null;const a={target:e.target,initialValue:s.initialValue,params:s.params},l=dt(e.params,t=>({bufferSize:t.optional.number,disabled:t.optional.boolean,hidden:t.optional.boolean,interval:t.optional.number,label:t.optional.string})),u=t.binding.reader(a),c=null!==(i=null!==(n=null==l?void 0:l.bufferSize)&&void 0!==n?n:t.binding.defaultBufferSize&&t.binding.defaultBufferSize(s.params))&&void 0!==i?i:1,d=new Wt({binding:new po({reader:u,target:e.target}),bufferSize:c,ticker:fo(e.document,null==l?void 0:l.interval)}),h=t.controller({document:e.document,params:s.params,value:d,viewProps:xe.create({disabled:null==l?void 0:l.disabled,hidden:null==l?void 0:l.hidden})});return h.viewProps.bindDisabled(d.ticker),h.viewProps.handleDispose(()=>{d.ticker.dispose()}),new Ut(e.document,{blade:de(),props:b.fromObject({label:"label"in e.params?null!==(o=null==l?void 0:l.label)&&void 0!==o?o:null:e.target.key}),value:d,valueController:h})}(o,{document:t,params:n,target:e}),null)}createBinding(t,e,n){if(r(e.read()))throw new c({context:{key:e.key},type:"nomatchingcontroller"});const i=this.createInput_(t,e,n);if(i)return i;const o=this.createMonitor_(t,e,n);if(o)return o;throw new c({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){const n=this.pluginsMap_.blades.reduce((n,r)=>null!=n?n:function(t,e){const n=t.accept(e.params);if(!n)return null;const r=dt(e.params,t=>({disabled:t.optional.boolean,hidden:t.optional.boolean}));return t.controller({blade:de(),document:e.document,params:Object.assign(Object.assign({},n.params),{disabled:null==r?void 0:r.disabled,hidden:null==r?void 0:r.hidden}),viewProps:xe.create({disabled:null==r?void 0:r.disabled,hidden:null==r?void 0:r.hidden})})}(r,{document:t,params:e}),null);if(!n)throw new c({type:"nomatchingview",context:{params:e}});return n}createInputBindingApi_(t){const e=this.pluginsMap_.inputs.reduce((e,n)=>{var r,i;return e||(null!==(i=null===(r=n.api)||void 0===r?void 0:r.call(n,{controller:t}))&&void 0!==i?i:null)},null);return this.apiCache_.add(t,null!=e?e:new st(t))}createMonitorBindingApi_(t){const e=this.pluginsMap_.monitors.reduce((e,n)=>{var r,i;return e||(null!==(i=null===(r=n.api)||void 0===r?void 0:r.call(n,{controller:t}))&&void 0!==i?i:null)},null);return this.apiCache_.add(t,null!=e?e:new st(t))}createBindingApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(jt(t))return this.createInputBindingApi_(t);if(Ht(t))return this.createMonitorBindingApi_(t);throw c.shouldNeverHappen()}createApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(function(t){return ft(t)&&vt(t.value)}(t))return this.createBindingApi(t);const e=this.pluginsMap_.blades.reduce((e,n)=>null!=e?e:n.api({controller:t,pool:this}),null);if(!e)throw c.shouldNeverHappen();return this.apiCache_.add(t,e)}}const mo=new class{constructor(){this.map_=new Map}get(t){var e;return null!==(e=this.map_.get(t))&&void 0!==e?e:null}has(t){return this.map_.has(t)}add(t,e){return this.map_.set(t,e),t.viewProps.handleDispose(()=>{this.map_.delete(t)}),e}};class bo extends tt{constructor(t){super(t),this.emitter_=new h,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new nt(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,t=>{n(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}class go extends tt{}class wo extends tt{constructor(t){super(t),this.emitter_=new h,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new nt(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,t=>{n(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}class _o extends tt{constructor(t){super(t),this.emitter_=new h,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new nt(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(t){this.controller.valueController.props.set("formatter",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,t=>{n(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}const yo={id:"list",type:"blade",core:te,accept(t){const e=dt(t,t=>({options:t.required.custom(De),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}));return e?{params:e}:null},controller(t){const e=new Ne(We(t.params.options)),n=m(t.params.value,{constraint:e}),r=new Ke(t.document,{props:new b({options:e.values.value("options")}),value:n,viewProps:t.viewProps});return new Lt(t.document,{blade:t.blade,props:b.fromObject({label:t.params.label}),value:n,valueController:r})},api:t=>t.controller instanceof Lt&&t.controller.valueController instanceof Ke?new bo(t.controller):null};class xo extends ve{constructor(t,e){super(t,e)}get element(){return this.controller.view.element}}class Ao extends ge{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}const Eo=kt("spr");class Co{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Eo()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("hr");n.classList.add(Eo("r")),this.element.appendChild(n)}}class Mo extends zt{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new Co(t,{viewProps:e.viewProps})}))}}const Po={id:"separator",type:"blade",core:te,accept(t){const e=dt(t,t=>({view:t.required.constant("separator")}));return e?{params:e}:null},controller:t=>new Mo(t.document,{blade:t.blade,viewProps:t.viewProps}),api:t=>t.controller instanceof Mo?new go(t.controller):null},So={id:"slider",type:"blade",core:te,accept(t){const e=dt(t,t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}));return e?{params:e}:null},controller(t){var e,n;const r=null!==(e=t.params.value)&&void 0!==e?e:0,i=new g({max:t.params.max,min:t.params.min}),o=m(r,{constraint:i}),s=new xn(t.document,Object.assign(Object.assign({},An({formatter:null!==(n=t.params.format)&&void 0!==n?n:j,keyScale:m(1),max:i.values.value("max"),min:i.values.value("min"),pointerScale:$(t.params,r)})),{parser:O,value:o,viewProps:t.viewProps}));return new Lt(t.document,{blade:t.blade,props:b.fromObject({label:t.params.label}),value:o,valueController:s})},api:t=>t.controller instanceof Lt&&t.controller.valueController instanceof xn?new wo(t.controller):null},ko={id:"text",type:"blade",core:te,accept(t){const e=dt(t,t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}));return e?{params:e}:null},controller(t){var e;const n=m(t.params.value),r=new Je(t.document,{parser:t.params.parse,props:b.fromObject({formatter:null!==(e=t.params.format)&&void 0!==e?e:t=>String(t)}),value:n,viewProps:t.viewProps});return new Lt(t.document,{blade:t.blade,props:b.fromObject({label:t.params.label}),value:n,valueController:r})},api:t=>t.controller instanceof Lt&&t.controller.valueController instanceof Je?new _o(t.controller):null};class To extends xo{constructor(t){var e,n;const r=null!=t?t:{},i=null!==(e=r.document)&&void 0!==e?e:wt(),o=function(){const t=new vo(mo);return[Ri,Di,Ki,$i,xi,mi,vi,hi,In,no,co,uo,ne,we,ze].forEach(e=>{t.register("core",e)}),t}();super(new Ao(i,{expanded:r.expanded,blade:de(),props:b.fromObject({title:r.title}),viewProps:xe.create()}),o),this.pool_=o,this.containerElem_=null!==(n=r.container)&&void 0!==n?n:function(t){const e=t.createElement("div");return e.classList.add(kt("dfw")()),t.body&&t.body.appendChild(e),e}(i),this.containerElem_.appendChild(this.element),this.doc_=i,this.usesDefaultWrapper_=!r.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw c.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw c.alreadyDisposed();if(this.usesDefaultWrapper_){const e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){t.css&&function(t,e,n){if(t.querySelector(`style[data-tp-style=${e}]`))return;const r=t.createElement("style");r.dataset.tpStyle=e,r.textContent=n,t.head.appendChild(r)}(this.document,"plugin-"+t.id,t.css);("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach(e=>{this.pool_.register(t.id,e)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[yo,Po,So,ze,ko]})}}const Bo=new Jt("4.0.3")},45:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n}}]);
//# sourceMappingURL=vendors~main.chunk.js.map